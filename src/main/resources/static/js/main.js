function intersectObject(e,t,r,i,n){if(e.visible&&!(e instanceof CLOUD.Group&&e.fileId&&n.hasFileFilter(e.fileId))){var o=e.raycast(t,r);if(i===!0&&e.children){var a=e.children;if(a.length>0&&!o)return;for(var s=0,h=a.length;h>s;s++)intersectObject(a[s],t,r,!0,n)}}}var THREE={REVISION:"73"};"function"==typeof define&&define.amd?define("three",THREE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=THREE),void 0!==self.requestAnimationFrame&&void 0!==self.cancelAnimationFrame||!function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!self.requestAnimationFrame;++r)self.requestAnimationFrame=self[t[r]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[r]+"CancelAnimationFrame"]||self[t[r]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var r=Date.now(),i=Math.max(0,16-(r-e)),n=self.setTimeout(function(){t(r+i)},i);return e=r+i,n}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),void 0===self.performance&&(self.performance={}),void 0===self.performance.now&&!function(){var e=Date.now();self.performance.now=function(){return Date.now()-e}}(),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:e>0?1:+e}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.MinEquation=103,THREE.MaxEquation=104,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.NeverDepth=0,THREE.AlwaysDepth=1,THREE.LessDepth=2,THREE.LessEqualDepth=3,THREE.EqualDepth=4,THREE.GreaterEqualDepth=5,THREE.GreaterDepth=6,THREE.NotEqualDepth=7,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=300,THREE.CubeReflectionMapping=301,THREE.CubeRefractionMapping=302,THREE.EquirectangularReflectionMapping=303,THREE.EquirectangularRefractionMapping=304,THREE.SphericalReflectionMapping=305,THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.HalfFloatType=1025,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGBEFormat=THREE.RGBAFormat,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.RGB_PVRTC_4BPPV1_Format=2100,THREE.RGB_PVRTC_2BPPV1_Format=2101,THREE.RGBA_PVRTC_4BPPV1_Format=2102,THREE.RGBA_PVRTC_2BPPV1_Format=2103,THREE.LoopOnce=2200,THREE.LoopRepeat=2201,THREE.LoopPingPong=2202,THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},THREE.Color=function(e){return 3===arguments.length?this.fromArray(arguments):this.set(e)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e}return function(t,r,i){if(t=THREE.Math.euclideanModulo(t,1),r=THREE.Math.clamp(r,0,1),i=THREE.Math.clamp(i,0,1),0===r)this.r=this.g=this.b=i;else{var n=.5>=i?i*(1+r):i+r-i*r,o=2*i-n;this.r=e(o,n,t+1/3),this.g=e(o,n,t),this.b=e(o,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,n=r[1],o=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,h=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(a,s,h)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=r[1],l=c.length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(e&&e.length>0){var c=THREE.ColorKeywords[e];void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,i=e||{h:0,s:0,l:0},n=this.r,o=this.g,a=this.b,s=Math.max(n,o,a),h=Math.min(n,o,a),c=(h+s)/2;if(h===s)t=0,r=0;else{var l=s-h;switch(r=.5>=c?l/(s+h):l/(2-s-h),s){case n:t=(o-a)/l+(a>o?6:0);break;case o:t=(a-n)/l+2;break;case a:t=(n-o)/l+4}t/=6}return i.h=t,i.s=r,i.l=c,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),i=Math.cos(e._y/2),n=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2),h=e.order;return"XYZ"===h?(this._x=o*i*n+r*a*s,this._y=r*a*n-o*i*s,this._z=r*i*s+o*a*n,this._w=r*i*n-o*a*s):"YXZ"===h?(this._x=o*i*n+r*a*s,this._y=r*a*n-o*i*s,this._z=r*i*s-o*a*n,this._w=r*i*n+o*a*s):"ZXY"===h?(this._x=o*i*n-r*a*s,this._y=r*a*n+o*i*s,this._z=r*i*s+o*a*n,this._w=r*i*n-o*a*s):"ZYX"===h?(this._x=o*i*n-r*a*s,this._y=r*a*n+o*i*s,this._z=r*i*s-o*a*n,this._w=r*i*n+o*a*s):"YZX"===h?(this._x=o*i*n+r*a*s,this._y=r*a*n+o*i*s,this._z=r*i*s-o*a*n,this._w=r*i*n-o*a*s):"XZY"===h&&(this._x=o*i*n-r*a*s,this._y=r*a*n-o*i*s,this._z=r*i*s+o*a*n,this._w=r*i*n+o*a*s),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],h=r[9],c=r[2],l=r[6],u=r[10],d=i+s+u;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(l-h)*t,this._y=(o-c)*t,this._z=(a-n)*t):i>s&&i>u?(t=2*Math.sqrt(1+i-s-u),this._w=(l-h)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+c)/t):s>u?(t=2*Math.sqrt(1+s-i-u),this._w=(o-c)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(h+l)/t):(t=2*Math.sqrt(1+u-i-s),this._w=(a-n)/t,this._x=(o+c)/t,this._y=(h+l)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(i,n){return void 0===e&&(e=new THREE.Vector3),t=i.dot(n)+1,r>t?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,o=e._w,a=t._x,s=t._y,h=t._z,c=t._w;return this._x=r*c+o*a+i*h-n*s,this._y=i*c+o*s+n*a-r*h,this._z=n*c+o*h+r*s-i*a,this._w=o*c-r*a-i*s-n*h,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,o=this._w,a=o*e._w+r*e._x+i*e._y+n*e._z;if(0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=n,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(n+this._z),this;var c=Math.sin((1-t)*s)/h,l=Math.sin(t*s)/h;return this._w=o*c+this._w*l,this._x=r*c+this._x*l,this._y=i*c+this._y*l,this._z=n*c+this._z*l,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},THREE.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(r,r),t.set(i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*r-o*i+e.x,this.y=n*i+o*r+e.y,this}},THREE.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,h=s*t+o*i-a*r,c=s*r+a*t-n*i,l=s*i+n*r-o*t,u=-n*t-o*r-a*i;return this.x=h*s+u*-n+c*-a-l*-o,this.y=c*s+u*-o+l*-n-h*-a,this.z=l*s+u*-a+h*-o-c*-n,this},project:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-n*a,this.y=n*o-r*s,this.z=r*a-i*o,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new THREE.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},THREE.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=.01,a=.1,s=e.elements,h=s[0],c=s[4],l=s[8],u=s[1],d=s[5],m=s[9],p=s[2],E=s[6],f=s[10];if(Math.abs(c-u)<o&&Math.abs(l-p)<o&&Math.abs(m-E)<o){if(Math.abs(c+u)<a&&Math.abs(l+p)<a&&Math.abs(m+E)<a&&Math.abs(h+d+f-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var T=(h+1)/2,v=(d+1)/2,g=(f+1)/2,y=(c+u)/4,R=(l+p)/4,_=(m+E)/4;return T>v&&T>g?o>T?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(T),
i=y/r,n=R/r):v>g?o>v?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(v),r=y/i,n=_/i):o>g?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(g),r=R/n,i=_/n),this.set(r,i,n,t),this}var x=Math.sqrt((E-m)*(E-m)+(l-p)*(l-p)+(u-c)*(u-c));return Math.abs(x)<.001&&(x=1),this.x=(E-m)/x,this.y=(l-p)/x,this.z=(u-c)/x,this.w=Math.acos((h+d+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},THREE.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=THREE.Math.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],h=n[1],c=n[5],l=n[9],u=n[2],d=n[6],m=n[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-l,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(s,m),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-u,m),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(h,o))):"ZYX"===t?(this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(d,m),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(s,m))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-l,m),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,r!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,i),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new THREE.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var n=t.dot(t),o=t.dot(e),a=o/n;return i&&(a=THREE.Math.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),n=r||new THREE.Vector3;return this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-(1/0),-(1/0))},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){var r=t||new THREE.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){var r=t||new THREE.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-(1/0),-(1/0),-(1/0))},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var i=t.geometry;if(void 0!==i)if(i instanceof THREE.Geometry)for(var n=i.vertices,o=0,a=n.length;a>o;o++)e.copy(n[o]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e);else if(i instanceof THREE.BufferGeometry&&void 0!==i.attributes.position)for(var s=i.attributes.position.array,o=0,a=s.length;a>o;o+=3)e.set(s[o],s[o+1],s[o+2]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e)}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){var r=t||new THREE.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){var r=t||new THREE.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var r=t||new THREE.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,r,i,n,o,a,s,h){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=i,c[4]=n,c[7]=o,c[2]=a,c[5]=s,c[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length);for(var n=0,o=r;i>n;n+=3,o+=3)e.fromArray(t,o),e.applyMatrix3(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length/t.itemSize);for(var n=0,o=r;i>n;n++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix3(this),t.setXYZ(e.x,e.y,e.z);return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],h=e[7],c=e[8];return t*o*c-t*a*h-r*n*c+r*a*s+i*n*h-i*o*s},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}},THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,r,i,n,o,a,s,h,c,l,u,d,m,p,E){var f=this.elements;return f[0]=e,f[4]=t,f[8]=r,f[12]=i,f[1]=n,f[5]=o,f[9]=a,f[13]=s,f[2]=h,f[6]=c,f[10]=l,f[14]=u,f[3]=d,f[7]=m,f[11]=p,f[15]=E,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),r.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){void 0===e&&(e=new THREE.Vector3);var r=this.elements,i=t.elements,n=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[4]=i[4]*o,r[5]=i[5]*o,r[6]=i[6]*o,r[8]=i[8]*a,r[9]=i[9]*a,r[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof THREE.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,n=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(i),h=Math.sin(i),c=Math.cos(n),l=Math.sin(n);if("XYZ"===e.order){var u=o*c,d=o*l,m=a*c,p=a*l;t[0]=s*c,t[4]=-s*l,t[8]=h,t[1]=d+m*h,t[5]=u-p*h,t[9]=-a*s,t[2]=p-u*h,t[6]=m+d*h,t[10]=o*s}else if("YXZ"===e.order){var E=s*c,f=s*l,T=h*c,v=h*l;t[0]=E+v*a,t[4]=T*a-f,t[8]=o*h,t[1]=o*l,t[5]=o*c,t[9]=-a,t[2]=f*a-T,t[6]=v+E*a,t[10]=o*s}else if("ZXY"===e.order){var E=s*c,f=s*l,T=h*c,v=h*l;t[0]=E-v*a,t[4]=-o*l,t[8]=T+f*a,t[1]=f+T*a,t[5]=o*c,t[9]=v-E*a,t[2]=-o*h,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){var u=o*c,d=o*l,m=a*c,p=a*l;t[0]=s*c,t[4]=m*h-d,t[8]=u*h+p,t[1]=s*l,t[5]=p*h+u,t[9]=d*h-m,t[2]=-h,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var g=o*s,y=o*h,R=a*s,_=a*h;t[0]=s*c,t[4]=_-g*l,t[8]=R*l+y,t[1]=l,t[5]=o*c,t[9]=-a*c,t[2]=-h*c,t[6]=y*l+R,t[10]=g-_*l}else if("XZY"===e.order){var g=o*s,y=o*h,R=a*s,_=a*h;t[0]=s*c,t[4]=-l,t[8]=h*c,t[1]=g*l+_,t[5]=o*c,t[9]=y*l-R,t[2]=R*l-y,t[6]=a*c,t[10]=_*l+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,o=e.w,a=r+r,s=i+i,h=n+n,c=r*a,l=r*s,u=r*h,d=i*s,m=i*h,p=n*h,E=o*a,f=o*s,T=o*h;return t[0]=1-(d+p),t[4]=l-T,t[8]=u+f,t[1]=l+T,t[5]=1-(c+p),t[9]=m-E,t[2]=u-f,t[6]=m+E,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,r;return function(i,n,o){void 0===e&&(e=new THREE.Vector3),void 0===t&&(t=new THREE.Vector3),void 0===r&&(r=new THREE.Vector3);var a=this.elements;return r.subVectors(i,n).normalize(),0===r.lengthSq()&&(r.z=1),e.crossVectors(o,r).normalize(),0===e.lengthSq()&&(r.x+=1e-4,e.crossVectors(o,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[4],s=r[8],h=r[12],c=r[1],l=r[5],u=r[9],d=r[13],m=r[2],p=r[6],E=r[10],f=r[14],T=r[3],v=r[7],g=r[11],y=r[15],R=i[0],_=i[4],x=i[8],b=i[12],H=i[1],C=i[5],S=i[9],M=i[13],w=i[2],D=i[6],A=i[10],L=i[14],O=i[3],U=i[7],I=i[11],P=i[15];return n[0]=o*R+a*H+s*w+h*O,n[4]=o*_+a*C+s*D+h*U,n[8]=o*x+a*S+s*A+h*I,n[12]=o*b+a*M+s*L+h*P,n[1]=c*R+l*H+u*w+d*O,n[5]=c*_+l*C+u*D+d*U,n[9]=c*x+l*S+u*A+d*I,n[13]=c*b+l*M+u*L+d*P,n[2]=m*R+p*H+E*w+f*O,n[6]=m*_+p*C+E*D+f*U,n[10]=m*x+p*S+E*A+f*I,n[14]=m*b+p*M+E*L+f*P,n[3]=T*R+v*H+g*w+y*O,n[7]=T*_+v*C+g*D+y*U,n[11]=T*x+v*S+g*A+y*I,n[15]=T*b+v*M+g*L+y*P,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length);for(var n=0,o=r;i>n;n+=3,o+=3)e.fromArray(t,o),e.applyMatrix4(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length/t.itemSize);for(var n=0,o=r;i>n;n++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix4(this),t.setXYZ(e.x,e.y,e.z);return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],h=e[13],c=e[2],l=e[6],u=e[10],d=e[14],m=e[3],p=e[7],E=e[11],f=e[15];return m*(+n*s*l-i*h*l-n*a*u+r*h*u+i*a*d-r*s*d)+p*(+t*s*d-t*h*u+n*o*u-i*o*d+i*h*c-n*s*c)+E*(+t*h*l-t*a*d-n*o*l+r*o*d+n*a*c-r*h*c)+f*(-i*a*c-t*s*l+t*a*u+i*o*l-r*o*u+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e;return function(){void 0===e&&(e=new THREE.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],o=i[4],a=i[8],s=i[12],h=i[1],c=i[5],l=i[9],u=i[13],d=i[2],m=i[6],p=i[10],E=i[14],f=i[3],T=i[7],v=i[11],g=i[15];r[0]=l*E*T-u*p*T+u*m*v-c*E*v-l*m*g+c*p*g,r[4]=s*p*T-a*E*T-s*m*v+o*E*v+a*m*g-o*p*g,r[8]=a*u*T-s*l*T+s*c*v-o*u*v-a*c*g+o*l*g,r[12]=s*l*m-a*u*m-s*c*p+o*u*p+a*c*E-o*l*E,r[1]=u*p*f-l*E*f-u*d*v+h*E*v+l*d*g-h*p*g,r[5]=a*E*f-s*p*f+s*d*v-n*E*v-a*d*g+n*p*g,r[9]=s*l*f-a*u*f-s*h*v+n*u*v+a*h*g-n*l*g,r[13]=a*u*d-s*l*d+s*h*p-n*u*p-a*h*E+n*l*E,r[2]=c*E*f-u*m*f+u*d*T-h*E*T-c*d*g+h*m*g,r[6]=s*m*f-o*E*f-s*d*T+n*E*T+o*d*g-n*m*g,r[10]=o*u*f-s*c*f+s*h*T-n*u*T-o*h*g+n*c*g,r[14]=s*c*d-o*u*d-s*h*m+n*u*m+o*h*E-n*c*E,r[3]=l*m*f-c*p*f-l*d*T+h*p*T+c*d*v-h*m*v,r[7]=o*p*f-a*m*f+a*d*T-n*p*T-o*d*v+n*m*v,r[11]=a*c*f-o*l*f-a*h*T+n*l*T+o*h*v-n*c*v,r[15]=o*l*d-a*c*d+a*h*m-n*l*m-o*h*p+n*c*p;var y=n*r[0]+h*r[4]+d*r[8]+f*r[12];if(0===y){var R="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(R);return console.warn(R),this.identity(),this}return this.multiplyScalar(1/y),this},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,h=n*o,c=n*a;return this.set(h*o+r,h*a-i*s,h*s+i*a,0,h*a+i*s,c*a+r,c*s-i*o,0,h*s-i*a,c*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e,t;return function(r,i,n){void 0===e&&(e=new THREE.Vector3),void 0===t&&(t=new THREE.Matrix4);var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),h=e.set(o[8],o[9],o[10]).length(),c=this.determinant();0>c&&(a=-a),r.x=o[12],r.y=o[13],r.z=o[14],t.elements.set(this.elements);var l=1/a,u=1/s,d=1/h;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,i.setFromRotationMatrix(t),n.x=a,n.y=s,n.z=h,this}}(),makeFrustum:function(e,t,r,i,n,o){var a=this.elements,s=2*n/(t-e),h=2*n/(i-r),c=(t+e)/(t-e),l=(i+r)/(i-r),u=-(o+n)/(o-n),d=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=h,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,i){var n=r*Math.tan(THREE.Math.degToRad(.5*e)),o=-n,a=o*t,s=n*t;return this.makeFrustum(a,s,o,n,r,i)},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=t-e,h=r-i,c=o-n,l=(t+e)/s,u=(r+i)/h,d=(o+n)/c;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;16>i;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new THREE.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new THREE.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return 0>i?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,n,o,a){e.copy(i).add(n).multiplyScalar(.5),t.copy(n).sub(i).normalize(),r.copy(this.origin).sub(e);var s,h,c,l,u=.5*i.distanceTo(n),d=-this.direction.dot(t),m=r.dot(this.direction),p=-r.dot(t),E=r.lengthSq(),f=Math.abs(1-d*d);if(f>0)if(s=d*p-m,h=d*m-p,l=u*f,s>=0)if(h>=-l)if(l>=h){var T=1/f;s*=T,h*=T,c=s*(s+d*h+2*m)+h*(d*s+h+2*p)+E}else h=u,s=Math.max(0,-(d*h+m)),c=-s*s+h*(h+2*p)+E;else h=-u,s=Math.max(0,-(d*h+m)),c=-s*s+h*(h+2*p)+E;else-l>=h?(s=Math.max(0,-(-d*u+m)),h=s>0?-u:Math.min(Math.max(-u,-p),u),c=-s*s+h*(h+2*p)+E):l>=h?(s=0,h=Math.min(Math.max(-u,-p),u),c=h*(h+2*p)+E):(s=Math.max(0,-(d*u+m)),h=s>0?u:Math.min(Math.max(-u,-p),u),c=-s*s+h*(h+2*p)+E);else h=d>0?-u:u,s=Math.max(0,-(d*h+m)),c=-s*s+h*(h+2*p)+E;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(t).multiplyScalar(h).add(e),c}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new THREE.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),n=e.dot(e)-i*i,o=t.radius*t.radius;if(n>o)return null;var a=Math.sqrt(o-n),s=i-a,h=i+a;return 0>s&&0>h?null:0>s?this.at(h,r):this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return 0>r*t},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var r,i,n,o,a,s,h=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,u=this.origin;return h>=0?(r=(e.min.x-u.x)*h,i=(e.max.x-u.x)*h):(r=(e.max.x-u.x)*h,i=(e.min.x-u.x)*h),c>=0?(n=(e.min.y-u.y)*c,o=(e.max.y-u.y)*c):(n=(e.max.y-u.y)*c,o=(e.min.y-u.y)*c),r>o||n>i?null:((n>r||r!==r)&&(r=n),(i>o||i!==i)&&(i=o),l>=0?(a=(e.min.z-u.z)*l,s=(e.max.z-u.z)*l):(a=(e.max.z-u.z)*l,s=(e.min.z-u.z)*l),r>s||a>i?null:((a>r||r!==r)&&(r=a),(i>s||i!==i)&&(i=s),0>i?null:this.at(r>=0?r:i,t)))},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;return function(n,o,a,s,h){t.subVectors(o,n),r.subVectors(a,n),i.crossVectors(t,r);var c,l=this.direction.dot(i);if(l>0){if(s)return null;c=1}else{if(!(0>l))return null;c=-1,l=-l}e.subVectors(this.origin,n);var u=c*this.direction.dot(r.crossVectors(e,r));if(0>u)return null;var d=c*this.direction.dot(t.cross(e));if(0>d)return null;if(u+d>l)return null;var m=-c*e.dot(i);return 0>m?null:this.at(m/l,h)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),
this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,r){var i=this.center;void 0!==r?i.copy(r):e.setFromPoints(t).center(i);for(var n=0,o=0,a=t.length;a>o;o++)n=Math.max(n,i.distanceToSquared(t[o]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new THREE.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},THREE.Frustum=function(e,t,r,i,n,o){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],h=r[5],c=r[6],l=r[7],u=r[8],d=r[9],m=r[10],p=r[11],E=r[12],f=r[13],T=r[14],v=r[15];return t[0].setComponents(a-i,l-s,p-u,v-E).normalize(),t[1].setComponents(a+i,l+s,p+u,v+E).normalize(),t[2].setComponents(a+n,l+h,p+d,v+f).normalize(),t[3].setComponents(a-n,l-h,p-d,v-f).normalize(),t[4].setComponents(a-o,l-c,p-m,v-T).normalize(),t[5].setComponents(a+o,l+c,p+m,v+T).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;6>n;n++){var o=t[n].distanceToPoint(r);if(i>o)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){for(var i=this.planes,n=0;6>n;n++){var o=i[n];e.x=o.normal.x>0?r.min.x:r.max.x,t.x=o.normal.x>0?r.max.x:r.min.x,e.y=o.normal.y>0?r.min.y:r.max.y,t.y=o.normal.y>0?r.max.y:r.min.y,e.z=o.normal.z>0?r.min.z:r.max.z,t.z=o.normal.z>0?r.max.z:r.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(0>a&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i,n){var o=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i=t||new THREE.Vector3;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&r>0||0>r&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,r){var i=r||new THREE.Vector3,n=t.delta(e),o=this.normal.dot(n);if(0!==o){var a=-(t.start.dot(this.normal)+this.constant)/o;if(!(0>a||a>1))return i.copy(n).multiplyScalar(a).add(t.start)}else if(0===this.distanceToPoint(t.start))return i.copy(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Matrix3;return function(i,n){var o=n||r.getNormalMatrix(i),a=e.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(t);return s.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},THREE.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;return function(){for(var n=0;36>n;n++)8===n||13===n||18===n||23===n?r[n]="-":14===n?r[n]="4":(2>=i&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[n]=t[19===n?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},THREE.Spline=function(e){function t(e,t,r,i,n,o,a){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*o+s*n+t}this.points=e;var r,i,n,o,a,s,h,c,l,u=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),n=r-i,u[0]=0===i?i:i-1,u[1]=i,u[2]=i>this.points.length-2?this.points.length-1:i+1,u[3]=i>this.points.length-3?this.points.length-1:i+2,s=this.points[u[0]],h=this.points[u[1]],c=this.points[u[2]],l=this.points[u[3]],o=n*n,a=n*o,d.x=t(s.x,h.x,c.x,l.x,n,o,a),d.y=t(s.y,h.y,c.y,l.y,n,o,a),d.z=t(s.z,h.z,c.z,l.z,n,o,a),d},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;r>e;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,n,o=0,a=0,s=0,h=new THREE.Vector3,c=new THREE.Vector3,l=[],u=0;for(l[0]=0,e||(e=100),i=this.points.length*e,h.copy(this.points[0]),t=1;i>t;t++)r=t/i,n=this.getPoint(r),c.copy(n),u+=c.distanceTo(h),h.copy(n),o=(this.points.length-1)*r,a=Math.floor(o),a!==s&&(l[a]=u,s=a);return l[l.length]=u,{chunks:l,total:u}},this.reparametrizeByArcLength=function(e){var t,r,i,n,o,a,s,h,c=[],l=new THREE.Vector3,u=this.getLength();for(c.push(l.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*a/u.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),r=1;s-1>r;r++)i=n+r*(1/s)*(o-n),h=this.getPoint(i),c.push(l.copy(h).clone());c.push(l.copy(this.points[t]).clone())}this.points=c}},THREE.Triangle=function(e,t,r){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==r?r:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,r,i,n){var o=n||new THREE.Vector3;o.subVectors(i,r),e.subVectors(t,r),o.cross(e);var a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,n,o,a,s){e.subVectors(a,n),t.subVectors(o,n),r.subVectors(i,n);var h=e.dot(e),c=e.dot(t),l=e.dot(r),u=t.dot(t),d=t.dot(r),m=h*u-c*c,p=s||new THREE.Vector3;if(0===m)return p.set(-2,-1,-1);var E=1/m,f=(u*l-c*d)*E,T=(h*d-c*l)*E;return p.set(1-f-T,T,f)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,r,i,n){var o=THREE.Triangle.barycoordFromPoint(t,r,i,n,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},THREE.Channels=function(){this.mask=1},THREE.Channels.prototype={constructor:THREE.Channels,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)}},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=self.performance.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,i=r[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var i=[],n=r.length,o=0;n>o;o++)i[o]=r[o];for(var o=0;n>o;o++)i[o].call(this,e)}}}},function(e){function t(e,t){return e.distance-t.distance}function r(e,t,i,n){if(e.visible!==!1&&(e.raycast(t,i),n===!0))for(var o=e.children,a=0,s=o.length;s>a;a++)r(o[a],t,i,!0)}e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){r instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(r.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(this.ray.origin).normalize()):r instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,i){var n=[];return r(e,this,n,i),n.sort(t),n},intersectObjects:function(e,i){var n=[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var o=0,a=e.length;a>o;o++)r(e[o],this,n,i);return n.sort(t),n}}}(THREE),THREE.Object3D=function(){function e(){n.setFromEuler(i,!1)}function t(){i.setFromQuaternion(n,void 0,!1)}Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.channels=new THREE.Channels,this.children=[],this.up=THREE.Object3D.DefaultUp.clone();var r=new THREE.Vector3,i=new THREE.Euler,n=new THREE.Quaternion,o=new THREE.Vector3(1,1,1);i.onChange(e),n.onChange(t),Object.defineProperties(this,{position:{enumerable:!0,value:r},rotation:{enumerable:!0,value:i},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:o},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0),THREE.Object3D.DefaultMatrixAutoUpdate=!0,THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof THREE.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;i>r;r++){var n=this.children[r],o=n.getObjectByProperty(e,t);if(void 0!==o)return o}},getWorldPosition:function(e){var t=e||new THREE.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){var i=r||new THREE.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldRotation:function(){var e=new THREE.Quaternion;return function(t){var r=t||new THREE.Euler;return this.getWorldQuaternion(e),r.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(r){var i=r||new THREE.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new THREE.Quaternion;return function(t){var r=t||new THREE.Vector3;return this.getWorldQuaternion(e),r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;i>r;r++)t[r].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,r=0,i=t.length;i>r;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&e!==!0||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){function t(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}var r=void 0===e,i={};r&&(e={geometries:{},materials:{},textures:{},images:{}},i.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var n={};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),n.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),n.material=this.material.uuid),this.children.length>0){n.children=[];for(var o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(r){var a=t(e.geometries),s=t(e.materials),h=t(e.textures),c=t(e.images);a.length>0&&(i.geometries=a),s.length>0&&(i.materials=s),h.length>0&&(i.textures=h),c.length>0&&(i.images=c)}return i.object=n,i},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.rotationAutoUpdate=e.rotationAutoUpdate,this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Face3=function(e,t,r,i,n,o){this.a=e,this.b=t,this.c=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=Array.isArray(i)?i:[],this.color=n instanceof THREE.Color?n:new THREE.Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;r>t;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;r>t;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},THREE.Face4=function(e,t,r,i,n,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,r,n,o,a)},THREE.BufferAttribute=function(e,t){this.uuid=THREE.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;n>i;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new THREE.Color),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var o=e[i];t[r++]=o.a,t[r++]=o.b,t[r++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new THREE.Vector2),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new THREE.Vector3),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new THREE.Vector4),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},clone:function(){return(new this.constructor).copy(this)}},THREE.Int8Attribute=function(e,t){return new THREE.BufferAttribute(new Int8Array(e),t)},THREE.Uint8Attribute=function(e,t){return new THREE.BufferAttribute(new Uint8Array(e),t)},THREE.Uint8ClampedAttribute=function(e,t){return new THREE.BufferAttribute(new Uint8ClampedArray(e),t)},THREE.Int16Attribute=function(e,t){return new THREE.BufferAttribute(new Int16Array(e),t)},THREE.Uint16Attribute=function(e,t){return new THREE.BufferAttribute(new Uint16Array(e),t)},THREE.Int32Attribute=function(e,t){return new THREE.BufferAttribute(new Int32Array(e),t)},THREE.Uint32Attribute=function(e,t){return new THREE.BufferAttribute(new Uint32Array(e),t)},THREE.Float32Attribute=function(e,t){return new THREE.BufferAttribute(new Float32Array(e),t)},THREE.Float64Attribute=function(e,t){return new THREE.BufferAttribute(new Float64Array(e),t)},THREE.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new THREE.BufferAttribute(e,t).setDynamic(!0)},THREE.InstancedBufferAttribute=function(e,t,r){THREE.BufferAttribute.call(this,e,t),this.meshPerAttribute=r||1},THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute,THREE.InstancedBufferAttribute.prototype.copy=function(e){return THREE.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBuffer=function(e,t){this.uuid=THREE.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,n=this.stride;n>i;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},THREE.InstancedInterleavedBuffer=function(e,t,r){THREE.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1},THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype),THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer,THREE.InstancedInterleavedBuffer.prototype.copy=function(e){return THREE.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBufferAttribute=function(e,t,r){this.uuid=THREE.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=r},THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}},THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;i>r;r++){var n=this.vertices[r];n.applyMatrix4(e)}for(var r=0,i=this.faces.length;i>r;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var a=0,s=o.vertexNormals.length;s>a;a++)o.vertexNormals[a].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},rotateX:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,r,i){
return void 0===e&&(e=new THREE.Matrix4),e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new THREE.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,i){var n=void 0!==a?[l[e].clone(),l[t].clone(),l[i].clone()]:[],o=void 0!==s?[r.colors[e].clone(),r.colors[t].clone(),r.colors[i].clone()]:[],m=new THREE.Face3(e,t,i,n,o);r.faces.push(m),void 0!==h&&r.faceVertexUvs[0].push([u[e].clone(),u[t].clone(),u[i].clone()]),void 0!==c&&r.faceVertexUvs[1].push([d[e].clone(),d[t].clone(),d[i].clone()])}var r=this,i=null!==e.index?e.index.array:void 0,n=e.attributes,o=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,h=void 0!==n.uv?n.uv.array:void 0,c=void 0!==n.uv2?n.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var l=[],u=[],d=[],m=0,p=0,E=0;m<o.length;m+=3,p+=2,E+=4)r.vertices.push(new THREE.Vector3(o[m],o[m+1],o[m+2])),void 0!==a&&l.push(new THREE.Vector3(a[m],a[m+1],a[m+2])),void 0!==s&&r.colors.push(new THREE.Color(s[m],s[m+1],s[m+2])),void 0!==h&&u.push(new THREE.Vector2(h[p],h[p+1])),void 0!==c&&d.push(new THREE.Vector2(c[p],c[p+1]));if(void 0!==i){var f=e.groups;if(f.length>0)for(var m=0;m<f.length;m++)for(var T=f[m],v=T.start,g=T.count,p=v,y=v+g;y>p;p+=3)t(i[p],i[p+1],i[p+2]);else for(var m=0;m<i.length;m+=3)t(i[m],i[m+1],i[m+2])}else for(var m=0;m<o.length/3;m+=3)t(m,m+1,m+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,i=new THREE.Matrix4;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,r=0,i=this.faces.length;i>r;r++){var n=this.faces[r],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,n,o,a;for(a=new Array(this.vertices.length),t=0,r=this.vertices.length;r>t;t++)a[t]=new THREE.Vector3;if(e){var s,h,c,l=new THREE.Vector3,u=new THREE.Vector3;for(i=0,n=this.faces.length;n>i;i++)o=this.faces[i],s=this.vertices[o.a],h=this.vertices[o.b],c=this.vertices[o.c],l.subVectors(c,h),u.subVectors(s,h),l.cross(u),a[o.a].add(l),a[o.b].add(l),a[o.c].add(l)}else for(i=0,n=this.faces.length;n>i;i++)o=this.faces[i],a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,r=this.vertices.length;r>t;t++)a[t].normalize();for(i=0,n=this.faces.length;n>i;i++){o=this.faces[i];var d=o.vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;i>r;r++)for(n=this.faces[r],n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;t>e;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,s,h=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;i>r;r++)a=new THREE.Vector3,s={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},h.push(a),c.push(s)}var l=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var a,s;for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],a=l.faceNormals[r],s=l.vertexNormals[r],a.copy(n.normal),s.a.copy(n.vertexNormals[0]),s.b.copy(n.vertexNormals[1]),s.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;i>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof THREE.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var i,n=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,h=e.faces,c=this.faceVertexUvs[0],l=e.faceVertexUvs[0];void 0===r&&(r=0),void 0!==t&&(i=(new THREE.Matrix3).getNormalMatrix(t));for(var u=0,d=a.length;d>u;u++){var m=a[u],p=m.clone();void 0!==t&&p.applyMatrix4(t),o.push(p)}for(u=0,d=h.length;d>u;u++){var E,f,T,v=h[u],g=v.vertexNormals,y=v.vertexColors;E=new THREE.Face3(v.a+n,v.b+n,v.c+n),E.normal.copy(v.normal),void 0!==i&&E.normal.applyMatrix3(i).normalize();for(var R=0,_=g.length;_>R;R++)f=g[R].clone(),void 0!==i&&f.applyMatrix3(i).normalize(),E.vertexNormals.push(f);E.color.copy(v.color);for(var R=0,_=y.length;_>R;R++)T=y[R],E.vertexColors.push(T.clone());E.materialIndex=v.materialIndex+r,s.push(E)}for(u=0,d=l.length;d>u;u++){var x=l[u],b=[];if(void 0!==x){for(var R=0,_=x.length;_>R;R++)b.push(x[R].clone());c.push(b)}}},mergeMesh:function(e){return e instanceof THREE.Mesh==!1?void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),void this.merge(e.geometry,e.matrix))},mergeVertices:function(){var e,t,r,i,n,o,a,s,h={},c=[],l=[],u=4,d=Math.pow(10,u);for(r=0,i=this.vertices.length;i>r;r++)e=this.vertices[r],t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===h[t]?(h[t]=r,c.push(this.vertices[r]),l[r]=c.length-1):l[r]=l[h[t]];var m=[];for(r=0,i=this.faces.length;i>r;r++){n=this.faces[r],n.a=l[n.a],n.b=l[n.b],n.c=l[n.c],o=[n.a,n.b,n.c];for(var p=-1,E=0;3>E;E++)if(o[E]===o[(E+1)%3]){p=E,m.push(r);break}}for(r=m.length-1;r>=0;r--){var f=m[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;s>a;a++)this.faceVertexUvs[a].splice(f,1)}var T=this.vertices.length-c.length;return this.vertices=c,T},sortFacesByMaterialIndex:function(){function e(e,t){return e.materialIndex-t.materialIndex}for(var t=this.faces,r=t.length,i=0;r>i;i++)t[i]._id=i;t.sort(e);var n,o,a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===r&&(n=[]),s&&s.length===r&&(o=[]);for(var i=0;r>i;i++){var h=t[i]._id;n&&n.push(a[h]),o&&o.push(s[h])}n&&(this.faceVertexUvs[0]=n),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==d[t]?d[t]:(d[t]=u.length/3,u.push(e.x,e.y,e.z),d[t])}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==p[t]?p[t]:(p[t]=m.length,m.push(e.getHex()),p[t])}function i(e){var t=e.x.toString()+e.y.toString();return void 0!==f[t]?f[t]:(f[t]=E.length/2,E.push(e.x,e.y),f[t])}var n={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(n[a]=o[a]);return n}for(var s=[],h=0;h<this.vertices.length;h++){var c=this.vertices[h];s.push(c.x,c.y,c.z)}for(var l=[],u=[],d={},m=[],p={},E=[],f={},h=0;h<this.faces.length;h++){var T=this.faces[h],v=!1,g=!1,y=void 0!==this.faceVertexUvs[0][h],R=T.normal.length()>0,_=T.vertexNormals.length>0,x=1!==T.color.r||1!==T.color.g||1!==T.color.b,b=T.vertexColors.length>0,H=0;if(H=e(H,0,0),H=e(H,1,v),H=e(H,2,g),H=e(H,3,y),H=e(H,4,R),H=e(H,5,_),H=e(H,6,x),H=e(H,7,b),l.push(H),l.push(T.a,T.b,T.c),y){var C=this.faceVertexUvs[0][h];l.push(i(C[0]),i(C[1]),i(C[2]))}if(R&&l.push(t(T.normal)),_){var S=T.vertexNormals;l.push(t(S[0]),t(S[1]),t(S[2]))}if(x&&l.push(r(T.color)),b){var M=T.vertexColors;l.push(r(M[0]),r(M[1]),r(M[2]))}}return n.data={},n.data.vertices=s,n.data.normals=u,m.length>0&&(n.data.colors=m),E.length>0&&(n.data.uvs=[E]),n.data.faces=l,n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,r=0,i=t.length;i>r;r++)this.vertices.push(t[r].clone());for(var n=e.faces,r=0,i=n.length;i>r;r++)this.faces.push(n[r].clone());for(var r=0,i=e.faceVertexUvs.length;i>r;r++){var o=e.faceVertexUvs[r];void 0===this.faceVertexUvs[r]&&(this.faceVertexUvs[r]=[]);for(var a=0,s=o.length;s>a;a++){for(var h=o[a],c=[],l=0,u=h.length;u>l;l++){var d=h[l];c.push(d.clone())}this.faceVertexUvs[r].push(c)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.DirectGeometry.prototype={constructor:THREE.DirectGeometry,computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){for(var t,r,i=[],n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t=e.faces,r=e.vertices,i=e.faceVertexUvs,n=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,a=e.morphTargets,s=a.length;if(s>0){for(var h=[],c=0;s>c;c++)h[c]=[];this.morphTargets.position=h}var l=e.morphNormals,u=l.length;if(u>0){for(var d=[],c=0;u>c;c++)d[c]=[];this.morphTargets.normal=d}for(var m=e.skinIndices,p=e.skinWeights,E=m.length===r.length,f=p.length===r.length,c=0;c<t.length;c++){var T=t[c];this.vertices.push(r[T.a],r[T.b],r[T.c]);var v=T.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var g=T.normal;this.normals.push(g,g,g)}var y=T.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{var R=T.color;this.colors.push(R,R,R)}if(n===!0){var _=i[0][c];void 0!==_?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}if(o===!0){var _=i[1][c];void 0!==_?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}for(var x=0;s>x;x++){var b=a[x].vertices;h[x].push(b[T.a],b[T.b],b[T.c])}for(var x=0;u>x;x++){var H=l[x].vertexNormals[c];d[x].push(H.a,H.b,H.c)}E&&this.skinIndices.push(m[T.a],m[T.b],m[T.c]),f&&this.skinWeights.push(p[T.a],p[T.b],p[T.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.DirectGeometry.prototype),THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){return t instanceof THREE.BufferAttribute==!1&&t instanceof THREE.InterleavedBufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new THREE.BufferAttribute(arguments[1],arguments[2]))):"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):void(this.attributes[e]=t)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e]},get drawcalls(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups},get offsets(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var i=(new THREE.Matrix3).getNormalMatrix(e);i.applyToVector3Array(r.array),r.needsUpdate=!0}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},rotateX:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new THREE.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Points||e instanceof THREE.Line){var r=new THREE.Float32Attribute(3*t.vertices.length,3),i=new THREE.Float32Attribute(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new THREE.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e instanceof THREE.Mesh&&t instanceof THREE.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Mesh){var r=t.__directGeometry;if(void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}if(t.verticesNeedUpdate===!0){var i=this.attributes.position;void 0!==i&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){var i=this.attributes.normal;void 0!==i&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){var i=this.attributes.color;void 0!==i&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var i=this.attributes.uv;void 0!==i&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var i=this.attributes.lineDistance;void 0!==i&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new THREE.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new THREE.BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new THREE.BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new THREE.BufferAttribute(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new THREE.BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new THREE.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var a=e.vertices.length>65535?Uint32Array:Uint16Array,s=new a(3*e.indices.length);this.setIndex(new THREE.BufferAttribute(s,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var h in e.morphTargets){for(var c=[],l=e.morphTargets[h],u=0,d=l.length;d>u;u++){var m=l[u],p=new THREE.Float32Attribute(3*m.length,3);c.push(p.copyVector3sArray(m))}this.morphAttributes[h]=c}if(e.skinIndices.length>0){var E=new THREE.Float32Attribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",E.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new THREE.Float32Attribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){var e=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var i=0,n=t.length;n>i;i+=3)e.fromArray(t,i),r.expandByPoint(e)}void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var i=this.boundingSphere.center,n=0,o=r.length;o>n;n+=3)t.fromArray(r,n),e.expandByPoint(t);e.center(i);for(var a=0,n=0,o=r.length;o>n;n+=3)t.fromArray(r,n),a=Math.max(a,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(i.length),3));else for(var n=t.normal.array,o=0,a=n.length;a>o;o++)n[o]=0;var s,h,c,n=t.normal.array,l=new THREE.Vector3,u=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3;if(e){var E=e.array;0===r.length&&this.addGroup(0,E.length);for(var f=0,T=r.length;T>f;++f)for(var v=r[f],g=v.start,y=v.count,o=g,a=g+y;a>o;o+=3)s=3*E[o+0],h=3*E[o+1],c=3*E[o+2],l.fromArray(i,s),u.fromArray(i,h),d.fromArray(i,c),m.subVectors(d,u),p.subVectors(l,u),m.cross(p),n[s]+=m.x,n[s+1]+=m.y,n[s+2]+=m.z,n[h]+=m.x,n[h+1]+=m.y,n[h+2]+=m.z,n[c]+=m.x,n[c+1]+=m.y,n[c+2]+=m.z}else for(var o=0,a=i.length;a>o;o+=9)l.fromArray(i,o),u.fromArray(i,o+3),d.fromArray(i,o+6),m.subVectors(d,u),p.subVectors(l,u),m.cross(p),n[o]=m.x,n[o+1]=m.y,n[o+2]=m.z,n[o+3]=m.x,n[o+4]=m.y,n[o+5]=m.z,n[o+6]=m.x,n[o+7]=m.y,n[o+8]=m.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(e){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(e,t){if(e instanceof THREE.BufferGeometry==!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var r=this.attributes;for(var i in r)if(void 0!==e.attributes[i])for(var n=r[i],o=n.array,a=e.attributes[i],s=a.array,h=a.itemSize,c=0,l=h*t;c<s.length;c++,l++)o[l]=s[c];return this},normalizeNormals:function(){for(var e,t,r,i,n=this.attributes.normal.array,o=0,a=n.length;a>o;o+=3)e=n[o],t=n[o+1],r=n[o+2],i=1/Math.sqrt(e*e+t*t+r*r),n[o]*=i,n[o+1]*=i,n[o+2]*=i},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(null!==i){var n=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:n}}var o=this.attributes;for(var r in o){var a=o[r],n=Array.prototype.slice.call(a.array);e.data.attributes[r]={itemSize:a.itemSize,type:a.array.constructor.name,array:n}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var h=this.boundingSphere;return null!==h&&(e.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var n=r[i];this.addAttribute(i,n.clone())}for(var o=e.groups,a=0,s=o.length;s>a;a++){var h=o[a];this.addGroup(h.start,h.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.BufferGeometry.MaxIndex=65535,THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry,THREE.InstancedBufferGeometry.prototype.addGroup=function(e,t,r){this.groups.push({start:e,count:t,instances:r})},THREE.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var n=r[i];this.addAttribute(i,n.clone())}for(var o=e.groups,a=0,s=o.length;s>a;a++){var h=o[a];this.addGroup(h.start,h.count,h.instances)}return this},THREE.EventDispatcher.prototype.apply(THREE.InstancedBufferGeometry.prototype),THREE.AnimationAction=function(e,t,r,i,n){if(void 0===e)throw new Error("clip is null");this.clip=e,this.localRoot=null,this.startTime=t||0,this.timeScale=r||1,this.weight=i||1,this.loop=n||THREE.LoopRepeat,this.loopCount=0,this.enabled=!0,this.actionTime=-this.startTime,this.clipTime=0,this.propertyBindings=[]},THREE.AnimationAction.prototype={constructor:THREE.AnimationAction,setLocalRoot:function(e){return this.localRoot=e,this},updateTime:function(e){var t=this.clipTime,r=this.loopCount,i=(this.actionTime,this.clip.duration);if(this.actionTime=this.actionTime+e,this.loop===THREE.LoopOnce)return this.loopCount=0,this.clipTime=Math.min(Math.max(this.actionTime,0),i),this.clipTime!==t&&(this.clipTime===i?this.mixer.dispatchEvent({type:"finished",action:this,direction:1}):0===this.clipTime&&this.mixer.dispatchEvent({type:"finished",action:this,direction:-1})),this.clipTime;this.loopCount=Math.floor(this.actionTime/i);var n=this.actionTime-this.loopCount*i;return n%=i,this.loop==THREE.LoopPingPong&&1===Math.abs(this.loopCount%2)&&(n=i-n),this.clipTime=n,this.loopCount!==r&&this.mixer.dispatchEvent({type:"loop",action:this,loopDelta:this.loopCount-this.loopCount}),this.clipTime},syncWith:function(e){return this.actionTime=e.actionTime,this.timeScale=e.timeScale,this},warpToDuration:function(e){return this.timeScale=this.clip.duration/e,this},init:function(e){return this.clipTime=e-this.startTime,this},update:function(e){this.updateTime(e);var t=this.clip.getAt(this.clipTime);return t},getTimeScaleAt:function(e){return this.timeScale.getAt?this.timeScale.getAt(e):this.timeScale},getWeightAt:function(e){return this.weight.getAt?this.weight.getAt(e):this.weight}},THREE.AnimationClip=function(e,t,r){if(this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.duration<0)for(var i=0;i<this.tracks.length;i++){var n=this.tracks[i];this.duration=Math.max(n.keys[n.keys.length-1].time)}this.trim(),this.optimize(),this.results=[]},THREE.AnimationClip.prototype={constructor:THREE.AnimationClip,getAt:function(e){e=Math.max(0,Math.min(e,this.duration));for(var t=0;t<this.tracks.length;t++){var r=this.tracks[t];this.results[t]=r.getAt(e)}return this.results},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},THREE.AnimationClip.CreateFromMorphTargetSequence=function(e,t,r){for(var i=t.length,n=[],o=0;i>o;o++){var a=[];a.push({time:(o+i-1)%i,value:0}),a.push({time:o,value:1}),a.push({time:(o+1)%i,value:0}),a.sort(THREE.KeyframeTrack.keyComparer),0===a[0].time&&a.push({time:i,value:a[0].value}),n.push(new THREE.NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",a).scale(1/r))}return new THREE.AnimationClip(e,-1,n)},THREE.AnimationClip.findByName=function(e,t){for(var r=0;r<e.length;r++)if(e[r].name===t)return e[r];return null},THREE.AnimationClip.CreateClipsFromMorphTargetSequences=function(e,t){for(var r={},i=/^([\w-]*?)([\d]+)$/,n=0,o=e.length;o>n;n++){var a=e[n],s=a.name.match(i);if(s&&s.length>1){var h=s[1],c=r[h];c||(r[h]=c=[]),c.push(a)}}var l=[];for(var h in r)l.push(THREE.AnimationClip.CreateFromMorphTargetSequence(h,r[h],t));return l},THREE.AnimationClip.parse=function(e){for(var t=[],r=0;r<e.tracks.length;r++)t.push(THREE.KeyframeTrack.parse(e.tracks[r]).scale(1/e.fps));return new THREE.AnimationClip(e.name,e.duration,t)},THREE.AnimationClip.parseAnimation=function(e,t,r){if(!e)return console.error("  no animation in JSONLoader data"),null;for(var i=function(e,t,r,i,n){for(var o=[],a=0;a<t.length;a++){var s=t[a];void 0!==s[r]&&o.push({time:s.time,value:n(s)})}return o.length>0?new i(e,o):null},n=[],o=e.name||"default",a=e.length||-1,s=e.fps||30,h=e.hierarchy||[],c=0;c<h.length;c++){var l=h[c].keys;if(l&&0!=l.length)if(l[0].morphTargets){for(var u={},d=0;d<l.length;d++)if(l[d].morphTargets)for(var m=0;m<l[d].morphTargets.length;m++)u[l[d].morphTargets[m]]=-1;for(var p in u){for(var E=[],m=0;m<l[d].morphTargets.length;m++){var f=l[d];E.push({time:f.time,value:f.morphTarget===p?1:0})}n.push(new THREE.NumberKeyframeTrack(r+".morphTargetInfluence["+p+"]",E))}a=u.length*(s||1)}else{var T=r+".bones["+t[c].name+"]",v=i(T+".position",l,"pos",THREE.VectorKeyframeTrack,function(e){return(new THREE.Vector3).fromArray(e.pos)});v&&n.push(v);var g=i(T+".quaternion",l,"rot",THREE.QuaternionKeyframeTrack,function(e){return e.rot.slerp?e.rot.clone():(new THREE.Quaternion).fromArray(e.rot)});g&&n.push(g);var y=i(T+".scale",l,"scl",THREE.VectorKeyframeTrack,function(e){return(new THREE.Vector3).fromArray(e.scl)});y&&n.push(y)}}if(0===n.length)return null;var R=new THREE.AnimationClip(o,a,n);return R},THREE.AnimationMixer=function(e){this.root=e,this.time=0,this.timeScale=1,this.actions=[],this.propertyBindingMap={}},THREE.AnimationMixer.prototype={constructor:THREE.AnimationMixer,addAction:function(e){this.actions.push(e),e.init(this.time),e.mixer=this;for(var t=e.clip.tracks,r=e.localRoot||this.root,i=0;i<t.length;i++){var n=t[i],o=r.uuid+"-"+n.name,a=this.propertyBindingMap[o];void 0===a&&(a=new THREE.PropertyBinding(r,n.name),this.propertyBindingMap[o]=a),e.propertyBindings.push(a),a.referenceCount+=1}},removeAllActions:function(){for(var e=0;e<this.actions.length;e++)this.actions[e].mixer=null;for(var t in this.propertyBindingMap)this.propertyBindingMap[t].unbind();return this.actions=[],this.propertyBindingMap={},this},removeAction:function(e){var t=this.actions.indexOf(e);-1!==t&&(this.actions.splice(t,1),e.mixer=null);for(var r=e.localRoot||this.root,i=e.clip.tracks,n=0;n<i.length;n++){var o=i[n],a=r.uuid+"-"+o.name,s=this.propertyBindingMap[a];s.referenceCount-=1,s.referenceCount<=0&&(s.unbind(),delete this.propertyBindingMap[a])}return this},findActionByName:function(e){for(var t=0;t<this.actions.length;t++)if(this.actions[t].name===e)return this.actions[t];return null},play:function(e,t){return e.startTime=this.time,this.addAction(e),this},fadeOut:function(e,t){var r=[];return r.push({time:this.time,value:1}),r.push({time:this.time+t,value:0}),e.weight=new THREE.NumberKeyframeTrack("weight",r),this},fadeIn:function(e,t){var r=[];return r.push({time:this.time,value:0}),r.push({time:this.time+t,value:1}),e.weight=new THREE.NumberKeyframeTrack("weight",r),this},warp:function(e,t,r,i){var n=[];return n.push({time:this.time,value:t}),n.push({time:this.time+i,value:r}),e.timeScale=new THREE.NumberKeyframeTrack("timeScale",n),this},crossFade:function(e,t,r,i){if(this.fadeOut(e,r),this.fadeIn(t,r),i){var n=e.clip.duration/t.clip.duration,o=1/n;this.warp(e,1,n,r),this.warp(t,o,1,r)}return this},update:function(e){var t=e*this.timeScale;this.time+=t;for(var r=0;r<this.actions.length;r++){var i=this.actions[r],n=i.getWeightAt(this.time),o=i.getTimeScaleAt(this.time),a=t*o,s=i.update(a);if(!(i.weight<=0)&&i.enabled)for(var h=0;h<s.length;h++){i.clip.tracks[h].name;i.propertyBindings[h].accumulate(s[h],n)}}for(var c in this.propertyBindingMap)this.propertyBindingMap[c].apply();return this}},THREE.EventDispatcher.prototype.apply(THREE.AnimationMixer.prototype),THREE.AnimationUtils={getEqualsFunc:function(e){return e.equals?function(e,t){return e.equals(t)}:function(e,t){return e===t}},clone:function(e){var t=typeof e;if("object"===t){if(e.clone)return e.clone();console.error("can not figure out how to copy exemplarValue",e);
}return e},lerp:function(e,t,r,i){var n=THREE.AnimationUtils.getLerpFunc(e,i);return n(e,t,r)},lerp_object:function(e,t,r){return e.lerp(t,r)},slerp_object:function(e,t,r){return e.slerp(t,r)},lerp_number:function(e,t,r){return e*(1-r)+t*r},lerp_boolean:function(e,t,r){return.5>r?e:t},lerp_boolean_immediate:function(e,t,r){return e},lerp_string:function(e,t,r){return.5>r?e:t},lerp_string_immediate:function(e,t,r){return e},getLerpFunc:function(e,t){if(void 0===e||null===e)throw new Error("examplarValue is null");var r=typeof e;switch(r){case"object":if(e.lerp)return THREE.AnimationUtils.lerp_object;if(e.slerp)return THREE.AnimationUtils.slerp_object;break;case"number":return THREE.AnimationUtils.lerp_number;case"boolean":return t?THREE.AnimationUtils.lerp_boolean:THREE.AnimationUtils.lerp_boolean_immediate;case"string":return t?THREE.AnimationUtils.lerp_string:THREE.AnimationUtils.lerp_string_immediate}}},THREE.KeyframeTrack=function(e,t){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keys in track named "+e);this.name=e,this.keys=t,this.lastIndex=0,this.validate(),this.optimize()},THREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,getAt:function(e){for(;this.lastIndex<this.keys.length&&e>=this.keys[this.lastIndex].time;)this.lastIndex++;for(;this.lastIndex>0&&e<this.keys[this.lastIndex-1].time;)this.lastIndex--;if(this.lastIndex>=this.keys.length)return this.setResult(this.keys[this.keys.length-1].value),this.result;if(0===this.lastIndex)return this.setResult(this.keys[0].value),this.result;var t=this.keys[this.lastIndex-1];if(this.setResult(t.value),t.constantToNext)return this.result;var r=this.keys[this.lastIndex],i=(e-t.time)/(r.time-t.time);return this.result=this.lerpValues(this.result,r.value,i),this.result},shift:function(e){if(0!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time+=e;return this},scale:function(e){if(1!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time*=e;return this},trim:function(e,t){for(var r=0,i=1;i<this.keys.length;i++)this.keys[i]<=e&&r++;for(var n=0,i=this.keys.length-2;i>0&&this.keys[i]>=t;i++)n++;return r+n>0&&(this.keys=this.keys.splice(r,this.keys.length-n-r)),this},validate:function(){var e=null;if(0===this.keys.length)return void console.error("  track is empty, no keys",this);for(var t=0;t<this.keys.length;t++){var r=this.keys[t];if(!r)return void console.error("  key is null in track",this,t);if("number"!=typeof r.time||isNaN(r.time))return void console.error("  key.time is not a valid number",this,t,r);if(void 0===r.value||null===r.value)return void console.error("  key.value is null in track",this,t,r);if(e&&e.time>r.time)return void console.error("  key.time is less than previous key time, out of order keys",this,t,r,e);e=r}return this},optimize:function(){var e=[],t=this.keys[0];e.push(t);for(var r=(THREE.AnimationUtils.getEqualsFunc(t.value),1);r<this.keys.length-1;r++){var i=this.keys[r],n=this.keys[r+1];t.time!==i.time&&(this.compareValues(t.value,i.value)&&this.compareValues(i.value,n.value)||(t.constantToNext=this.compareValues(t.value,i.value),e.push(i),t=i))}return e.push(this.keys[this.keys.length-1]),this.keys=e,this}},THREE.KeyframeTrack.keyComparer=function(e,t){return e.time-t.time},THREE.KeyframeTrack.parse=function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");var t=THREE.KeyframeTrack.GetTrackTypeForTypeName(e.type);return t.parse(e)},THREE.KeyframeTrack.GetTrackTypeForTypeName=function(e){switch(e.toLowerCase()){case"vector":case"vector2":case"vector3":case"vector4":return THREE.VectorKeyframeTrack;case"quaternion":return THREE.QuaternionKeyframeTrack;case"integer":case"scalar":case"double":case"float":case"number":return THREE.NumberKeyframeTrack;case"bool":case"boolean":return THREE.BooleanKeyframeTrack;case"string":return THREE.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)},THREE.PropertyBinding=function(e,t){this.rootNode=e,this.trackName=t,this.referenceCount=0,this.originalValue=null;var r=THREE.PropertyBinding.parseTrackName(t);this.directoryName=r.directoryName,this.nodeName=r.nodeName,this.objectName=r.objectName,this.objectIndex=r.objectIndex,this.propertyName=r.propertyName,this.propertyIndex=r.propertyIndex,this.node=THREE.PropertyBinding.findNode(e,this.nodeName)||e,this.cumulativeValue=null,this.cumulativeWeight=0},THREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,reset:function(){this.cumulativeValue=null,this.cumulativeWeight=0},accumulate:function(e,t){if(this.isBound||this.bind(),0===this.cumulativeWeight)t>0&&(null===this.cumulativeValue&&(this.cumulativeValue=THREE.AnimationUtils.clone(e)),this.cumulativeWeight=t);else{var r=t/(this.cumulativeWeight+t);this.cumulativeValue=this.lerpValue(this.cumulativeValue,e,r),this.cumulativeWeight+=t}},unbind:function(){this.isBound&&(this.setValue(this.originalValue),this.setValue=null,this.getValue=null,this.lerpValue=null,this.equalsValue=null,this.triggerDirty=null,this.isBound=!1)},bind:function(){if(!this.isBound){var e=this.node;if(!e)return void console.error("  trying to update node for track: "+this.trackName+" but it wasn't found.");if(this.objectName){if("materials"===this.objectName){if(!e.material)return void console.error("  can not bind to material as node does not have a material",this);if(!e.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);e=e.material.materials}else if("bones"===this.objectName){if(!e.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);e=e.skeleton.bones;for(var t=0;t<e.length;t++)if(e[t].name===this.objectIndex){this.objectIndex=t;break}}else{if(void 0===e[this.objectName])return void console.error("  can not bind to objectName of node, undefined",this);e=e[this.objectName]}if(void 0!==this.objectIndex){if(void 0===e[this.objectIndex])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);e=e[this.objectIndex]}}var r=e[this.propertyName];if(!r)return void console.error("  trying to update property for track: "+this.nodeName+"."+this.propertyName+" but it wasn't found.",e);if(void 0!==this.propertyIndex){if("morphTargetInfluences"===this.propertyName){e.geometry||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this),e.geometry.morphTargets||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(var t=0;t<this.node.geometry.morphTargets.length;t++)if(e.geometry.morphTargets[t].name===this.propertyIndex){this.propertyIndex=t;break}}this.setValue=function(e){return this.equalsValue(r[this.propertyIndex],e)?!1:(r[this.propertyIndex]=e,!0)},this.getValue=function(){return r[this.propertyIndex]}}else r.copy?(this.setValue=function(e){return this.equalsValue(r,e)?!1:(r.copy(e),!0)},this.getValue=function(){return r}):(this.setValue=function(t){return this.equalsValue(e[this.propertyName],t)?!1:(e[this.propertyName]=t,!0)},this.getValue=function(){return e[this.propertyName]});void 0!==e.needsUpdate?this.triggerDirty=function(){this.node.needsUpdate=!0}:void 0!==e.matrixWorldNeedsUpdate&&(this.triggerDirty=function(){e.matrixWorldNeedsUpdate=!0}),this.originalValue=this.getValue(),this.equalsValue=THREE.AnimationUtils.getEqualsFunc(this.originalValue),this.lerpValue=THREE.AnimationUtils.getLerpFunc(this.originalValue,!0),this.isBound=!0}},apply:function(){if(this.isBound||this.bind(),this.cumulativeWeight>0){if(this.cumulativeWeight<1){var e=1-this.cumulativeWeight,t=e/(this.cumulativeWeight+e);this.cumulativeValue=this.lerpValue(this.cumulativeValue,this.originalValue,t)}var r=this.setValue(this.cumulativeValue);r&&this.triggerDirty&&this.triggerDirty(),this.cumulativeValue=null,this.cumulativeWeight=0}}},THREE.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_. ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,r=t.exec(e);if(!r)throw new Error("cannot parse trackName at all: "+e);r.index===t.lastIndex&&t.lastIndex++;var i={directoryName:r[1],nodeName:r[3],objectName:r[5],objectIndex:r[7],propertyName:r[9],propertyIndex:r[11]};if(null===i.propertyName||0===i.propertyName.length)throw new Error("can not parse propertyName from trackName: "+e);return i},THREE.PropertyBinding.findNode=function(e,t){function r(e){for(var r=0;r<e.bones.length;r++){var i=e.bones[r];if(i.name===t)return i}return null}function i(e){for(var r=0;r<e.length;r++){var n=e[r];if(n.name===t||n.uuid===t)return n;var o=i(n.children);if(o)return o}return null}if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=r(e.skeleton);if(n)return n}if(e.children){var o=i(e.children);if(o)return o}return null},THREE.VectorKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},THREE.VectorKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.VectorKeyframeTrack.prototype.constructor=THREE.VectorKeyframeTrack,THREE.VectorKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},THREE.VectorKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.lerp(t,r)},THREE.VectorKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},THREE.VectorKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new THREE.VectorKeyframeTrack(this.name,e)},THREE.VectorKeyframeTrack.parse=function(e){for(var t=e.keys[0].value.length,r=THREE["Vector"+t],i=[],n=0;n<e.keys.length;n++){var o=e.keys[n];i.push({value:(new r).fromArray(o.value),time:o.time})}return new THREE.VectorKeyframeTrack(e.name,i)},THREE.QuaternionKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},THREE.QuaternionKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.QuaternionKeyframeTrack.prototype.constructor=THREE.QuaternionKeyframeTrack,THREE.QuaternionKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},THREE.QuaternionKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.slerp(t,r)},THREE.QuaternionKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},THREE.QuaternionKeyframeTrack.prototype.multiply=function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].value.multiply(e);return this},THREE.QuaternionKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new THREE.QuaternionKeyframeTrack(this.name,e)},THREE.QuaternionKeyframeTrack.parse=function(e){for(var t=[],r=0;r<e.keys.length;r++){var i=e.keys[r];t.push({value:(new THREE.Quaternion).fromArray(i.value),time:i.time})}return new THREE.QuaternionKeyframeTrack(e.name,t)},THREE.StringKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},THREE.StringKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.StringKeyframeTrack.prototype.constructor=THREE.StringKeyframeTrack,THREE.StringKeyframeTrack.prototype.setResult=function(e){this.result=e},THREE.StringKeyframeTrack.prototype.lerpValues=function(e,t,r){return 1>r?e:t},THREE.StringKeyframeTrack.prototype.compareValues=function(e,t){return e===t},THREE.StringKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new THREE.StringKeyframeTrack(this.name,e)},THREE.StringKeyframeTrack.parse=function(e){return new THREE.StringKeyframeTrack(e.name,e.keys)},THREE.BooleanKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},THREE.BooleanKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.BooleanKeyframeTrack.prototype.constructor=THREE.BooleanKeyframeTrack,THREE.BooleanKeyframeTrack.prototype.setResult=function(e){this.result=e},THREE.BooleanKeyframeTrack.prototype.lerpValues=function(e,t,r){return 1>r?e:t},THREE.BooleanKeyframeTrack.prototype.compareValues=function(e,t){return e===t},THREE.BooleanKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new THREE.BooleanKeyframeTrack(this.name,e)},THREE.BooleanKeyframeTrack.parse=function(e){return new THREE.BooleanKeyframeTrack(e.name,e.keys)},THREE.NumberKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},THREE.NumberKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.NumberKeyframeTrack.prototype.constructor=THREE.NumberKeyframeTrack,THREE.NumberKeyframeTrack.prototype.setResult=function(e){this.result=e},THREE.NumberKeyframeTrack.prototype.lerpValues=function(e,t,r){return e*(1-r)+t*r},THREE.NumberKeyframeTrack.prototype.compareValues=function(e,t){return e===t},THREE.NumberKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new THREE.NumberKeyframeTrack(this.name,e)},THREE.NumberKeyframeTrack.parse=function(e){return new THREE.NumberKeyframeTrack(e.name,e.keys)},THREE.Camera=function(){THREE.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.getWorldDirection=function(){var e=new THREE.Quaternion;return function(t){var r=t||new THREE.Vector3;return this.getWorldQuaternion(e),r.set(0,0,-1).applyQuaternion(e)}}(),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.Camera.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},THREE.CubeCamera=function(e,t,r){THREE.Object3D.call(this),this.type="CubeCamera";var i=90,n=1,o=new THREE.PerspectiveCamera(i,n,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(1,0,0)),this.add(o);var a=new THREE.PerspectiveCamera(i,n,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(-1,0,0)),this.add(a);var s=new THREE.PerspectiveCamera(i,n,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var h=new THREE.PerspectiveCamera(i,n,e,t);h.up.set(0,0,-1),h.lookAt(new THREE.Vector3(0,-1,0)),this.add(h);var c=new THREE.PerspectiveCamera(i,n,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,1)),this.add(c);var l=new THREE.PerspectiveCamera(i,n,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,-1)),this.add(l),this.renderTarget=new THREE.WebGLRenderTargetCube(r,r,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,i=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,o,r),r.activeCubeFace=1,e.render(t,a,r),r.activeCubeFace=2,e.render(t,s,r),r.activeCubeFace=3,e.render(t,h,r),r.activeCubeFace=4,e.render(t,c,r),r.texture.generateMipmaps=i,r.activeCubeFace=5,e.render(t,l,r),e.setRenderTarget(null)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.OrthographicCamera=function(e,t,r,i,n,o){THREE.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,i+t,i-t,this.near,this.far)},THREE.OrthographicCamera.prototype.copy=function(e){return THREE.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},THREE.OrthographicCamera.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,t},THREE.PerspectiveCamera=function(e,t,r,i){THREE.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,r=Math.tan(THREE.Math.degToRad(.5*e))*this.near,i=-r,n=t*i,o=t*r,a=Math.abs(o-n),s=Math.abs(r-i);this.projectionMatrix.makeFrustum(n+this.x*a/this.fullWidth,n+(this.x+this.width)*a/this.fullWidth,r-(this.y+this.height)*s/this.fullHeight,r-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.copy=function(e){return THREE.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.aspect=e.aspect,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},THREE.PerspectiveCamera.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.fov=this.fov,t.object.aspect=this.aspect,t.object.near=this.near,t.object.far=this.far,t},THREE.Light=function(e){THREE.Object3D.call(this),this.type="Light",this.color=new THREE.Color(e),this.receiveShadow=void 0},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.constructor=THREE.Light,Object.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(e){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){this.shadow.camera.far=e}},shadowCameraVisible:{set:function(e){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow ) instead.")}},shadowBias:{set:function(e){this.shadow.bias=e}},shadowDarkness:{set:function(e){this.shadow.darkness=e}},shadowMapWidth:{set:function(e){this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){this.shadow.mapSize.height=e}}}),THREE.Light.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this},THREE.Light.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.intensity&&(t.object.intensity=this.intensity),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.exponent&&(t.object.exponent=this.exponent),t},THREE.LightShadow=function(e){this.camera=e,this.bias=0,this.darkness=1,this.mapSize=new THREE.Vector2(512,512),this.map=null,this.matrix=null},THREE.LightShadow.prototype={constructor:THREE.LightShadow,copy:function(e){this.camera=e.camera.clone(),this.bias=e.bias,this.darkness=e.darkness,this.mapSize.copy(e.mapSize)},clone:function(){return(new this.constructor).copy(this)}},THREE.AmbientLight=function(e){THREE.Light.call(this,e),this.type="AmbientLight",this.castShadow=void 0},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.shadow=new THREE.LightShadow(new THREE.OrthographicCamera(-500,500,500,-500,50,5e3))},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.DirectionalLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},THREE.HemisphereLight=function(e,t,r){THREE.Light.call(this,e),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new THREE.Color(t),this.intensity=void 0!==r?r:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight,THREE.HemisphereLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this.intensity=e.intensity,this},THREE.PointLight=function(e,t,r,i){THREE.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,1,500))},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.PointLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},THREE.SpotLight=function(e,t,r,i,n,o){THREE.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==n?n:10,this.decay=void 0!==o?o:1,this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(50,1,50,5e3))},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.SpotLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.angle=e.angle,this.exponent=e.exponent,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},THREE.Cache={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){return this.enabled!==!1?this.files[e]:void 0},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},THREE.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,r){for(var i=[],n=0;n<e.length;++n)i[n]=this.createMaterial(e[n],t,r);return i},createMaterial:function(){var e,t,r;return function(i,n,o){function a(e,r,i,a,h){var c,l=n+e,u=THREE.Loader.Handlers.get(l);null!==u?c=u.load(l):(t.setCrossOrigin(o),c=t.load(l)),void 0!==r&&(c.repeat.fromArray(r),1!==r[0]&&(c.wrapS=THREE.RepeatWrapping),1!==r[1]&&(c.wrapT=THREE.RepeatWrapping)),void 0!==i&&c.offset.fromArray(i),void 0!==a&&("repeat"===a[0]&&(c.wrapS=THREE.RepeatWrapping),"mirror"===a[0]&&(c.wrapS=THREE.MirroredRepeatWrapping),"repeat"===a[1]&&(c.wrapT=THREE.RepeatWrapping),"mirror"===a[1]&&(c.wrapT=THREE.MirroredRepeatWrapping)),void 0!==h&&(c.anisotropy=h);var d=THREE.Math.generateUUID();return s[d]=c,d}void 0===e&&(e=new THREE.Color),void 0===t&&(t=new THREE.TextureLoader),void 0===r&&(r=new THREE.MaterialLoader);var s={},h={uuid:THREE.Math.generateUUID(),type:"MeshLambertMaterial"};for(var c in i){var l=i[c];switch(c){case"DbgColor":h.color=l;break;case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":h.name=l;break;case"blending":h.blending=THREE[l];break;case"colorDiffuse":h.color=e.fromArray(l).getHex();break;case"colorSpecular":h.specular=e.fromArray(l).getHex();break;case"colorEmissive":h.emissive=e.fromArray(l).getHex();break;case"specularCoef":h.shininess=l;break;case"shading":"basic"===l.toLowerCase()&&(h.type="MeshBasicMaterial"),"phong"===l.toLowerCase()&&(h.type="MeshPhongMaterial");break;case"mapDiffuse":h.map=a(l,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":h.lightMap=a(l,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":h.aoMap=a(l,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":h.bumpMap=a(l,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":h.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":h.normalMap=a(l,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":h.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":h.specularMap=a(l,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":h.alphaMap=a(l,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":h.side=THREE.BackSide;break;case"doubleSided":h.side=THREE.DoubleSide;break;case"transparency":console.warn("THREE.Loader: transparency has been renamed to opacity"),h.opacity=l;break;case"opacity":case"transparent":case"depthTest":case"depthWrite":case"transparent":case"visible":case"wireframe":h[c]=l;break;case"vertexColors":l===!0&&(h.vertexColors=THREE.VertexColors),"face"===l&&(h.vertexColors=THREE.FaceColors);break;default:console.error("Loader.createMaterial: Unsupported",c,l)}}return"MeshPhongMaterial"!==h.type&&delete h.specular,h.opacity<1&&(h.transparent=!0),r.setTextures(s),r.parse(h)}}()},THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;i>r;r+=2){var n=t[r],o=t[r+1];if(n.test(e))return o}return null}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,r,i){var n=this,o=THREE.Cache.get(e);if(void 0!==o)return t&&setTimeout(function(){t(o)},0),o;var a=new XMLHttpRequest;return a.open("GET",e,!0),a.addEventListener("load",function(r){var i=r.target.response;THREE.Cache.add(e,i),t&&t(i),n.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),a.addEventListener("error",function(t){i&&i(t),n.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.send(null),n.manager.itemStart(e),a},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e},setWithCredentials:function(e){this.withCredentials=e}},THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,r,i){var n=this,o=THREE.Cache.get(e);if(void 0!==o)return n.manager.itemStart(e),t?setTimeout(function(){t(o),n.manager.itemEnd(e)},0):n.manager.itemEnd(e),o;var a=document.createElement("img");return a.addEventListener("load",function(r){THREE.Cache.add(e,this),t&&t(this),n.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),a.addEventListener("error",function(t){i&&i(t),n.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1},THREE.JSONLoader.prototype={constructor:THREE.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(e,t,r,i){var n=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(e),a=new THREE.XHRLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setWithCredentials(this.withCredentials),a.load(e,function(r){var i=JSON.parse(r),a=i.metadata;if(void 0!==a){if("object"===a.type)return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===a.type)return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}var s=n.parse(i,o);t(s.geometry,s.materials)})},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){function r(t){function r(e,t){return e&1<<t}var i,n,o,s,h,c,l,u,d,m,p,E,f,T,v,g,y,R,_,x,b,H,C,S,M,w,D,A=e.faces,L=e.vertices,O=e.normals,U=e.colors,I=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&I++;for(i=0;I>i;i++)a.faceVertexUvs[i]=[]}for(s=0,h=L.length;h>s;)R=new THREE.Vector3,R.x=L[s++]*t,R.y=L[s++]*t,R.z=L[s++]*t,a.vertices.push(R);for(s=0,h=A.length;h>s;)if(m=A[s++],p=r(m,0),E=r(m,1),f=r(m,3),T=r(m,4),v=r(m,5),g=r(m,6),y=r(m,7),p){if(x=new THREE.Face3,x.a=A[s],x.b=A[s+1],x.c=A[s+3],b=new THREE.Face3,b.a=A[s+1],b.b=A[s+2],b.c=A[s+3],s+=4,E&&(d=A[s++],x.materialIndex=d,b.materialIndex=d),o=a.faces.length,f)for(i=0;I>i;i++)for(S=e.uvs[i],a.faceVertexUvs[i][o]=[],a.faceVertexUvs[i][o+1]=[],n=0;4>n;n++)u=A[s++],w=S[2*u],D=S[2*u+1],M=new THREE.Vector2(w,D),2!==n&&a.faceVertexUvs[i][o].push(M),0!==n&&a.faceVertexUvs[i][o+1].push(M);if(T&&(l=3*A[s++],x.normal.set(O[l++],O[l++],O[l]),b.normal.copy(x.normal)),v)for(i=0;4>i;i++)l=3*A[s++],C=new THREE.Vector3(O[l++],O[l++],O[l]),2!==i&&x.vertexNormals.push(C),0!==i&&b.vertexNormals.push(C);if(g&&(c=A[s++],H=U[c],x.color.setHex(H),b.color.setHex(H)),y)for(i=0;4>i;i++)c=A[s++],H=U[c],2!==i&&x.vertexColors.push(new THREE.Color(H)),0!==i&&b.vertexColors.push(new THREE.Color(H));a.faces.push(x),a.faces.push(b);
}else{if(_=new THREE.Face3,_.a=A[s++],_.b=A[s++],_.c=A[s++],E&&(d=A[s++],_.materialIndex=d),o=a.faces.length,f)for(i=0;I>i;i++)for(S=e.uvs[i],a.faceVertexUvs[i][o]=[],n=0;3>n;n++)u=A[s++],w=S[2*u],D=S[2*u+1],M=new THREE.Vector2(w,D),a.faceVertexUvs[i][o].push(M);if(T&&(l=3*A[s++],_.normal.set(O[l++],O[l++],O[l])),v)for(i=0;3>i;i++)l=3*A[s++],C=new THREE.Vector3(O[l++],O[l++],O[l]),_.vertexNormals.push(C);if(g&&(c=A[s++],_.color.setHex(U[c])),y)for(i=0;3>i;i++)c=A[s++],_.vertexColors.push(new THREE.Color(U[c]));a.faces.push(_)}}function i(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;i>r;r+=t){var n=e.skinWeights[r],o=t>1?e.skinWeights[r+1]:0,s=t>2?e.skinWeights[r+2]:0,h=t>3?e.skinWeights[r+3]:0;a.skinWeights.push(new THREE.Vector4(n,o,s,h))}if(e.skinIndices)for(var r=0,i=e.skinIndices.length;i>r;r+=t){var c=e.skinIndices[r],l=t>1?e.skinIndices[r+1]:0,u=t>2?e.skinIndices[r+2]:0,d=t>3?e.skinIndices[r+3]:0;a.skinIndices.push(new THREE.Vector4(c,l,u,d))}a.bones=e.bones,a.bones&&a.bones.length>0&&(a.skinWeights.length!==a.skinIndices.length||a.skinIndices.length!==a.vertices.length)&&console.warn("When skinning, number of vertices ("+a.vertices.length+"), skinIndices ("+a.skinIndices.length+"), and skinWeights ("+a.skinWeights.length+") should match.")}function n(t){if(void 0!==e.morphTargets)for(var r=0,i=e.morphTargets.length;i>r;r++){a.morphTargets[r]={},a.morphTargets[r].name=e.morphTargets[r].name,a.morphTargets[r].vertices=[];for(var n=a.morphTargets[r].vertices,o=e.morphTargets[r].vertices,s=0,h=o.length;h>s;s+=3){var c=new THREE.Vector3;c.x=o[s]*t,c.y=o[s+1]*t,c.z=o[s+2]*t,n.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var l=a.faces,u=e.morphColors[0].colors,r=0,i=l.length;i>r;r++)l[r].color.fromArray(u,3*r)}}function o(){var t=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var i=0;i<r.length;i++){var n=THREE.AnimationClip.parseAnimation(r[i],a.bones);n&&t.push(n)}if(a.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(a.morphTargets,10);t=t.concat(o)}t.length>0&&(a.animations=t)}var a=new THREE.Geometry,s=void 0!==e.scale?1/e.scale:1;if(r(s),i(),n(s),o(),a.computeFaceNormals(),a.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:a};var h=THREE.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:a,materials:h}}},THREE.LoadingManager=function(e,t,r){var i=this,n=!1,o=0,a=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,n===!1&&void 0!==i.onStart&&i.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,r,i){var n=this,o=new THREE.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry,r=e.data.index;if(void 0!==r){var i=new self[r.type](r.array);t.setIndex(new THREE.BufferAttribute(i,1))}var n=e.data.attributes;for(var o in n){var a=n[o],i=new self[a.type](a.array);t.addAttribute(o,new THREE.BufferAttribute(i,a.itemSize))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var h=0,c=s.length;h!==c;++h){var l=s[h];t.addGroup(l.start,l.count)}var u=e.data.boundingSphere;if(void 0!==u){var d=new THREE.Vector3;void 0!==u.center&&d.fromArray(u.center),t.boundingSphere=new THREE.Sphere(d,u.radius)}return t}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.textures={}},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,r,i){var n=this,o=new THREE.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new THREE[e.type];if(t.uuid=e.uuid,void 0!==e.name&&(t.name=e.name),void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=this.getTexture(e.map)),void 0!==e.alphaMap&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.getTexture(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=this.getTexture(e.normalMap)),e.normalScale&&(t.normalScale=new THREE.Vector2(e.normalScale,e.normalScale)),void 0!==e.displacementMap&&(t.displacementMap=this.getTexture(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.specularMap&&(t.specularMap=this.getTexture(e.specularMap)),void 0!==e.envMap&&(t.envMap=this.getTexture(e.envMap),t.combine=THREE.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.lightMap&&(t.lightMap=this.getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=this.getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.materials)for(var r=0,i=e.materials.length;i>r;r++)t.materials.push(this.parse(e.materials[r]));return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.texturePath=""},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,r,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this,o=new THREE.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){n.parse(JSON.parse(e),t)},r,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){void 0!==t&&t(a)}),n=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,n),a=this.parseObject(e.object,r,o);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new THREE.JSONLoader,i=new THREE.BufferGeometryLoader,n=0,o=e.length;o>n;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new THREE[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleBufferGeometry":a=new THREE.CircleBufferGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CircleGeometry":a=new THREE.CircleGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":a=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":a=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"SphereBufferGeometry":a=new THREE.SphereBufferGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":a=new THREE.DodecahedronGeometry(s.radius,s.detail);break;case"IcosahedronGeometry":a=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"OctahedronGeometry":a=new THREE.OctahedronGeometry(s.radius,s.detail);break;case"TetrahedronGeometry":a=new THREE.TetrahedronGeometry(s.radius,s.detail);break;case"RingGeometry":a=new THREE.RingGeometry(s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":a=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=i.parse(s);break;case"Geometry":a=r.parse(s.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e,t){var r={};if(void 0!==e){var i=new THREE.MaterialLoader;i.setTextures(t);for(var n=0,o=e.length;o>n;n++){var a=i.parse(e[n]);r[a.uuid]=a}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=THREE.AnimationClip.parse(e[r]);t.push(i)}return t},parseImages:function(e,t){function r(e){return i.manager.itemStart(e),a.load(e,function(){i.manager.itemEnd(e)})}var i=this,n={};if(void 0!==e&&e.length>0){var o=new THREE.LoadingManager(t),a=new THREE.ImageLoader(o);a.setCrossOrigin(this.crossOrigin);for(var s=0,h=e.length;h>s;s++){var c=e[s],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.texturePath+c.url;n[c.uuid]=r(l)}}return n},parseTextures:function(e,t){function r(e){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),THREE[e])}var i={};if(void 0!==e)for(var n=0,o=e.length;o>n;n++){var a=e[n];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new THREE.Texture(t[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=r(a.mapping)),void 0!==a.offset&&(s.offset=new THREE.Vector2(a.offset[0],a.offset[1])),void 0!==a.repeat&&(s.repeat=new THREE.Vector2(a.repeat[0],a.repeat[1])),void 0!==a.minFilter&&(s.minFilter=r(a.minFilter)),void 0!==a.magFilter&&(s.magFilter=r(a.magFilter)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),Array.isArray(a.wrap)&&(s.wrapS=r(a.wrap[0]),s.wrapT=r(a.wrap[1])),i[a.uuid]=s}return i},parseObject:function(){var e=new THREE.Matrix4;return function(t,r,i){function n(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),r[e]}function o(e){return void 0!==e?(void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]):void 0}var a;switch(t.type){case"Scene":a=new THREE.Scene;break;case"PerspectiveCamera":a=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":a=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new THREE.AmbientLight(t.color);break;case"DirectionalLight":a=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new THREE.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":a=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":a=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":a=new THREE.Mesh(n(t.geometry),o(t.material));break;case"LOD":a=new THREE.LOD;break;case"Line":a=new THREE.Line(n(t.geometry),o(t.material),t.mode);break;case"PointCloud":case"Points":a=new THREE.Points(n(t.geometry),o(t.material));break;case"Sprite":a=new THREE.Sprite(o(t.material));break;case"Group":a=new THREE.Group;break;default:a=new THREE.Object3D}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.children)for(var s in t.children)a.add(this.parseObject(t.children[s],r,i));if("LOD"===t.type)for(var h=t.levels,c=0;c<h.length;c++){var l=h[c],s=a.getObjectByProperty("uuid",l.object);void 0!==s&&a.addLevel(s,l.distance)}return a}}()},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,r,i){var n=new THREE.Texture,o=new THREE.ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.CubeTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.CubeTextureLoader.prototype={constructor:THREE.CubeTextureLoader,load:function(e,t,r,i){function n(r){a.load(e[r],function(e){o.images[r]=e,s++,6===s&&(o.needsUpdate=!0,t&&t(o))},void 0,i)}var o=new THREE.CubeTexture([]),a=new THREE.ImageLoader;a.setCrossOrigin(this.crossOrigin);for(var s=0,h=0;h<e.length;++h)n(h);return o},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=null},THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(e,t,r,i){var n=this,o=new THREE.DataTexture,a=new THREE.XHRLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setResponseType("arraybuffer"),a.load(e,function(e){var r=n._parser(e);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:THREE.ClampToEdgeWrapping,o.wrapT=void 0!==r.wrapT?r.wrapT:THREE.ClampToEdgeWrapping,o.magFilter=void 0!==r.magFilter?r.magFilter:THREE.LinearFilter,o.minFilter=void 0!==r.minFilter?r.minFilter:THREE.LinearMipMapLinearFilter,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=THREE.LinearFilter),o.needsUpdate=!0,t&&t(o,r))},r,i),o},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.CompressedTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=null},THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(e,t,r,i){var n=this,o=[],a=new THREE.CompressedTexture;a.image=o;var s=new THREE.XHRLoader(this.manager);if(s.setCrossOrigin(this.crossOrigin),s.setResponseType("arraybuffer"),Array.isArray(e))for(var h=0,c=function(c){s.load(e[c],function(e){var r=n._parser(e,!0);o[c]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},h+=1,6===h&&(1===r.mipmapCount&&(a.minFilter=THREE.LinearFilter),a.format=r.format,a.needsUpdate=!0,t&&t(a))},r,i)},l=0,u=e.length;u>l;++l)c(l);else s.load(e,function(e){var r=n._parser(e,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,s=0;i>s;s++){o[s]={mipmaps:[]};for(var h=0;h<r.mipmapCount;h++)o[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+h]),o[s].format=r.format,o[s].width=r.width,o[s].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=THREE.LinearFilter),a.format=r.format,a.needsUpdate=!0,t&&t(a)},r,i);return a},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Material",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=THREE.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){var i=this[t];void 0!==i?i instanceof THREE.Color?i.set(r):i instanceof THREE.Vector3&&r instanceof THREE.Vector3?i.copy(r):"overdraw"===t?this[t]=Number(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};return t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),this.color instanceof THREE.Color&&(t.color=this.color.getHex()),this.emissive instanceof THREE.Color&&(t.emissive=this.emissive.getHex()),this.specular instanceof THREE.Color&&(t.specular=this.specular.getHex()),void 0!==this.shininess&&(t.shininess=this.shininess),this.map instanceof THREE.Texture&&(t.map=this.map.toJSON(e).uuid),this.alphaMap instanceof THREE.Texture&&(t.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof THREE.Texture&&(t.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof THREE.Texture&&(t.bumpMap=this.bumpMap.toJSON(e).uuid,t.bumpScale=this.bumpScale),this.normalMap instanceof THREE.Texture&&(t.normalMap=this.normalMap.toJSON(e).uuid,t.normalScale=this.normalScale),this.displacementMap instanceof THREE.Texture&&(t.displacementMap=this.displacementMap.toJSON(e).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.specularMap instanceof THREE.Texture&&(t.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof THREE.Texture&&(t.envMap=this.envMap.toJSON(e).uuid,t.reflectivity=this.reflectivity),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==THREE.NoColors&&(t.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==THREE.SmoothShading&&(t.shading=this.shading),void 0!==this.blending&&this.blending!==THREE.NormalBlending&&(t.blending=this.blending),void 0!==this.side&&this.side!==THREE.FrontSide&&(t.side=this.side),this.opacity<1&&(t.opacity=this.opacity),this.transparent===!0&&(t.transparent=this.transparent),this.alphaTest>0&&(t.alphaTest=this.alphaTest),this.wireframe===!0&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),t},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.side=e.side,this.opacity=e.opacity,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.overdraw=e.overdraw,this.visible=e.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new THREE.Color}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.type="LineBasicMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.LineBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.type="LineDashedMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial,THREE.LineDashedMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.type="MeshBasicMaterial",this.color=new THREE.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.type="MeshLambertMaterial",this.color=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.map=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshLambertMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.map=e.map,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.type="MeshPhongMaterial",this.color=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshPhongMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.specular.copy(e.specular),this.shininess=e.shininess,this.metal=e.metal,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissiveMap=e.emissiveMap,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshDepthMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshNormalMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MultiMaterial=function(e){this.uuid=THREE.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,r=this.materials.length;r>t;t++)e.materials.push(this.materials[t].toJSON());return e.visible=this.visible,e},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},THREE.MeshFaceMaterial=THREE.MultiMaterial,THREE.PointsMaterial=function(e){THREE.Material.call(this),this.type="PointsMaterial",this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype),THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial,THREE.PointsMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},THREE.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},THREE.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.derivatives=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.ShaderMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.attributes=e.attributes,this.defines=e.defines,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.derivatives=e.derivatives,this},THREE.ShaderMaterial.prototype.toJSON=function(e){var t=THREE.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.attributes=this.attributes,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),
THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial,THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.type="SpriteMaterial",this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial,THREE.SpriteMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.fog=e.fog,this},THREE.Texture=function(e,t,r,i,n,o,a,s,h){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:THREE.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:THREE.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.version=0,this.onUpdate=null},THREE.Texture.DEFAULT_IMAGE=void 0,THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping,THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(e){e===!0&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this},toJSON:function(e){function t(e){var t;return void 0!==e.toDataURL?t=e:(t=document.createElement("canvas"),t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=THREE.Math.generateUUID()),void 0===e.images[i.uuid]&&(e.images[i.uuid]={uuid:i.uuid,url:t(i)}),r.image=i.uuid}return e.textures[this.uuid]=r,r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===THREE.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case THREE.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case THREE.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case THREE.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case THREE.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CanvasTexture=function(e,t,r,i,n,o,a,s,h){THREE.Texture.call(this,e,t,r,i,n,o,a,s,h),this.needsUpdate=!0},THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture,THREE.CubeTexture=function(e,t,r,i,n,o,a,s,h){t=void 0!==t?t:THREE.CubeReflectionMapping,THREE.Texture.call(this,e,t,r,i,n,o,a,s,h),this.images=e,this.flipY=!1},THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CubeTexture.prototype.constructor=THREE.CubeTexture,THREE.CubeTexture.prototype.copy=function(e){return THREE.Texture.prototype.copy.call(this,e),this.images=e.images,this},THREE.CompressedTexture=function(e,t,r,i,n,o,a,s,h,c,l){THREE.Texture.call(this,null,o,a,s,h,c,i,n,l),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture,THREE.DataTexture=function(e,t,r,i,n,o,a,s,h,c,l){THREE.Texture.call(this,null,o,a,s,h,c,i,n,l),this.image={data:e,width:t,height:r},this.magFilter=void 0!==h?h:THREE.NearestFilter,this.minFilter=void 0!==c?c:THREE.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.VideoTexture=function(e,t,r,i,n,o,a,s,h){function c(){requestAnimationFrame(c),e.readyState===e.HAVE_ENOUGH_DATA&&(l.needsUpdate=!0)}THREE.Texture.call(this,e,t,r,i,n,o,a,s,h),this.generateMipmaps=!1;var l=this;c()},THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype),THREE.VideoTexture.prototype.constructor=THREE.VideoTexture,THREE.Group=function(){THREE.Object3D.call(this),this.type="Group"},THREE.Group.prototype=Object.create(THREE.Object3D.prototype),THREE.Group.prototype.constructor=THREE.Group,THREE.Points=function(e,t){THREE.Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.PointsMaterial({color:16777215*Math.random()})},THREE.Points.prototype=Object.create(THREE.Object3D.prototype),THREE.Points.prototype.constructor=THREE.Points,THREE.Points.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray;return function(r,i){function n(e,n){var a=t.distanceSqToPoint(e);if(c>a){var s=t.closestPointToPoint(e);s.applyMatrix4(o.matrixWorld);var h=r.ray.origin.distanceTo(s);if(h<r.near||h>r.far)return;i.push({distance:h,distanceToRay:Math.sqrt(a),point:s.clone(),index:n,face:null,object:o})}}var o=this,a=o.geometry,s=r.params.Points.threshold;if(e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),null===a.boundingBox||t.isIntersectionBox(a.boundingBox)!==!1){var h=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=h*h,l=new THREE.Vector3;if(a instanceof THREE.BufferGeometry){var u=a.index,d=a.attributes,m=d.position.array;if(null!==u)for(var p=u.array,E=0,f=p.length;f>E;E++){var T=p[E];l.fromArray(m,3*T),n(l,T)}else for(var E=0,v=m.length/3;v>E;E++)l.fromArray(m,3*E),n(l,E)}else for(var g=a.vertices,E=0,v=g.length;v>E;E++)n(g[E],E)}}}(),THREE.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},THREE.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new THREE.Points(e,t)},THREE.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new THREE.Points(e,t)},THREE.Line=function(e,t,r){return 1===r?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new THREE.LineSegments(e,t)):(THREE.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new THREE.Geometry,void(this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()})))},THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.constructor=THREE.Line,THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,r=new THREE.Sphere;return function(i,n){var o=i.linePrecision,a=o*o,s=this.geometry;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(this.matrixWorld),i.ray.isIntersectionSphere(r)!==!1){e.getInverse(this.matrixWorld),t.copy(i.ray).applyMatrix4(e);var h=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,d=this instanceof THREE.LineSegments?2:1;if(s instanceof THREE.BufferGeometry){var m=s.index,p=s.attributes;if(null!==m)for(var E=m.array,f=p.position.array,T=0,v=E.length-1;v>T;T+=d){var g=E[T],y=E[T+1];h.fromArray(f,3*g),c.fromArray(f,3*y);var R=t.distanceSqToSegment(h,c,u,l);if(!(R>a)){u.applyMatrix4(this.matrixWorld);var _=i.ray.origin.distanceTo(u);_<i.near||_>i.far||n.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}else for(var f=p.position.array,T=0,v=f.length/3-1;v>T;T+=d){h.fromArray(f,3*T),c.fromArray(f,3*T+3);var R=t.distanceSqToSegment(h,c,u,l);if(!(R>a)){u.applyMatrix4(this.matrixWorld);var _=i.ray.origin.distanceTo(u);_<i.near||_>i.far||n.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}}else if(s instanceof THREE.Geometry)for(var x=s.vertices,b=x.length,T=0;b-1>T;T+=d){var R=t.distanceSqToSegment(x[T],x[T+1],u,l);if(!(R>a)){u.applyMatrix4(this.matrixWorld);var _=i.ray.origin.distanceTo(u);_<i.near||_>i.far||n.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}}}}(),THREE.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},THREE.LineStrip=0,THREE.LinePieces=1,THREE.LineSegments=function(e,t){THREE.Line.call(this,e,t),this.type="LineSegments"},THREE.LineSegments.prototype=Object.create(THREE.Line.prototype),THREE.LineSegments.prototype.constructor=THREE.LineSegments,THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.raycast=function(){function e(e,t,r,i,n,o,a){return THREE.Triangle.barycoordFromPoint(e,t,r,i,E),n.multiplyScalar(E.x),o.multiplyScalar(E.y),a.multiplyScalar(E.z),n.add(o).add(a),n.clone()}function t(e,t,r,i,n,o,a){var s,h=e.material;if(s=h.side===THREE.BackSide?r.intersectTriangle(o,n,i,!0,a):r.intersectTriangle(i,n,o,h.side!==THREE.DoubleSide,a),null===s)return null;T.copy(a),T.applyMatrix4(e.matrixWorld);var c=t.ray.origin.distanceTo(T);return c<t.near||c>t.far?null:{distance:c,point:T.clone(),object:e}}function r(r,i,n,o,c,l,u,E){a.fromArray(o,3*l),s.fromArray(o,3*u),h.fromArray(o,3*E);var T=t(r,i,n,a,s,h,f);return T&&(c&&(d.fromArray(c,2*l),m.fromArray(c,2*u),p.fromArray(c,2*E),T.uv=e(f,a,s,h,d,m,p)),T.face=new THREE.Face3(l,u,E,THREE.Triangle.normal(a,s,h)),T.faceIndex=l),T}var i=new THREE.Matrix4,n=new THREE.Ray,o=new THREE.Sphere,a=new THREE.Vector3,s=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,d=new THREE.Vector2,m=new THREE.Vector2,p=new THREE.Vector2,E=new THREE.Vector3,f=new THREE.Vector3,T=new THREE.Vector3;return function(E,T){var v=this.geometry,g=this.material;if(void 0!==g){null===v.boundingSphere&&v.computeBoundingSphere();var y=this.matrixWorld;if(o.copy(v.boundingSphere),o.applyMatrix4(y),E.ray.isIntersectionSphere(o)!==!1&&(i.getInverse(y),n.copy(E.ray).applyMatrix4(i),null===v.boundingBox||n.isIntersectionBox(v.boundingBox)!==!1)){var R,_;if(v instanceof THREE.BufferGeometry){var x,b,H,C=v.index,S=v.attributes,M=S.position.array;if(void 0!==S.uv&&(R=S.uv.array),null!==C)for(var w=C.array,D=0,A=w.length;A>D;D+=3)x=w[D],b=w[D+1],H=w[D+2],_=r(this,E,n,M,R,x,b,H),_&&(_.faceIndex=Math.floor(D/3),T.push(_));else for(var D=0,A=M.length;A>D;D+=9)x=D/3,b=x+1,H=x+2,_=r(this,E,n,M,R,x,b,H),_&&(_.index=x,T.push(_))}else if(v instanceof THREE.Geometry){var L,O,U,I=g instanceof THREE.MeshFaceMaterial,P=I===!0?g.materials:null,k=v.vertices,F=v.faces,B=v.faceVertexUvs[0];B.length>0&&(R=B);for(var V=0,G=F.length;G>V;V++){var N=F[V],z=I===!0?P[N.materialIndex]:g;if(void 0!==z){if(L=k[N.a],O=k[N.b],U=k[N.c],z.morphTargets===!0){var j=v.morphTargets,W=this.morphTargetInfluences;a.set(0,0,0),s.set(0,0,0),h.set(0,0,0);for(var X=0,Y=j.length;Y>X;X++){var K=W[X];if(0!==K){var q=j[X].vertices;a.addScaledVector(c.subVectors(q[N.a],L),K),s.addScaledVector(l.subVectors(q[N.b],O),K),h.addScaledVector(u.subVectors(q[N.c],U),K)}}a.add(L),s.add(O),h.add(U),L=a,O=s,U=h}if(_=t(this,E,n,L,O,U,f)){if(R){var Q=R[V];d.copy(Q[0]),m.copy(Q[1]),p.copy(Q[2]),_.uv=e(f,L,O,U,d,m,p)}_.face=N,_.faceIndex=V,T.push(_)}}}}}}}}(),THREE.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},THREE.Bone=function(e){THREE.Object3D.call(this),this.type="Bone",this.skin=e},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this},THREE.Skeleton=function(e,t,r){if(this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new THREE.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var i=Math.sqrt(4*this.bones.length);i=THREE.Math.nextPowerOfTwo(Math.ceil(i)),i=Math.max(i,4),this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var n=0,o=this.bones.length;o>n;n++)this.boneInverses.push(new THREE.Matrix4)}},THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var r=new THREE.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},THREE.Skeleton.prototype.pose=function(){for(var e,t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},THREE.Skeleton.prototype.update=function(){var e=new THREE.Matrix4;return function(){for(var t=0,r=this.bones.length;r>t;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.Skeleton.prototype.clone=function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},THREE.SkinnedMesh=function(e,t,r){THREE.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new THREE.Matrix4,this.bindMatrixInverse=new THREE.Matrix4;var i=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,o,a=0,s=this.geometry.bones.length;s>a;++a)o=this.geometry.bones[a],n=new THREE.Bone(this),i.push(n),n.name=o.name,n.position.fromArray(o.pos),n.quaternion.fromArray(o.rotq),void 0!==o.scl&&n.scale.fromArray(o.scl);for(var a=0,s=this.geometry.bones.length;s>a;++a)o=this.geometry.bones[a],-1!==o.parent&&null!==o.parent?i[o.parent].add(i[a]):this.add(i[a])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new THREE.Skeleton(i,void 0,r),this.matrixWorld)},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},THREE.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},THREE.LOD=function(){THREE.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=this.levels,r=1,i=t.length;i>r&&!(e<t[r].distance);r++);return t[r-1].object},THREE.LOD.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}(),THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);i[0].object.visible=!0;for(var o=1,a=i.length;a>o&&n>=i[o].distance;o++)i[o-1].object.visible=!1,i[o].object.visible=!0;for(;a>o;o++)i[o].object.visible=!1}}}(),THREE.LOD.prototype.copy=function(e){THREE.Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;i>r;r++){var n=t[r];this.addLevel(n.object.clone(),n.distance)}return this},THREE.LOD.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,n=r.length;n>i;i++){var o=r[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t},THREE.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]),i=new THREE.BufferGeometry;return i.setIndex(new THREE.BufferAttribute(e,1)),i.addAttribute("position",new THREE.BufferAttribute(t,3)),i.addAttribute("uv",new THREE.BufferAttribute(r,2)),function(e){THREE.Object3D.call(this),this.type="Sprite",this.geometry=i,this.material=void 0!==e?e:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceSqToPoint(e),n=this.scale.x*this.scale.y;i>n||r.push({distance:Math.sqrt(i),point:this.position,face:null,object:this})}}(),THREE.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},THREE.Particle=THREE.Sprite,THREE.LensFlare=function(e,t,r,i,n){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,n)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.add=function(e,t,r,i,n,o){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===n&&(n=new THREE.Color(16777215)),void 0===i&&(i=THREE.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:n,blending:i})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.LensFlare.prototype.copy=function(e){THREE.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,r=e.lensFlares.length;r>t;t++)this.lensFlares.push(e.lensFlares[t]);return this},THREE.Scene=function(){THREE.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},THREE.Fog=function(e,t,r){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.ShaderChunk={},THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",THREE.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n	totalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n",THREE.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n\n#endif",THREE.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",THREE.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n",THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif",THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	vColor.xyz = color.xyz;\n\n#endif",THREE.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	float distance = dot( planeNormal, point - pointOnPlane );\n\n	return - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n	if ( decayExponent > 0.0 ) {\n\n	  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n	}\n\n	return 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n\n	float fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n\n	return 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n\n	return ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n	vec3 halfDir = normalize( lightDir + viewDir );\n\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotLH = saturate( dot( lightDir, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n	float D = D_BlinnPhong( shininess, dotNH );\n\n	return F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n	#ifdef GAMMA_INPUT\n\n		return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n	#ifdef GAMMA_OUTPUT\n\n		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n",THREE.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",THREE.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",THREE.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n\n#endif\n",THREE.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n	emissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n	totalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n",THREE.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\n	uniform sampler2D emissiveMap;\n\n#endif\n",THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",THREE.ShaderChunk.hemilight_fragment="#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalAmbientLight += lightColor;\n\n	}\n\n#endif\n\n",THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	totalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n",THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n\n#endif",
THREE.ShaderChunk.lights_lambert_pars_vertex="#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n",THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n\n			float dotProduct = dot( normal, lightDir );\n\n			vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			float hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n",THREE.ShaderChunk.lights_phong_fragment="vec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lightPosition = pointLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n\n			float cosineTerm = saturate( dot( normal, lightDir ) );\n\n			totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n			vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n			totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * cosineTerm;\n\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n	}\n\n#endif\n",THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n",THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\n#endif\n",THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif\n",THREE.ShaderChunk.linear_to_gamma_fragment="\n	outgoingLight = linearToOutput( outgoingLight );\n",THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif\n",THREE.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n",THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.normal_phong_fragment="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n",THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",THREE.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	for ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		float texelSizeY =  1.0 / shadowMapSize[ i ].y;\n\n		float shadow = 0.0;\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n		bool isPointLight = shadowDarkness[ i ] < 0.0;\n\n		if ( isPointLight ) {\n\n			float realShadowDarkness = abs( shadowDarkness[ i ] );\n\n			vec3 lightToPosition = vShadowCoord[ i ].xyz;\n\n	#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n			vec3 bd3D = normalize( lightToPosition );\n			float dp = length( lightToPosition );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\n	#if defined( SHADOWMAP_TYPE_PCF )\n			const float Dr = 1.25;\n	#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			const float Dr = 2.25;\n	#endif\n\n			float os = Dr *  2.0 * texelSizeY;\n\n			const vec3 Gsd = vec3( - 1, 0, 1 );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			shadow *= realShadowDarkness * ( 1.0 / 21.0 );\n\n	#else \n			vec3 bd3D = normalize( lightToPosition );\n			float dp = length( lightToPosition );\n\n			adjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n			shadow *= realShadowDarkness;\n\n	#endif\n\n		} else {\n\n#endif \n			float texelSizeX =  1.0 / shadowMapSize[ i ].x;\n\n			vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\n			bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n			bool inFrustum = all( inFrustumVec );\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n			bool frustumTest = all( frustumTestVec );\n\n			if ( frustumTest ) {\n\n	#if defined( SHADOWMAP_TYPE_PCF )\n\n\n				/*\n					for ( float y = -1.25; y <= 1.25; y += 1.25 )\n						for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n							vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n							float fDepth = unpackDepth( rgbaDepth );\n							if ( fDepth < shadowCoord.z )\n								shadow += 1.0;\n					}\n					shadow /= 9.0;\n				*/\n\n				shadowCoord.z += shadowBias[ i ];\n\n				const float ShadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = texelSizeX;\n				float yPixelOffset = texelSizeY;\n\n				float dx0 = - 1.25 * xPixelOffset;\n				float dy0 = - 1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				float fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n				shadow *= shadowDarkness[ i ];\n\n	#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\n				shadowCoord.z += shadowBias[ i ];\n\n				float xPixelOffset = texelSizeX;\n				float yPixelOffset = texelSizeY;\n\n				float dx0 = - 1.0 * xPixelOffset;\n				float dy0 = - 1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[ 0 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[ 0 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[ 0 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[ 1 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[ 1 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[ 1 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[ 2 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[ 2 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[ 2 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[ 0 ] = vec3( lessThan( depthKernel[ 0 ], shadowZ ) );\n				shadowKernel[ 0 ] *= vec3( 0.25 );\n\n				shadowKernel[ 1 ] = vec3( lessThan( depthKernel[ 1 ], shadowZ ) );\n				shadowKernel[ 1 ] *= vec3( 0.25 );\n\n				shadowKernel[ 2 ] = vec3( lessThan( depthKernel[ 2 ], shadowZ ) );\n				shadowKernel[ 2 ] *= vec3( 0.25 );\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[ i ].xy );\n\n				shadowKernel[ 0 ] = mix( shadowKernel[ 1 ], shadowKernel[ 0 ], fractionalCoord.x );\n				shadowKernel[ 1 ] = mix( shadowKernel[ 2 ], shadowKernel[ 1 ], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[ 0 ][ 1 ], shadowKernel[ 0 ][ 0 ], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[ 0 ][ 2 ], shadowKernel[ 0 ][ 1 ], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[ 1 ][ 1 ], shadowKernel[ 1 ][ 0 ], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[ 1 ][ 2 ], shadowKernel[ 1 ][ 1 ], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) ) * shadowDarkness[ i ];\n\n	#else \n				shadowCoord.z += shadowBias[ i ];\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n					shadow = shadowDarkness[ i ];\n\n	#endif\n\n			}\n\n#ifdef SHADOWMAP_DEBUG\n\n			if ( inFrustum ) {\n\n				if ( i == 0 ) {\n\n					outgoingLight *= vec3( 1.0, 0.5, 0.0 );\n\n				} else if ( i == 1 ) {\n\n					outgoingLight *= vec3( 0.0, 1.0, 0.8 );\n\n				} else {\n\n					outgoingLight *= vec3( 0.0, 0.5, 1.0 );\n\n				}\n\n			}\n\n#endif\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n		}\n\n#endif\n\n		shadowMask = shadowMask * vec3( 1.0 - shadow );\n\n	}\n\n#endif\n",THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n	#if defined(POINT_LIGHT_SHADOWS)\n\n\n		void adjustShadowValue1K( const float testDepth, const vec4 textureData, const float bias, inout float shadowValue ) {\n\n			const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n			if ( testDepth >= dot( textureData, bitSh ) * 1000.0 + bias )\n				shadowValue += 1.0;\n\n		}\n\n\n		vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\n			vec3 absV = abs( v );\n\n\n			float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n			absV *= scaleToCube;\n\n\n			v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\n\n			vec2 planar = v.xy;\n\n			float almostATexel = 1.5 * texelSizeY;\n			float almostOne = 1.0 - almostATexel;\n\n			if ( absV.z >= almostOne ) {\n\n				if ( v.z > 0.0 )\n					planar.x = 4.0 - v.x;\n\n			} else if ( absV.x >= almostOne ) {\n\n				float signX = sign( v.x );\n				planar.x = v.z * signX + 2.0 * signX;\n\n			} else if ( absV.y >= almostOne ) {\n\n				float signY = sign( v.y );\n				planar.x = v.x + 2.0 * signY + 2.0;\n				planar.y = v.z * signY - 2.0;\n\n			}\n\n\n			return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n		}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n#endif",THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",THREE.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	vUv2 = uv2;\n\n#endif",THREE.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n\n#endif",THREE.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",THREE.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n	#endif\n\n#endif\n",THREE.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var i=this.clone(e[r]);for(var n in i)t[n]=i[n]}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var i in e[r]){var n=e[r][i];n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix3||n instanceof THREE.Matrix4||n instanceof THREE.Texture?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = vec3( 1.0 );","	vec3 shadowMask = vec3( 1.0 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.aomap_fragment,THREE.ShaderChunk.shadowmap_fragment,"	outgoingLight = diffuseColor.rgb * totalAmbientLight * shadowMask;",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")
},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","uniform vec3 ambientLightColor;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = ambientLightColor;","	vec3 shadowMask = vec3( 1.0 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.shadowmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","		else","			outgoingLight += diffuseColor.rgb * ( vLightBack * shadowMask + totalAmbientLight ) + emissive;","	#else","		outgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","	#endif",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.displacementmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.displacementmap_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = ambientLightColor;","	vec3 totalEmissiveLight = emissive;","	vec3 shadowMask = vec3( 1.0 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.normal_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.hemilight_fragment,THREE.ShaderChunk.aomap_fragment,THREE.ShaderChunk.emissivemap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.shadowmap_fragment,"totalDiffuseLight *= shadowMask;","totalSpecularLight *= shadowMask;","#ifdef METAL","	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;","#else","	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;","#endif",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );","	vec3 shadowMask = vec3( 1.0 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.shadowmap_fragment,"	outgoingLight = diffuseColor.rgb * shadowMask;",THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,"	outgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new THREE.Vector3(0,0,0)}},vertexShader:["varying vec4 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.worldpos_vertex,"vWorldPosition = worldPosition;","}"].join("\n"),fragmentShader:["uniform vec3 lightPos;","varying vec4 vWorldPosition;",THREE.ShaderChunk.common,"vec4 pack1K ( float depth ) {","   depth /= 1000.0;","   const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = fract( depth * bitSh );","	res -= res.xxyz * bitMsk;","	return res; ","}","float unpack1K ( vec4 color ) {","	const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","	return dot( color, bitSh ) * 1000.0;","}","void main () {","	gl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );","}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(e,t,r,i){oe===!0&&(e*=i,t*=i,r*=i),Fe.clearColor(e,t,r,i)}function r(){ze.init(),Fe.viewport(be,He,Ce,Se),t(se.r,se.g,se.b,he)}function i(){ve=null,_e=null,Re="",ye=-1,Ue=!0,ze.reset()}function n(e){e.preventDefault(),i(),r(),je.clear()}function o(e){var t=e.target;t.removeEventListener("dispose",o),h(t),Pe.textures--}function a(e){var t=e.target;t.removeEventListener("dispose",a),c(t),Pe.textures--}function s(e){var t=e.target;t.removeEventListener("dispose",s),l(t)}function h(e){var t=je.get(e);if(e.image&&t.__image__webglTextureCube)Fe.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)return;Fe.deleteTexture(t.__webglTexture)}je["delete"](e)}function c(e){var t=je.get(e),r=je.get(e.texture);if(e&&void 0!==r.__webglTexture){if(Fe.deleteTexture(r.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var i=0;6>i;i++)Fe.deleteFramebuffer(t.__webglFramebuffer[i]),Fe.deleteRenderbuffer(t.__webglRenderbuffer[i]);else Fe.deleteFramebuffer(t.__webglFramebuffer),Fe.deleteRenderbuffer(t.__webglRenderbuffer);je["delete"](e.texture),je["delete"](e)}}function l(e){u(e),je["delete"](e)}function u(e){var t=je.get(e).program;e.program=void 0,void 0!==t&&Xe.releaseProgram(t)}function d(e,t,r,i){var n;if(r instanceof THREE.InstancedBufferGeometry&&(n=Ge.get("ANGLE_instanced_arrays"),null===n))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===i&&(i=0),ze.initAttributes();var o=r.attributes,a=t.getAttributes(),s=e.defaultAttributeValues;for(var h in a){var c=a[h];if(c>=0){var l=o[h];if(void 0!==l){var u=l.itemSize,d=We.getAttributeBuffer(l);if(l instanceof THREE.InterleavedBufferAttribute){var m=l.data,p=m.stride,E=l.offset;m instanceof THREE.InstancedInterleavedBuffer?(ze.enableAttributeAndDivisor(c,m.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=m.meshPerAttribute*m.count)):ze.enableAttribute(c),Fe.bindBuffer(Fe.ARRAY_BUFFER,d),Fe.vertexAttribPointer(c,u,Fe.FLOAT,!1,p*m.array.BYTES_PER_ELEMENT,(i*p+E)*m.array.BYTES_PER_ELEMENT)}else l instanceof THREE.InstancedBufferAttribute?(ze.enableAttributeAndDivisor(c,l.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):ze.enableAttribute(c),Fe.bindBuffer(Fe.ARRAY_BUFFER,d),Fe.vertexAttribPointer(c,u,Fe.FLOAT,!1,0,i*u*4)}else if(void 0!==s){var f=s[h];if(void 0!==f)switch(f.length){case 2:Fe.vertexAttrib2fv(c,f);break;case 3:Fe.vertexAttrib3fv(c,f);break;case 4:Fe.vertexAttrib4fv(c,f);break;default:Fe.vertexAttrib1fv(c,f)}}}}ze.disableUnusedAttributes()}function m(e,t){return t[0]-e[0]}function p(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function E(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function f(e,t,r,i,n){var o,a;r.transparent?(o=de,a=++me):(o=le,a=++ue);var s=o[a];void 0!==s?(s.id=e.id,s.object=e,s.geometry=t,s.material=r,s.z=Le.z,s.group=n):(s={id:e.id,object:e,geometry:t,material:r,z:Le.z,group:n},o.push(s))}function T(e,t){if(e.visible!==!1){if(0!==(e.channels.mask&t.channels.mask))if(e instanceof THREE.Light)ce.push(e);else if(e instanceof THREE.Sprite)Ee.push(e);else if(e instanceof THREE.LensFlare)fe.push(e);else if(e instanceof THREE.ImmediateRenderObject)Te.sortObjects===!0&&(Le.setFromMatrixPosition(e.matrixWorld),Le.applyProjection(Ae)),f(e,null,e.material,Le.z,null);else if((e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)&&(e instanceof THREE.SkinnedMesh&&e.skeleton.update(),e.frustumCulled===!1||De.intersectsObject(e)===!0)){var r=e.material;if(r.visible===!0){Te.sortObjects===!0&&(Le.setFromMatrixPosition(e.matrixWorld),Le.applyProjection(Ae));var i=We.update(e);if(r instanceof THREE.MeshFaceMaterial)for(var n=i.groups,o=r.materials,a=0,s=n.length;s>a;a++){var h=n[a],c=o[h.materialIndex];c.visible===!0&&f(e,i,c,Le.z,h)}else f(e,i,r,Le.z,null)}}for(var l=e.children,a=0,s=l.length;s>a;a++)T(l[a],t)}}function v(e,t,r,i,n){for(var o=0,a=e.length;a>o;o++){var s=e[o],h=s.object,c=s.geometry,l=void 0===n?s.material:n,u=s.group;if(h.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,h.matrixWorld),h.normalMatrix.getNormalMatrix(h.modelViewMatrix),h instanceof THREE.ImmediateRenderObject){y(l);var d=_(t,r,i,l,h);Re="",h.render(function(e){Te.renderBufferImmediate(e,d,l)})}else Te.renderBufferDirect(t,r,i,c,l,h,u)}}function g(e,t,r,i){var n=je.get(e),o=Xe.getParameters(e,t,r,i),a=Xe.getProgramCode(e,o),h=n.program,c=!0;if(void 0===h)e.addEventListener("dispose",s);else if(h.code!==a)u(e);else{if(void 0!==o.shaderID)return;c=!1}if(c){if(o.shaderID){var l=THREE.ShaderLib[o.shaderID];n.__webglShader={name:e.type,uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else n.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=n.__webglShader,h=Xe.acquireProgram(e,o,a),n.program=h,e.program=h}var d=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<Te.maxMorphTargets;m++)d["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,m=0;m<Te.maxMorphNormals;m++)d["morphNormal"+m]>=0&&e.numSupportedMorphNormals++;n.uniformsList=[];var p=n.program.getUniforms();for(var E in n.__webglShader.uniforms){var f=p[E];f&&n.uniformsList.push([n.__webglShader.uniforms[E],f])}}function y(e){R(e),e.transparent===!0?ze.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):ze.setBlending(THREE.NoBlending),ze.setDepthFunc(e.depthFunc),ze.setDepthTest(e.depthTest),ze.setDepthWrite(e.depthWrite),ze.setColorWrite(e.colorWrite),ze.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function R(e){e.side!==THREE.DoubleSide?ze.enable(Fe.CULL_FACE):ze.disable(Fe.CULL_FACE),ze.setFlipSided(e.side===THREE.BackSide)}function _(e,t,r,i,n){xe=0;var o=je.get(i);!i.needsUpdate&&o.program||(g(i,t,r,n),i.needsUpdate=!1);var a=!1,s=!1,h=!1,c=o.program,l=c.getUniforms(),u=o.__webglShader.uniforms;if(c.id!==ve&&(Fe.useProgram(c.program),ve=c.id,a=!0,s=!0,h=!0),i.id!==ye&&(-1===ye&&(h=!0),ye=i.id,s=!0),(a||e!==_e)&&(Fe.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),Ne.logarithmicDepthBuffer&&Fe.uniform1f(l.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==_e&&(_e=e),(i instanceof THREE.ShaderMaterial||i instanceof THREE.MeshPhongMaterial||i.envMap)&&void 0!==l.cameraPosition&&(Le.setFromMatrixPosition(e.matrixWorld),Fe.uniform3f(l.cameraPosition,Le.x,Le.y,Le.z)),(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshBasicMaterial||i instanceof THREE.ShaderMaterial||i.skinning)&&void 0!==l.viewMatrix&&Fe.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements)),i.skinning)if(n.bindMatrix&&void 0!==l.bindMatrix&&Fe.uniformMatrix4fv(l.bindMatrix,!1,n.bindMatrix.elements),n.bindMatrixInverse&&void 0!==l.bindMatrixInverse&&Fe.uniformMatrix4fv(l.bindMatrixInverse,!1,n.bindMatrixInverse.elements),Ne.floatVertexTextures&&n.skeleton&&n.skeleton.useVertexTexture){if(void 0!==l.boneTexture){var d=O();Fe.uniform1i(l.boneTexture,d),Te.setTexture(n.skeleton.boneTexture,d)}void 0!==l.boneTextureWidth&&Fe.uniform1i(l.boneTextureWidth,n.skeleton.boneTextureWidth),void 0!==l.boneTextureHeight&&Fe.uniform1i(l.boneTextureHeight,n.skeleton.boneTextureHeight)}else n.skeleton&&n.skeleton.boneMatrices&&void 0!==l.boneGlobalMatrices&&Fe.uniformMatrix4fv(l.boneGlobalMatrices,!1,n.skeleton.boneMatrices);return s&&(r&&i.fog&&S(u,r),(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i.lights)&&(Ue&&(h=!0,P(t,e),Ue=!1),h?(w(u,Ie),D(u,!0)):D(u,!1)),(i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial)&&x(u,i),i instanceof THREE.LineBasicMaterial?b(u,i):i instanceof THREE.LineDashedMaterial?(b(u,i),H(u,i)):i instanceof THREE.PointsMaterial?C(u,i):i instanceof THREE.MeshPhongMaterial?M(u,i):i instanceof THREE.MeshDepthMaterial?(u.mNear.value=e.near,u.mFar.value=e.far,u.opacity.value=i.opacity):i instanceof THREE.MeshNormalMaterial&&(u.opacity.value=i.opacity),n.receiveShadow&&!i._shadowPass&&A(u,t,e),U(o.uniformsList)),L(l,n),void 0!==l.modelMatrix&&Fe.uniformMatrix4fv(l.modelMatrix,!1,n.matrixWorld.elements),c}function x(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&(e.emissive.value=t.emissive),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r){r instanceof THREE.WebGLRenderTarget&&(r=r.texture);var i=r.offset,n=r.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function b(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function H(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function C(e,t){if(e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Q.height/2,e.map.value=t.map,null!==t.map){var r=t.map.offset,i=t.map.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}}function S(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function M(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function w(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function D(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function A(e,t,r){if(e.shadowMatrix)for(var i=0,n=0,o=t.length;o>n;n++){var a=t[n];if(a.castShadow===!0&&(a instanceof THREE.PointLight||a instanceof THREE.SpotLight||a instanceof THREE.DirectionalLight)){var s=a.shadow;a instanceof THREE.PointLight?(Le.setFromMatrixPosition(a.matrixWorld).negate(),s.matrix.identity().setPosition(Le),e.shadowDarkness.value[i]=-s.darkness):e.shadowDarkness.value[i]=s.darkness,e.shadowMatrix.value[i]=s.matrix,e.shadowMap.value[i]=s.map,e.shadowMapSize.value[i]=s.mapSize,e.shadowBias.value[i]=s.bias,i++}}}function L(e,t){Fe.uniformMatrix4fv(e.modelViewMatrix,!1,t.modelViewMatrix.elements),e.normalMatrix&&Fe.uniformMatrix3fv(e.normalMatrix,!1,t.normalMatrix.elements)}function O(){var e=xe;return e>=Ne.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Ne.maxTextures),xe+=1,e}function U(e){for(var t,r,i=0,n=e.length;n>i;i++){var o=e[i][0];if(o.needsUpdate!==!1){var a=o.type,s=o.value,h=e[i][1];switch(a){case"1i":Fe.uniform1i(h,s);break;case"1f":Fe.uniform1f(h,s);break;case"2f":Fe.uniform2f(h,s[0],s[1]);break;case"3f":Fe.uniform3f(h,s[0],s[1],s[2]);break;case"4f":Fe.uniform4f(h,s[0],s[1],s[2],s[3]);break;case"1iv":Fe.uniform1iv(h,s);break;case"3iv":Fe.uniform3iv(h,s);break;case"1fv":Fe.uniform1fv(h,s);break;case"2fv":Fe.uniform2fv(h,s);break;case"3fv":Fe.uniform3fv(h,s);break;case"4fv":Fe.uniform4fv(h,s);break;case"Matrix3fv":Fe.uniformMatrix3fv(h,!1,s);break;case"Matrix4fv":Fe.uniformMatrix4fv(h,!1,s);break;case"i":Fe.uniform1i(h,s);break;case"f":Fe.uniform1f(h,s);break;case"v2":Fe.uniform2f(h,s.x,s.y);break;case"v3":Fe.uniform3f(h,s.x,s.y,s.z);break;case"v4":Fe.uniform4f(h,s.x,s.y,s.z,s.w);break;case"c":Fe.uniform3f(h,s.r,s.g,s.b);break;case"iv1":Fe.uniform1iv(h,s);break;case"iv":Fe.uniform3iv(h,s);break;case"fv1":Fe.uniform1fv(h,s);break;case"fv":Fe.uniform3fv(h,s);break;case"v2v":void 0===o._array&&(o._array=new Float32Array(2*s.length));for(var c=0,l=0,u=s.length;u>c;c++,l+=2)o._array[l+0]=s[c].x,o._array[l+1]=s[c].y;Fe.uniform2fv(h,o._array);break;case"v3v":void 0===o._array&&(o._array=new Float32Array(3*s.length));for(var c=0,d=0,u=s.length;u>c;c++,d+=3)o._array[d+0]=s[c].x,o._array[d+1]=s[c].y,o._array[d+2]=s[c].z;Fe.uniform3fv(h,o._array);break;case"v4v":void 0===o._array&&(o._array=new Float32Array(4*s.length));for(var c=0,m=0,u=s.length;u>c;c++,m+=4)o._array[m+0]=s[c].x,o._array[m+1]=s[c].y,o._array[m+2]=s[c].z,o._array[m+3]=s[c].w;Fe.uniform4fv(h,o._array);break;case"m3":Fe.uniformMatrix3fv(h,!1,s.elements);break;case"m3v":void 0===o._array&&(o._array=new Float32Array(9*s.length));for(var c=0,u=s.length;u>c;c++)s[c].flattenToArrayOffset(o._array,9*c);Fe.uniformMatrix3fv(h,!1,o._array);break;case"m4":Fe.uniformMatrix4fv(h,!1,s.elements);break;case"m4v":void 0===o._array&&(o._array=new Float32Array(16*s.length));for(var c=0,u=s.length;u>c;c++)s[c].flattenToArrayOffset(o._array,16*c);Fe.uniformMatrix4fv(h,!1,o._array);break;case"t":if(t=s,r=O(),Fe.uniform1i(h,r),!t)continue;t instanceof THREE.CubeTexture||Array.isArray(t.image)&&6===t.image.length?z(t,r):t instanceof THREE.WebGLRenderTargetCube?j(t.texture,r):t instanceof THREE.WebGLRenderTarget?Te.setTexture(t.texture,r):Te.setTexture(t,r);break;case"tv":void 0===o._array&&(o._array=[]);for(var c=0,u=o.value.length;u>c;c++)o._array[c]=O();Fe.uniform1iv(h,o._array);for(var c=0,u=o.value.length;u>c;c++)t=o.value[c],r=o._array[c],t&&(t instanceof THREE.CubeTexture||t.image instanceof Array&&6===t.image.length?z(t,r):t instanceof THREE.WebGLRenderTarget?Te.setTexture(t.texture,r):t instanceof THREE.WebGLRenderTargetCube?j(t.texture,r):Te.setTexture(t,r));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}}function I(e,t,r,i){e[t+0]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function P(e,t){var r,i,n,o,a,s,h,c,l=0,u=0,d=0,m=Ie,p=t.matrixWorldInverse,E=m.directional.colors,f=m.directional.positions,T=m.point.colors,v=m.point.positions,g=m.point.distances,y=m.point.decays,R=m.spot.colors,_=m.spot.positions,x=m.spot.distances,b=m.spot.directions,H=m.spot.anglesCos,C=m.spot.exponents,S=m.spot.decays,M=m.hemi.skyColors,w=m.hemi.groundColors,D=m.hemi.positions,A=0,L=0,O=0,U=0,P=0,k=0,F=0,B=0,V=0,G=0,N=0,z=0;for(r=0,i=e.length;i>r;r++)if(n=e[r],o=n.color,h=n.intensity,c=n.distance,n instanceof THREE.AmbientLight){if(!n.visible)continue;l+=o.r,u+=o.g,d+=o.b}else if(n instanceof THREE.DirectionalLight){if(P+=1,!n.visible)continue;Oe.setFromMatrixPosition(n.matrixWorld),Le.setFromMatrixPosition(n.target.matrixWorld),Oe.sub(Le),Oe.transformDirection(p),V=3*A,f[V+0]=Oe.x,f[V+1]=Oe.y,f[V+2]=Oe.z,I(E,V,o,h),A+=1}else if(n instanceof THREE.PointLight){if(k+=1,!n.visible)continue;G=3*L,I(T,G,o,h),Le.setFromMatrixPosition(n.matrixWorld),Le.applyMatrix4(p),v[G+0]=Le.x,v[G+1]=Le.y,v[G+2]=Le.z,g[L]=c,y[L]=0===n.distance?0:n.decay,L+=1}else if(n instanceof THREE.SpotLight){if(F+=1,!n.visible)continue;N=3*O,I(R,N,o,h),Oe.setFromMatrixPosition(n.matrixWorld),Le.copy(Oe).applyMatrix4(p),_[N+0]=Le.x,_[N+1]=Le.y,_[N+2]=Le.z,x[O]=c,Le.setFromMatrixPosition(n.target.matrixWorld),
Oe.sub(Le),Oe.transformDirection(p),b[N+0]=Oe.x,b[N+1]=Oe.y,b[N+2]=Oe.z,H[O]=Math.cos(n.angle),C[O]=n.exponent,S[O]=0===n.distance?0:n.decay,O+=1}else if(n instanceof THREE.HemisphereLight){if(B+=1,!n.visible)continue;Oe.setFromMatrixPosition(n.matrixWorld),Oe.transformDirection(p),z=3*U,D[z+0]=Oe.x,D[z+1]=Oe.y,D[z+2]=Oe.z,a=n.color,s=n.groundColor,I(M,z,a,h),I(w,z,s,h),U+=1}for(r=3*A,i=Math.max(E.length,3*P);i>r;r++)E[r]=0;for(r=3*L,i=Math.max(T.length,3*k);i>r;r++)T[r]=0;for(r=3*O,i=Math.max(R.length,3*F);i>r;r++)R[r]=0;for(r=3*U,i=Math.max(M.length,3*B);i>r;r++)M[r]=0;for(r=3*U,i=Math.max(w.length,3*B);i>r;r++)w[r]=0;m.directional.length=A,m.point.length=L,m.spot.length=O,m.hemi.length=U,m.ambient[0]=l,m.ambient[1]=u,m.ambient[2]=d}function k(e,t,r){var i;if(r?(Fe.texParameteri(e,Fe.TEXTURE_WRAP_S,q(t.wrapS)),Fe.texParameteri(e,Fe.TEXTURE_WRAP_T,q(t.wrapT)),Fe.texParameteri(e,Fe.TEXTURE_MAG_FILTER,q(t.magFilter)),Fe.texParameteri(e,Fe.TEXTURE_MIN_FILTER,q(t.minFilter))):(Fe.texParameteri(e,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(e,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),t.wrapS===THREE.ClampToEdgeWrapping&&t.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t),Fe.texParameteri(e,Fe.TEXTURE_MAG_FILTER,K(t.magFilter)),Fe.texParameteri(e,Fe.TEXTURE_MIN_FILTER,K(t.minFilter)),t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t)),i=Ge.get("EXT_texture_filter_anisotropic")){if(t.type===THREE.FloatType&&null===Ge.get("OES_texture_float_linear"))return;if(t.type===THREE.HalfFloatType&&null===Ge.get("OES_texture_half_float_linear"))return;(t.anisotropy>1||je.get(t).__currentAnisotropy)&&(Fe.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Te.getMaxAnisotropy())),je.get(t).__currentAnisotropy=t.anisotropy)}}function F(e,t,r){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",o),e.__webglTexture=Fe.createTexture(),Pe.textures++),ze.activeTexture(Fe.TEXTURE0+r),ze.bindTexture(Fe.TEXTURE_2D,e.__webglTexture),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,t.flipY),Fe.pixelStorei(Fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Fe.pixelStorei(Fe.UNPACK_ALIGNMENT,t.unpackAlignment),t.image=B(t.image,Ne.maxTextureSize),G(t)&&V(t.image)===!1&&(t.image=N(t.image));var i=t.image,n=V(i),a=q(t.format),s=q(t.type);k(Fe.TEXTURE_2D,t,n);var h,c=t.mipmaps;if(t instanceof THREE.DataTexture)if(c.length>0&&n){for(var l=0,u=c.length;u>l;l++)h=c[l],ze.texImage2D(Fe.TEXTURE_2D,l,a,h.width,h.height,0,a,s,h.data);t.generateMipmaps=!1}else ze.texImage2D(Fe.TEXTURE_2D,0,a,i.width,i.height,0,a,s,i.data);else if(t instanceof THREE.CompressedTexture)for(var l=0,u=c.length;u>l;l++)h=c[l],t.format!==THREE.RGBAFormat&&t.format!==THREE.RGBFormat?ze.getCompressedTextureFormats().indexOf(a)>-1?ze.compressedTexImage2D(Fe.TEXTURE_2D,l,a,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ze.texImage2D(Fe.TEXTURE_2D,l,a,h.width,h.height,0,a,s,h.data);else if(c.length>0&&n){for(var l=0,u=c.length;u>l;l++)h=c[l],ze.texImage2D(Fe.TEXTURE_2D,l,a,a,s,h);t.generateMipmaps=!1}else ze.texImage2D(Fe.TEXTURE_2D,0,a,a,s,t.image);t.generateMipmaps&&n&&Fe.generateMipmap(Fe.TEXTURE_2D),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function B(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height),i=document.createElement("canvas");i.width=Math.floor(e.width*r),i.height=Math.floor(e.height*r);var n=i.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e),i}return e}function V(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}function G(e){return e.wrapS!==THREE.ClampToEdgeWrapping||e.wrapT!==THREE.ClampToEdgeWrapping?!0:e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter}function N(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement("canvas");t.width=THREE.Math.nearestPowerOfTwo(e.width),t.height=THREE.Math.nearestPowerOfTwo(e.height);var r=t.getContext("2d");return r.drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function z(e,t){var r=je.get(e);if(6===e.image.length)if(e.version>0&&r.__version!==e.version){r.__image__webglTextureCube||(e.addEventListener("dispose",o),r.__image__webglTextureCube=Fe.createTexture(),Pe.textures++),ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_CUBE_MAP,r.__image__webglTextureCube),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof THREE.CompressedTexture,n=e.image[0]instanceof THREE.DataTexture,a=[],s=0;6>s;s++)!Te.autoScaleCubemaps||i||n?a[s]=n?e.image[s].image:e.image[s]:a[s]=B(e.image[s],Ne.maxCubemapSize);var h=a[0],c=V(h),l=q(e.format),u=q(e.type);k(Fe.TEXTURE_CUBE_MAP,e,c);for(var s=0;6>s;s++)if(i)for(var d,m=a[s].mipmaps,p=0,E=m.length;E>p;p++)d=m[p],e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat?ze.getCompressedTextureFormats().indexOf(l)>-1?ze.compressedTexImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,d.width,d.height,0,l,u,d.data);else n?ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,a[s].width,a[s].height,0,l,u,a[s].data):ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,l,u,a[s]);e.generateMipmaps&&c&&Fe.generateMipmap(Fe.TEXTURE_CUBE_MAP),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}else ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}function j(e,t){ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_CUBE_MAP,je.get(e).__webglTexture)}function W(e,t,r){Fe.bindFramebuffer(Fe.FRAMEBUFFER,e),Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,r,je.get(t.texture).__webglTexture,0)}function X(e,t){Fe.bindRenderbuffer(Fe.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.DEPTH_COMPONENT16,t.width,t.height),Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_ATTACHMENT,Fe.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.DEPTH_STENCIL,t.width,t.height),Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_STENCIL_ATTACHMENT,Fe.RENDERBUFFER,e)):Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.RGBA4,t.width,t.height)}function Y(e){var t=e instanceof THREE.WebGLRenderTargetCube?Fe.TEXTURE_CUBE_MAP:Fe.TEXTURE_2D,r=je.get(e.texture).__webglTexture;ze.bindTexture(t,r),Fe.generateMipmap(t),ze.bindTexture(t,null)}function K(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Fe.NEAREST:Fe.LINEAR}function q(e){var t;if(e===THREE.RepeatWrapping)return Fe.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Fe.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Fe.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Fe.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Fe.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Fe.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Fe.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Fe.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Fe.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Fe.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Fe.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Fe.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Fe.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Fe.BYTE;if(e===THREE.ShortType)return Fe.SHORT;if(e===THREE.UnsignedShortType)return Fe.UNSIGNED_SHORT;if(e===THREE.IntType)return Fe.INT;if(e===THREE.UnsignedIntType)return Fe.UNSIGNED_INT;if(e===THREE.FloatType)return Fe.FLOAT;if(t=Ge.get("OES_texture_half_float"),null!==t&&e===THREE.HalfFloatType)return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return Fe.ALPHA;if(e===THREE.RGBFormat)return Fe.RGB;if(e===THREE.RGBAFormat)return Fe.RGBA;if(e===THREE.LuminanceFormat)return Fe.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Fe.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Fe.FUNC_ADD;if(e===THREE.SubtractEquation)return Fe.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Fe.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Fe.ZERO;if(e===THREE.OneFactor)return Fe.ONE;if(e===THREE.SrcColorFactor)return Fe.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Fe.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Fe.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Fe.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Fe.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Fe.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Fe.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Fe.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Fe.SRC_ALPHA_SATURATE;if(t=Ge.get("WEBGL_compressed_texture_s3tc"),null!==t){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=Ge.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=Ge.get("EXT_blend_minmax"),null!==t){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var Q=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Z=void 0!==e.context?e.context:null,J=Q.width,$=Q.height,ee=1,te=void 0!==e.alpha?e.alpha:!1,re=void 0!==e.depth?e.depth:!0,ie=void 0!==e.stencil?e.stencil:!0,ne=void 0!==e.antialias?e.antialias:!1,oe=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,ae=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,se=new THREE.Color(0),he=0,ce=[],le=[],ue=-1,de=[],me=-1,pe=new Float32Array(8),Ee=[],fe=[];this.domElement=Q,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var Te=this,ve=null,ge=null,ye=-1,Re="",_e=null,xe=0,be=0,He=0,Ce=Q.width,Se=Q.height,Me=0,we=0,De=new THREE.Frustum,Ae=new THREE.Matrix4,Le=new THREE.Vector3,Oe=new THREE.Vector3,Ue=!0,Ie={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Pe={geometries:0,textures:0},ke={calls:0,vertices:0,faces:0,points:0};this.info={render:ke,memory:Pe,programs:null};var Fe;try{var Be={alpha:te,depth:re,stencil:ie,antialias:ne,premultipliedAlpha:oe,preserveDrawingBuffer:ae};if(Fe=Z||Q.getContext("webgl",Be)||Q.getContext("experimental-webgl",Be),null===Fe)throw null!==Q.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";Q.addEventListener("webglcontextlost",n,!1)}catch(Ve){console.error("THREE.WebGLRenderer: "+Ve)}var Ge=new THREE.WebGLExtensions(Fe);Ge.get("OES_texture_float"),Ge.get("OES_texture_float_linear"),Ge.get("OES_texture_half_float"),Ge.get("OES_texture_half_float_linear"),Ge.get("OES_standard_derivatives"),Ge.get("ANGLE_instanced_arrays"),Ge.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var Ne=new THREE.WebGLCapabilities(Fe,Ge,e),ze=new THREE.WebGLState(Fe,Ge,q),je=new THREE.WebGLProperties,We=new THREE.WebGLObjects(Fe,je,this.info),Xe=new THREE.WebGLPrograms(this,Ne);this.info.programs=Xe.programs;var Ye=new THREE.WebGLBufferRenderer(Fe,Ge,ke),Ke=new THREE.WebGLIndexedBufferRenderer(Fe,Ge,ke);r(),this.context=Fe,this.capabilities=Ne,this.extensions=Ge,this.state=ze;var qe=new THREE.WebGLShadowMap(this,ce,We);this.shadowMap=qe;var Qe=new THREE.SpritePlugin(this,Ee),Ze=new THREE.LensFlarePlugin(this,fe);this.getContext=function(){return Fe},this.getContextAttributes=function(){return Fe.getContextAttributes()},this.forceContextLoss=function(){Ge.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=Ge.get("EXT_texture_filter_anisotropic");return e=null!==t?Fe.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return Ne.precision},this.getPixelRatio=function(){return ee},this.setPixelRatio=function(e){void 0!==e&&(ee=e)},this.getSize=function(){return{width:J,height:$}},this.setSize=function(e,t,r){J=e,$=t,Q.width=e*ee,Q.height=t*ee,r!==!1&&(Q.style.width=e+"px",Q.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){be=e*ee,He=t*ee,Ce=r*ee,Se=i*ee,Fe.viewport(be,He,Ce,Se)},this.getViewport=function(e){e.x=be/ee,e.y=He/ee,e.z=Ce/ee,e.w=Se/ee},this.setScissor=function(e,t,r,i){Fe.scissor(e*ee,t*ee,r*ee,i*ee)},this.enableScissorTest=function(e){ze.setScissorTest(e)},this.getClearColor=function(){return se},this.setClearColor=function(e,r){se.set(e),he=void 0!==r?r:1,t(se.r,se.g,se.b,he)},this.getClearAlpha=function(){return he},this.setClearAlpha=function(e){he=e,t(se.r,se.g,se.b,he)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=Fe.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Fe.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=Fe.STENCIL_BUFFER_BIT),Fe.clear(i)},this.clearColor=function(){Fe.clear(Fe.COLOR_BUFFER_BIT)},this.clearDepth=function(){Fe.clear(Fe.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Fe.clear(Fe.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.resetGLState=i,this.dispose=function(){Q.removeEventListener("webglcontextlost",n,!1)},this.renderBufferImmediate=function(e,t,r){ze.initAttributes();var i=je.get(e);e.hasPositions&&!i.position&&(i.position=Fe.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=Fe.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=Fe.createBuffer()),e.hasColors&&!i.color&&(i.color=Fe.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.position),Fe.bufferData(Fe.ARRAY_BUFFER,e.positionArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.position),Fe.vertexAttribPointer(n.position,3,Fe.FLOAT,!1,0,0)),e.hasNormals){if(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.normal),"MeshPhongMaterial"!==r.type&&r.shading===THREE.FlatShading)for(var o=0,a=3*e.count;a>o;o+=9){var s=e.normalArray,h=(s[o+0]+s[o+3]+s[o+6])/3,c=(s[o+1]+s[o+4]+s[o+7])/3,l=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=h,s[o+1]=c,s[o+2]=l,s[o+3]=h,s[o+4]=c,s[o+5]=l,s[o+6]=h,s[o+7]=c,s[o+8]=l}Fe.bufferData(Fe.ARRAY_BUFFER,e.normalArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.normal),Fe.vertexAttribPointer(n.normal,3,Fe.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.uv),Fe.bufferData(Fe.ARRAY_BUFFER,e.uvArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.uv),Fe.vertexAttribPointer(n.uv,2,Fe.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==THREE.NoColors&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.color),Fe.bufferData(Fe.ARRAY_BUFFER,e.colorArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.color),Fe.vertexAttribPointer(n.color,3,Fe.FLOAT,!1,0,0)),ze.disableUnusedAttributes(),Fe.drawArrays(Fe.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,o,a){y(n);var s=_(e,t,r,n,o),h=!1,c=i.id+"_"+s.id+"_"+n.wireframe;c!==Re&&(Re=c,h=!0);var l=o.morphTargetInfluences;if(void 0!==l){for(var u=[],p=0,E=l.length;E>p;p++){var f=l[p];u.push([f,p])}u.sort(m),u.length>8&&(u.length=8);for(var T=i.morphAttributes,p=0,E=u.length;E>p;p++){var f=u[p];if(pe[p]=f[0],0!==f[0]){var v=f[1];n.morphTargets===!0&&T.position&&i.addAttribute("morphTarget"+p,T.position[v]),n.morphNormals===!0&&T.normal&&i.addAttribute("morphNormal"+p,T.normal[v])}else n.morphTargets===!0&&i.removeAttribute("morphTarget"+p),n.morphNormals===!0&&i.removeAttribute("morphNormal"+p)}var g=s.getUniforms();null!==g.morphTargetInfluences&&Fe.uniform1fv(g.morphTargetInfluences,pe),h=!0}var v=i.index,R=i.attributes.position;n.wireframe===!0&&(v=We.getWireframeAttribute(i));var x;null!==v?(x=Ke,x.setIndex(v)):x=Ye,h&&(d(n,s,i),null!==v&&Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,We.getAttributeBuffer(v)));var b=0,H=1/0;null!==v?H=v.count:void 0!==R&&(H=R.count);var C=i.drawRange.start,S=i.drawRange.count,M=null!==a?a.start:0,w=null!==a?a.count:1/0,D=Math.max(b,C,M),A=Math.min(b+H,C+S,M+w)-1,L=Math.max(0,A-D+1);if(o instanceof THREE.Mesh)n.wireframe===!0?(ze.setLineWidth(n.wireframeLinewidth*ee),x.setMode(Fe.LINES)):x.setMode(Fe.TRIANGLES),i instanceof THREE.InstancedBufferGeometry&&i.maxInstancedCount>0?x.renderInstances(i):x.render(D,L);else if(o instanceof THREE.Line){var O=n.linewidth;void 0===O&&(O=1),ze.setLineWidth(O*ee),o instanceof THREE.LineSegments?x.setMode(Fe.LINES):x.setMode(Fe.LINE_STRIP),x.render(D,L)}else o instanceof THREE.Points&&(x.setMode(Fe.POINTS),x.render(D,L))},this.render=function(e,t,r,i){if(t instanceof THREE.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var n=e.fog;if(Re="",ye=-1,_e=null,Ue=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Ae.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),De.setFromMatrix(Ae),ce.length=0,ue=-1,me=-1,Ee.length=0,fe.length=0,T(e,t),le.length=ue+1,de.length=me+1,Te.sortObjects===!0&&(le.sort(p),de.sort(E)),qe.render(e),ke.calls=0,ke.vertices=0,ke.faces=0,ke.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var o=e.overrideMaterial;v(le,t,ce,n,o),v(de,t,ce,n,o)}else ze.setBlending(THREE.NoBlending),v(le,t,ce,n),v(de,t,ce,n);if(Qe.render(e,t),Ze.render(e,t,Me,we),r){var a=r.texture,s=V(r);a.generateMipmaps&&s&&a.minFilter!==THREE.NearestFilter&&a.minFilter!==THREE.LinearFilter&&Y(r)}ze.setDepthTest(!0),ze.setDepthWrite(!0),ze.setColorWrite(!0)},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?ze.disable(Fe.CULL_FACE):(t===THREE.FrontFaceDirectionCW?Fe.frontFace(Fe.CW):Fe.frontFace(Fe.CCW),e===THREE.CullFaceBack?Fe.cullFace(Fe.BACK):e===THREE.CullFaceFront?Fe.cullFace(Fe.FRONT):Fe.cullFace(Fe.FRONT_AND_BACK),ze.enable(Fe.CULL_FACE))},this.setTexture=function(e,t){var r=je.get(e);if(e.version>0&&r.__version!==e.version){var i=e.image;return void 0===i?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e):i.complete===!1?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e):void F(r,e,t)}ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_2D,r.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&void 0===je.get(e).__webglFramebuffer){var r=je.get(e),i=je.get(e.texture);void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",a),i.__webglTexture=Fe.createTexture(),Pe.textures++;var n=V(e),o=q(e.texture.format),s=q(e.texture.type);if(t){r.__webglFramebuffer=[],r.__webglRenderbuffer=[],ze.bindTexture(Fe.TEXTURE_CUBE_MAP,i.__webglTexture),k(Fe.TEXTURE_CUBE_MAP,e.texture,n);for(var h=0;6>h;h++)r.__webglFramebuffer[h]=Fe.createFramebuffer(),r.__webglRenderbuffer[h]=Fe.createRenderbuffer(),ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,o,e.width,e.height,0,o,s,null),W(r.__webglFramebuffer[h],e,Fe.TEXTURE_CUBE_MAP_POSITIVE_X+h),X(r.__webglRenderbuffer[h],e);e.texture.generateMipmaps&&n&&Fe.generateMipmap(Fe.TEXTURE_CUBE_MAP)}else r.__webglFramebuffer=Fe.createFramebuffer(),e.shareDepthFrom?r.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:r.__webglRenderbuffer=Fe.createRenderbuffer(),ze.bindTexture(Fe.TEXTURE_2D,i.__webglTexture),k(Fe.TEXTURE_2D,e.texture,n),ze.texImage2D(Fe.TEXTURE_2D,0,o,e.width,e.height,0,o,s,null),W(r.__webglFramebuffer,e,Fe.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_ATTACHMENT,Fe.RENDERBUFFER,r.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_STENCIL_ATTACHMENT,Fe.RENDERBUFFER,r.__webglRenderbuffer):X(r.__webglRenderbuffer,e),e.texture.generateMipmaps&&n&&Fe.generateMipmap(Fe.TEXTURE_2D);t?ze.bindTexture(Fe.TEXTURE_CUBE_MAP,null):ze.bindTexture(Fe.TEXTURE_2D,null),Fe.bindRenderbuffer(Fe.RENDERBUFFER,null),Fe.bindFramebuffer(Fe.FRAMEBUFFER,null)}var c,l,u,d,m;if(e){var r=je.get(e);c=t?r.__webglFramebuffer[e.activeCubeFace]:r.__webglFramebuffer,l=e.width,u=e.height,d=0,m=0}else c=null,l=Ce,u=Se,d=be,m=He;if(c!==ge&&(Fe.bindFramebuffer(Fe.FRAMEBUFFER,c),Fe.viewport(d,m,l,u),ge=c),t){var i=je.get(e.texture);Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,0)}Me=l,we=u},this.readRenderTargetPixels=function(e,t,r,i,n,o){if(e instanceof THREE.WebGLRenderTarget==!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var a=je.get(e).__webglFramebuffer;if(a){var s=!1;a!==ge&&(Fe.bindFramebuffer(Fe.FRAMEBUFFER,a),s=!0);try{var h=e.texture;if(h.format!==THREE.RGBAFormat&&q(h.format)!==Fe.getParameter(Fe.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h.type===THREE.UnsignedByteType||q(h.type)===Fe.getParameter(Fe.IMPLEMENTATION_COLOR_READ_TYPE)||h.type===THREE.FloatType&&Ge.get("WEBGL_color_buffer_float")||h.type===THREE.HalfFloatType&&Ge.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Fe.checkFramebufferStatus(Fe.FRAMEBUFFER)===Fe.FRAMEBUFFER_COMPLETE?Fe.readPixels(t,r,i,n,q(h.format),q(h.type),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&Fe.bindFramebuffer(Fe.FRAMEBUFFER,ge)}}},this.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),Ge.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),Ge.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),Ge.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),Ge.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),Ge.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),Ge.get("EXT_blend_minmax")},this.supportsVertexTextures=function(){return Ne.vertexTextures},this.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),Ge.get("ANGLE_instanced_arrays")},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Object.defineProperties(this,{shadowMapEnabled:{get:function(){return qe.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),qe.enabled=e}},shadowMapType:{get:function(){return qe.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),qe.type=e}},shadowMapCullFace:{get:function(){return qe.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),qe.cullFace=e}},shadowMapDebug:{get:function(){return qe.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug."),qe.debug=e}}})},THREE.WebGLRenderTarget=function(e,t,r){this.uuid=THREE.Math.generateUUID(),this.width=e,this.height=t,r=r||{},void 0===r.minFilter&&(r.minFilter=THREE.LinearFilter),this.texture=new THREE.Texture(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy),this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.shareDepthFrom=void 0!==r.shareDepthFrom?r.shareDepthFrom:null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,get wrapS(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set wrapS(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e},get wrapT(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set wrapT(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e},get magFilter(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set magFilter(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e},get minFilter(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set minFilter(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e},get anisotropy(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set anisotropy(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e},get offset(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set offset(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e},get repeat(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set repeat(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e},get format(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set format(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e},get type(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set type(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e},get generateMipmaps(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set generateMipmaps(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e},setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose())},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.shareDepthFrom=e.shareDepthFrom,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,r){THREE.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.WebGLBufferRenderer=function(e,t,r){function i(e){a=e}function n(t,i){e.drawArrays(a,t,i),r.calls++,r.vertices+=i,a===e.TRIANGLES&&(r.faces+=i/3)}function o(e){var r=t.get("ANGLE_instanced_arrays");if(null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var i=e.attributes.position;i instanceof THREE.InterleavedBufferAttribute?r.drawArraysInstancedANGLE(a,0,i.data.count,e.maxInstancedCount):r.drawArraysInstancedANGLE(a,0,i.count,e.maxInstancedCount)}var a;this.setMode=i,this.render=n,this.renderInstances=o},THREE.WebGLIndexedBufferRenderer=function(e,t,r){function i(e){s=e}function n(r){r.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(h=e.UNSIGNED_INT,c=4):(h=e.UNSIGNED_SHORT,c=2)}function o(t,i){e.drawElements(s,i,h,t*c),r.calls++,r.vertices+=i,s===e.TRIANGLES&&(r.faces+=i/3)}function a(e){var r=t.get("ANGLE_instanced_arrays");if(null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var i=e.index;r.drawElementsInstancedANGLE(s,i.array.length,h,0,e.maxInstancedCount)}var s,h,c;this.setMode=i,this.setIndex=n,this.render=o,this.renderInstances=a},THREE.WebGLExtensions=function(e){var t={};this.get=function(r){if(void 0!==t[r])return t[r];var i;switch(r){case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=i,i}},THREE.WebGLCapabilities=function(e,t,r){function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=i,this.precision=void 0!==r.precision?r.precision:"highp",this.logarithmicDepthBuffer=void 0!==r.logarithmicDepthBuffer?r.logarithmicDepthBuffer:!1,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!t.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var n=i(this.precision);n!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",n,"instead."),this.precision=n),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth"))},THREE.WebGLGeometries=function(e,t,r){function i(e){var t=e.geometry;if(void 0!==c[t.id])return c[t.id];t.addEventListener("dispose",n);var i;return t instanceof THREE.BufferGeometry?i=t:t instanceof THREE.Geometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new THREE.BufferGeometry).setFromObject(e)),i=t._bufferGeometry),c[t.id]=i,r.memory.geometries++,i}function n(e){var i=e.target,o=c[i.id];s(o.attributes),o.index&&a(o.index),i.removeEventListener("dispose",n),delete c[i.id];var h=t.get(i);h.wireframe&&a(h.wireframe),r.memory.geometries--}function o(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function a(t){var r=o(t);void 0!==r&&(e.deleteBuffer(r),h(t))}function s(e){for(var t in e)a(e[t])}function h(e){e instanceof THREE.InterleavedBufferAttribute?t["delete"](e.data):t["delete"](e)}var c={};this.get=i},THREE.WebGLObjects=function(e,t,r){function i(t){var r=l.get(t);if(r.ticket===this.renderTicket)return r;r.ticket=this.renderTicket,t.geometry instanceof THREE.Geometry&&r.updateFromObject(t);var i=r.index,o=r.attributes;null!==i&&n(i,e.ELEMENT_ARRAY_BUFFER);for(var a in o)n(o[a],e.ARRAY_BUFFER);var s=r.morphAttributes;for(var a in s)for(var h=s[a],c=0,u=h.length;u>c;c++)n(h[c],e.ARRAY_BUFFER);return r}function n(e,r){var i=e instanceof THREE.InterleavedBufferAttribute?e.data:e,n=t.get(i);void 0===n.__webglBuffer?o(n,i,r):n.version!==i.version&&a(n,i,r)}function o(t,r,i){t.__webglBuffer=e.createBuffer(),e.bindBuffer(i,t.__webglBuffer);var n=r.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(i,r.array,n),t.version=r.version}function a(t,r,i){e.bindBuffer(i,t.__webglBuffer),r.dynamic===!1||-1===r.updateRange.count?e.bufferSubData(i,0,r.array):0===r.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,r.updateRange.offset*r.array.BYTES_PER_ELEMENT,r.array.subarray(r.updateRange.offset,r.updateRange.offset+r.updateRange.count)),r.updateRange.count=0),t.version=r.version}function s(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function h(r){var i=t.get(r);if(void 0!==i.wireframe)return i.wireframe;var o=[],a=r.index,s=r.attributes,h=s.position;if(null!==a)for(var l={},u=a.array,d=0,m=u.length;m>d;d+=3){var p=u[d+0],E=u[d+1],f=u[d+2];c(l,p,E)&&o.push(p,E),c(l,E,f)&&o.push(E,f),c(l,f,p)&&o.push(f,p)}else for(var u=s.position.array,d=0,m=u.length/3-1;m>d;d+=3){var p=d+0,E=d+1,f=d+2;o.push(p,E,E,f,f,p)}var T=h.count>65535?Uint32Array:Uint16Array,v=new THREE.BufferAttribute(new T(o),1);return n(v,e.ELEMENT_ARRAY_BUFFER),i.wireframe=v,v}function c(e,t,r){if(t>r){var i=t;t=r,r=i}var n=e[t];return void 0===n?(e[t]=[r],!0):-1===n.indexOf(r)?(n.push(r),!0):!1}var l=new THREE.WebGLGeometries(e,t,r);this.getAttributeBuffer=s,this.getWireframeAttribute=h,this.update=i},THREE.WebGLProgram=function(){function e(e){var t=[];for(var r in e){var i=e[r];i!==!1&&t.push("#define "+r+" "+i)}return t.join("\n")}function t(e,t,r){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;n>o;o++){var a=e.getActiveUniform(t,o),s=a.name,h=e.getUniformLocation(t,s),c=s.lastIndexOf("[0]");-1!==c&&c===s.length-3&&(i[s.substr(0,c)]=h),i[s]=h}return i}function r(e,t,r){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;n>o;o++){var a=e.getActiveAttrib(t,o),s=a.name;i[s]=e.getAttribLocation(t,s)}return i}function i(e){return""!==e}var n=0;return function(o,a,s,h){var c=o.context,l=s.defines,u=s.__webglShader.vertexShader,d=s.__webglShader.fragmentShader,m="SHADOWMAP_TYPE_BASIC";h.shadowMapType===THREE.PCFShadowMap?m="SHADOWMAP_TYPE_PCF":h.shadowMapType===THREE.PCFSoftShadowMap&&(m="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",E="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(h.envMap){switch(s.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:p="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:p="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:p="ENVMAP_TYPE_SPHERE"}switch(s.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:E="ENVMAP_MODE_REFRACTION"}switch(s.combine){case THREE.MultiplyOperation:f="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:f="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:f="ENVMAP_BLENDING_ADD"}}var T,v,g=o.gammaFactor>0?o.gammaFactor:1,y=e(l),R=c.createProgram();s instanceof THREE.RawShaderMaterial?(T="",v=""):(T=["precision "+h.precision+" float;","precision "+h.precision+" int;","#define SHADER_NAME "+s.__webglShader.name,y,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+g,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+E:"",h.lightMap?"#define USE_LIGHTMAP":"",h.aoMap?"#define USE_AOMAP":"",h.emissiveMap?"#define USE_EMISSIVEMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.displacementMap&&h.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals&&h.flatShading===!1?"#define USE_MORPHNORMALS":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+m:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.logarithmicDepthBuffer&&o.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(i).join("\n"),v=[h.bumpMap||h.normalMap||h.flatShading||s.derivatives?"#extension GL_OES_standard_derivatives : enable":"",h.logarithmicDepthBuffer&&o.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+h.precision+" float;","precision "+h.precision+" int;","#define SHADER_NAME "+s.__webglShader.name,y,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+g,h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+p:"",h.envMap?"#define "+E:"",h.envMap?"#define "+f:"",h.lightMap?"#define USE_LIGHTMAP":"",h.aoMap?"#define USE_AOMAP":"",h.emissiveMap?"#define USE_EMISSIVEMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.metal?"#define METAL":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+m:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.logarithmicDepthBuffer&&o.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(i).join("\n"));var _=T+u,x=v+d,b=THREE.WebGLShader(c,c.VERTEX_SHADER,_),H=THREE.WebGLShader(c,c.FRAGMENT_SHADER,x);c.attachShader(R,b),c.attachShader(R,H),void 0!==s.index0AttributeName?c.bindAttribLocation(R,0,s.index0AttributeName):h.morphTargets===!0&&c.bindAttribLocation(R,0,"position"),c.linkProgram(R);var C=c.getProgramInfoLog(R),S=c.getShaderInfoLog(b),M=c.getShaderInfoLog(H),w=!0,D=!0;c.getProgramParameter(R,c.LINK_STATUS)===!1?(w=!1,console.error("THREE.WebGLProgram: shader error: ",c.getError(),"gl.VALIDATE_STATUS",c.getProgramParameter(R,c.VALIDATE_STATUS),"gl.getProgramInfoLog",C,S,M)):""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==S&&""!==M||(D=!1),D&&(this.diagnostics={runnable:w,material:s,programLog:C,vertexShader:{log:S,prefix:T},fragmentShader:{log:M,prefix:v}}),c.deleteShader(b),c.deleteShader(H);var A;this.getUniforms=function(){return void 0===A&&(A=t(c,R)),A};var L;return this.getAttributes=function(){return void 0===L&&(L=r(c,R)),L},this.destroy=function(){c.deleteProgram(R),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=n++,this.code=a,this.usedTimes=1,this.program=R,this.vertexShader=b,this.fragmentShader=H,this}}(),THREE.WebGLPrograms=function(e,t){function r(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var r=t.maxVertexUniforms,i=Math.floor((r-20)/4),n=i;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(n=Math.min(e.skeleton.bones.length,n),n<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),n}function i(e){for(var t=0,r=0,i=0,n=0,o=0,a=e.length;a>o;o++){var s=e[o];s.visible!==!1&&(s instanceof THREE.DirectionalLight&&t++,s instanceof THREE.PointLight&&r++,s instanceof THREE.SpotLight&&i++,s instanceof THREE.HemisphereLight&&n++)}return{directional:t,point:r,spot:i,hemi:n}}function n(e){for(var t=0,r=0,i=0,n=e.length;n>i;i++){var o=e[i];o.castShadow&&((o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight)&&t++,o instanceof THREE.PointLight&&(t++,r++))}return{maxShadows:t,pointLightShadows:r}}var o=[],a={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},s=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","pointLightShadows","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];this.getParameters=function(o,s,h,c){var l=a[o.type],u=i(s),d=n(s),m=r(c),p=e.getPrecision();null!==o.precision&&(p=t.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLRenderer.initMaterial:",o.precision,"not supported, using",p,"instead."));var E={shaderID:l,precision:p,supportsVertexTextures:t.vertexTextures,map:!!o.map,envMap:!!o.envMap,envMapMode:o.envMap&&o.envMap.mapping,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,displacementMap:!!o.displacementMap,specularMap:!!o.specularMap,alphaMap:!!o.alphaMap,combine:o.combine,vertexColors:o.vertexColors,fog:h,useFog:o.fog,fogExp:h instanceof THREE.FogExp2,flatShading:o.shading===THREE.FlatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:o.skinning,maxBones:m,useVertexTexture:t.floatVertexTextures&&c&&c.skeleton&&c.skeleton.useVertexTexture,morphTargets:o.morphTargets,morphNormals:o.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,maxDirLights:u.directional,maxPointLights:u.point,maxSpotLights:u.spot,maxHemiLights:u.hemi,maxShadows:d.maxShadows,pointLightShadows:d.pointLightShadows,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&d.maxShadows>0,shadowMapType:e.shadowMap.type,shadowMapDebug:e.shadowMap.debug,alphaTest:o.alphaTest,metal:o.metal,doubleSided:o.side===THREE.DoubleSide,flipSided:o.side===THREE.BackSide};return E},this.getProgramCode=function(e,t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)r.push(i),r.push(e.defines[i]);for(var n=0;n<s.length;n++){var o=s[n];r.push(o),r.push(t[o])}return r.join()},this.acquireProgram=function(t,r,i){for(var n,a=0,s=o.length;s>a;a++){var h=o[a];if(h.code===i){n=h,++n.usedTimes;break}}return void 0===n&&(n=new THREE.WebGLProgram(e,i,t,r),o.push(n)),n},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},this.programs=o},THREE.WebGLProperties=function(){var e={};this.get=function(t){var r=t.uuid,i=e[r];return void 0===i&&(i={},e[r]=i),i},this["delete"]=function(t){delete e[t.uuid]},this.clear=function(){e={}}},THREE.WebGLShader=function(){function e(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}return function(t,r,i){var n=t.createShader(r);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),e(i)),n}}(),THREE.WebGLShadowMap=function(e,t,r){function i(e,t,r,i){var n=e.geometry,o=null,a=E,s=e.customDepthMaterial;if(r&&(a=f,s=e.customDistanceMaterial),s)o=s;else{var h=void 0!==n.morphTargets&&n.morphTargets.length>0&&t.morphTargets,c=e instanceof THREE.SkinnedMesh&&t.skinning,l=0;h&&(l|=d),c&&(l|=m),o=a[l]}return o.visible=t.visible,o.wireframe=t.wireframe,o.wireframeLinewidth=t.wireframeLinewidth,r&&void 0!==o.uniforms.lightPos&&o.uniforms.lightPos.value.copy(i),o}function n(e,t){if(e.visible!==!1){if((e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)&&e.castShadow&&(e.frustumCulled===!1||s.intersectsObject(e)===!0)){var r=e.material;r.visible===!0&&(e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),u.push(e))}for(var i=e.children,o=0,a=i.length;a>o;o++)n(i[o],t)}}for(var o=e.context,a=e.state,s=new THREE.Frustum,h=new THREE.Matrix4,c=(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),l=new THREE.Vector3,u=[],d=1,m=2,p=(d|m)+1,E=new Array(p),f=new Array(p),T=[new THREE.Vector3(1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1),new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],v=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1)],g=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],y=new THREE.Vector4,R=THREE.ShaderLib.depthRGBA,_=THREE.UniformsUtils.clone(R.uniforms),x=THREE.ShaderLib.distanceRGBA,b=THREE.UniformsUtils.clone(x.uniforms),H=0;H!==p;++H){var C=0!==(H&d),S=0!==(H&m),M=new THREE.ShaderMaterial({uniforms:_,vertexShader:R.vertexShader,fragmentShader:R.fragmentShader,morphTargets:C,skinning:S});M._shadowPass=!0,E[H]=M;var w=new THREE.ShaderMaterial({uniforms:b,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,morphTargets:C,skinning:S});w._shadowPass=!0,f[H]=w}var D=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=THREE.PCFShadowMap,this.cullFace=THREE.CullFaceFront,this.render=function(d){var m,p;if(D.enabled!==!1&&(D.autoUpdate!==!1||D.needsUpdate!==!1)){o.clearColor(1,1,1,1),a.disable(o.BLEND),a.enable(o.CULL_FACE),o.frontFace(o.CCW),o.cullFace(D.cullFace===THREE.CullFaceFront?o.FRONT:o.BACK),a.setDepthTest(!0),e.getViewport(y);for(var E=0,f=t.length;f>E;E++){var R=t[E];if(R.castShadow===!0){var _=R.shadow,x=_.camera,b=_.mapSize;if(R instanceof THREE.PointLight){m=6,p=!0;var H=b.x/4,C=b.y/2;g[0].set(2*H,C,H,C),g[1].set(0,C,H,C),g[2].set(3*H,C,H,C),g[3].set(H,C,H,C),g[4].set(3*H,0,H,C),g[5].set(H,0,H,C)}else m=1,p=!1;if(null===_.map){var S=THREE.LinearFilter;D.type===THREE.PCFSoftShadowMap&&(S=THREE.NearestFilter);var M={minFilter:S,magFilter:S,format:THREE.RGBAFormat};_.map=new THREE.WebGLRenderTarget(b.x,b.y,M),_.matrix=new THREE.Matrix4,R instanceof THREE.SpotLight&&(x.aspect=b.x/b.y),x.updateProjectionMatrix()}var w=_.map,A=_.matrix;l.setFromMatrixPosition(R.matrixWorld),x.position.copy(l),e.setRenderTarget(w),e.clear();for(var L=0;m>L;L++){if(p){c.copy(x.position),c.add(T[L]),x.up.copy(v[L]),x.lookAt(c);var O=g[L];e.setViewport(O.x,O.y,O.z,O.w)}else c.setFromMatrixPosition(R.target.matrixWorld),x.lookAt(c);x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(x.projectionMatrix),A.multiply(x.matrixWorldInverse),h.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),s.setFromMatrix(h),u.length=0,n(d,x);for(var U=0,I=u.length;I>U;U++){var P=u[U],k=r.update(P),F=P.material;if(F instanceof THREE.MeshFaceMaterial)for(var B=k.groups,V=F.materials,G=0,N=B.length;N>G;G++){var z=B[G],j=V[z.materialIndex];if(j.visible===!0){var W=i(P,j,p,l);e.renderBufferDirect(x,t,null,k,W,P,z)}}else{var W=i(P,F,p,l);e.renderBufferDirect(x,t,null,k,W,P,null)}}}e.resetGLState()}}e.setViewport(y.x,y.y,y.z,y.w);var X=e.getClearColor(),Y=e.getClearAlpha();e.setClearColor(X,Y),a.enable(o.BLEND),D.cullFace===THREE.CullFaceFront&&o.cullFace(o.BACK),e.resetGLState(),D.needsUpdate=!1}}},THREE.WebGLState=function(e,t,r){var i=this,n=new Uint8Array(16),o=new Uint8Array(16),a=new Uint8Array(16),s={},h=null,c=null,l=null,u=null,d=null,m=null,p=null,E=null,f=null,T=null,v=null,g=null,y=null,R=null,_=null,x=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),b=void 0,H={};this.init=function(){e.clearColor(0,0,0,1),e.clearDepth(1),e.clearStencil(0),this.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),this.enable(e.CULL_FACE),this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=n.length;t>e;e++)n[e]=0},this.enableAttribute=function(r){if(n[r]=1,0===o[r]&&(e.enableVertexAttribArray(r),o[r]=1),0!==a[r]){var i=t.get("ANGLE_instanced_arrays");i.vertexAttribDivisorANGLE(r,0),a[r]=0}},this.enableAttributeAndDivisor=function(t,r,i){n[t]=1,0===o[t]&&(e.enableVertexAttribArray(t),o[t]=1),a[t]!==r&&(i.vertexAttribDivisorANGLE(t,r),a[t]=r)},this.disableUnusedAttributes=function(){for(var t=0,r=o.length;r>t;t++)o[t]!==n[t]&&(e.disableVertexAttribArray(t),o[t]=0)},this.enable=function(t){s[t]!==!0&&(e.enable(t),s[t]=!0)},this.disable=function(t){s[t]!==!1&&(e.disable(t),s[t]=!1)},this.getCompressedTextureFormats=function(){if(null===h&&(h=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")))for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),i=0;i<r.length;i++)h.push(r[i]);return h},this.setBlending=function(t,i,n,o,a,s,h){t!==c&&(t===THREE.NoBlending?this.disable(e.BLEND):t===THREE.AdditiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===THREE.SubtractiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===THREE.MultiplyBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):t===THREE.CustomBlending?this.enable(e.BLEND):(this.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),c=t),t===THREE.CustomBlending?(a=a||i,s=s||n,h=h||o,i===l&&a===m||(e.blendEquationSeparate(r(i),r(a)),l=i,m=a),n===u&&o===d&&s===p&&h===E||(e.blendFuncSeparate(r(n),r(o),r(s),r(h)),u=n,d=o,p=s,E=h)):(l=null,u=null,d=null,m=null,p=null,E=null)},this.setDepthFunc=function(t){if(f!==t){if(t)switch(t){case THREE.NeverDepth:e.depthFunc(e.NEVER);break;case THREE.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case THREE.LessDepth:e.depthFunc(e.LESS);break;case THREE.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case THREE.EqualDepth:e.depthFunc(e.EQUAL);break;case THREE.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case THREE.GreaterDepth:e.depthFunc(e.GREATER);break;case THREE.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);f=t}},this.setDepthTest=function(t){t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)},this.setDepthWrite=function(t){T!==t&&(e.depthMask(t),T=t)},this.setColorWrite=function(t){v!==t&&(e.colorMask(t,t,t,t),v=t)},this.setFlipSided=function(t){g!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),g=t)},this.setLineWidth=function(t){t!==y&&(e.lineWidth(t),y=t)},this.setPolygonOffset=function(t,r,i){t?this.enable(e.POLYGON_OFFSET_FILL):this.disable(e.POLYGON_OFFSET_FILL),!t||R===r&&_===i||(e.polygonOffset(r,i),R=r,_=i)},this.setScissorTest=function(t){t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){void 0===t&&(t=e.TEXTURE0+x-1),b!==t&&(e.activeTexture(t),b=t)},this.bindTexture=function(t,r){void 0===b&&i.activeTexture();var n=H[b];void 0===n&&(n={type:void 0,texture:void 0},H[b]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r),n.type=t,n.texture=r)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.reset=function(){for(var t=0;t<o.length;t++)1===o[t]&&(e.disableVertexAttribArray(t),o[t]=0);s={},h=null,c=null,T=null,v=null,g=null}},THREE.LensFlarePlugin=function(e,t){function r(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);n=d.createBuffer(),o=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,n),d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),d.bufferData(d.ELEMENT_ARRAY_BUFFER,t,d.STATIC_DRAW),l=d.createTexture(),u=d.createTexture(),m.bindTexture(d.TEXTURE_2D,l),d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),m.bindTexture(d.TEXTURE_2D,u),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),c=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var r;r=c?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},a=i(r),s={vertex:d.getAttribLocation(a,"position"),uv:d.getAttribLocation(a,"uv")},h={renderType:d.getUniformLocation(a,"renderType"),map:d.getUniformLocation(a,"map"),occlusionMap:d.getUniformLocation(a,"occlusionMap"),opacity:d.getUniformLocation(a,"opacity"),color:d.getUniformLocation(a,"color"),scale:d.getUniformLocation(a,"scale"),rotation:d.getUniformLocation(a,"rotation"),screenPosition:d.getUniformLocation(a,"screenPosition")}}function i(t){var r=d.createProgram(),i=d.createShader(d.FRAGMENT_SHADER),n=d.createShader(d.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return d.shaderSource(i,o+t.fragmentShader),d.shaderSource(n,o+t.vertexShader),d.compileShader(i),d.compileShader(n),d.attachShader(r,i),d.attachShader(r,n),d.linkProgram(r),r}var n,o,a,s,h,c,l,u,d=e.context,m=e.state;this.render=function(i,p,E,f){if(0!==t.length){var T=new THREE.Vector3,v=f/E,g=.5*E,y=.5*f,R=16/f,_=new THREE.Vector2(R*v,R),x=new THREE.Vector3(1,1,0),b=new THREE.Vector2(1,1);void 0===a&&r(),d.useProgram(a),m.initAttributes(),m.enableAttribute(s.vertex),m.enableAttribute(s.uv),m.disableUnusedAttributes(),d.uniform1i(h.occlusionMap,0),d.uniform1i(h.map,1),d.bindBuffer(d.ARRAY_BUFFER,n),d.vertexAttribPointer(s.vertex,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(s.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),m.disable(d.CULL_FACE),d.depthMask(!1);for(var H=0,C=t.length;C>H;H++){R=16/f,_.set(R*v,R);var S=t[H];if(T.set(S.matrixWorld.elements[12],S.matrixWorld.elements[13],S.matrixWorld.elements[14]),T.applyMatrix4(p.matrixWorldInverse),T.applyProjection(p.projectionMatrix),x.copy(T),b.x=x.x*g+g,b.y=x.y*y+y,c||b.x>0&&b.x<E&&b.y>0&&b.y<f){m.activeTexture(d.TEXTURE0),m.bindTexture(d.TEXTURE_2D,null),m.activeTexture(d.TEXTURE1),m.bindTexture(d.TEXTURE_2D,l),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,b.x-8,b.y-8,16,16,0),d.uniform1i(h.renderType,0),d.uniform2f(h.scale,_.x,_.y),d.uniform3f(h.screenPosition,x.x,x.y,x.z),m.disable(d.BLEND),m.enable(d.DEPTH_TEST),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),m.activeTexture(d.TEXTURE0),m.bindTexture(d.TEXTURE_2D,u),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,b.x-8,b.y-8,16,16,0),d.uniform1i(h.renderType,1),m.disable(d.DEPTH_TEST),m.activeTexture(d.TEXTURE1),m.bindTexture(d.TEXTURE_2D,l),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),S.positionScreen.copy(x),S.customUpdateCallback?S.customUpdateCallback(S):S.updateLensFlares(),d.uniform1i(h.renderType,2),m.enable(d.BLEND);for(var M=0,w=S.lensFlares.length;w>M;M++){var D=S.lensFlares[M];D.opacity>.001&&D.scale>.001&&(x.x=D.x,x.y=D.y,x.z=D.z,R=D.size*D.scale/f,_.x=R*v,_.y=R,d.uniform3f(h.screenPosition,x.x,x.y,x.z),d.uniform2f(h.scale,_.x,_.y),d.uniform1f(h.rotation,D.rotation),d.uniform1f(h.opacity,D.opacity),d.uniform3f(h.color,D.color.r,D.color.g,D.color.b),m.setBlending(D.blending,D.blendEquation,D.blendSrc,D.blendDst),e.setTexture(D.texture,1),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0))}}}m.enable(d.CULL_FACE),m.enable(d.DEPTH_TEST),d.depthMask(!0),e.resetGLState()}}},THREE.SpritePlugin=function(e,t){function r(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);o=u.createBuffer(),a=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,o),u.bufferData(u.ARRAY_BUFFER,e,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),u.bufferData(u.ELEMENT_ARRAY_BUFFER,t,u.STATIC_DRAW),s=i(),h={position:u.getAttribLocation(s,"position"),uv:u.getAttribLocation(s,"uv")},c={uvOffset:u.getUniformLocation(s,"uvOffset"),uvScale:u.getUniformLocation(s,"uvScale"),rotation:u.getUniformLocation(s,"rotation"),scale:u.getUniformLocation(s,"scale"),color:u.getUniformLocation(s,"color"),map:u.getUniformLocation(s,"map"),opacity:u.getUniformLocation(s,"opacity"),modelViewMatrix:u.getUniformLocation(s,"modelViewMatrix"),
projectionMatrix:u.getUniformLocation(s,"projectionMatrix"),fogType:u.getUniformLocation(s,"fogType"),fogDensity:u.getUniformLocation(s,"fogDensity"),fogNear:u.getUniformLocation(s,"fogNear"),fogFar:u.getUniformLocation(s,"fogFar"),fogColor:u.getUniformLocation(s,"fogColor"),alphaTest:u.getUniformLocation(s,"alphaTest")};var r=document.createElement("canvas");r.width=8,r.height=8;var n=r.getContext("2d");n.fillStyle="white",n.fillRect(0,0,8,8),l=new THREE.Texture(r),l.needsUpdate=!0}function i(){var t=u.createProgram(),r=u.createShader(u.VERTEX_SHADER),i=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),u.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),u.compileShader(r),u.compileShader(i),u.attachShader(t,r),u.attachShader(t,i),u.linkProgram(t),t}function n(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var o,a,s,h,c,l,u=e.context,d=e.state,m=new THREE.Vector3,p=new THREE.Quaternion,E=new THREE.Vector3;this.render=function(i,f){if(0!==t.length){void 0===s&&r(),u.useProgram(s),d.initAttributes(),d.enableAttribute(h.position),d.enableAttribute(h.uv),d.disableUnusedAttributes(),d.disable(u.CULL_FACE),d.enable(u.BLEND),u.bindBuffer(u.ARRAY_BUFFER,o),u.vertexAttribPointer(h.position,2,u.FLOAT,!1,16,0),u.vertexAttribPointer(h.uv,2,u.FLOAT,!1,16,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),u.uniformMatrix4fv(c.projectionMatrix,!1,f.projectionMatrix.elements),d.activeTexture(u.TEXTURE0),u.uniform1i(c.map,0);var T=0,v=0,g=i.fog;g?(u.uniform3f(c.fogColor,g.color.r,g.color.g,g.color.b),g instanceof THREE.Fog?(u.uniform1f(c.fogNear,g.near),u.uniform1f(c.fogFar,g.far),u.uniform1i(c.fogType,1),T=1,v=1):g instanceof THREE.FogExp2&&(u.uniform1f(c.fogDensity,g.density),u.uniform1i(c.fogType,2),T=2,v=2)):(u.uniform1i(c.fogType,0),T=0,v=0);for(var y=0,R=t.length;R>y;y++){var _=t[y];_.modelViewMatrix.multiplyMatrices(f.matrixWorldInverse,_.matrixWorld),_.z=-_.modelViewMatrix.elements[14]}t.sort(n);for(var x=[],y=0,R=t.length;R>y;y++){var _=t[y],b=_.material;u.uniform1f(c.alphaTest,b.alphaTest),u.uniformMatrix4fv(c.modelViewMatrix,!1,_.modelViewMatrix.elements),_.matrixWorld.decompose(m,p,E),x[0]=E.x,x[1]=E.y;var H=0;i.fog&&b.fog&&(H=v),T!==H&&(u.uniform1i(c.fogType,H),T=H),null!==b.map?(u.uniform2f(c.uvOffset,b.map.offset.x,b.map.offset.y),u.uniform2f(c.uvScale,b.map.repeat.x,b.map.repeat.y)):(u.uniform2f(c.uvOffset,0,0),u.uniform2f(c.uvScale,1,1)),u.uniform1f(c.opacity,b.opacity),u.uniform3f(c.color,b.color.r,b.color.g,b.color.b),u.uniform1f(c.rotation,b.rotation),u.uniform2fv(c.scale,x),d.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),d.setDepthTest(b.depthTest),d.setDepthWrite(b.depthWrite),b.map&&b.map.image&&b.map.image.width?e.setTexture(b.map,0):e.setTexture(l,0),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0)}d.enable(u.CULL_FACE),e.resetGLState()}}},THREE.CurveUtils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){var o=6*e*e-6*e,a=3*e*e-4*e+1,s=-6*e*e+6*e,h=3*e*e-2*e;return o+a+s+h},interpolate:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n,h=n*s;return(2*t-2*r+o+a)*h+(-3*t+3*r-2*o-a)*s+o*n+t}},THREE.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture is being deprecated. Use THREE.TextureLoader() instead.");var n=new THREE.TextureLoader;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube is being deprecated. Use THREE.CubeTextureLoader() instead.");var n=new THREE.CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new THREE.Group,i=0,n=t.length;n>i;i++)r.add(new THREE.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new THREE.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},THREE.ShapeUtils={area:function(e){for(var t=e.length,r=0,i=t-1,n=0;t>n;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},triangulate:function(){function e(e,t,r,i,n,o){var a,s,h,c,l,u,d,m,p;if(s=e[o[t]].x,h=e[o[t]].y,c=e[o[r]].x,l=e[o[r]].y,u=e[o[i]].x,d=e[o[i]].y,Number.EPSILON>(c-s)*(d-h)-(l-h)*(u-s))return!1;var E,f,T,v,g,y,R,_,x,b,H,C,S,M,w;for(E=u-c,f=d-l,T=s-u,v=h-d,g=c-s,y=l-h,a=0;n>a;a++)if(m=e[o[a]].x,p=e[o[a]].y,!(m===s&&p===h||m===c&&p===l||m===u&&p===d)&&(R=m-s,_=p-h,x=m-c,b=p-l,H=m-u,C=p-d,w=E*b-f*x,S=g*_-y*R,M=T*C-v*H,w>=-Number.EPSILON&&M>=-Number.EPSILON&&S>=-Number.EPSILON))return!1;return!0}return function(t,r){var i=t.length;if(3>i)return null;var n,o,a,s=[],h=[],c=[];if(THREE.ShapeUtils.area(t)>0)for(o=0;i>o;o++)h[o]=o;else for(o=0;i>o;o++)h[o]=i-1-o;var l=i,u=2*l;for(o=l-1;l>2;){if(u--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),r?c:s;if(n=o,n>=l&&(n=0),o=n+1,o>=l&&(o=0),a=o+1,a>=l&&(a=0),e(t,n,o,a,l,h)){var d,m,p,E,f;for(d=h[n],m=h[o],p=h[a],s.push([t[d],t[m],t[p]]),c.push([h[n],h[o],h[a]]),E=o,f=o+1;l>f;E++,f++)h[E]=h[f];l--,u=2*l}}return r?c:s}}(),triangulateShape:function(e,t){function r(e,t,r){return e.x!==t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function i(e,t,i,n,o){var a=t.x-e.x,s=t.y-e.y,h=n.x-i.x,c=n.y-i.y,l=e.x-i.x,u=e.y-i.y,d=s*h-a*c,m=s*l-a*u;if(Math.abs(d)>Number.EPSILON){var p;if(d>0){if(0>m||m>d)return[];if(p=c*l-h*u,0>p||p>d)return[]}else{if(m>0||d>m)return[];if(p=c*l-h*u,p>0||d>p)return[]}if(0===p)return!o||0!==m&&m!==d?[e]:[];if(p===d)return!o||0!==m&&m!==d?[t]:[];if(0===m)return[i];if(m===d)return[n];var E=p/d;return[{x:e.x+E*a,y:e.y+E*s}]}if(0!==m||c*l!==h*u)return[];var f=0===a&&0===s,T=0===h&&0===c;if(f&&T)return e.x!==i.x||e.y!==i.y?[]:[e];if(f)return r(i,n,e)?[e]:[];if(T)return r(e,t,i)?[i]:[];var v,g,y,R,_,x,b,H;return 0!==a?(e.x<t.x?(v=e,y=e.x,g=t,R=t.x):(v=t,y=t.x,g=e,R=e.x),i.x<n.x?(_=i,b=i.x,x=n,H=n.x):(_=n,b=n.x,x=i,H=i.x)):(e.y<t.y?(v=e,y=e.y,g=t,R=t.y):(v=t,y=t.y,g=e,R=e.y),i.y<n.y?(_=i,b=i.y,x=n,H=n.y):(_=n,b=n.y,x=i,H=i.y)),b>=y?b>R?[]:R===b?o?[]:[_]:H>=R?[_,g]:[_,x]:y>H?[]:y===H?o?[]:[v]:H>=R?[v,g]:[v,x]}function n(e,t,r,i){var n=t.x-e.x,o=t.y-e.y,a=r.x-e.x,s=r.y-e.y,h=i.x-e.x,c=i.y-e.y,l=n*s-o*a,u=n*c-o*h;if(Math.abs(l)>Number.EPSILON){var d=h*s-c*a;return l>0?u>=0&&d>=0:u>=0||d>=0}return u>0}function o(e,t){function r(e,t){var r=v.length-1,i=e-1;0>i&&(i=r);var o=e+1;o>r&&(o=0);var a=n(v[e],v[i],v[o],s[t]);if(!a)return!1;var h=s.length-1,c=t-1;0>c&&(c=h);var l=t+1;return l>h&&(l=0),a=n(s[t],s[c],s[l],v[e]),!!a}function o(e,t){var r,n,o;for(r=0;r<v.length;r++)if(n=r+1,n%=v.length,o=i(e,t,v[r],v[n],!0),o.length>0)return!0;return!1}function a(e,r){var n,o,a,s,h;for(n=0;n<g.length;n++)for(o=t[g[n]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,h=i(e,r,o[a],o[s],!0),h.length>0)return!0;return!1}for(var s,h,c,l,u,d,m,p,E,f,T,v=e.concat(),g=[],y=[],R=0,_=t.length;_>R;R++)g.push(R);for(var x=0,b=2*g.length;g.length>0;){if(b--,0>b){console.log("Infinite Loop! Holes left:"+g.length+", Probably Hole outside Shape!");break}for(c=x;c<v.length;c++){l=v[c],h=-1;for(var R=0;R<g.length;R++)if(d=g[R],m=l.x+":"+l.y+":"+d,void 0===y[m]){s=t[d];for(var H=0;H<s.length;H++)if(u=s[H],r(c,H)&&!o(l,u)&&!a(l,u)){h=H,g.splice(R,1),p=v.slice(0,c+1),E=v.slice(c),f=s.slice(h),T=s.slice(0,h+1),v=p.concat(f).concat(T).concat(E),x=c;break}if(h>=0)break;y[m]=!0}if(h>=0)break}}return v}for(var a,s,h,c,l,u,d={},m=e.concat(),p=0,E=t.length;E>p;p++)Array.prototype.push.apply(m,t[p]);for(a=0,s=m.length;s>a;a++)l=m[a].x+":"+m[a].y,void 0!==d[l]&&console.warn("THREE.Shape: Duplicate point",l),d[l]=a;var f=o(e,t),T=THREE.ShapeUtils.triangulate(f,!1);for(a=0,s=T.length;s>a;a++)for(c=T[a],h=0;3>h;h++)l=c[h].x+":"+c[h].y,u=d[l],void 0!==u&&(c[h]=u);return T.concat()},isClockWise:function(e){return THREE.ShapeUtils.area(e)<0},b2:function(){function e(e,t){var r=1-e;return r*r*t}function t(e,t){return 2*(1-e)*e*t}function r(e,t){return e*e*t}return function(i,n,o,a){return e(i,n)+t(i,o)+r(i,a)}}(),b3:function(){function e(e,t){var r=1-e;return r*r*r*t}function t(e,t){var r=1-e;return 3*r*r*e*t}function r(e,t){var r=1-e;return 3*r*e*e*t}function i(e,t){return e*e*e*t}return function(n,o,a,s,h){return e(n,o)+t(n,a)+r(n,s)+i(n,h)}}()},THREE.Audio=function(e){THREE.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1},THREE.Audio.prototype=Object.create(THREE.Object3D.prototype),THREE.Audio.prototype.constructor=THREE.Audio,THREE.Audio.prototype.load=function(e){var t=this,r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},r.send(),this},THREE.Audio.prototype.play=function(){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()},THREE.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},THREE.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},THREE.Audio.prototype.connect=function(){void 0!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.panner)):this.source.connect(this.panner)},THREE.Audio.prototype.disconnect=function(){void 0!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.panner)):this.source.disconnect(this.panner)},THREE.Audio.prototype.setFilter=function(e){this.isPlaying===!0?(this.disconnect(),this.filter=e,this.connect()):this.filter=e},THREE.Audio.prototype.getFilter=function(){return this.filter},THREE.Audio.prototype.setPlaybackRate=function(e){this.playbackRate=e,this.isPlaying===!0&&(this.source.playbackRate.value=this.playbackRate)},THREE.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},THREE.Audio.prototype.onEnded=function(){this.isPlaying=!1},THREE.Audio.prototype.setLoop=function(e){this.source.loop=e},THREE.Audio.prototype.getLoop=function(){return this.source.loop},THREE.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},THREE.Audio.prototype.getRefDistance=function(){return this.panner.refDistance},THREE.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},THREE.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},THREE.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},THREE.Audio.prototype.getVolume=function(){return this.gain.gain.value},THREE.Audio.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;return function(t){THREE.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),THREE.AudioListener=function(){THREE.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype),THREE.AudioListener.prototype.constructor=THREE.AudioListener,THREE.AudioListener.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3,t=new THREE.Quaternion,r=new THREE.Vector3,i=new THREE.Vector3;return function(n){THREE.Object3D.prototype.updateMatrixWorld.call(this,n);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(e,t,r),i.set(0,0,-1).applyQuaternion(t),o.setPosition(e.x,e.y,e.z),o.setOrientation(i.x,i.y,i.z,a.x,a.y,a.z)}}(),THREE.Curve=function(){},THREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},getSpacedPoints:function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),o=0;for(i.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),o+=t.distanceTo(n),i.push(o),n=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,i=this.getLengths(),n=0,o=i.length;r=t?t:e*i[o-1];for(var a,s=0,h=o-1;h>=s;)if(n=Math.floor(s+(h-s)/2),a=i[n]-r,0>a)s=n+1;else{if(!(a>0)){h=n;break}h=n-1}if(n=h,i[n]===r){var c=n/(o-1);return c}var l=i[n],u=i[n+1],d=u-l,m=(r-l)/d,c=(n+m)/(o-1);return c},getTangent:function(e){var t=1e-4,r=e-t,i=e+t;0>r&&(r=0),i>1&&(i=1);var n=this.getPoint(r),o=this.getPoint(i),a=o.clone().sub(n);return a.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}},THREE.Curve.Utils=THREE.CurveUtils,THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var n=r[i]-t,o=this.curves[i],a=1-n/o.getLength();return o.getPointAt(a)}i++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;i>r;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,r=0,i=e.length;i>r;r++){var n=e[r];t.vertices.push(new THREE.Vector3(n.x,n.y,n.z||0))}return t},THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.Path.prototype.constructor=THREE.Path,THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){this.actions.push({action:"moveTo",args:[e,t]})},THREE.Path.prototype.lineTo=function(e,t){var r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],o=new THREE.LineCurve(new THREE.Vector2(i,n),new THREE.Vector2(e,t));this.curves.push(o),this.actions.push({action:"lineTo",args:[e,t]})},THREE.Path.prototype.quadraticCurveTo=function(e,t,r,i){var n=this.actions[this.actions.length-1].args,o=n[n.length-2],a=n[n.length-1],s=new THREE.QuadraticBezierCurve(new THREE.Vector2(o,a),new THREE.Vector2(e,t),new THREE.Vector2(r,i));this.curves.push(s),this.actions.push({action:"quadraticCurveTo",args:[e,t,r,i]})},THREE.Path.prototype.bezierCurveTo=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1],c=new THREE.CubicBezierCurve(new THREE.Vector2(s,h),new THREE.Vector2(e,t),new THREE.Vector2(r,i),new THREE.Vector2(n,o));this.curves.push(c),this.actions.push({action:"bezierCurveTo",args:[e,t,r,i,n,o]})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],o=[new THREE.Vector2(i,n)];Array.prototype.push.apply(o,e);var a=new THREE.SplineCurve(o);this.curves.push(a),this.actions.push({action:"splineThru",args:t})},THREE.Path.prototype.arc=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1];this.absarc(e+s,t+h,r,i,n,o)},THREE.Path.prototype.absarc=function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},THREE.Path.prototype.ellipse=function(e,t,r,i,n,o,a,s){var h=this.actions[this.actions.length-1].args,c=h[h.length-2],l=h[h.length-1];this.absellipse(e+c,t+l,r,i,n,o,a,s)},THREE.Path.prototype.absellipse=function(e,t,r,i,n,o,a,s){var h=[e,t,r,i,n,o,a,s||0],c=new THREE.EllipseCurve(e,t,r,i,n,o,a,s);this.curves.push(c);var l=c.getPoint(1);h.push(l.x),h.push(l.y),this.actions.push({action:"ellipse",args:h})},THREE.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;e>i;i++)r.push(this.getPoint(i/e));return r},THREE.Path.prototype.getPoints=function(e,t){e=e||12;for(var r,i,n,o,a,s,h,c,l,u,d,m=THREE.ShapeUtils.b2,p=THREE.ShapeUtils.b3,E=[],f=0,T=this.actions.length;T>f;f++){var v=this.actions[f],g=v.action,y=v.args;switch(g){case"moveTo":E.push(new THREE.Vector2(y[0],y[1]));break;case"lineTo":E.push(new THREE.Vector2(y[0],y[1]));break;case"quadraticCurveTo":r=y[2],i=y[3],a=y[0],s=y[1],E.length>0?(l=E[E.length-1],h=l.x,c=l.y):(l=this.actions[f-1].args,h=l[l.length-2],c=l[l.length-1]);for(var R=1;e>=R;R++){var _=R/e;u=m(_,h,a,r),d=m(_,c,s,i),E.push(new THREE.Vector2(u,d))}break;case"bezierCurveTo":r=y[4],i=y[5],a=y[0],s=y[1],n=y[2],o=y[3],E.length>0?(l=E[E.length-1],h=l.x,c=l.y):(l=this.actions[f-1].args,h=l[l.length-2],c=l[l.length-1]);for(var R=1;e>=R;R++){var _=R/e;u=p(_,h,a,n,r),d=p(_,c,s,o,i),E.push(new THREE.Vector2(u,d))}break;case"splineThru":l=this.actions[f-1].args;var x=new THREE.Vector2(l[l.length-2],l[l.length-1]),b=[x],H=e*y[0].length;b=b.concat(y[0]);for(var C=new THREE.SplineCurve(b),R=1;H>=R;R++)E.push(C.getPointAt(R/H));break;case"arc":for(var S,M=y[0],w=y[1],D=y[2],A=y[3],L=y[4],O=!!y[5],U=L-A,I=2*e,R=1;I>=R;R++){var _=R/I;O||(_=1-_),S=A+_*U,u=M+D*Math.cos(S),d=w+D*Math.sin(S),E.push(new THREE.Vector2(u,d))}break;case"ellipse":var S,P,k,M=y[0],w=y[1],F=y[2],B=y[3],A=y[4],L=y[5],O=!!y[6],V=y[7],U=L-A,I=2*e;0!==V&&(P=Math.cos(V),k=Math.sin(V));for(var R=1;I>=R;R++){var _=R/I;if(O||(_=1-_),S=A+_*U,u=M+F*Math.cos(S),d=w+B*Math.sin(S),0!==V){var G=u,N=d;u=(G-M)*P-(N-w)*k+M,d=(G-M)*k+(N-w)*P+w}E.push(new THREE.Vector2(u,d))}}}var z=E[E.length-1];return Math.abs(z.x-E[0].x)<Number.EPSILON&&Math.abs(z.y-E[0].y)<Number.EPSILON&&E.splice(E.length-1,1),t&&E.push(E[0]),E},THREE.Path.prototype.toShapes=function(e,t){function r(e){for(var t=[],r=new THREE.Path,i=0,n=e.length;n>i;i++){var o=e[i],a=o.args,s=o.action;"moveTo"===s&&0!==r.actions.length&&(t.push(r),r=new THREE.Path),r[s].apply(r,a)}return 0!==r.actions.length&&t.push(r),t}function i(e){for(var t=[],r=0,i=e.length;i>r;r++){var n=e[r],o=new THREE.Shape;o.actions=n.actions,o.curves=n.curves,t.push(o)}return t}function n(e,t){for(var r=t.length,i=!1,n=r-1,o=0;r>o;n=o++){var a=t[n],s=t[o],h=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(a=t[o],h=-h,s=t[n],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var l=c*(e.x-a.x)-h*(e.y-a.y);if(0===l)return!0;if(0>l)continue;i=!i}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var o=THREE.ShapeUtils.isClockWise,a=r(this.actions);if(0===a.length)return[];if(t===!0)return i(a);var s,h,c,l=[];if(1===a.length)return h=a[0],c=new THREE.Shape,c.actions=h.actions,c.curves=h.curves,l.push(c),l;var u=!o(a[0].getPoints());u=e?!u:u;var d,m=[],p=[],E=[],f=0;p[f]=void 0,E[f]=[];for(var T=0,v=a.length;v>T;T++)h=a[T],d=h.getPoints(),s=o(d),s=e?!s:s,s?(!u&&p[f]&&f++,p[f]={s:new THREE.Shape,p:d},p[f].s.actions=h.actions,p[f].s.curves=h.curves,u&&f++,E[f]=[]):E[f].push({h:h,p:d[0]});if(!p[0])return i(a);if(p.length>1){for(var g=!1,y=[],R=0,_=p.length;_>R;R++)m[R]=[];for(var R=0,_=p.length;_>R;R++)for(var x=E[R],b=0;b<x.length;b++){for(var H=x[b],C=!0,S=0;S<p.length;S++)n(H.p,p[S].p)&&(R!==S&&y.push({froms:R,tos:S,hole:b}),C?(C=!1,m[S].push(H)):g=!0);C&&m[R].push(H)}y.length>0&&(g||(E=m))}for(var M,T=0,w=p.length;w>T;T++){c=p[T].s,l.push(c),M=E[T];for(var D=0,A=M.length;A>D;D++)c.holes.push(M[D].h)}return l},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.constructor=THREE.Shape,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){for(var t=[],r=0,i=this.holes.length;i>r;r++)t[r]=this.holes[r].getPoints(e);return t},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.extractAllPoints(e)},THREE.Shape.Utils=THREE.ShapeUtils,THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},THREE.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t=THREE.ShapeUtils.b2;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t=THREE.CurveUtils.tangentQuadraticBezier;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},THREE.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t=THREE.ShapeUtils.b3;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t=THREE.CurveUtils.tangentCubicBezier;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,o=t[0===i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(o.x,a.x,s.x,h.x,n),c(o.y,a.y,s.y,h.y,n))},THREE.EllipseCurve=function(e,t,r,i,n,o,a,s){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve,THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var r;r=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var i=this.aX+this.xRadius*Math.cos(r),n=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){var o=Math.cos(this.aRotation),a=Math.sin(this.aRotation),s=i,h=n;i=(s-this.aX)*o-(h-this.aY)*a+this.aX,n=(s-this.aX)*a+(h-this.aY)*o+this.aY}return new THREE.Vector2(i,n)},THREE.ArcCurve=function(e,t,r,i,n,o){THREE.EllipseCurve.call(this,e,t,r,r,i,n,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=THREE.ShapeUtils.b2;return new THREE.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t=THREE.ShapeUtils.b3;return new THREE.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),THREE.SplineCurve3=THREE.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0==e?[]:e},function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,o=t[0==i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(o.x,a.x,s.x,h.x,n),c(o.y,a.y,s.y,h.y,n),c(o.z,a.z,s.z,h.z,n))}),THREE.CatmullRomCurve3=function(){function e(){}var t=new THREE.Vector3,r=new e,i=new e,n=new e;return e.prototype.init=function(e,t,r,i){this.c0=e,this.c1=r,this.c2=-3*e+3*t-2*r-i,this.c3=2*e-2*t+r+i},e.prototype.initNonuniformCatmullRom=function(e,t,r,i,n,o,a){var s=(t-e)/n-(r-e)/(n+o)+(r-t)/o,h=(r-t)/o-(i-t)/(o+a)+(i-r)/a;s*=o,h*=o,this.init(t,r,s,h)},e.prototype.initCatmullRom=function(e,t,r,i,n){this.init(t,r,n*(r-e),n*(i-t))},e.prototype.calc=function(e){var t=e*e,r=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*r},THREE.Curve.create(function(e){this.points=e||[]},function(e){var o,a,s,h,c=this.points;h=c.length,2>h&&console.log("duh, you need at least 2 points"),o=(h-1)*e,a=Math.floor(o),s=o-a,0===s&&a===h-1&&(a=h-2,s=1);var l,u,d,m;if(0===a?(t.subVectors(c[0],c[1]).add(c[0]),l=t):l=c[a-1],u=c[a],d=c[a+1],h>a+2?m=c[a+2]:(t.subVectors(c[h-1],c[h-2]).add(c[h-2]),m=t),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var p="chordal"===this.type?.5:.25,E=Math.pow(l.distanceToSquared(u),p),f=Math.pow(u.distanceToSquared(d),p),T=Math.pow(d.distanceToSquared(m),p);1e-4>f&&(f=1),1e-4>E&&(E=f),1e-4>T&&(T=f),r.initNonuniformCatmullRom(l.x,u.x,d.x,m.x,E,f,T),i.initNonuniformCatmullRom(l.y,u.y,d.y,m.y,E,f,T),n.initNonuniformCatmullRom(l.z,u.z,d.z,m.z,E,f,T)}else if("catmullrom"===this.type){var v=void 0!==this.tension?this.tension:.5;r.initCatmullRom(l.x,u.x,d.x,m.x,v),i.initCatmullRom(l.y,u.y,d.y,m.y,v),n.initCatmullRom(l.z,u.z,d.z,m.z,v)}var g=new THREE.Vector3(r.calc(s),i.calc(s),n.calc(s));return g})}(),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,r=(t.length-0)*e,i=Math.floor(r),n=r-i;i+=i>0?0:(Math.floor(Math.abs(i)/t.length)+1)*t.length;var o=t[(i-1)%t.length],a=t[i%t.length],s=t[(i+1)%t.length],h=t[(i+2)%t.length],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(o.x,a.x,s.x,h.x,n),c(o.y,a.y,s.y,h.y,n),c(o.z,a.z,s.z,h.z,n))}),THREE.BoxGeometry=function(e,t,r,i,n,o){function a(e,t,r,i,n,o,a,h){var c,l,u,d=s.widthSegments,m=s.heightSegments,p=n/2,E=o/2,f=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",m=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",d=s.depthSegments);var T=d+1,v=m+1,g=n/d,y=o/m,R=new THREE.Vector3;for(R[c]=a>0?1:-1,u=0;v>u;u++)for(l=0;T>l;l++){var _=new THREE.Vector3;_[e]=(l*g-p)*r,_[t]=(u*y-E)*i,_[c]=a,s.vertices.push(_)}for(u=0;m>u;u++)for(l=0;d>l;l++){var x=l+T*u,b=l+T*(u+1),H=l+1+T*(u+1),C=l+1+T*u,S=new THREE.Vector2(l/d,1-u/m),M=new THREE.Vector2(l/d,1-(u+1)/m),w=new THREE.Vector2((l+1)/d,1-(u+1)/m),D=new THREE.Vector2((l+1)/d,1-u/m),A=new THREE.Face3(x+f,b+f,C+f);A.normal.copy(R),A.vertexNormals.push(R.clone(),R.clone(),R.clone()),A.materialIndex=h,s.faces.push(A),s.faceVertexUvs[0].push([S,M,D]),A=new THREE.Face3(b+f,H+f,C+f),A.normal.copy(R),A.vertexNormals.push(R.clone(),R.clone(),R.clone()),A.materialIndex=h,s.faces.push(A),s.faceVertexUvs[0].push([M.clone(),w,D.clone()])}}THREE.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:o},this.widthSegments=i||1,this.heightSegments=n||1,this.depthSegments=o||1;var s=this,h=e/2,c=t/2,l=r/2;a("z","y",-1,-1,r,t,h,0),a("z","y",1,-1,r,t,-h,1),a("x","z",1,1,e,r,c,2),a("x","z",1,-1,e,r,-c,3),a("x","y",1,-1,e,t,l,4),a("x","y",-1,-1,e,t,-l,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry,
THREE.BoxGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)},THREE.CubeGeometry=THREE.BoxGeometry,THREE.CircleGeometry=function(e,t,r,i){THREE.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new THREE.CircleBufferGeometry(e,t,r,i))},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry,THREE.CircleGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},THREE.CircleBufferGeometry=function(e,t,r,i){THREE.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var n=t+2,o=new Float32Array(3*n),a=new Float32Array(3*n),s=new Float32Array(2*n);a[2]=1,s[0]=.5,s[1]=.5;for(var h=0,c=3,l=2;t>=h;h++,c+=3,l+=2){var u=r+h/t*i;o[c]=e*Math.cos(u),o[c+1]=e*Math.sin(u),a[c+2]=1,s[l]=(o[c]/e+1)/2,s[l+1]=(o[c+1]/e+1)/2}for(var d=[],c=1;t>=c;c++)d.push(c,c+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(d),1)),this.addAttribute("position",new THREE.BufferAttribute(o,3)),this.addAttribute("normal",new THREE.BufferAttribute(a,3)),this.addAttribute("uv",new THREE.BufferAttribute(s,2)),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry,THREE.CircleBufferGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.CircleBufferGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},THREE.CylinderGeometry=function(e,t,r,i,n,o,a,s){THREE.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,i=i||8,n=n||1,o=void 0!==o?o:!1,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var h,c,l=r/2,u=[],d=[];for(c=0;n>=c;c++){var m=[],p=[],E=c/n,f=E*(t-e)+e;for(h=0;i>=h;h++){var T=h/i,v=new THREE.Vector3;v.x=f*Math.sin(T*s+a),v.y=-E*r+l,v.z=f*Math.cos(T*s+a),this.vertices.push(v),m.push(this.vertices.length-1),p.push(new THREE.Vector2(T,1-E))}u.push(m),d.push(p)}var g,y,R=(t-e)/r;for(h=0;i>h;h++)for(0!==e?(g=this.vertices[u[0][h]].clone(),y=this.vertices[u[0][h+1]].clone()):(g=this.vertices[u[1][h]].clone(),y=this.vertices[u[1][h+1]].clone()),g.setY(Math.sqrt(g.x*g.x+g.z*g.z)*R).normalize(),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*R).normalize(),c=0;n>c;c++){var _=u[c][h],x=u[c+1][h],b=u[c+1][h+1],H=u[c][h+1],C=g.clone(),S=g.clone(),M=y.clone(),w=y.clone(),D=d[c][h].clone(),A=d[c+1][h].clone(),L=d[c+1][h+1].clone(),O=d[c][h+1].clone();this.faces.push(new THREE.Face3(_,x,H,[C,S,w])),this.faceVertexUvs[0].push([D,A,O]),this.faces.push(new THREE.Face3(x,b,H,[S.clone(),M,w.clone()])),this.faceVertexUvs[0].push([A.clone(),L,O.clone()])}if(o===!1&&e>0)for(this.vertices.push(new THREE.Vector3(0,l,0)),h=0;i>h;h++){var _=u[0][h],x=u[0][h+1],b=this.vertices.length-1,C=new THREE.Vector3(0,1,0),S=new THREE.Vector3(0,1,0),M=new THREE.Vector3(0,1,0),D=d[0][h].clone(),A=d[0][h+1].clone(),L=new THREE.Vector2(A.x,0);this.faces.push(new THREE.Face3(_,x,b,[C,S,M],void 0,1)),this.faceVertexUvs[0].push([D,A,L])}if(o===!1&&t>0)for(this.vertices.push(new THREE.Vector3(0,-l,0)),h=0;i>h;h++){var _=u[n][h+1],x=u[n][h],b=this.vertices.length-1,C=new THREE.Vector3(0,-1,0),S=new THREE.Vector3(0,-1,0),M=new THREE.Vector3(0,-1,0),D=d[n][h+1].clone(),A=d[n][h].clone(),L=new THREE.Vector2(A.x,1);this.faces.push(new THREE.Face3(_,x,b,[C,S,M],void 0,2)),this.faceVertexUvs[0].push([D,A,L])}this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.CylinderGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)},THREE.EdgesGeometry=function(e,t){function r(e,t){return e-t}THREE.BufferGeometry.call(this),t=void 0!==t?t:1;var i,n=Math.cos(THREE.Math.degToRad(t)),o=[0,0],a={},s=["a","b","c"];e instanceof THREE.BufferGeometry?(i=new THREE.Geometry,i.fromBufferGeometry(e)):i=e.clone(),i.mergeVertices(),i.computeFaceNormals();for(var h=i.vertices,c=i.faces,l=0,u=c.length;u>l;l++)for(var d=c[l],m=0;3>m;m++){o[0]=d[s[m]],o[1]=d[s[(m+1)%3]],o.sort(r);var p=o.toString();void 0===a[p]?a[p]={vert1:o[0],vert2:o[1],face1:l,face2:void 0}:a[p].face2=l}var E=[];for(var p in a){var f=a[p];if(void 0===f.face2||c[f.face1].normal.dot(c[f.face2].normal)<=n){var T=h[f.vert1];E.push(T.x),E.push(T.y),E.push(T.z),T=h[f.vert2],E.push(T.x),E.push(T.y),E.push(T.z)}}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(E),3))},THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry,THREE.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(THREE.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),void this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;r>i;i++){var n=e[i];this.addShape(n,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function i(e,t,r){var i,n,o=1,a=e.x-t.x,s=e.y-t.y,h=r.x-e.x,c=r.y-e.y,l=a*a+s*s,u=a*c-s*h;if(Math.abs(u)>Number.EPSILON){var d=Math.sqrt(l),m=Math.sqrt(h*h+c*c),p=t.x-s/d,E=t.y+a/d,f=r.x-c/m,T=r.y+h/m,v=((f-p)*c-(T-E)*h)/(a*c-s*h);i=p+a*v-e.x,n=E+s*v-e.y;var g=i*i+n*n;if(2>=g)return new THREE.Vector2(i,n);o=Math.sqrt(g/2)}else{var y=!1;a>Number.EPSILON?h>Number.EPSILON&&(y=!0):a<-Number.EPSILON?h<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(i=-s,n=a,o=Math.sqrt(l)):(i=a,n=s,o=Math.sqrt(l/2))}return new THREE.Vector2(i/o,n/o)}function n(){if(g){var e=0,t=N*e;for(W=0;z>W;W++)G=U[W],h(G[2]+t,G[1]+t,G[0]+t);for(e=R+2*v,t=N*e,W=0;z>W;W++)G=U[W],h(G[0]+t,G[1]+t,G[2]+t)}else{for(W=0;z>W;W++)G=U[W],h(G[2],G[1],G[0]);for(W=0;z>W;W++)G=U[W],h(G[0]+N*R,G[1]+N*R,G[2]+N*R)}}function o(){var e=0;for(a(I,e),e+=I.length,C=0,S=L.length;S>C;C++)H=L[C],a(H,e),e+=H.length}function a(e,t){var r,i;for(W=e.length;--W>=0;){r=W,i=W-1,0>i&&(i=e.length-1);var n=0,o=R+2*v;for(n=0;o>n;n++){var a=N*n,s=N*(n+1),h=t+r+a,l=t+i+a,u=t+i+s,d=t+r+s;c(h,l,u,d,e,n,o,r,i)}}}function s(e,t,r){M.vertices.push(new THREE.Vector3(e,t,r))}function h(e,t,r){e+=w,t+=w,r+=w,M.faces.push(new THREE.Face3(e,t,r,null,null,0));var i=b.generateTopUV(M,e,t,r);M.faceVertexUvs[0].push(i)}function c(e,t,r,i,n,o,a,s,h){e+=w,t+=w,r+=w,i+=w,M.faces.push(new THREE.Face3(e,t,i,null,null,1)),M.faces.push(new THREE.Face3(t,r,i,null,null,1));var c=b.generateSideWallUV(M,e,t,r,i);M.faceVertexUvs[0].push([c[0],c[1],c[3]]),M.faceVertexUvs[0].push([c[1],c[2],c[3]])}var l,u,d,m,p,E=void 0!==t.amount?t.amount:100,f=void 0!==t.bevelThickness?t.bevelThickness:6,T=void 0!==t.bevelSize?t.bevelSize:f-2,v=void 0!==t.bevelSegments?t.bevelSegments:3,g=void 0!==t.bevelEnabled?t.bevelEnabled:!0,y=void 0!==t.curveSegments?t.curveSegments:12,R=void 0!==t.steps?t.steps:1,_=t.extrudePath,x=!1,b=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;_&&(l=_.getSpacedPoints(R),x=!0,g=!1,u=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(_,R,!1),d=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3),g||(v=0,f=0,T=0);var H,C,S,M=this,w=this.vertices.length,D=e.extractPoints(y),A=D.shape,L=D.holes,O=!THREE.ShapeUtils.isClockWise(A);if(O){for(A=A.reverse(),C=0,S=L.length;S>C;C++)H=L[C],THREE.ShapeUtils.isClockWise(H)&&(L[C]=H.reverse());O=!1}var U=THREE.ShapeUtils.triangulateShape(A,L),I=A;for(C=0,S=L.length;S>C;C++)H=L[C],A=A.concat(H);for(var P,k,F,B,V,G,N=A.length,z=U.length,j=[],W=0,X=I.length,Y=X-1,K=W+1;X>W;W++,Y++,K++)Y===X&&(Y=0),K===X&&(K=0),j[W]=i(I[W],I[Y],I[K]);var q,Q=[],Z=j.concat();for(C=0,S=L.length;S>C;C++){for(H=L[C],q=[],W=0,X=H.length,Y=X-1,K=W+1;X>W;W++,Y++,K++)Y===X&&(Y=0),K===X&&(K=0),q[W]=i(H[W],H[Y],H[K]);Q.push(q),Z=Z.concat(q)}for(P=0;v>P;P++){for(F=P/v,B=f*(1-F),k=T*Math.sin(F*Math.PI/2),W=0,X=I.length;X>W;W++)V=r(I[W],j[W],k),s(V.x,V.y,-B);for(C=0,S=L.length;S>C;C++)for(H=L[C],q=Q[C],W=0,X=H.length;X>W;W++)V=r(H[W],q[W],k),s(V.x,V.y,-B)}for(k=T,W=0;N>W;W++)V=g?r(A[W],Z[W],k):A[W],x?(m.copy(u.normals[0]).multiplyScalar(V.x),d.copy(u.binormals[0]).multiplyScalar(V.y),p.copy(l[0]).add(m).add(d),s(p.x,p.y,p.z)):s(V.x,V.y,0);var J;for(J=1;R>=J;J++)for(W=0;N>W;W++)V=g?r(A[W],Z[W],k):A[W],x?(m.copy(u.normals[J]).multiplyScalar(V.x),d.copy(u.binormals[J]).multiplyScalar(V.y),p.copy(l[J]).add(m).add(d),s(p.x,p.y,p.z)):s(V.x,V.y,E/R*J);for(P=v-1;P>=0;P--){for(F=P/v,B=f*(1-F),k=T*Math.sin(F*Math.PI/2),W=0,X=I.length;X>W;W++)V=r(I[W],j[W],k),s(V.x,V.y,E+B);for(C=0,S=L.length;S>C;C++)for(H=L[C],q=Q[C],W=0,X=H.length;X>W;W++)V=r(H[W],q[W],k),x?s(V.x,V.y+l[R-1].y,l[R-1].x+B):s(V.x,V.y,E+B)}n(),o()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i){var n=e.vertices,o=n[t],a=n[r],s=n[i];return[new THREE.Vector2(o.x,o.y),new THREE.Vector2(a.x,a.y),new THREE.Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,r,i,n){var o=e.vertices,a=o[t],s=o[r],h=o[i],c=o[n];return Math.abs(a.y-s.y)<.01?[new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(s.x,1-s.z),new THREE.Vector2(h.x,1-h.z),new THREE.Vector2(c.x,1-c.z)]:[new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(s.y,1-s.z),new THREE.Vector2(h.y,1-h.z),new THREE.Vector2(c.y,1-c.z)]}},THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),this.type="ShapeGeometry",Array.isArray(e)===!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry,THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;i>r;r++)this.addShape(e[r],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,n,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=this.vertices.length,c=e.extractPoints(o),l=c.shape,u=c.holes,d=!THREE.ShapeUtils.isClockWise(l);if(d){for(l=l.reverse(),r=0,i=u.length;i>r;r++)n=u[r],THREE.ShapeUtils.isClockWise(n)&&(u[r]=n.reverse());d=!1}var m=THREE.ShapeUtils.triangulateShape(l,u);for(r=0,i=u.length;i>r;r++)n=u[r],l=l.concat(n);var p,E,f=l.length,T=m.length;for(r=0;f>r;r++)p=l[r],this.vertices.push(new THREE.Vector3(p.x,p.y,0));for(r=0;T>r;r++){E=m[r];var v=E[0]+h,g=E[1]+h,y=E[2]+h;this.faces.push(new THREE.Face3(v,g,y,null,null,a)),this.faceVertexUvs[0].push(s.generateTopUV(this,v,g,y))}},THREE.LatheGeometry=function(e,t,r,i){THREE.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=t||12,r=r||0,i=i||2*Math.PI;for(var n=1/(e.length-1),o=1/t,a=0,s=t;s>=a;a++)for(var h=r+a*o*i,c=Math.cos(h),l=Math.sin(h),u=0,d=e.length;d>u;u++){var m=e[u],p=new THREE.Vector3;p.x=c*m.x-l*m.y,p.y=l*m.x+c*m.y,p.z=m.z,this.vertices.push(p)}for(var E=e.length,a=0,s=t;s>a;a++)for(var u=0,d=e.length-1;d>u;u++){var f=u+E*a,T=f,v=f+E,c=f+1+E,g=f+1,y=a*o,R=u*n,_=y+o,x=R+n;this.faces.push(new THREE.Face3(T,v,g)),this.faceVertexUvs[0].push([new THREE.Vector2(y,R),new THREE.Vector2(_,R),new THREE.Vector2(y,x)]),this.faces.push(new THREE.Face3(v,c,g)),this.faceVertexUvs[0].push([new THREE.Vector2(_,R),new THREE.Vector2(_,x),new THREE.Vector2(y,x)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,r,i){THREE.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new THREE.PlaneBufferGeometry(e,t,r,i))},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.PlaneGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},THREE.PlaneBufferGeometry=function(e,t,r,i){THREE.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};for(var n=e/2,o=t/2,a=Math.floor(r)||1,s=Math.floor(i)||1,h=a+1,c=s+1,l=e/a,u=t/s,d=new Float32Array(h*c*3),m=new Float32Array(h*c*3),p=new Float32Array(h*c*2),E=0,f=0,T=0;c>T;T++)for(var v=T*u-o,g=0;h>g;g++){var y=g*l-n;d[E]=y,d[E+1]=-v,m[E+2]=1,p[f]=g/a,p[f+1]=1-T/s,E+=3,f+=2}E=0;for(var R=new(d.length/3>65535?Uint32Array:Uint16Array)(a*s*6),T=0;s>T;T++)for(var g=0;a>g;g++){var _=g+h*T,x=g+h*(T+1),b=g+1+h*(T+1),H=g+1+h*T;R[E]=_,R[E+1]=x,R[E+2]=H,R[E+3]=x,R[E+4]=b,R[E+5]=H,E+=6}this.setIndex(new THREE.BufferAttribute(R,1)),this.addAttribute("position",new THREE.BufferAttribute(d,3)),this.addAttribute("normal",new THREE.BufferAttribute(m,3)),this.addAttribute("uv",new THREE.BufferAttribute(p,2))},THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry,THREE.PlaneBufferGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.PlaneBufferGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},THREE.RingGeometry=function(e,t,r,i,n,o){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:o},e=e||0,t=t||50,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(1,i):8;var a,s,h=[],c=e,l=(t-e)/i;for(a=0;i+1>a;a++){for(s=0;r+1>s;s++){var u=new THREE.Vector3,d=n+s/r*o;u.x=c*Math.cos(d),u.y=c*Math.sin(d),this.vertices.push(u),h.push(new THREE.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}c+=l}var m=new THREE.Vector3(0,0,1);for(a=0;i>a;a++){var p=a*(r+1);for(s=0;r>s;s++){var d=s+p,E=d,f=d+r+1,T=d+r+2;this.faces.push(new THREE.Face3(E,f,T,[m.clone(),m.clone(),m.clone()])),this.faceVertexUvs[0].push([h[E].clone(),h[f].clone(),h[T].clone()]),E=d,f=d+r+2,T=d+1,this.faces.push(new THREE.Face3(E,f,T,[m.clone(),m.clone(),m.clone()])),this.faceVertexUvs[0].push([h[E].clone(),h[f].clone(),h[T].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry.prototype.constructor=THREE.RingGeometry,THREE.RingGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)},THREE.SphereGeometry=function(e,t,r,i,n,o,a){THREE.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new THREE.SphereBufferGeometry(e,t,r,i,n,o,a))},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.SphereGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},THREE.SphereBufferGeometry=function(e,t,r,i,n,o,a){THREE.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;for(var s=o+a,h=(t+1)*(r+1),c=new THREE.BufferAttribute(new Float32Array(3*h),3),l=new THREE.BufferAttribute(new Float32Array(3*h),3),u=new THREE.BufferAttribute(new Float32Array(2*h),2),d=0,m=[],p=new THREE.Vector3,E=0;r>=E;E++){for(var f=[],T=E/r,v=0;t>=v;v++){var g=v/t,y=-e*Math.cos(i+g*n)*Math.sin(o+T*a),R=e*Math.cos(o+T*a),_=e*Math.sin(i+g*n)*Math.sin(o+T*a);p.set(y,R,_).normalize(),c.setXYZ(d,y,R,_),l.setXYZ(d,p.x,p.y,p.z),u.setXY(d,g,1-T),f.push(d),d++}m.push(f)}for(var x=[],E=0;r>E;E++)for(var v=0;t>v;v++){var b=m[E][v+1],H=m[E][v],C=m[E+1][v],S=m[E+1][v+1];(0!==E||o>0)&&x.push(b,H,S),(E!==r-1||s<Math.PI)&&x.push(H,C,S)}this.setIndex(new(c.count>65535?THREE.Uint32Attribute:THREE.Uint16Attribute)(x,1)),this.addAttribute("position",c),this.addAttribute("normal",l),this.addAttribute("uv",u),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry,THREE.SphereBufferGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.SphereBufferGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},THREE.TorusGeometry=function(e,t,r,i,n){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||100,t=t||40,r=r||8,i=i||6,n=n||2*Math.PI;for(var o=new THREE.Vector3,a=[],s=[],h=0;r>=h;h++)for(var c=0;i>=c;c++){var l=c/i*n,u=h/r*Math.PI*2;o.x=e*Math.cos(l),o.y=e*Math.sin(l);var d=new THREE.Vector3;d.x=(e+t*Math.cos(u))*Math.cos(l),d.y=(e+t*Math.cos(u))*Math.sin(l),d.z=t*Math.sin(u),this.vertices.push(d),a.push(new THREE.Vector2(c/i,h/r)),s.push(d.clone().sub(o).normalize())}for(var h=1;r>=h;h++)for(var c=1;i>=c;c++){var m=(i+1)*h+c-1,p=(i+1)*(h-1)+c-1,E=(i+1)*(h-1)+c,f=(i+1)*h+c,T=new THREE.Face3(m,p,f,[s[m].clone(),s[p].clone(),s[f].clone()]);this.faces.push(T),this.faceVertexUvs[0].push([a[m].clone(),a[p].clone(),a[f].clone()]),T=new THREE.Face3(p,E,f,[s[p].clone(),s[E].clone(),s[f].clone()]),this.faces.push(T),this.faceVertexUvs[0].push([a[p].clone(),a[E].clone(),a[f].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)},THREE.TorusKnotGeometry=function(e,t,r,i,n,o,a){function s(e,t,r,i,n){var o=Math.cos(e),a=Math.sin(e),s=t/r*e,h=Math.cos(s),c=i*(2+h)*.5*o,l=i*(2+h)*a*.5,u=n*i*Math.sin(s)*.5;return new THREE.Vector3(c,l,u)}THREE.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,p:n,q:o,heightScale:a},e=e||100,t=t||40,r=r||64,i=i||8,n=n||2,o=o||3,a=a||1;for(var h=new Array(r),c=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,d=0;r>d;++d){h[d]=new Array(i);var m=d/r*2*n*Math.PI,p=s(m,o,n,e,a),E=s(m+.01,o,n,e,a);c.subVectors(E,p),l.addVectors(E,p),u.crossVectors(c,l),l.crossVectors(u,c),u.normalize(),l.normalize();for(var f=0;i>f;++f){var T=f/i*2*Math.PI,v=-t*Math.cos(T),g=t*Math.sin(T),y=new THREE.Vector3;y.x=p.x+v*l.x+g*u.x,y.y=p.y+v*l.y+g*u.y,y.z=p.z+v*l.z+g*u.z,h[d][f]=this.vertices.push(y)-1}}for(var d=0;r>d;++d)for(var f=0;i>f;++f){var R=(d+1)%r,_=(f+1)%i,x=h[d][f],b=h[R][f],H=h[R][_],C=h[d][_],S=new THREE.Vector2(d/r,f/i),M=new THREE.Vector2((d+1)/r,f/i),w=new THREE.Vector2((d+1)/r,(f+1)/i),D=new THREE.Vector2(d/r,(f+1)/i);this.faces.push(new THREE.Face3(x,b,C)),this.faceVertexUvs[0].push([S,M,D]),this.faces.push(new THREE.Face3(b,H,C)),this.faceVertexUvs[0].push([M.clone(),w,D.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TorusKnotGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.TorusKnotGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.heightScale)},THREE.TubeGeometry=function(e,t,r,i,n,o){function a(e,t,r){return w.vertices.push(new THREE.Vector3(e,t,r))-1}THREE.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:i,closed:n,taper:o},t=t||64,r=r||1,i=i||8,n=n||!1,o=o||THREE.TubeGeometry.NoTaper;var s,h,c,l,u,d,m,p,E,f,T,v,g,y,R,_,x,b,H,C,S,M=[],w=this,D=t+1,A=new THREE.Vector3,L=new THREE.TubeGeometry.FrenetFrames(e,t,n),O=L.tangents,U=L.normals,I=L.binormals;for(this.tangents=O,this.normals=U,this.binormals=I,f=0;D>f;f++)for(M[f]=[],l=f/(D-1),E=e.getPointAt(l),s=O[f],h=U[f],c=I[f],d=r*o(l),T=0;i>T;T++)u=T/i*2*Math.PI,m=-d*Math.cos(u),p=d*Math.sin(u),A.copy(E),A.x+=m*h.x+p*c.x,A.y+=m*h.y+p*c.y,A.z+=m*h.z+p*c.z,M[f][T]=a(A.x,A.y,A.z);for(f=0;t>f;f++)for(T=0;i>T;T++)v=n?(f+1)%t:f+1,g=(T+1)%i,y=M[f][T],R=M[v][T],_=M[v][g],x=M[f][g],b=new THREE.Vector2(f/t,T/i),H=new THREE.Vector2((f+1)/t,T/i),C=new THREE.Vector2((f+1)/t,(T+1)/i),S=new THREE.Vector2(f/t,(T+1)/i),this.faces.push(new THREE.Face3(y,R,x)),this.faceVertexUvs[0].push([b,H,S]),this.faces.push(new THREE.Face3(R,_,x)),this.faceVertexUvs[0].push([H.clone(),C,S.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.prototype.clone=function(){return new this.constructor(this.parameters.path,this.parameters.segments,this.parameters.radius,this.parameters.radialSegments,this.parameters.closed,this.parameters.taper)},THREE.TubeGeometry.NoTaper=function(e){return 1},THREE.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},THREE.TubeGeometry.FrenetFrames=function(e,t,r){function i(){m[0]=new THREE.Vector3,p[0]=new THREE.Vector3,o=Number.MAX_VALUE,a=Math.abs(d[0].x),s=Math.abs(d[0].y),h=Math.abs(d[0].z),o>=a&&(o=a,u.set(1,0,0)),o>=s&&(o=s,u.set(0,1,0)),o>=h&&u.set(0,0,1),E.crossVectors(d[0],u).normalize(),m[0].crossVectors(d[0],E),p[0].crossVectors(d[0],m[0])}var n,o,a,s,h,c,l,u=new THREE.Vector3,d=[],m=[],p=[],E=new THREE.Vector3,f=new THREE.Matrix4,T=t+1;for(this.tangents=d,this.normals=m,this.binormals=p,c=0;T>c;c++)l=c/(T-1),d[c]=e.getTangentAt(l),d[c].normalize();for(i(),c=1;T>c;c++)m[c]=m[c-1].clone(),p[c]=p[c-1].clone(),E.crossVectors(d[c-1],d[c]),E.length()>Number.EPSILON&&(E.normalize(),n=Math.acos(THREE.Math.clamp(d[c-1].dot(d[c]),-1,1)),m[c].applyMatrix4(f.makeRotationAxis(E,n))),p[c].crossVectors(d[c],m[c]);if(r)for(n=Math.acos(THREE.Math.clamp(m[0].dot(m[T-1]),-1,1)),n/=T-1,d[0].dot(E.crossVectors(m[0],m[T-1]))>0&&(n=-n),c=1;T>c;c++)m[c].applyMatrix4(f.makeRotationAxis(d[c],n*c)),p[c].crossVectors(d[c],m[c])},THREE.PolyhedronGeometry=function(e,t,r,i){function n(e){var t=e.normalize().clone();t.index=l.vertices.push(t)-1;var r=s(e)/2/Math.PI+.5,i=h(e)/Math.PI+.5;return t.uv=new THREE.Vector2(r,1-i),t}function o(e,t,r,i){var n=new THREE.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()],void 0,i);l.faces.push(n),g.copy(e).add(t).add(r).divideScalar(3);var o=s(g);l.faceVertexUvs[0].push([c(e.uv,e,o),c(t.uv,t,o),c(r.uv,r,o)])}function a(e,t){for(var r=Math.pow(2,t),i=n(l.vertices[e.a]),a=n(l.vertices[e.b]),s=n(l.vertices[e.c]),h=[],c=e.materialIndex,u=0;r>=u;u++){h[u]=[];for(var d=n(i.clone().lerp(s,u/r)),m=n(a.clone().lerp(s,u/r)),p=r-u,E=0;p>=E;E++)0===E&&u===r?h[u][E]=d:h[u][E]=n(d.clone().lerp(m,E/p))}for(var u=0;r>u;u++)for(var E=0;2*(r-u)-1>E;E++){var f=Math.floor(E/2);E%2===0?o(h[u][f+1],h[u+1][f],h[u][f],c):o(h[u][f+1],h[u+1][f+1],h[u+1][f],c)}}function s(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function c(e,t,r){return 0>r&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1,i=i||0;for(var l=this,u=0,d=e.length;d>u;u+=3)n(new THREE.Vector3(e[u],e[u+1],e[u+2]));for(var m=this.vertices,p=[],u=0,E=0,d=t.length;d>u;u+=3,E++){var f=m[t[u]],T=m[t[u+1]],v=m[t[u+2]];p[E]=new THREE.Face3(f.index,T.index,v.index,[f.clone(),T.clone(),v.clone()],void 0,E)}for(var g=new THREE.Vector3,u=0,d=p.length;d>u;u++)a(p[u],i);for(var u=0,d=this.faceVertexUvs[0].length;d>u;u++){var y=this.faceVertexUvs[0][u],R=y[0].x,_=y[1].x,x=y[2].x,b=Math.max(R,_,x),H=Math.min(R,_,x);b>.9&&.1>H&&(.2>R&&(y[0].x+=1),.2>_&&(y[1].x+=1),.2>x&&(y[2].x+=1))}for(var u=0,d=this.vertices.length;d>u;u++)this.vertices[u].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,r)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.PolyhedronGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.PolyhedronGeometry(e.vertices,e.indices,e.radius,e.detail)},THREE.DodecahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,n,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry,THREE.DodecahedronGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.DodecahedronGeometry(e.radius,e.detail)},THREE.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,i,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.IcosahedronGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.IcosahedronGeometry(e.radius,e.detail)},THREE.OctahedronGeometry=function(e,t){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.OctahedronGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.OctahedronGeometry(e.radius,e.detail)},THREE.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.TetrahedronGeometry.prototype.clone=function(){var e=this.parameters;return new THREE.TetrahedronGeometry(e.radius,e.detail)},THREE.ParametricGeometry=function(e,t,r){THREE.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var i,n,o,a,s,h=this.vertices,c=this.faces,l=this.faceVertexUvs[0],u=t+1;for(i=0;r>=i;i++)for(s=i/r,n=0;t>=n;n++)a=n/t,o=e(a,s),h.push(o);var d,m,p,E,f,T,v,g;for(i=0;r>i;i++)for(n=0;t>n;n++)d=i*u+n,m=i*u+n+1,p=(i+1)*u+n+1,E=(i+1)*u+n,f=new THREE.Vector2(n/t,i/r),T=new THREE.Vector2((n+1)/t,i/r),v=new THREE.Vector2((n+1)/t,(i+1)/r),g=new THREE.Vector2(n/t,(i+1)/r),c.push(new THREE.Face3(d,m,E)),l.push([f,T,g]),c.push(new THREE.Face3(m,p,E)),l.push([T.clone(),v,g.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.WireframeGeometry=function(e){function t(e,t){return e-t}THREE.BufferGeometry.call(this);var r=[0,0],i={},n=["a","b","c"];if(e instanceof THREE.Geometry){for(var o=e.vertices,a=e.faces,s=0,h=new Uint32Array(6*a.length),c=0,l=a.length;l>c;c++)for(var u=a[c],d=0;3>d;d++){r[0]=u[n[d]],r[1]=u[n[(d+1)%3]],r.sort(t);var m=r.toString();void 0===i[m]&&(h[2*s]=r[0],h[2*s+1]=r[1],i[m]=!0,s++)}for(var p=new Float32Array(2*s*3),c=0,l=s;l>c;c++)for(var d=0;2>d;d++){var E=o[h[2*c+d]],f=6*c+3*d;p[f+0]=E.x,p[f+1]=E.y,p[f+2]=E.z}this.addAttribute("position",new THREE.BufferAttribute(p,3))}else if(e instanceof THREE.BufferGeometry)if(null!==e.index){var T=e.index.array,o=e.attributes.position,v=e.drawcalls,s=0;0===v.length&&e.addGroup(0,T.length);for(var h=new Uint32Array(2*T.length),g=0,y=v.length;y>g;++g)for(var R=v[g],_=R.start,x=R.count,c=_,b=_+x;b>c;c+=3)for(var d=0;3>d;d++){r[0]=T[c+d],r[1]=T[c+(d+1)%3],r.sort(t);var m=r.toString();void 0===i[m]&&(h[2*s]=r[0],h[2*s+1]=r[1],i[m]=!0,s++)}for(var p=new Float32Array(2*s*3),c=0,l=s;l>c;c++)for(var d=0;2>d;d++){var f=6*c+3*d,H=h[2*c+d];p[f+0]=o.getX(H),p[f+1]=o.getY(H),p[f+2]=o.getZ(H)}this.addAttribute("position",new THREE.BufferAttribute(p,3))}else{for(var o=e.attributes.position.array,s=o.length/3,C=s/3,p=new Float32Array(2*s*3),c=0,l=C;l>c;c++)for(var d=0;3>d;d++){var f=18*c+6*d,S=9*c+3*d;p[f+0]=o[S],p[f+1]=o[S+1],p[f+2]=o[S+2];var H=9*c+3*((d+1)%3);p[f+3]=o[H],p[f+4]=o[H+1],p[f+5]=o[H+2]}this.addAttribute("position",new THREE.BufferAttribute(p,3))}},THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry,THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.BufferAttribute(t,3)),i.addAttribute("color",new THREE.BufferAttribute(r,3));var n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,i,n)},THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var t=new THREE.CylinderGeometry(0,.5,1,5,1);return t.translate(0,-.5,0),function(r,i,n,o,a,s){THREE.Object3D.call(this),void 0===o&&(o=16776960),void 0===n&&(n=1),void 0===a&&(a=.2*n),void 0===s&&(s=.2*a),this.position.copy(i),n>a&&(this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line)),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(n,a,s)}}(),THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;
return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),e>t&&(this.line.scale.set(1,e-t,1),this.line.updateMatrix()),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){void 0!==this.line&&this.line.material.color.set(e),this.cone.material.color.set(e)},THREE.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new THREE.BufferGeometry;i.setIndex(new THREE.BufferAttribute(t,1)),i.addAttribute("position",new THREE.BufferAttribute(r,3)),THREE.LineSegments.call(this,i,new THREE.LineBasicMaterial({color:16776960})),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.BoxHelper.prototype.constructor=THREE.BoxHelper,THREE.BoxHelper.prototype.update=function(){var e=new THREE.Box3;return function(t){if(e.setFromObject(t),!e.empty()){var r=e.min,i=e.max,n=this.geometry.attributes.position,o=n.array;o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=r.x,o[4]=i.y,o[5]=i.z,o[6]=r.x,o[7]=r.y,o[8]=i.z,o[9]=i.x,o[10]=r.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=r.z,o[15]=r.x,o[16]=i.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=i.x,o[22]=r.y,o[23]=r.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),THREE.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:r,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper,THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){i.vertices.push(new THREE.Vector3),i.colors.push(new THREE.Color(t)),void 0===o[e]&&(o[e]=[]),o[e].push(i.vertices.length-1)}var i=new THREE.Geometry,n=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),o={},a=16755200,s=16711680,h=43775,c=16777215,l=3355443;t("n1","n2",a),t("n2","n4",a),t("n4","n3",a),t("n3","n1",a),t("f1","f2",a),t("f2","f4",a),t("f4","f3",a),t("f3","f1",a),t("n1","f1",a),t("n2","f2",a),t("n3","f3",a),t("n4","f4",a),t("p","n1",s),t("p","n2",s),t("p","n3",s),t("p","n4",s),t("u1","u2",h),t("u2","u3",h),t("u3","u1",h),t("c","t",c),t("p","c",l),t("cn1","cn2",l),t("cn3","cn4",l),t("cf1","cf2",l),t("cf3","cf4",l),THREE.LineSegments.call(this,i,n),this.camera=e,this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function e(e,o,a,s){i.set(o,a,s).unproject(n);var h=r[e];if(void 0!==h)for(var c=0,l=h.length;l>c;c++)t.vertices[h[c]].copy(i)}var t,r,i=new THREE.Vector3,n=new THREE.Camera;return function(){t=this.geometry,r=this.pointMap;var i=1,o=1;n.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-i,-o,-1),e("n2",i,-o,-1),e("n3",-i,o,-1),e("n4",i,o,-1),e("f1",-i,-o,1),e("f2",i,-o,1),e("f3",-i,o,1),e("f4",i,o,1),e("u1",.7*i,1.1*o,-1),e("u2",.7*-i,1.1*o,-1),e("u3",0,2*o,-1),e("cf1",-i,0,1),e("cf2",i,0,1),e("cf3",0,-o,1),e("cf4",0,o,1),e("cn1",-i,0,-1),e("cn2",i,0,-1),e("cn3",0,-o,-1),e("cn4",0,o,-1),t.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var i=new THREE.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(r,i),this.add(this.lightPlane),r=new THREE.Geometry,r.vertices.push(new THREE.Vector3,new THREE.Vector3),i=new THREE.LineBasicMaterial({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(r,i),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper,THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(e,t,r){var i=void 0!==t?t:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(e.geometry,r),new THREE.LineBasicMaterial({color:i})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper,THREE.FaceNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16776960,o=void 0!==i?i:1,a=0,s=this.object.geometry;s instanceof THREE.Geometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var h=new THREE.BufferGeometry,c=new THREE.Float32Attribute(2*a*3,3);h.addAttribute("position",c),THREE.LineSegments.call(this,h,new THREE.LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper,THREE.FaceNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,n=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,h=0,c=0,l=s.length;l>c;c++){var u=s[c],d=u.normal;e.copy(a[u.a]).add(a[u.b]).add(a[u.c]).divideScalar(3).applyMatrix4(i),t.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),n.setXYZ(h,e.x,e.y,e.z),h+=1,n.setXYZ(h,t.x,t.y,t.z),h+=1}return n.needsUpdate=!0,this}}(),THREE.GridHelper=function(e,t){var r=new THREE.Geometry,i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var n=-e;e>=n;n+=t){r.vertices.push(new THREE.Vector3(-e,0,n),new THREE.Vector3(e,0,n),new THREE.Vector3(n,0,-e),new THREE.Vector3(n,0,e));var o=0===n?this.color1:this.color2;r.colors.push(o,o,o,o)}THREE.LineSegments.call(this,r,i)},THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.GridHelper.prototype.constructor=THREE.GridHelper,THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var r=new THREE.SphereGeometry(t,4,2);r.rotateX(-Math.PI/2);for(var i=0,n=8;n>i;i++)r.faces[i].color=this.colors[4>i?0:1];var o=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(r,o),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper,THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new THREE.SphereGeometry(t,4,2),i=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper,THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new THREE.Geometry,r=0;r<this.bones.length;r++){var i=this.bones[r];i.parent instanceof THREE.Bone&&(t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(0,0,1)),t.colors.push(new THREE.Color(0,1,0)))}t.dynamic=!0;var n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,t,n),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper,THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof THREE.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},THREE.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new THREE.Matrix4).getInverse(this.root.matrixWorld),r=new THREE.Matrix4,i=0,n=0;n<this.bones.length;n++){var o=this.bones[n];o.parent instanceof THREE.Bone&&(r.multiplyMatrices(t,o.matrixWorld),e.vertices[i].setFromMatrixPosition(r),r.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(r),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new THREE.CylinderGeometry(0,1,1,8,1,!0);t.translate(0,-.5,0),t.rotateX(-Math.PI/2);var r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,r),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper,THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16711680,o=void 0!==i?i:1,a=0,s=this.object.geometry;s instanceof THREE.Geometry?a=3*s.faces.length:s instanceof THREE.BufferGeometry&&(a=s.attributes.normal.count);var h=new THREE.BufferGeometry,c=new THREE.Float32Attribute(2*a*3,3);h.addAttribute("position",c),THREE.LineSegments.call(this,h,new THREE.LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper,THREE.VertexNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Matrix3;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a instanceof THREE.Geometry)for(var s=a.vertices,h=a.faces,c=0,l=0,u=h.length;u>l;l++)for(var d=h[l],m=0,p=d.vertexNormals.length;p>m;m++){var E=s[d[i[m]]],f=d.vertexNormals[m];e.copy(E).applyMatrix4(n),t.copy(f).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}else if(a instanceof THREE.BufferGeometry)for(var T=a.attributes.position,v=a.attributes.normal,c=0,m=0,p=T.count;p>m;m++)e.set(T.getX(m),T.getY(m),T.getZ(m)).applyMatrix4(n),t.set(v.getX(m),v.getY(m),v.getZ(m)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1;return o.needsUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(e.geometry),new THREE.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper,THREE.ImmediateRenderObject=function(e){THREE.Object3D.call(this),this.material=e,this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",n=0,o=r-1,a=r/1;this.createAnimation(i,n,o,a),this.setAnimationWeight(i,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={start:t,end:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/,i={},n=this.geometry,o=0,a=n.morphTargets.length;a>o;o++){var s=n.morphTargets[o],h=s.name.match(r);if(h&&h.length>1){var c=h[1];i[c]||(i[c]={start:1/0,end:-(1/0)});var l=i[c];o<l.start&&(l.start=o),o>l.end&&(l.end=o),t||(t=c)}}for(var c in i){var l=i[c];this.createAnimation(c,l.start,l.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;r>t;t++){var i=this.animationsList[t];if(i.active){var n=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var o=i.start+THREE.Math.clamp(Math.floor(i.time/n),0,i.length-1),a=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*a,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o);var s=i.time%n/n;i.directionBackwards&&(s=1-s),i.currentFrame!==i.lastFrame?(this.morphTargetInfluences[i.currentFrame]=s*a,this.morphTargetInfluences[i.lastFrame]=(1-s)*a):this.morphTargetInfluences[i.currentFrame]=a}}};var CLOUD=CLOUD||{};CLOUD.Version="20160426",CLOUD.GlobalData={SceneSize:1e3,SceneScale:2,LengthUnitScale:1e3,MinBoxSize:new THREE.Vector3(500,500,500),MaxTriangle:4e7,MaxVertex:35e6,UseArrayBuffer:!0,TextureResRoot:"images/",ShowSubSceneBox:!1,ShowCellBox:!1,DynamicRelease:!0,SubSceneVisibleDistance:.1,CellVisibleLOD:15,RayTracingDeep:10,SubSceneVisibleLOD:10,ScreenCullLOD:2e-4,LimitFrameTime:60,GarbageCollection:!0},CLOUD.EnumObjectLevel={Default:0,Tiny:1,Small:2,Medium:5,Large:6},CLOUD.ObjectLevelLoD={0:.1,1:.2,2:1,3:4,4:5,5:5,6:6},CLOUD.EnumStandardView={ISO:0,Top:1,Bottom:2,Front:3,Back:4,Right:5,Left:6,SouthEast:7,SouthWest:8,NorthEast:9,NorthWest:10,BottomFront:11,BottomBack:12,BottomRight:13,BottomLeft:14,BottomSouthEast:15,BottomSouthWest:16,BottomNorthEast:17,BottomNorthWest:18,RoofFront:19,RoofBack:20,RoofRight:21,RoofLeft:22,RoofSouthEast:23,RoofSouthWest:24,RoofNorthEast:25,RoofNorthWest:26,TopTurnRight:27,TopTurnBack:28,TopTurnLeft:29,BottomTurnRight:30,BottomTurnBack:31,BottomTurnLeft:32,FrontTurnRight:33,FrontTurnTop:34,FrontTurnLeft:35,RightTurnBack:36,RightTurnTop:37,RightTurnFront:38,BackTurnRight:39,BackTurnTop:40,BackTurnLeft:41,LeftTurnFront:42,LeftTurnTop:43,LeftTurnBack:44},CLOUD.SCENETYPE={Default:0,Aux:1,Child:2,Link:3},CLOUD.MPKSTATUS={UNKONW:0,LOADING:1,LOADED:2},CLOUD.EVENTS={ON_LOAD_START:0,ON_LOAD_PROGRESS:1,ON_LOAD_COMPLETE:2,ON_LOAD_SUBSCENE:10,ON_SELECTION_CHANGED:100,ON_UPDATE_SELECTION_UI:101},CLOUD.Utils={box3FromArray:function(e,t){if(e instanceof Array){var r=t||new THREE.Box3;return r.min.fromArray(e,0),r.max.fromArray(e,3),r}return null},computeBBox:function(e){for(var t=new THREE.Box3,r=new THREE.Vector3,i=0,n=e.length;n>i;++i)r.fromArray(e[i],0),t.expandByPoint(r);return t},parseTransform:function(e,t,r){var i=!1;if(t.rotation&&(e.rotation.fromArray(t.rotation),i=!0),t.position&&(e.position.fromArray(t.position),i=!0),t.scale&&(e.scale.fromArray(t.scale),i=!0),t.quaternion&&(e.quaternion.fromArray(t.quaternion),i=!0),i&&(e.updateMatrix(),e.matrixAutoUpdate=!1),t.matrix&&(e.matrix.fromArray(t.matrix),e.matrixAutoUpdate=!1),r){var n=e.matrix.clone();n.multiplyMatrices(r,e.matrix),e.matrix=n,e.matrixAutoUpdate=!1}e.boundingBox=CLOUD.Utils.box3FromArray(t.bbox)},parseRootNode:function(e,t){if(!(e instanceof CLOUD.Scene))return e;var r=e.rootNode,i=CLOUD.Utils.box3FromArray(t.metadata.bbox);if(null===r.boundingBox){if(r.boundingBox=i,t.transform){var n=new THREE.Vector3,o=new THREE.Quaternion,a=new THREE.Vector3(1,1,1);if(t.transform.position&&n.fromArray(t.transform.position),t.transform.rotation){var s=new THREE.Euler;s.fromArray(t.transform.rotation),o.setFromEuler(s,!1)}t.transform.scale&&(a.fromArray(t.transform.scale),a.multiplyScalar(CLOUD.GlobalData.SceneScale),CLOUD.GlobalData.SubSceneVisibleDistance=CLOUD.GlobalData.LengthUnitScale*a.x,console.log(CLOUD.GlobalData.SubSceneVisibleDistance)),r.matrix.compose(n,o,a),r.matrixAutoUpdate=!1,r.updateMatrixWorld(!0)}}else r.boundingBox.expandByPoint(i.min),r.boundingBox.expandByPoint(i.max);var h=new CLOUD.Group;return h.boundingBox=i,r.add(h),h.updateMatrixWorld(!0),h.matrixAutoUpdate=!1,h}},CLOUD.DomUtil={splitStr:function(e){return e.trim().split(/\s+/g)},getContainerOffsetToClient:function(e){var t,r=function(e){for(var t=0,r=0;e;)t+=e.offsetTop,r+=e.offsetLeft,e=e.offsetParent;var i=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||i.scrollTop,a=window.pageXOffset||n.scrollLeft||i.scrollLeft;return t-=o,r-=a,{top:t,left:r}},i=function(e){var t=e.getBoundingClientRect(),r=document.body,i=document.documentElement,n=i.clientTop||r.clientTop,o=i.clientLeft||r.clientLeft,a=t.top-n,s=t.left-o;return{top:Math.round(a),left:Math.round(s)}},n=function(e){return e.getBoundingClientRect?i(e):r(e)};if(e!=document){var o=n(e);t={width:e.offsetWidth,height:e.offsetHeight,left:o.left,top:o.top}}else t={width:window.innerWidth,height:window.innerHeight,left:0,top:0};return t},setClassName:function(e,t){var r=document.getElementById(e);r&&(r.className=t)},addClassName:function(e,t){var r,i,n,o,a,s=/\s+/,h=document.getElementById(e);if(h&&(i=h,t&&"string"==typeof t&&(r=t.split(s),1===i.nodeType)))if(i.className||1!==r.length){for(n=" "+i.className+" ",o=0,a=r.length;a>o;++o)n.indexOf(" "+r[o]+" ")<0&&(n+=r[0]+" ");i.className=String.trim(n)}else i.className=t},removeClassName:function(e,t){var r,i,n,o,a,s=/\s+/,h=document.getElementById(e);if(h&&(n=h,t&&"string"==typeof t&&(r=(t||"").split(s),1===n.nodeType&&n.className))){for(i=(" "+n.className+" ").replace(O," "),o=0,a=r.length;a>o;o++)for(;i.indexOf(" "+r[o]+" ")>=0;)i=i.replace(" "+r[o]+" "," ");n.className=t?String.trim(i):""}},showOrHideElement:function(e,t){var r=document.getElementById(e);r&&(t?r.style.display="":r.style.display="none")},getStyleString:function(e){var t=[];for(var r in e){var i=e[r];t.push(r),t.push(":"),t.push(i),t.push("; ")}return t.join("")},cloneStyle:function(e){var t={};for(var r in e)t[r]=e[r];return t},removeStyleAttribute:function(e,t){Array.isArray(t)||(t=[t]),t.forEach(function(t){t in e&&delete e[t]})},trimRight:function(e){if(0===e.length)return"";for(var t=e.length-1,r=t;r>=0;--r)if(" "!==e.charAt(r)){t=r;break}return e.substr(0,t+1)},trimLeft:function(e){if(0===e.length)return"";for(var t=0,r=0;r<e.length;++r)if(" "!==e.charAt(r)){t=r;break}return e.substr(t)},matchesSelector:function(e,t){if(e.matches)return e.matches(t);if(e.matchesSelector)return e.matchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.mozMatchesSelector)return e.mozMatchesSelector(t);if(e.oMatchesSelector)return e.oMatchesSelector(t);if(e.querySelectorAll){for(var r=(e.document||e.ownerDocument).querySelectorAll(t),i=0;r[i]&&r[i]!==element;)i++;return!!r[i]}return!1},toTranslate3d:function(e,t){return"translate3d("+e+"px,"+t+"px,0)"},setCursorStyle:function(e,t){var r;switch(t){case"n":case"s":r="ns-resize";break;case"w":case"e":r="ew-resize";break;case"ne":case"sw":r="nesw-resize";break;case"nw":case"se":r="nwse-resize"}e.style.cursor=r}},CLOUD.GeomUtil={createInstancedBufferGeometry:function(e,t){var r=t.count,i=new THREE.InstancedBufferGeometry;i.maxInstancedCount=r,i.addAttribute("position",e.getAttribute("position")),i.setIndex(e.index);var n=[],o=[],a=[],s=t.items;for(var h in s){var c=s[h];n.push(c.worldMatrix),o.push(c.userId),a.push(CLOUD.Utils.box3FromArray(c.bbox))}for(var l=new THREE.InstancedBufferAttribute(new Float32Array(4*r),4,1),u=0,d=l.count;d>u;u++)l.setXYZW(u,n[u][0],n[u][1],n[u][2],n[u][3]);i.addAttribute("componentV1",l);for(var m=new THREE.InstancedBufferAttribute(new Float32Array(4*r),4,1),u=0,d=m.count;d>u;u++)m.setXYZW(u,n[u][4],n[u][5],n[u][6],n[u][7]);i.addAttribute("componentV2",m);for(var p=new THREE.InstancedBufferAttribute(new Float32Array(4*r),4,1),u=0,d=p.count;d>u;u++)p.setXYZW(u,n[u][8],n[u][9],n[u][10],n[u][11]);i.addAttribute("componentV3",p);for(var E=new THREE.InstancedBufferAttribute(new Float32Array(4*r),4,1),u=0,d=E.count;d>u;u++)E.setXYZW(u,n[u][12],n[u][13],n[u][14],n[u][15]);i.addAttribute("componentV4",E),void 0===i.attributes.normal&&i.computeVertexNormals(),i.boundingBox=CLOUD.Utils.box3FromArray(t.bbox);var f={bboxs:a,userIds:o,transformMatrixs:n};return i.extProperty=f,i},parseNodeProperties:function(e,t,r,i){t.userId?e.name=t.userId:e.name=r,CLOUD.Utils.parseTransform(e,t,i)},parseSceneNode:function(e,t,r,i){if(e.sceneId=t.sceneId,e.worldBoundingBox=e.boundingBox.clone(),e.worldBoundingBox.applyMatrix4(r.getGlobalTransform()),e.level=t.level,t.order&&(e.out=1),CLOUD.GlobalData.ShowSubSceneBox){var n=255;n<<=5*i;var o=new CLOUD.BBoxNode(e.boundingBox,n);CLOUD.Utils.parseTransform(o,t),e.add(o)}},parseCylinderNode:function(){var e=new RegExp("'","g"),t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3(0,1,0);return function(o,a){a instanceof Object||(a=a.replace(e,'"'),a=JSON.parse(a)),t.fromArray(a.startPt),r.fromArray(a.endPt),i.subVectors(r,t);var s=i.length();i.normalize();var h=a.radius;1>=h&&(h=100),o.scale.set(h,s,h),o.quaternion.setFromUnitVectors(n,i),o.position.copy(t).addScaledVector(i,.5*s),o.updateMatrix(),o.matrixAutoUpdate=!1,o.geometry.boundingBox||o.geometry.computeBoundingBox()}}(),parseBoxNode:function(){var e=new THREE.Box3,t=new THREE.Matrix4;return function(r,i){CLOUD.Utils.parseTransform(r,i),CLOUD.Utils.box3FromArray(i.bbox,e);var n=e.size(),o=e.center();t.identity(),t.scale(n),t.setPosition(o),r.matrix.multiply(t),r.matrixAutoUpdate=!1}}(),parsePGeomNodeInstance:function(e,t,r){var i;if("pipe"==e.geomType||"tube"==e.geomType){var n=CLOUD.GeomUtil.UnitCylinderInstance;i=new THREE.Mesh(n,t),CLOUD.GeomUtil.parseCylinderNode(i,e.params)}else{if("box"!=e.geomType)return console.log("unknonw geometry!"),i;var n=CLOUD.GeomUtil.UnitBoxInstance;i=new THREE.Mesh(n,t),CLOUD.GeomUtil.parseBoxNode(i,e)}if(r){var o=r.clone();o.multiply(i.matrix),i.matrix=o,i.matrixAutoUpdate=!1}return i},EmptyGeometry:new THREE.Geometry,UnitCylinderInstance:new THREE.CylinderGeometry(1,1,1,8,1,!1),UnitBoxInstance:new THREE.BoxGeometry(1,1,1)},THREE.CombinedCamera=function(e,t,r,i,n,o,a){THREE.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(r,e/t,i,n),this.zoom=1,this.toPerspective(),this.aspect=e/t},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.constructor=THREE.CombinedCamera,THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,r=this.cameraP.near,i=this.cameraP.far,n=(r+i)/2,o=Math.tan(e*Math.PI/180/2)*n,a=2*o,s=a*t,h=s/2;o/=this.zoom,h/=this.zoom,this.cameraO.left=-h,this.cameraO.right=h,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},CLOUD.BBoxNode=function(e,t){"use strict";var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3)),THREE.LineSegments.call(this,r,new THREE.LineBasicMaterial({color:t})),void 0!==e&&this.updateBBox(e)},CLOUD.BBoxNode.prototype=Object.create(THREE.LineSegments.prototype),CLOUD.BBoxNode.prototype.constructor=CLOUD.BBoxNode,CLOUD.BBoxNode.prototype.unload=function(){},CLOUD.BBoxNode.prototype.updateBBox=function(e){var t=e.min,r=e.max,i=this.geometry.attributes.position.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=t.x,i[4]=r.y,i[5]=r.z,i[6]=t.x,i[7]=r.y,i[8]=r.z,i[9]=t.x,i[10]=t.y,i[11]=r.z,i[12]=t.x,i[13]=t.y,i[14]=r.z,i[15]=r.x,i[16]=t.y,i[17]=r.z,i[18]=r.x,i[19]=t.y,i[20]=r.z,i[21]=r.x,i[22]=r.y,i[23]=r.z,i[24]=r.x,i[25]=r.y,i[26]=t.z,i[27]=t.x,i[28]=r.y,i[29]=t.z,i[30]=t.x,i[31]=r.y,i[32]=t.z,i[33]=t.x,i[34]=t.y,i[35]=t.z,i[36]=t.x,i[37]=t.y,i[38]=t.z,i[39]=r.x,i[40]=t.y,i[41]=t.z,i[42]=r.x,i[43]=t.y,i[44]=t.z,i[45]=r.x,i[46]=r.y,i[47]=t.z,i[48]=r.x,i[49]=r.y,i[50]=r.z,i[51]=r.x,i[52]=r.y,i[53]=t.z,i[54]=t.x,i[55]=r.y,i[56]=r.z,i[57]=t.x,i[58]=r.y,i[59]=t.z,i[60]=t.x,i[61]=t.y,i[62]=r.z,i[63]=t.x,i[64]=t.y,i[65]=t.z,i[66]=r.x,i[67]=t.y,i[68]=r.z,i[69]=r.x,i[70]=t.y,i[71]=t.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.matrixAutoUpdate=!1},CLOUD.RenderGroup=function(){function e(e,t){return e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function t(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function r(e,t,r,i,n,o){l=Date.now();for(var a=t.length,h=s;a>h;h++){var c=t[h],u=c.object,d=c.material,m=c.group;u.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,u.matrixWorld),u.normalMatrix.getNormalMatrix(u.modelViewMatrix);var p=c.geometry;if(p&&p._listeners?0===p.refCount&&(p=null):p=null,0===u.loaded&&u.load(),e.renderBufferDirect(r,i,n,p,d,u,m),h%5e3===4999&&(endTime=Date.now(),elapseTime=endTime-l,elapseTime>CLOUD.GlobalData.LimitFrameTime))return s=h+1,!1}return s=0,!0}var i=[],n=[],o=-1,a=-1,s=0,h=!1,c=!1,l=0;this.getOpaqueObjects=function(){return i},this.getTransparentObjects=function(){return n},this.restart=function(){s=0,h=!1,c=!1},this.prepare=function(){this.restart(),o=-1,a=-1},this.renderableCount=function(){return o+a},this.pushRenderItem=function(e,t,r,s,h){var c,l;r.transparent?(c=n,l=++a):(c=i,l=++o);var u=c[l];void 0!==u?(u.id=e.id,u.object=e,u.geometry=t,u.material=r,u.z=s,u.group=h):(u={id:e.id,object:e,geometry:t,material:r,z:s,group:h},c[l]=u)},this.sortRenderList=function(r){i.length=o+1,n.length=a+1,r&&(i.sort(e),n.sort(t))},this.renderOpaqueObjects=function(e,t,n,o,a){return h||(h=r(e,i,t,n,o,a)),h},this.renderTransparentObjects=function(e,t,i,o,a){return c||(c=r(e,n,t,i,o,a)),c}},CLOUD.OrderedRenderer=function(){function e(e){return b&&b.isVisible(e)}function t(e){return b?b.getOverridedMaterial(e):null}function r(){++l,l>1e5&&(l=0);for(var e=0,t=T.length;t>e;++e){var r=T[e];void 0!==r&&r.prepare()}}function i(e,t,r,i){var n=T[e.renderOrder];void 0===n&&(n=new CLOUD.RenderGroup,T[e.renderOrder]=n),n.pushRenderItem(e,t,r,i,null)}function n(e){e.modelCenter=new THREE.Vector3,e.boundingBox?(e.boundingBox.center(e.modelCenter),e.modelCenter.applyMatrix4(e.matrixWorld),y.copy(e.boundingBox.min),y.applyMatrix4(e.matrixWorld),
e.radius=e.modelCenter.distanceTo(y)):e.modelCenter.setFromMatrixPosition(e.matrixWorld)}function o(){for(var e=0,t=T.length;t>e;++e){var r=T[e];void 0!==r&&r.sortRenderList(u)}}function a(r,o,s){if(r.visible===!1)return!0;if(s||(s=r.inFrustum),r instanceof CLOUD.Group){if(b&&r.fileId&&b.hasFileFilter(r.fileId))return!0}else if(r._cullTicket!=l){if(++m,m%5e3==4999){var h=Date.now()-E;if(h>30)return!1}if(r._cullTicket=l,(r instanceof CLOUD.Mesh||r instanceof THREE.Mesh||r instanceof THREE.Line||r instanceof THREE.Points)&&(s||v.intersectsObject(r)===!0)){if(!e(r))return!0;if(r.renderOrder<=5)if(r.modelCenter||n(r),void 0!==r.radius){y.copy(r.modelCenter),y.applyProjection(g),R.copy(o.realUp),R.multiplyScalar(r.radius).add(r.modelCenter),R.applyProjection(g);var c=10*R.distanceTo(y);if(c<CLOUD.GlobalData.ScreenCullLOD)return++p,!0}else y.copy(r.modelCenter),y.applyProjection(g);var u=t(r);u=u||r.material;var d=r.geometry;d instanceof THREE.Geometry&&(d=d._bufferGeometry),i(r,d,u,y.z)}}var f=r.children;if(f)for(var T=0,_=f.length;_>T;T++)if(!a(f[T],o,s))return!1;return!0}function s(e,t){t.length=0;for(var r=e.children,i=0,n=r.length;n>i;i++){var o=r[i];o instanceof THREE.Light&&t.push(o)}}function h(e,t,i){return _?(u&&(r(),s(e,i)),E=Date.now(),u=a(e,t),void o()):void(u=!0)}function c(){_&&!x||++f,f>1e4&&(f=0)}var l=0,u=!1,d=!1,m=0,p=0,E=0,f=0,T=[],v=null,g=null,y=new THREE.Vector3,R=new THREE.Vector3,_=!0,x=!0,b=null;this.updateObjectList=function(e){_=e},this.restart=function(){for(var e=0,t=T.length;t>e;++e){var r=T[e];void 0!==r&&r.restart()}m=0,p=0,x=!0},this.setFilter=function(e){b=e},this.update=function(e,t){g=t,v=e},this.render=function(e,t,r,i,n,o,a){if(c(),x){if(h(t,r,i),!u)return!1;o=!0,x=!1,e.setRenderTarget(n)}(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil,_);var s=t.fog;e.setRenderTicket(f),a.setBlending(THREE.NoBlending);for(var l=T.length-1;l>=0;--l){var m=T[l];if(void 0!==m&&(d=m.renderOpaqueObjects(e,r,i,s,_),!d))break}if(d)for(var l=T.length-1;l>=0;--l){var m=T[l];if(void 0!==m&&(d=m.renderTransparentObjects(e,r,i,s),!d))break}return a.setDepthTest(!0),a.setDepthWrite(!0),a.setColorWrite(!0),d},this.computeSelectionBBox=function(){if(null===b)return null;if(b.isSelectionSetEmpty())return null;b.resetSelectionBox();for(var e=T.length-1;e>=0;--e){var t=T[e];void 0!==t&&(b.computeSelectionBox(t.getOpaqueObjects()),b.computeSelectionBox(t.getTransparentObjects()))}return b.getSelectionBox()}},THREE.WebGLIncrementRenderer=function(e){function t(e,t,r,i){oe===!0&&(e*=i,t*=i,r*=i),Fe.clearColor(e,t,r,i)}function r(){ze.init(),Fe.viewport(be,He,Ce,Se),t(se.r,se.g,se.b,he)}function i(){ve=null,_e=null,Re="",ye=-1,Ue=!0,ze.reset()}function n(e){e.preventDefault(),i(),r(),je.clear()}function o(e){var t=e.target;t.removeEventListener("dispose",o),h(t),Pe.textures--}function a(e){var t=e.target;t.removeEventListener("dispose",a),c(t),Pe.textures--}function s(e){var t=e.target;t.removeEventListener("dispose",s),l(t)}function h(e){var t=je.get(e);if(e.image&&t.__image__webglTextureCube)Fe.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)return;Fe.deleteTexture(t.__webglTexture)}je["delete"](e)}function c(e){var t=je.get(e),r=je.get(e.texture);if(e&&void 0!==r.__webglTexture){if(Fe.deleteTexture(r.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var i=0;6>i;i++)Fe.deleteFramebuffer(t.__webglFramebuffer[i]),Fe.deleteRenderbuffer(t.__webglRenderbuffer[i]);else Fe.deleteFramebuffer(t.__webglFramebuffer),Fe.deleteRenderbuffer(t.__webglRenderbuffer);je["delete"](e.texture),je["delete"](e)}}function l(e){u(e),je["delete"](e)}function u(e){var t=je.get(e).program;e.program=void 0,void 0!==t&&Xe.releaseProgram(t)}function d(e,t,r,i){var n;if(r instanceof THREE.InstancedBufferGeometry&&(n=Ge.get("ANGLE_instanced_arrays"),null===n))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===i&&(i=0),ze.initAttributes();var o=r.attributes,a=t.getAttributes(),s=e.defaultAttributeValues;for(var h in a){var c=a[h];if(c>=0){var l=o[h];if(void 0!==l){var u=l.itemSize,d=We.getAttributeBuffer(l);if(l instanceof THREE.InterleavedBufferAttribute){var m=l.data,p=m.stride,E=l.offset;m instanceof THREE.InstancedInterleavedBuffer?(ze.enableAttributeAndDivisor(c,m.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=m.meshPerAttribute*m.count)):ze.enableAttribute(c),Fe.bindBuffer(Fe.ARRAY_BUFFER,d),Fe.vertexAttribPointer(c,u,Fe.FLOAT,!1,p*m.array.BYTES_PER_ELEMENT,(i*p+E)*m.array.BYTES_PER_ELEMENT)}else l instanceof THREE.InstancedBufferAttribute?(ze.enableAttributeAndDivisor(c,l.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):ze.enableAttribute(c),Fe.bindBuffer(Fe.ARRAY_BUFFER,d),Fe.vertexAttribPointer(c,u,Fe.FLOAT,!1,0,i*u*4)}else if(void 0!==s){var f=s[h];if(void 0!==f)switch(f.length){case 2:Fe.vertexAttrib2fv(c,f);break;case 3:Fe.vertexAttrib3fv(c,f);break;case 4:Fe.vertexAttrib4fv(c,f);break;default:Fe.vertexAttrib1fv(c,f)}}}}ze.disableUnusedAttributes()}function m(e,t){return t[0]-e[0]}function p(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function E(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function f(e,t,r,i,n){var o,a;r.transparent?(o=de,a=++me):(o=le,a=++ue);var s=o[a];void 0!==s?(s.id=e.id,s.object=e,s.geometry=t,s.material=r,s.z=Le.z,s.group=n):(s={id:e.id,object:e,geometry:t,material:r,z:Le.z,group:n},o[a]=s)}function T(e,t){if(e.visible!==!1){if(0!==(e.channels.mask&t.channels.mask))if(e instanceof THREE.Light)ce.push(e);else if(e instanceof THREE.Sprite)Ee.push(e);else if(e instanceof THREE.LensFlare)fe.push(e);else if(e instanceof THREE.ImmediateRenderObject)Te.sortObjects===!0&&(Le.setFromMatrixPosition(e.matrixWorld),Le.applyProjection(Ae)),f(e,null,e.material,Le.z,null);else if((e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)&&(e instanceof THREE.SkinnedMesh&&e.skeleton.update(),e.frustumCulled===!1||De.intersectsObject(e)===!0)){var r=e.material;if(r.visible===!0){Te.sortObjects===!0&&(Le.setFromMatrixPosition(e.matrixWorld),Le.applyProjection(Ae));var i=We.update(e);if(r instanceof THREE.MeshFaceMaterial)for(var n=i.groups,o=r.materials,a=0,s=n.length;s>a;a++){var h=n[a],c=o[h.materialIndex];c.visible===!0&&f(e,i,c,Le.z,h)}else f(e,i,r,Le.z,null)}}for(var l=e.children,a=0,s=l.length;s>a;a++)T(l[a],t)}}function v(e,t,r,i,n){for(var o=0,a=e.length;a>o;o++){var s=e[o],h=s.object,c=s.geometry,l=void 0===n?s.material:n,u=s.group;if(h.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,h.matrixWorld),h.normalMatrix.getNormalMatrix(h.modelViewMatrix),h instanceof THREE.ImmediateRenderObject){y(l);var d=_(t,r,i,l,h);Re="",h.render(function(e){Te.renderBufferImmediate(e,d,l)})}else Te.renderBufferDirect(t,r,i,c,l,h,u)}}function g(e,t,r,i){var n=je.get(e),o=Xe.getParameters(e,t,r,i),a=Xe.getProgramCode(e,o),h=n.program,c=!0;if(void 0===h)e.addEventListener("dispose",s);else if(h.code!==a)u(e);else{if(void 0!==o.shaderID)return;c=!1}if(c){if(o.shaderID){var l=THREE.ShaderLib[o.shaderID];n.__webglShader={name:e.type,uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else n.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=n.__webglShader,h=Xe.acquireProgram(e,o,a),n.program=h,e.program=h}var d=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<Te.maxMorphTargets;m++)d["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,m=0;m<Te.maxMorphNormals;m++)d["morphNormal"+m]>=0&&e.numSupportedMorphNormals++;n.uniformsList=[];var p=n.program.getUniforms();for(var E in n.__webglShader.uniforms){var f=p[E];f&&n.uniformsList.push([n.__webglShader.uniforms[E],f])}}function y(e){R(e),e.transparent===!0?ze.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):ze.setBlending(THREE.NoBlending),ze.setDepthFunc(e.depthFunc),ze.setDepthTest(e.depthTest),ze.setDepthWrite(e.depthWrite),ze.setColorWrite(e.colorWrite),ze.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function R(e){e.side!==THREE.DoubleSide?ze.enable(Fe.CULL_FACE):ze.disable(Fe.CULL_FACE),ze.setFlipSided(e.side===THREE.BackSide)}function _(e,t,r,i,n){xe=0;var o=je.get(i);!i.needsUpdate&&o.program||(g(i,t,r,n),i.needsUpdate=!1);var a=!1,s=!1,h=!1,c=o.program,l=c.getUniforms(),u=o.__webglShader.uniforms;if(c.id!==ve&&(Fe.useProgram(c.program),ve=c.id,a=!0,s=!0,h=!0),i.id!==ye&&(-1===ye&&(h=!0),ye=i.id,s=!0),(a||e!==_e)&&(Fe.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),Ne.logarithmicDepthBuffer&&Fe.uniform1f(l.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==_e&&(_e=e),(i instanceof THREE.ShaderMaterial||i instanceof THREE.MeshPhongMaterial||i.envMap)&&void 0!==l.cameraPosition&&(Le.setFromMatrixPosition(e.matrixWorld),Fe.uniform3f(l.cameraPosition,Le.x,Le.y,Le.z)),(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshBasicMaterial||i instanceof THREE.ShaderMaterial||i.skinning)&&void 0!==l.viewMatrix&&Fe.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements)),i.skinning)if(n.bindMatrix&&void 0!==l.bindMatrix&&Fe.uniformMatrix4fv(l.bindMatrix,!1,n.bindMatrix.elements),n.bindMatrixInverse&&void 0!==l.bindMatrixInverse&&Fe.uniformMatrix4fv(l.bindMatrixInverse,!1,n.bindMatrixInverse.elements),Ne.floatVertexTextures&&n.skeleton&&n.skeleton.useVertexTexture){if(void 0!==l.boneTexture){var d=O();Fe.uniform1i(l.boneTexture,d),Te.setTexture(n.skeleton.boneTexture,d)}void 0!==l.boneTextureWidth&&Fe.uniform1i(l.boneTextureWidth,n.skeleton.boneTextureWidth),void 0!==l.boneTextureHeight&&Fe.uniform1i(l.boneTextureHeight,n.skeleton.boneTextureHeight)}else n.skeleton&&n.skeleton.boneMatrices&&void 0!==l.boneGlobalMatrices&&Fe.uniformMatrix4fv(l.boneGlobalMatrices,!1,n.skeleton.boneMatrices);return s&&(r&&i.fog&&S(u,r),(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i.lights)&&(Ue&&(h=!0,P(t,e),Ue=!1),h?(w(u,Ie),D(u,!0)):D(u,!1)),(i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial)&&x(u,i),i instanceof THREE.LineBasicMaterial?b(u,i):i instanceof THREE.LineDashedMaterial?(b(u,i),H(u,i)):i instanceof THREE.PointsMaterial?C(u,i):i instanceof THREE.MeshPhongMaterial?M(u,i):i instanceof THREE.MeshDepthMaterial?(u.mNear.value=e.near,u.mFar.value=e.far,u.opacity.value=i.opacity):i instanceof THREE.MeshNormalMaterial&&(u.opacity.value=i.opacity),n.receiveShadow&&!i._shadowPass&&A(u,t,e),U(o.uniformsList)),L(l,n),void 0!==l.modelMatrix&&Fe.uniformMatrix4fv(l.modelMatrix,!1,n.matrixWorld.elements),c}function x(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&(e.emissive.value=t.emissive),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r){r instanceof THREE.WebGLRenderTarget&&(r=r.texture);var i=r.offset,n=r.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function b(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function H(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function C(e,t){if(e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Q.height/2,e.map.value=t.map,null!==t.map){var r=t.map.offset,i=t.map.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}}function S(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function M(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function w(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function D(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function A(e,t,r){if(e.shadowMatrix)for(var i=0,n=0,o=t.length;o>n;n++){var a=t[n];if(a.castShadow===!0&&(a instanceof THREE.PointLight||a instanceof THREE.SpotLight||a instanceof THREE.DirectionalLight)){var s=a.shadow;a instanceof THREE.PointLight?(Le.setFromMatrixPosition(a.matrixWorld).negate(),s.matrix.identity().setPosition(Le),e.shadowDarkness.value[i]=-s.darkness):e.shadowDarkness.value[i]=s.darkness,e.shadowMatrix.value[i]=s.matrix,e.shadowMap.value[i]=s.map,e.shadowMapSize.value[i]=s.mapSize,e.shadowBias.value[i]=s.bias,i++}}}function L(e,t){Fe.uniformMatrix4fv(e.modelViewMatrix,!1,t.modelViewMatrix.elements),e.normalMatrix&&Fe.uniformMatrix3fv(e.normalMatrix,!1,t.normalMatrix.elements)}function O(){var e=xe;return e>=Ne.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Ne.maxTextures),xe+=1,e}function U(e){for(var t,r,i=0,n=e.length;n>i;i++){var o=e[i][0];if(o.needsUpdate!==!1){var a=o.type,s=o.value,h=e[i][1];switch(a){case"1i":Fe.uniform1i(h,s);break;case"1f":Fe.uniform1f(h,s);break;case"2f":Fe.uniform2f(h,s[0],s[1]);break;case"3f":Fe.uniform3f(h,s[0],s[1],s[2]);break;case"4f":Fe.uniform4f(h,s[0],s[1],s[2],s[3]);break;case"1iv":Fe.uniform1iv(h,s);break;case"3iv":Fe.uniform3iv(h,s);break;case"1fv":Fe.uniform1fv(h,s);break;case"2fv":Fe.uniform2fv(h,s);break;case"3fv":Fe.uniform3fv(h,s);break;case"4fv":Fe.uniform4fv(h,s);break;case"Matrix3fv":Fe.uniformMatrix3fv(h,!1,s);break;case"Matrix4fv":Fe.uniformMatrix4fv(h,!1,s);break;case"i":Fe.uniform1i(h,s);break;case"f":Fe.uniform1f(h,s);break;case"v2":Fe.uniform2f(h,s.x,s.y);break;case"v3":Fe.uniform3f(h,s.x,s.y,s.z);break;case"v4":Fe.uniform4f(h,s.x,s.y,s.z,s.w);break;case"c":Fe.uniform3f(h,s.r,s.g,s.b);break;case"iv1":Fe.uniform1iv(h,s);break;case"iv":Fe.uniform3iv(h,s);break;case"fv1":Fe.uniform1fv(h,s);break;case"fv":Fe.uniform3fv(h,s);break;case"v2v":void 0===o._array&&(o._array=new Float32Array(2*s.length));for(var c=0,l=0,u=s.length;u>c;c++,l+=2)o._array[l+0]=s[c].x,o._array[l+1]=s[c].y;Fe.uniform2fv(h,o._array);break;case"v3v":void 0===o._array&&(o._array=new Float32Array(3*s.length));for(var c=0,d=0,u=s.length;u>c;c++,d+=3)o._array[d+0]=s[c].x,o._array[d+1]=s[c].y,o._array[d+2]=s[c].z;Fe.uniform3fv(h,o._array);break;case"v4v":void 0===o._array&&(o._array=new Float32Array(4*s.length));for(var c=0,m=0,u=s.length;u>c;c++,m+=4)o._array[m+0]=s[c].x,o._array[m+1]=s[c].y,o._array[m+2]=s[c].z,o._array[m+3]=s[c].w;Fe.uniform4fv(h,o._array);break;case"m3":Fe.uniformMatrix3fv(h,!1,s.elements);break;case"m3v":void 0===o._array&&(o._array=new Float32Array(9*s.length));for(var c=0,u=s.length;u>c;c++)s[c].flattenToArrayOffset(o._array,9*c);Fe.uniformMatrix3fv(h,!1,o._array);break;case"m4":Fe.uniformMatrix4fv(h,!1,s.elements);break;case"m4v":void 0===o._array&&(o._array=new Float32Array(16*s.length));for(var c=0,u=s.length;u>c;c++)s[c].flattenToArrayOffset(o._array,16*c);Fe.uniformMatrix4fv(h,!1,o._array);break;case"t":if(t=s,r=O(),Fe.uniform1i(h,r),!t)continue;t instanceof THREE.CubeTexture||Array.isArray(t.image)&&6===t.image.length?z(t,r):t instanceof THREE.WebGLRenderTargetCube?j(t.texture,r):t instanceof THREE.WebGLRenderTarget?Te.setTexture(t.texture,r):Te.setTexture(t,r);break;case"tv":void 0===o._array&&(o._array=[]);for(var c=0,u=o.value.length;u>c;c++)o._array[c]=O();Fe.uniform1iv(h,o._array);for(var c=0,u=o.value.length;u>c;c++)t=o.value[c],r=o._array[c],t&&(t instanceof THREE.CubeTexture||t.image instanceof Array&&6===t.image.length?z(t,r):t instanceof THREE.WebGLRenderTarget?Te.setTexture(t.texture,r):t instanceof THREE.WebGLRenderTargetCube?j(t.texture,r):Te.setTexture(t,r));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}}function I(e,t,r,i){e[t+0]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function P(e,t){var r,i,n,o,a,s,h,c,l=0,u=0,d=0,m=Ie,p=t.matrixWorldInverse,E=m.directional.colors,f=m.directional.positions,T=m.point.colors,v=m.point.positions,g=m.point.distances,y=m.point.decays,R=m.spot.colors,_=m.spot.positions,x=m.spot.distances,b=m.spot.directions,H=m.spot.anglesCos,C=m.spot.exponents,S=m.spot.decays,M=m.hemi.skyColors,w=m.hemi.groundColors,D=m.hemi.positions,A=0,L=0,O=0,U=0,P=0,k=0,F=0,B=0,V=0,G=0,N=0,z=0;for(r=0,i=e.length;i>r;r++)if(n=e[r],o=n.color,h=n.intensity,c=n.distance,n instanceof THREE.AmbientLight){if(!n.visible)continue;l+=o.r,u+=o.g,d+=o.b}else if(n instanceof THREE.DirectionalLight){if(P+=1,!n.visible)continue;Oe.setFromMatrixPosition(n.matrixWorld),Le.setFromMatrixPosition(n.target.matrixWorld),Oe.sub(Le),Oe.transformDirection(p),V=3*A,f[V+0]=Oe.x,f[V+1]=Oe.y,f[V+2]=Oe.z,I(E,V,o,h),A+=1}else if(n instanceof THREE.PointLight){if(k+=1,!n.visible)continue;G=3*L,I(T,G,o,h),Le.setFromMatrixPosition(n.matrixWorld),Le.applyMatrix4(p),v[G+0]=Le.x,v[G+1]=Le.y,v[G+2]=Le.z,g[L]=c,y[L]=0===n.distance?0:n.decay,L+=1}else if(n instanceof THREE.SpotLight){if(F+=1,!n.visible)continue;N=3*O,I(R,N,o,h),Oe.setFromMatrixPosition(n.matrixWorld),Le.copy(Oe).applyMatrix4(p),_[N+0]=Le.x,_[N+1]=Le.y,_[N+2]=Le.z,x[O]=c,Le.setFromMatrixPosition(n.target.matrixWorld),Oe.sub(Le),Oe.transformDirection(p),b[N+0]=Oe.x,b[N+1]=Oe.y,b[N+2]=Oe.z,H[O]=Math.cos(n.angle),C[O]=n.exponent,S[O]=0===n.distance?0:n.decay,O+=1}else if(n instanceof THREE.HemisphereLight){if(B+=1,!n.visible)continue;Oe.setFromMatrixPosition(n.matrixWorld),Oe.transformDirection(p),z=3*U,D[z+0]=Oe.x,D[z+1]=Oe.y,D[z+2]=Oe.z,a=n.color,s=n.groundColor,I(M,z,a,h),I(w,z,s,h),U+=1}for(r=3*A,i=Math.max(E.length,3*P);i>r;r++)E[r]=0;for(r=3*L,i=Math.max(T.length,3*k);i>r;r++)T[r]=0;for(r=3*O,i=Math.max(R.length,3*F);i>r;r++)R[r]=0;for(r=3*U,i=Math.max(M.length,3*B);i>r;r++)M[r]=0;for(r=3*U,i=Math.max(w.length,3*B);i>r;r++)w[r]=0;m.directional.length=A,m.point.length=L,m.spot.length=O,m.hemi.length=U,m.ambient[0]=l,m.ambient[1]=u,m.ambient[2]=d}function k(e,t,r){var i;if(r?(Fe.texParameteri(e,Fe.TEXTURE_WRAP_S,q(t.wrapS)),Fe.texParameteri(e,Fe.TEXTURE_WRAP_T,q(t.wrapT)),Fe.texParameteri(e,Fe.TEXTURE_MAG_FILTER,q(t.magFilter)),Fe.texParameteri(e,Fe.TEXTURE_MIN_FILTER,q(t.minFilter))):(Fe.texParameteri(e,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(e,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),t.wrapS===THREE.ClampToEdgeWrapping&&t.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t),Fe.texParameteri(e,Fe.TEXTURE_MAG_FILTER,K(t.magFilter)),Fe.texParameteri(e,Fe.TEXTURE_MIN_FILTER,K(t.minFilter)),t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t)),i=Ge.get("EXT_texture_filter_anisotropic")){if(t.type===THREE.FloatType&&null===Ge.get("OES_texture_float_linear"))return;if(t.type===THREE.HalfFloatType&&null===Ge.get("OES_texture_half_float_linear"))return;(t.anisotropy>1||je.get(t).__currentAnisotropy)&&(Fe.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Te.getMaxAnisotropy())),je.get(t).__currentAnisotropy=t.anisotropy)}}function F(e,t,r){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",o),e.__webglTexture=Fe.createTexture(),Pe.textures++),ze.activeTexture(Fe.TEXTURE0+r),ze.bindTexture(Fe.TEXTURE_2D,e.__webglTexture),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,t.flipY),Fe.pixelStorei(Fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Fe.pixelStorei(Fe.UNPACK_ALIGNMENT,t.unpackAlignment),t.image=B(t.image,Ne.maxTextureSize),G(t)&&V(t.image)===!1&&(t.image=N(t.image));var i=t.image,n=V(i),a=q(t.format),s=q(t.type);k(Fe.TEXTURE_2D,t,n);var h,c=t.mipmaps;if(t instanceof THREE.DataTexture)if(c.length>0&&n){for(var l=0,u=c.length;u>l;l++)h=c[l],ze.texImage2D(Fe.TEXTURE_2D,l,a,h.width,h.height,0,a,s,h.data);t.generateMipmaps=!1}else ze.texImage2D(Fe.TEXTURE_2D,0,a,i.width,i.height,0,a,s,i.data);else if(t instanceof THREE.CompressedTexture)for(var l=0,u=c.length;u>l;l++)h=c[l],t.format!==THREE.RGBAFormat&&t.format!==THREE.RGBFormat?ze.getCompressedTextureFormats().indexOf(a)>-1?ze.compressedTexImage2D(Fe.TEXTURE_2D,l,a,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ze.texImage2D(Fe.TEXTURE_2D,l,a,h.width,h.height,0,a,s,h.data);else if(c.length>0&&n){for(var l=0,u=c.length;u>l;l++)h=c[l],ze.texImage2D(Fe.TEXTURE_2D,l,a,a,s,h);t.generateMipmaps=!1}else ze.texImage2D(Fe.TEXTURE_2D,0,a,a,s,t.image);t.generateMipmaps&&n&&Fe.generateMipmap(Fe.TEXTURE_2D),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function B(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height),i=document.createElement("canvas");i.width=Math.floor(e.width*r),i.height=Math.floor(e.height*r);var n=i.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e),i}return e}function V(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}function G(e){return e.wrapS!==THREE.ClampToEdgeWrapping||e.wrapT!==THREE.ClampToEdgeWrapping?!0:e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter}function N(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement("canvas");t.width=THREE.Math.nearestPowerOfTwo(e.width),t.height=THREE.Math.nearestPowerOfTwo(e.height);var r=t.getContext("2d");return r.drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function z(e,t){var r=je.get(e);if(6===e.image.length)if(e.version>0&&r.__version!==e.version){r.__image__webglTextureCube||(e.addEventListener("dispose",o),r.__image__webglTextureCube=Fe.createTexture(),Pe.textures++),ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_CUBE_MAP,r.__image__webglTextureCube),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof THREE.CompressedTexture,n=e.image[0]instanceof THREE.DataTexture,a=[],s=0;6>s;s++)!Te.autoScaleCubemaps||i||n?a[s]=n?e.image[s].image:e.image[s]:a[s]=B(e.image[s],Ne.maxCubemapSize);var h=a[0],c=V(h),l=q(e.format),u=q(e.type);k(Fe.TEXTURE_CUBE_MAP,e,c);for(var s=0;6>s;s++)if(i)for(var d,m=a[s].mipmaps,p=0,E=m.length;E>p;p++)d=m[p],e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat?ze.getCompressedTextureFormats().indexOf(l)>-1?ze.compressedTexImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,l,d.width,d.height,0,l,u,d.data);else n?ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,a[s].width,a[s].height,0,l,u,a[s].data):ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,l,u,a[s]);e.generateMipmaps&&c&&Fe.generateMipmap(Fe.TEXTURE_CUBE_MAP),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}else ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}function j(e,t){ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_CUBE_MAP,je.get(e).__webglTexture)}function W(e,t,r){Fe.bindFramebuffer(Fe.FRAMEBUFFER,e),Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,r,je.get(t.texture).__webglTexture,0)}function X(e,t){Fe.bindRenderbuffer(Fe.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.DEPTH_COMPONENT16,t.width,t.height),Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_ATTACHMENT,Fe.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.DEPTH_STENCIL,t.width,t.height),Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_STENCIL_ATTACHMENT,Fe.RENDERBUFFER,e)):Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.RGBA4,t.width,t.height)}function Y(e){var t=e instanceof THREE.WebGLRenderTargetCube?Fe.TEXTURE_CUBE_MAP:Fe.TEXTURE_2D,r=je.get(e.texture).__webglTexture;ze.bindTexture(t,r),Fe.generateMipmap(t),ze.bindTexture(t,null)}function K(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Fe.NEAREST:Fe.LINEAR}function q(e){var t;if(e===THREE.RepeatWrapping)return Fe.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Fe.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Fe.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Fe.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Fe.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Fe.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Fe.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Fe.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Fe.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Fe.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Fe.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Fe.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Fe.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Fe.BYTE;if(e===THREE.ShortType)return Fe.SHORT;if(e===THREE.UnsignedShortType)return Fe.UNSIGNED_SHORT;if(e===THREE.IntType)return Fe.INT;if(e===THREE.UnsignedIntType)return Fe.UNSIGNED_INT;if(e===THREE.FloatType)return Fe.FLOAT;if(t=Ge.get("OES_texture_half_float"),null!==t&&e===THREE.HalfFloatType)return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return Fe.ALPHA;if(e===THREE.RGBFormat)return Fe.RGB;if(e===THREE.RGBAFormat)return Fe.RGBA;if(e===THREE.LuminanceFormat)return Fe.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Fe.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Fe.FUNC_ADD;if(e===THREE.SubtractEquation)return Fe.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Fe.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Fe.ZERO;if(e===THREE.OneFactor)return Fe.ONE;if(e===THREE.SrcColorFactor)return Fe.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Fe.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Fe.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Fe.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Fe.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Fe.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Fe.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Fe.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Fe.SRC_ALPHA_SATURATE;if(t=Ge.get("WEBGL_compressed_texture_s3tc"),null!==t){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=Ge.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=Ge.get("EXT_blend_minmax"),null!==t){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}e=e||{};var Q=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Z=void 0!==e.context?e.context:null,J=Q.width,$=Q.height,ee=1,te=void 0!==e.alpha?e.alpha:!1,re=void 0!==e.depth?e.depth:!0,ie=void 0!==e.stencil?e.stencil:!0,ne=void 0!==e.antialias?e.antialias:!1,oe=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,ae=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,se=new THREE.Color(0),he=0,ce=[],le=[],ue=-1,de=[],me=-1,pe=new Float32Array(8),Ee=[],fe=[];this.domElement=Q,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var Te=this,ve=null,ge=null,ye=-1,Re="",_e=null,xe=0,be=0,He=0,Ce=Q.width,Se=Q.height,Me=0,we=0,De=new THREE.Frustum,Ae=new THREE.Matrix4,Le=new THREE.Vector3,Oe=new THREE.Vector3,Ue=!0,Ie={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Pe={geometries:0,textures:0},ke={calls:0,vertices:0,faces:0,points:0};this.info={render:ke,memory:Pe,programs:null};var Fe;try{var Be={alpha:te,depth:re,stencil:ie,antialias:ne,premultipliedAlpha:oe,preserveDrawingBuffer:ae};if(Fe=Z||Q.getContext("webgl",Be)||Q.getContext("experimental-webgl",Be),null===Fe)throw null!==Q.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";Q.addEventListener("webglcontextlost",n,!1)}catch(Ve){console.error("THREE.WebGLRenderer: "+Ve)}var Ge=new THREE.WebGLExtensions(Fe);Ge.get("OES_texture_float"),Ge.get("OES_texture_float_linear"),Ge.get("OES_texture_half_float"),Ge.get("OES_texture_half_float_linear"),Ge.get("OES_standard_derivatives"),Ge.get("ANGLE_instanced_arrays"),Ge.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var Ne=new THREE.WebGLCapabilities(Fe,Ge,e),ze=new THREE.WebGLState(Fe,Ge,q),je=new THREE.WebGLProperties,We=new THREE.WebGLObjects(Fe,je,this.info),Xe=new THREE.WebGLPrograms(this,Ne);
this.info.programs=Xe.programs;var Ye=new THREE.WebGLBufferRenderer(Fe,Ge,ke),Ke=new THREE.WebGLIndexedBufferRenderer(Fe,Ge,ke);r(),this.context=Fe,this.capabilities=Ne,this.extensions=Ge,this.state=ze;var qe=new THREE.WebGLShadowMap(this,ce,We);this.shadowMap=qe;var Qe=new THREE.SpritePlugin(this,Ee),Ze=new THREE.LensFlarePlugin(this,fe);this.getContext=function(){return Fe},this.getContextAttributes=function(){return Fe.getContextAttributes()},this.forceContextLoss=function(){Ge.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=Ge.get("EXT_texture_filter_anisotropic");return e=null!==t?Fe.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return Ne.precision},this.getPixelRatio=function(){return ee},this.setPixelRatio=function(e){void 0!==e&&(ee=e)},this.getSize=function(){return{width:J,height:$}},this.setSize=function(e,t,r){J=e,$=t,Q.width=e*ee,Q.height=t*ee,r!==!1&&(Q.style.width=e+"px",Q.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){be=e*ee,He=t*ee,Ce=r*ee,Se=i*ee,Fe.viewport(be,He,Ce,Se)},this.getViewport=function(e){e.x=be/ee,e.y=He/ee,e.z=Ce/ee,e.w=Se/ee},this.setScissor=function(e,t,r,i){Fe.scissor(e*ee,t*ee,r*ee,i*ee)},this.enableScissorTest=function(e){ze.setScissorTest(e)},this.getClearColor=function(){return se},this.setClearColor=function(e,r){se.set(e),he=void 0!==r?r:1,t(se.r,se.g,se.b,he)},this.getClearAlpha=function(){return he},this.setClearAlpha=function(e){he=e,t(se.r,se.g,se.b,he)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=Fe.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Fe.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=Fe.STENCIL_BUFFER_BIT),Fe.clear(i)},this.clearColor=function(){Fe.clear(Fe.COLOR_BUFFER_BIT)},this.clearDepth=function(){Fe.clear(Fe.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Fe.clear(Fe.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.resetGLState=i,this.dispose=function(){Q.removeEventListener("webglcontextlost",n,!1)},this.renderBufferImmediate=function(e,t,r){ze.initAttributes();var i=je.get(e);e.hasPositions&&!i.position&&(i.position=Fe.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=Fe.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=Fe.createBuffer()),e.hasColors&&!i.color&&(i.color=Fe.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.position),Fe.bufferData(Fe.ARRAY_BUFFER,e.positionArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.position),Fe.vertexAttribPointer(n.position,3,Fe.FLOAT,!1,0,0)),e.hasNormals){if(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.normal),"MeshPhongMaterial"!==r.type&&r.shading===THREE.FlatShading)for(var o=0,a=3*e.count;a>o;o+=9){var s=e.normalArray,h=(s[o+0]+s[o+3]+s[o+6])/3,c=(s[o+1]+s[o+4]+s[o+7])/3,l=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=h,s[o+1]=c,s[o+2]=l,s[o+3]=h,s[o+4]=c,s[o+5]=l,s[o+6]=h,s[o+7]=c,s[o+8]=l}Fe.bufferData(Fe.ARRAY_BUFFER,e.normalArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.normal),Fe.vertexAttribPointer(n.normal,3,Fe.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.uv),Fe.bufferData(Fe.ARRAY_BUFFER,e.uvArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.uv),Fe.vertexAttribPointer(n.uv,2,Fe.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==THREE.NoColors&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,i.color),Fe.bufferData(Fe.ARRAY_BUFFER,e.colorArray,Fe.DYNAMIC_DRAW),ze.enableAttribute(n.color),Fe.vertexAttribPointer(n.color,3,Fe.FLOAT,!1,0,0)),ze.disableUnusedAttributes(),Fe.drawArrays(Fe.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,o,a){i||(i=We.update(o)),y(n);var s=_(e,t,r,n,o),h=!1,c=i.id+"_"+s.id+"_"+n.wireframe;c!==Re&&(Re=c,h=!0);var l=o.morphTargetInfluences;if(void 0!==l){for(var u=[],p=0,E=l.length;E>p;p++){var f=l[p];u.push([f,p])}u.sort(m),u.length>8&&(u.length=8);for(var T=i.morphAttributes,p=0,E=u.length;E>p;p++){var f=u[p];if(pe[p]=f[0],0!==f[0]){var v=f[1];n.morphTargets===!0&&T.position&&i.addAttribute("morphTarget"+p,T.position[v]),n.morphNormals===!0&&T.normal&&i.addAttribute("morphNormal"+p,T.normal[v])}else n.morphTargets===!0&&i.removeAttribute("morphTarget"+p),n.morphNormals===!0&&i.removeAttribute("morphNormal"+p)}var g=s.getUniforms();null!==g.morphTargetInfluences&&Fe.uniform1fv(g.morphTargetInfluences,pe),h=!0}var v=i.index,R=i.attributes.position;n.wireframe===!0&&(v=We.getWireframeAttribute(i));var x;null!==v?(x=Ke,x.setIndex(v)):x=Ye,h&&(d(n,s,i),null!==v&&Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,We.getAttributeBuffer(v)));var b=1/0;null!==v?b=v.count:void 0!==R&&(b=R.count);var H=0,C=b;if(o instanceof CLOUD.Mesh||o instanceof THREE.Mesh)n.wireframe===!0?(ze.setLineWidth(n.wireframeLinewidth*ee),x.setMode(Fe.LINES)):x.setMode(Fe.TRIANGLES),i instanceof THREE.InstancedBufferGeometry&&i.maxInstancedCount>0?x.renderInstances(i):x.render(H,C);else if(o instanceof THREE.Line){var S=n.linewidth;void 0===S&&(S=1),ze.setLineWidth(S*ee),o instanceof THREE.LineSegments?x.setMode(Fe.LINES):x.setMode(Fe.LINE_STRIP),x.render(H,C)}else o instanceof THREE.Points&&(x.setMode(Fe.POINTS),x.render(H,C))},this.render=function(e,t,r,i){if(t instanceof THREE.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var n=e.fog;if(Re="",ye=-1,_e=null,Ue=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Ae.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),De.setFromMatrix(Ae),ce.length=0,ue=-1,me=-1,Ee.length=0,fe.length=0,T(e,t),le.length=ue+1,de.length=me+1,Te.sortObjects===!0&&(le.sort(p),de.sort(E)),qe.render(e),ke.calls=0,ke.vertices=0,ke.faces=0,ke.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var o=e.overrideMaterial;v(le,t,ce,n,o),v(de,t,ce,n,o)}else ze.setBlending(THREE.NoBlending),v(le,t,ce,n),v(de,t,ce,n);if(Qe.render(e,t),Ze.render(e,t,Me,we),r){var a=r.texture,s=V(r);a.generateMipmaps&&s&&a.minFilter!==THREE.NearestFilter&&a.minFilter!==THREE.LinearFilter&&Y(r)}ze.setDepthTest(!0),ze.setDepthWrite(!0),ze.setColorWrite(!0)},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?ze.disable(Fe.CULL_FACE):(t===THREE.FrontFaceDirectionCW?Fe.frontFace(Fe.CW):Fe.frontFace(Fe.CCW),e===THREE.CullFaceBack?Fe.cullFace(Fe.BACK):e===THREE.CullFaceFront?Fe.cullFace(Fe.FRONT):Fe.cullFace(Fe.FRONT_AND_BACK),ze.enable(Fe.CULL_FACE))},this.setTexture=function(e,t){var r=je.get(e);if(e.version>0&&r.__version!==e.version){var i=e.image;return void 0===i?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e):i.complete===!1?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e):void F(r,e,t)}ze.activeTexture(Fe.TEXTURE0+t),ze.bindTexture(Fe.TEXTURE_2D,r.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&void 0===je.get(e).__webglFramebuffer){var r=je.get(e),i=je.get(e.texture);void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",a),i.__webglTexture=Fe.createTexture(),Pe.textures++;var n=V(e),o=q(e.texture.format),s=q(e.texture.type);if(t){r.__webglFramebuffer=[],r.__webglRenderbuffer=[],ze.bindTexture(Fe.TEXTURE_CUBE_MAP,i.__webglTexture),k(Fe.TEXTURE_CUBE_MAP,e.texture,n);for(var h=0;6>h;h++)r.__webglFramebuffer[h]=Fe.createFramebuffer(),r.__webglRenderbuffer[h]=Fe.createRenderbuffer(),ze.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,o,e.width,e.height,0,o,s,null),W(r.__webglFramebuffer[h],e,Fe.TEXTURE_CUBE_MAP_POSITIVE_X+h),X(r.__webglRenderbuffer[h],e);e.texture.generateMipmaps&&n&&Fe.generateMipmap(Fe.TEXTURE_CUBE_MAP)}else r.__webglFramebuffer=Fe.createFramebuffer(),e.shareDepthFrom?r.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:r.__webglRenderbuffer=Fe.createRenderbuffer(),ze.bindTexture(Fe.TEXTURE_2D,i.__webglTexture),k(Fe.TEXTURE_2D,e.texture,n),ze.texImage2D(Fe.TEXTURE_2D,0,o,e.width,e.height,0,o,s,null),W(r.__webglFramebuffer,e,Fe.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_ATTACHMENT,Fe.RENDERBUFFER,r.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_STENCIL_ATTACHMENT,Fe.RENDERBUFFER,r.__webglRenderbuffer):X(r.__webglRenderbuffer,e),e.texture.generateMipmaps&&n&&Fe.generateMipmap(Fe.TEXTURE_2D);t?ze.bindTexture(Fe.TEXTURE_CUBE_MAP,null):ze.bindTexture(Fe.TEXTURE_2D,null),Fe.bindRenderbuffer(Fe.RENDERBUFFER,null),Fe.bindFramebuffer(Fe.FRAMEBUFFER,null)}var c,l,u,d,m;if(e){var r=je.get(e);c=t?r.__webglFramebuffer[e.activeCubeFace]:r.__webglFramebuffer,l=e.width,u=e.height,d=0,m=0}else c=null,l=Ce,u=Se,d=be,m=He;if(c!==ge&&(Fe.bindFramebuffer(Fe.FRAMEBUFFER,c),Fe.viewport(d,m,l,u),ge=c),t){var i=je.get(e.texture);Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,0)}Me=l,we=u},this.readRenderTargetPixels=function(e,t,r,i,n,o){if(e instanceof THREE.WebGLRenderTarget==!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var a=je.get(e).__webglFramebuffer;if(a){var s=!1;a!==ge&&(Fe.bindFramebuffer(Fe.FRAMEBUFFER,a),s=!0);try{var h=e.texture;if(h.format!==THREE.RGBAFormat&&q(h.format)!==Fe.getParameter(Fe.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h.type===THREE.UnsignedByteType||q(h.type)===Fe.getParameter(Fe.IMPLEMENTATION_COLOR_READ_TYPE)||h.type===THREE.FloatType&&Ge.get("WEBGL_color_buffer_float")||h.type===THREE.HalfFloatType&&Ge.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Fe.checkFramebufferStatus(Fe.FRAMEBUFFER)===Fe.FRAMEBUFFER_COMPLETE?Fe.readPixels(t,r,i,n,q(h.format),q(h.type),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&Fe.bindFramebuffer(Fe.FRAMEBUFFER,ge)}}},this.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),Ge.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),Ge.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),Ge.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),Ge.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),Ge.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),Ge.get("EXT_blend_minmax")},this.supportsVertexTextures=function(){return Ne.vertexTextures},this.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),Ge.get("ANGLE_instanced_arrays")},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Object.defineProperties(this,{shadowMapEnabled:{get:function(){return qe.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),qe.enabled=e}},shadowMapType:{get:function(){return qe.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),qe.type=e}},shadowMapCullFace:{get:function(){return qe.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),qe.cullFace=e}},shadowMapDebug:{get:function(){return qe.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug."),qe.debug=e}}});var Je=new CLOUD.OrderedRenderer;this.IncrementRender=function(e,t,r,i){return t instanceof THREE.Camera==!1?void console.error("THREE.WebGLIncrementRenderer.IncrementRender: camera is not an instance of THREE.Camera."):(Re="",ye=-1,_e=null,Ue=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Ae.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),De.setFromMatrix(Ae),ke.calls=0,ke.vertices=0,ke.faces=0,ke.points=0,Je.update(De,Ae),Je.render(this,e,t,ce,r,i,ze))},this.resetIncrementRender=function(){Je.restart()},this.setFilterObject=function(e){Je.setFilter(e)},this.setObjectListUpdateState=function(e){Je.updateObjectList(e)},this.computeSelectionBBox=function(){return Je.computeSelectionBBox()},this.setRenderTicket=function(e){We.renderTicket=e}};var CloudTouch=CloudTouch||{};!function(){var e=1,t=2,r=4,i=8,n={touchstart:e,touchmove:t,touchend:r,touchcancel:i},o="touch",a=1,s=2,h=4,c=8,l=16,u=s|h,d=c|l,m=u|d,p=["x","y"],E=["clientX","clientY"],f=function(t,a){var s=t,h={pointers:a.touches,changedPointers:a.changedTouches,pointerType:o,srcEvent:a},c=a.touches.length,l=a.changedTouches.length,u=n[a.type],d=u&e&&c-l===0,m=u&(r|i)&&c-l===0;h.isFirst=!!d,h.isFinal=!!m,d&&(s.session={}),h.eventType=u,g(s,h),s.session.prevInput=h},T=function(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:v(t),deltaX:e.deltaX||0,deltaY:e.deltaY||0}},v=function(e){var t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};for(var r=0,i=0,n=0;t>n;)r+=e[n].clientX,i+=e[n].clientY,n++;return{x:Math.round(r/t),y:Math.round(i/t)}},g=function(e,t){var r=e.session,i=t.pointers,n=i.length;r.firstInput||(r.firstInput=T(t)),n>1&&!r.firstMultiple?r.firstMultiple=T(t):1===n&&(r.firstMultiple=!1);var o=r.firstInput,a=r.firstMultiple,s=a?a.center:o.center,h=t.center=v(i);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=x(s,h),t.distance=_(s,h),t.scale=a?H(a.pointers,i):1,t.rotation=a?b(a.pointers,i):0,y(r,t),t.offsetDirection=R(t.deltaX,t.deltaY),t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length},y=function(t,i){var n=i.center,o=t.offsetDelta||{},a=t.prevDelta||{},s=t.prevInput||{};i.eventType!==e&&s.eventType!==r||(a=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},o=t.offsetDelta={x:n.x,y:n.y}),i.deltaX=a.x+(n.x-o.x),i.deltaY=a.y+(n.y-o.y),i.eventType===e?(i.relativeDeltaX=0,i.relativeDeltaY=0,i.relativeRotation=0,i.relativeScale=1,i.deltaAngle=0):(i.relativeDeltaX=n.x-s.center.x,i.relativeDeltaY=n.y-s.center.y,i.relativeRotation=i.rotation-s.rotation,i.relativeScale=i.scale/s.scale,i.deltaAngle=i.angle-s.angle)},R=function(e,t){return e===t?a:Math.abs(e)>=Math.abs(t)?0>e?s:h:0>t?c:l},_=function(e,t,r){r||(r=p);var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return Math.sqrt(i*i+n*n)},x=function(e,t,r){r||(r=p);var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return Math.atan2(n,i)},b=function(e,t){return x(t[1],t[0],E)+x(e[1],e[0],E)},H=function(e,t){return _(t[0],t[1],E)/_(e[0],e[1],E)};CloudTouch.proxy={INPUT_START:e,INPUT_MOVE:t,INPUT_END:r,INPUT_CANCEL:i,DIRECTION_NONE:a,DIRECTION_LEFT:s,DIRECTION_RIGHT:h,DIRECTION_UP:c,DIRECTION_DOWN:l,DIRECTION_HORIZONTAL:u,DIRECTION_VERTICAL:d,DIRECTION_ALL:m,touchsHandler:f}}(),CLOUD.Animation=function(){var e=this,t=null,r={},i={},n=1e3,o=null,a=null,s=.9995,h=null,c=!1,l=null,u=null,d=null;this.from=function(e){t=e;for(var i in t)r[i]=t[i];return this},this.to=function(e,t){return void 0!==t&&(n=t),i=e,this},this.onStart=function(e){return l=e,this},this.onUpdate=function(e){return u=e,this},this.onComplete=function(e){return d=e,this},this.start=function(e){c=!1,a&&clearInterval(a),o=Date.now(),h=this.interpolate;var s=function(){var e,s=r,m=i,p=Date.now();c===!1&&(null!==l&&l.call(t),c=!0),e=(p-o)/n,e=e>1?1:e,t=h(s,m,e),1===e?(clearInterval(a),null!==d&&d.call(t)):null!==u&&u.call(t,e)};a=setInterval(s,e)},this.isAngleGreaterThanPi=function(e,t,r){var i=new THREE.Vector3;i.crossVectors(e,t);var n=i.dot(r);return!(n>=0)},this.conicInterpolate=function(e,t,r,i,n){var o=-Math.PI*i;n&&(o*=-1);var a=new THREE.Vector3;a.addVectors(t,e).normalize();var s=new THREE.Quaternion;s.setFromAxisAngle(a,o),r.copy(e),r.applyQuaternion(s)},this.slerpInterpolate=function(e,t,r,i,n,o,a,s){var h=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3),c=0,l=e.dot(t),u=new THREE.Quaternion(e.x,e.y,e.z,1).normalize(),d=new THREE.Quaternion(t.x,t.y,t.z,1).normalize(),m=new THREE.Quaternion(0,0,0,1),p=new THREE.Quaternion(0,0,0,1);void 0===a&&(a=!1),void 0===s&&(s=!1),l>o?i.copy(t):o<Math.abs(l)?(h.crossVectors(e,r).normalize(),m.set(h.x,h.y,h.z,1).normalize(),.5>n?(c=2*n,THREE.Quaternion.slerp(u,m,p,c),i.set(p.x,p.y,p.z)):(c=2*(n-.5),THREE.Quaternion.slerp(m,d,p,c),i.set(p.x,p.y,p.z))):a?this.conicInterpolate(e,t,i,n,s):(THREE.Quaternion.slerp(u,d,p,n),i.set(p.x,p.y,p.z)),i.normalize()},this.linearInterpolate=function(e,t,r,i,n){var o=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,0,1),s=new THREE.Vector3,h=0,c=e.dot(t);c>n?r.copy(t):-c>n?(n>Math.abs(e.dot(a))?s.crossVectors(e,a).normalize():s.crossVectors(e,o).normalize(),.5>i?(h=2*i,r.lerpVectors(e,s,h)):(h=2*(i-.5),r.lerpVectors(s,t,h))):r.lerpVectors(e,t,i),r.normalize()},this.interpolate=function(t,r,i){var n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,h=new THREE.Vector3,c=t.animDir,l=t.animUp,u=r.animDir,d=r.animUp;n.crossVectors(c,l),o.crossVectors(u,d);var m=n.dot(o),p=s-1,E=p>m,f=e.isAngleGreaterThanPi(c,u,l);return e.slerpInterpolate(c,u,l,a,i,s,E,f),e.linearInterpolate(l,d,h,i,s),{animDir:a,animUp:h}}},CloudUniformsLib={cust_clip:{iClipPlane:{type:"i",value:0},vClipPlane:{type:"v4",value:new THREE.Vector4(0,0,1,0)}},cus_Instanced:{transformMatrix:{type:"m4",value:new THREE.Matrix4}}},CloudShaderChunk={cust_clip_pars_vertex:"#ifdef USE_CUSTOMCLIP\n\n    uniform vec4 vClipPlane; \n\n    uniform int iClipPlane; \n\n    varying float fClipDistance;\n\n#endif\n",cust_clip_pars_fragment:"#ifdef USE_CUSTOMCLIP\n\n    uniform int iClipPlane; \n\n    varying float fClipDistance;\n\n#endif\n",cust_clip_vertex:"#ifdef USE_CUSTOMCLIP\n\n    if(iClipPlane >0) {\n        fClipDistance = dot(worldPosition.xyz, vClipPlane.xyz) + vClipPlane.w;\n    }\n#endif\n",cust_clip_fragment:"#ifdef USE_CUSTOMCLIP\n\n    if(iClipPlane >0 && fClipDistance > 0.0) {\n\n        discard;\n\n    }\n\n#endif\n",cust_Instanced_pars_vertex:"#ifdef USE_CUST_INSTANCED\n\n    attribute vec4 componentV1;\nattribute vec4 componentV2;\nattribute vec4 componentV3;\nattribute vec4 componentV4;\n#endif\n",cust_Instanced_normal_vertex:"#ifdef USE_CUST_INSTANCED\n\n	mat4 modelTransMatrix = mat4(componentV1, componentV2, componentV3,componentV4);\n	 objectNormal = inverseTransformDirection(objectNormal, modelTransMatrix);\n#endif\n",cust_Instanced_vertex:"#ifdef USE_CUST_INSTANCED\n\n	vec4 newposition = mat4(componentV1, componentV2, componentV3,componentV4) * vec4( transformed, 1.0 );\n	 transformed = newposition.xyz;\n#endif\n",cust_Instanced_pars_vertex2:"#ifdef USE_CUST_INSTANCED\n\n  uniform mat4 transformMatrix; \n#endif\n",cust_Instanced_vertex2:"#ifdef USE_CUST_INSTANCED\n\n	vec4 newposition = transformMatrix * vec4( transformed, 1.0 );\n	 transformed = newposition.xyz;\n#endif\n"},CloudShaderLibs={},CloudShaderLibs.r73={phong_cust_clip:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,CloudUniformsLib.cust_clip,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define USE_CUSTOMCLIP","#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","    varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.displacementmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,CloudShaderChunk.cust_clip_pars_vertex,CloudShaderChunk.cust_Instanced_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,CloudShaderChunk.cust_Instanced_normal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","    vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex,CloudShaderChunk.cust_Instanced_vertex,THREE.ShaderChunk.displacementmap_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"    vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,CloudShaderChunk.cust_clip_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define USE_CUSTOMCLIP",CloudShaderChunk.cust_clip_pars_fragment,"#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",CloudShaderChunk.cust_clip_fragment,"    vec3 outgoingLight = vec3( 0.0 );","    vec4 diffuseColor = vec4( diffuse, opacity );","    vec3 totalAmbientLight = ambientLightColor;","    vec3 totalEmissiveLight = emissive;","    vec3 shadowMask = vec3( 1.0 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.normal_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.hemilight_fragment,THREE.ShaderChunk.aomap_fragment,THREE.ShaderChunk.emissivemap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.shadowmap_fragment,"totalDiffuseLight *= shadowMask;","totalSpecularLight *= shadowMask;","#ifdef METAL","    outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;","#else","    outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;","#endif",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"    gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},base_cust_clip:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap,CloudUniformsLib.cust_clip,CloudUniformsLib.cus_Instanced]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"#define USE_CUSTOMCLIP",CloudShaderChunk.cust_clip_pars_vertex,CloudShaderChunk.cust_Instanced_pars_vertex2,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"    #ifdef USE_ENVMAP",THREE.ShaderChunk.beginnormal_vertex,CloudShaderChunk.cust_Instanced_normal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"    #endif",THREE.ShaderChunk.begin_vertex,CloudShaderChunk.cust_Instanced_vertex2,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,"vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );",CloudShaderChunk.cust_clip_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define USE_CUSTOMCLIP","uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,CloudShaderChunk.cust_clip_pars_fragment,"void main() {",CloudShaderChunk.cust_clip_fragment,"    vec3 outgoingLight = vec3( 0.0 );","    vec4 diffuseColor = vec4( diffuse, opacity );","    vec3 totalAmbientLight = vec3( 1.0 );","    vec3 shadowMask = vec3( 1.0 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.aomap_fragment,THREE.ShaderChunk.shadowmap_fragment,"    outgoingLight = diffuseColor.rgb * totalAmbientLight * shadowMask;",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"    gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")}},CloudShaderLib=CloudShaderLibs["r"+THREE.REVISION],void 0===CloudShaderLib&&console.log("custom clip not implemented for three.js r"+THREE.REVISION+" yet!"),CLOUD.MaterialUtil={createInstancePhongMaterial:function(e){var t=e.clone();return t.type="phong_instanced",t.uniforms=CloudShaderLib.phong_cust_clip.uniforms,t.vertexShader="#define USE_CUST_INSTANCED \n"+CloudShaderLib.phong_cust_clip.vertexShader,t.fragmentShader="#define USE_CUST_INSTANCED \n"+CloudShaderLib.phong_cust_clip.fragmentShader,t},updateBasicMaterial:function(e,t){t?(e.vertexShader="#define USE_CUST_INSTANCED \n"+CloudShaderLib.base_cust_clip.vertexShader,e.fragmentShader="#define USE_CUST_INSTANCED \n"+CloudShaderLib.base_cust_clip.fragmentShader):(e.vertexShader=CloudShaderLib.base_cust_clip.vertexShader,e.fragmentShader=CloudShaderLib.base_cust_clip.fragmentShader),e.needsUpdate=!0},setMatrixUniform:function(e){CloudShaderLib.base_cust_clip.uniforms.transformMatrix.value=e},createPhongMaterial:function(e){var t=new THREE.MeshPhongMaterial(e);return t.type="phong_cust_clip",t.uniforms=CloudShaderLib.phong_cust_clip.uniforms,t.vertexShader=CloudShaderLib.phong_cust_clip.vertexShader,t.fragmentShader=CloudShaderLib.phong_cust_clip.fragmentShader,t},createHilightMaterial:function(){return this.createPhongMaterial({color:136,opacity:.8,side:THREE.DoubleSide,transparent:!1})}},CLOUD.CameraInfo=function(e,t,r){"use strict";this.position=e,this.target=t,this.up=r},CLOUD.CameraUtil={transformCamera:function(e,t){var r=new THREE.Vector3,i=function(e){return[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]};r.fromArray(i(e.camera_position.split(",")));var n=new THREE.Vector3;n.fromArray(i(e.camera_direction.split(",")));var o=new THREE.Vector3;o.fromArray(i(e.camera_up.split(",")));var a=new THREE.Vector3;a.addVectors(r,n),r.applyMatrix4(t.rootNode.matrix),a.applyMatrix4(t.rootNode.matrix);var s=new THREE.Matrix4;return s.makeRotationFromEuler(t.rootNode.rotation),o.applyMatrix4(s),o.normalize(),new CLOUD.CameraInfo(r,a,o)},parseCameraInfo:function(e){var t=JSON.parse(e),r=new THREE.Vector3;r.x=t.position.x,r.y=t.position.y,r.z=t.position.z;var i=new THREE.Vector3;i.x=t.target.x,i.y=t.target.y,i.z=t.target.z;var n=new THREE.Vector3;return n.x=t.up.x,n.y=t.up.y,n.z=t.up.z,new CLOUD.CameraInfo(r,i,n)},intersectBoxByRay:function(e,t){var r,i,n,o,a,s,h=1/e.direction.x,c=1/e.direction.y,l=1/e.direction.z,u=e.origin;return h>=0?(r=(t.min.x-u.x)*h,i=(t.max.x-u.x)*h):(r=(t.max.x-u.x)*h,i=(t.min.x-u.x)*h),c>=0?(n=(t.min.y-u.y)*c,o=(t.max.y-u.y)*c):(n=(t.max.y-u.y)*c,o=(t.min.y-u.y)*c),r>o||n>i?null:((n>r||r!==r)&&(r=n),(i>o||i!==i)&&(i=o),l>=0?(a=(t.min.z-u.z)*l,s=(t.max.z-u.z)*l):(a=(t.max.z-u.z)*l,s=(t.min.z-u.z)*l),r>s||a>i?null:((a>r||r!==r)&&(r=a),(i>s||i!==i)&&(i=s),0>i?null:r>=0?r:i))}},CLOUD.Camera=function(e,t,r,i,n,o,a){THREE.CombinedCamera.call(this,e,t,r,i,n,o,a),this.positionPlane=new THREE.Plane,this.projScreenMatrix=new THREE.Matrix4,this.viewProjInverse=new THREE.Matrix4},CLOUD.Camera.prototype=Object.create(THREE.CombinedCamera.prototype),CLOUD.Camera.prototype.constructor=CLOUD.Camera,CLOUD.Camera.prototype.updateMVP=function(){null===this.parent&&this.updateMatrixWorld(),this.matrixWorldInverse.getInverse(this.matrixWorld),this.updatePositionPlane(),this.projScreenMatrix.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse),this.viewProjInverse.getInverse(this.projScreenMatrix)},CLOUD.Camera.prototype.LookAt=function(e,t,r,i){var n=new THREE.Vector3;n.copy(t),void 0!==i&&n.setLength(i),this.position.subVectors(e,n),this.up=r,this.lookAt(e),this.realUp=r.clone(),this.target=e.clone()},CLOUD.Camera.prototype.updatePositionPlane=function(){this.positionPlane.setFromNormalAndCoplanarPoint(this.getWorldDirection(),this.position)},CLOUD.Camera.prototype.setStandardView=function(e,t){var r=t.center(),i=CLOUD.GlobalData.SceneSize/2;switch(e){case CLOUD.EnumStandardView.ISO:var n=new THREE.Vector3(-CLOUD.GlobalData.SceneSize,CLOUD.GlobalData.SceneSize,CLOUD.GlobalData.SceneSize),o=new THREE.Vector3;o.subVectors(r,n),this.LookAt(r,o,THREE.Object3D.DefaultUp);break;case CLOUD.EnumStandardView.Top:this.LookAt(r,new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1),i);break;case CLOUD.EnumStandardView.Bottom:this.LookAt(r,new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),i);break;case CLOUD.EnumStandardView.Front:this.LookAt(r,new THREE.Vector3(0,0,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.Back:this.LookAt(r,new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.Right:this.LookAt(r,new THREE.Vector3(-1,0,0),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.Left:this.LookAt(r,new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),i);
break;case CLOUD.EnumStandardView.SouthEast:this.LookAt(r,new THREE.Vector3(-1,0,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.SouthWest:this.LookAt(r,new THREE.Vector3(1,0,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.NorthWest:this.LookAt(r,new THREE.Vector3(1,0,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.NorthEast:this.LookAt(r,new THREE.Vector3(-1,0,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomFront:this.LookAt(r,new THREE.Vector3(0,1,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomBack:this.LookAt(r,new THREE.Vector3(0,1,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomRight:this.LookAt(r,new THREE.Vector3(-1,1,0),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomLeft:this.LookAt(r,new THREE.Vector3(1,1,0),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomSouthEast:this.LookAt(r,new THREE.Vector3(-1,1,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomSouthWest:this.LookAt(r,new THREE.Vector3(1,1,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomNorthWest:this.LookAt(r,new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.BottomNorthEast:this.LookAt(r,new THREE.Vector3(-1,1,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofFront:this.LookAt(r,new THREE.Vector3(0,-1,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofBack:this.LookAt(r,new THREE.Vector3(0,-1,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofRight:this.LookAt(r,new THREE.Vector3(-1,-1,0),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofLeft:this.LookAt(r,new THREE.Vector3(1,-1,0),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofSouthEast:this.LookAt(r,new THREE.Vector3(-1,-1,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofSouthWest:this.LookAt(r,new THREE.Vector3(1,-1,-1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofNorthWest:this.LookAt(r,new THREE.Vector3(1,-1,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.RoofNorthEast:this.LookAt(r,new THREE.Vector3(-1,-1,1),new THREE.Vector3(0,1,0),i);break;case CLOUD.EnumStandardView.TopTurnRight:this.LookAt(r,new THREE.Vector3(0,-1,0),new THREE.Vector3(-1,0,0),i);break;case CLOUD.EnumStandardView.TopTurnBack:this.LookAt(r,new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,1),i);break;case CLOUD.EnumStandardView.TopTurnLeft:this.LookAt(r,new THREE.Vector3(0,-1,0),new THREE.Vector3(1,0,0),i);break;case CLOUD.EnumStandardView.BottomTurnRight:this.LookAt(r,new THREE.Vector3(0,1,0),new THREE.Vector3(-1,0,0),i);break;case CLOUD.EnumStandardView.BottomTurnBack:this.LookAt(r,new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,-1),i);break;case CLOUD.EnumStandardView.BottomTurnLeft:this.LookAt(r,new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0),i);break;case CLOUD.EnumStandardView.FrontTurnTop:this.LookAt(r,new THREE.Vector3(0,0,-1),new THREE.Vector3(0,-1,0),i);break;case CLOUD.EnumStandardView.FrontTurnLeft:this.LookAt(r,new THREE.Vector3(0,0,-1),new THREE.Vector3(1,0,0),i);break;case CLOUD.EnumStandardView.FrontTurnRight:this.LookAt(r,new THREE.Vector3(0,0,-1),new THREE.Vector3(-1,0,0),i);break;case CLOUD.EnumStandardView.RightTurnTop:this.LookAt(r,new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),i);break;case CLOUD.EnumStandardView.RightTurnFront:this.LookAt(r,new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,-1),i);break;case CLOUD.EnumStandardView.RightTurnBack:this.LookAt(r,new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,1),i);break;case CLOUD.EnumStandardView.BackTurnTop:this.LookAt(r,new THREE.Vector3(0,0,1),new THREE.Vector3(0,-1,0),i);break;case CLOUD.EnumStandardView.BackTurnLeft:this.LookAt(r,new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),i);break;case CLOUD.EnumStandardView.BackTurnRight:this.LookAt(r,new THREE.Vector3(0,0,1),new THREE.Vector3(1,0,0),i);break;case CLOUD.EnumStandardView.LeftTurnTop:this.LookAt(r,new THREE.Vector3(1,0,0),new THREE.Vector3(0,-1,0),i);break;case CLOUD.EnumStandardView.LeftTurnBack:this.LookAt(r,new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),i);break;case CLOUD.EnumStandardView.LeftTurnFront:this.LookAt(r,new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,-1),i)}return this.updateProjectionMatrix(),r},CLOUD.Camera.prototype.zoomToBBox=function(e){var t=this.getWorldDirection(),r=this.up,i=this.aspect,n=THREE.Math.degToRad(.5*this.fov),o=e.size(),a=e.center(),s=.5*o.length(),h=s/Math.sin(n),c=new THREE.Vector3;c.copy(t),c.setLength(h);var l=new THREE.Vector3;l.subVectors(a,c);var u=new THREE.Vector3;u.crossVectors(t,r),u.normalize();var d=new THREE.Plane;d.setFromNormalAndCoplanarPoint(u,l);var m=new THREE.Plane;m.setFromNormalAndCoplanarPoint(r,l);var p=0,E=0,f=0,T=0,v=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];v[0].set(e.min.x,e.min.y,e.min.z),v[1].set(e.min.x,e.min.y,e.max.z),v[2].set(e.min.x,e.max.y,e.min.z),v[3].set(e.min.x,e.max.y,e.max.z),v[4].set(e.max.x,e.min.y,e.min.z),v[5].set(e.max.x,e.min.y,e.max.z),v[6].set(e.max.x,e.max.y,e.min.z),v[7].set(e.max.x,e.max.y,e.max.z);for(var g=0;8>g;g++){var y=new THREE.Vector3;y.subVectors(v[g],l);var R=Math.abs(y.dot(t)),_=Math.abs(m.distanceToPoint(v[g])),x=Math.abs(d.distanceToPoint(v[g]));(!p||!E||_>p*R/E)&&(p=_,E=R),(!f||!T||x>f*R/T)&&(f=x,T=R)}var b=p,H=f/i;p=Math.max(b,H);var C=p/Math.tan(n)+(h-E);return h>C&&(h=C),c.copy(t).normalize().setLength(h),l.subVectors(a,c),this.position.copy(l),this.lookAt(a),this.updateProjectionMatrix(),a},CLOUD.Camera.prototype.computeRay=function(e,t,r){var i=new THREE.Vector2;if(void 0===r)i.x=window.innerWidth,i.y=window.innerHeight;else{var n=r===document?r.body:r;i.x=n.offsetWidth,i.y=n.offsetHeight}var o=new THREE.Vector2;o.x=e/i.x*2-1,o.y=2*-(t/i.y)+1;var a=new THREE.Ray;return this.inPerspectiveMode?(a.origin.copy(this.position),a.direction.set(o.x,o.y,.5).unproject(this).sub(this.position).normalize()):(a.origin.set(o.x,o.y,-1).unproject(this),a.direction.set(0,0,-1).transformDirection(this.matrixWorld)),a},CLOUD.Camera.prototype.screenToWorld=function(e,t,r,i){var n=this.computeRay(e,t,r),o=this.getWorldDirection().normalize(),a=new THREE.Plane(o);return a.setFromNormalAndCoplanarPoint(o,i),n.intersectPlane(a,i)},CLOUD.ClipWidget=function(e,t){THREE.Object3D.call(this),this.uniforms=CloudShaderLib.phong_cust_clip.uniforms,this.uniforms.vClipPlane.value.copy(e),this.clipplane=new THREE.Vector4,this.clipplane.copy(e),this.center=new THREE.Vector3,this.center.copy(t),this.size=.4,this.raycaster=new CLOUD.Raycaster;var r=new THREE.PlaneBufferGeometry(16,16,1,1);r.dynamic=!0;var e=new THREE.Mesh(r,new THREE.MeshPhongMaterial({opacity:.3,transparent:!0,side:THREE.DoubleSide,color:6724044})),i=new THREE.BufferGeometry,n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),o=6,a=new Float32Array(3*o),s=new Float32Array(3*o);a[0]=0,a[1]=0,a[2]=0,a[3]=this.size,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=this.size,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=0,a[16]=0,a[17]=this.size,s[0]=1,s[1]=0,s[2]=0,s[3]=1,s[4]=0,s[5]=0,s[6]=0,s[7]=1,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=1,s[15]=0,s[16]=0,s[17]=1,i.addAttribute("position",new THREE.BufferAttribute(a,3)),i.addAttribute("color",new THREE.BufferAttribute(s,3)),i.computeBoundingSphere();var h=1.57,c=new THREE.Line(i,n,THREE.LineSegments),l=new THREE.Mesh(new THREE.CylinderGeometry(0,.03,.1,6,1,!1),new THREE.MeshBasicMaterial({color:255}));l.rotation.x=h,l.position.z=this.size;var u=new THREE.Mesh(new THREE.TorusGeometry(.06,.01,4,8),new THREE.MeshBasicMaterial({color:16711680}));u.rotation.y=h,u.position.x=.85*this.size;var d=new THREE.Mesh(new THREE.TorusGeometry(.06,.01,4,8),new THREE.MeshBasicMaterial({color:65280}));d.rotation.x=h,d.position.y=.85*this.size;var m=new THREE.Object3D;m.add(c),m.add(u),m.add(d),m.add(l),this.visible=!1,this.add(e),this.coord=m,this.add(m),this.XYZ=[u,d,l],this.axis=null;var p=new THREE.Vector3,E=new THREE.Euler,f=new THREE.Matrix4,T=new THREE.Vector3,v=new THREE.Euler,g=new THREE.Quaternion,y=new THREE.Vector3(1,0,0),R=new THREE.Vector3(0,1,0);this.onUpdateClipPlane=function(e,t,r){CloudShaderLib.base_cust_clip.uniforms.iClipPlane.value=e,void 0!==t&&CloudShaderLib.base_cust_clip.uniforms.vClipPlane.value.copy(t),void 0!==r&&CloudShaderLib.base_cust_clip.uniforms.vClipPlane.value.applyMatrix4(r)},this.enable=function(e,t){this.visible=t,this.uniforms.iClipPlane.value=e?1:0,this.onUpdateClipPlane(this.isEnabled())},this.isEnabled=function(){return 1==this.uniforms.iClipPlane.value},this.horizon=function(e){e?(this.quaternion.setFromAxisAngle(y,-h),this.position.copy(this.center)):(this.quaternion.setFromAxisAngle(y,0),this.position.copy(this.center)),this.recaculateClipplane()},this.update=function(e){m=this.coord,this.updateMatrixWorld(),p.setFromMatrixPosition(this.matrixWorld),E.setFromRotationMatrix(f.extractRotation(this.matrixWorld)),e.updateMatrixWorld(),T.setFromMatrixPosition(e.matrixWorld),v.setFromRotationMatrix(f.extractRotation(e.matrixWorld)),scale=p.distanceTo(T)/6*this.size,m.scale.set(scale,scale,scale)},this.recaculateClipplane=function(){this.updateMatrix();var e=new THREE.Matrix4;e.getInverse(this.matrix),e.transpose(),this.uniforms.vClipPlane.value.copy(this.clipplane),this.uniforms.vClipPlane.value.applyMatrix4(e),this.onUpdateClipPlane(this.isEnabled(),this.clipplane,e)},this.position.copy(this.center),this.recaculateClipplane();var _=0;this.offset=function(e){e!=_&&(dist=e-_,_=e,tmpClipplane=this.uniforms.vClipPlane.value,offsetVector=new THREE.Vector3(tmpClipplane.x*dist,tmpClipplane.y*dist,tmpClipplane.z*dist),this.position.add(offsetVector),tmpClipplane.w-=dist,this.onUpdateClipPlane(this.isEnabled(),tmpClipplane))};var x=0;this.rotX=function(e){e!=x&&(angle=e-x,x=e,g.setFromAxisAngle(y,angle),this.quaternion.multiply(g),this.recaculateClipplane())};var b=0;this.rotY=function(e){e!=b&&(angle=e-b,b=e,g.setFromAxisAngle(R,angle),this.quaternion.multiply(g),this.recaculateClipplane())},this.snap=function(e,t){this.raycaster.setFromCamera(e,t);var r=this.raycaster.intersectObjects(this.XYZ);r.length>0?(c=r[0].object,c.color=c.material.color,c.material.color.set(16777215),this.axis=c):null!=this.axis&&(this.axis.material.color.set(this.axis.color),this.axis=null)},this.backup=function(){var e=new Object;return e.quaternion=this.quaternion.clone(),e.position=this.position.clone(),e},this.restore=function(e,t,r,i){_=t,x=r,b=i,this.quaternion.copy(e.quaternion),this.position.copy(e.position),this.recaculateClipplane()},this.onMouseUp=function(e){return null!=this.axis&&(this.axis.material.color.set(this.axis.color),this.axis=null),!0},this.onMouseDown=function(e){return null!==this.axis,!0},this.onMouseMove=function(e,t){this.snap(e,t)},this.hitTest=function(e){var t=new THREE.Plane,r=this.uniforms.vClipPlane.value;return t.setComponents(r.x,r.y,r.z,r.w),{sign:e.direction.dot(t.normal)<0,distance:e.distanceToPlane(t)}}},CLOUD.ClipWidget.prototype=Object.create(THREE.Object3D.prototype),CLOUD.ClipWidget.prototype.constructor=CLOUD.ClipWidget,CLOUD.Client=function(e,t,r,i){"use strict";this.serverUrl=t,this.databagId=r,this.texturePath=i,this.cache={geometries:{},face_materials:{},materials:{},textures:{},instancedMaterials:{}},this.index=null,this.meshIds={},this.mkpIndex=null,this.symbolIndex=null;var n=new THREE.MeshPhongMaterial;n.side=THREE.DoubleSide,this.defaultMaterial=n,this.geomCacheVer=0,this.modelManager=e,this.taskManager=new CLOUD.TaskManager(e)},CLOUD.Client.prototype={constructor:CLOUD.Client,projectUrl:function(){return this.serverUrl+this.databagId+"/index.json"},sceneUrl:function(e){return this.serverUrl+this.databagId+"/scene/"+e+".gz"},mpkIndexUrl:function(){return this.serverUrl+this.databagId+"/mpk/index.gz"},symbolIndexUrl:function(){return this.serverUrl+this.databagId+"/symbol/index.gz"},mpkUrl:function(e){return this.serverUrl+this.databagId+"/mpk/"+e+".gz"},submeshUrl:function(e){return this.serverUrl+this.databagId+"/midx/"+e+".gz"},materialUrl:function(e){return this.serverUrl+this.databagId+"/material/"+e+".gz"},getTexturePath:function(){return this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(this.materialUrl("material"))},purgeUnusedResource:function(){},findMaterial:function(e,t){var r=this.cache,i=r.materials[e];if(i||(i=r.defaultMaterial,console.log("not found!"+e)),t){var n=r.instancedMaterials[i.name];void 0===n&&(n=CLOUD.MaterialUtil.createInstancePhongMaterial(i)),i=n}return i},findSymbol:function(e){return this.symbolIndex.items[e]},loadSubScene:function(e){var t=this;0==e.children.length?t.taskManager.addSceneTask(e):(t.modelManager.subSceneLoader.update(e),e.visible=!0)},addDelayLoadMesh:function(e,t){this.taskManager.addMpkTask(e,t)},processMpkTasks:function(e){this.taskManager.processMpkTasks(this,e)},processSceneTasks:function(e){this.taskManager.processSceneTasks(this,e)},needGroupBySceneId:function(){var e=this.index.statics.files;return void 0===e?!1:e>1}},CLOUD.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++}),this.name="",this.type="Object3D",this.parent=null,Object.defineProperties(this,{modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}}),this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.renderOrder=0,this.userData={}},CLOUD.Object3D.prototype={constructor:CLOUD.Object3D,applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),getWorldPosition:function(e){var t=e||new THREE.Vector3;return t.setFromMatrixPosition(this.matrixWorld)},raycast:function(){},traverse:function(e){e(this)},traverseVisible:function(e){this.visible!==!1&&e(this)},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrixWorld:function(e){if((this.matrixWorldNeedsUpdate===!0||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0),this.children)for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)}},THREE.EventDispatcher.prototype.apply(CLOUD.Object3D.prototype),CLOUD.Group=function(){"use strict";CLOUD.Object3D.call(this),this.type="Group",this.children=[],this.boundingBox=null},CLOUD.Group.prototype=Object.create(CLOUD.Object3D.prototype),CLOUD.Group.prototype.constructor=CLOUD.Group,CLOUD.Group.prototype.unload=function(){for(var e=this.children,t=0,r=e.length;r>t;t++){var i=e[t];i.unload&&i.unload()}},CLOUD.Group.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray;return function(r,i){var n=this.boundingBox;return e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),null===n||t.isIntersectionBox(n)!==!1}}(),CLOUD.Group.prototype.add=function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("CLOUD.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof CLOUD.Object3D||e instanceof THREE.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("CLOUD.Object3D.add: object not an instance of Object3D.",e),this)},CLOUD.Group.prototype.remove=function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},CLOUD.Group.prototype.traverseVisible=function(e){if(this.visible!==!1){e(this);for(var t=this.children,r=0,i=t.length;i>r;r++)t[r].traverseVisible(e)}},CLOUD.Group.prototype.traverse=function(e){e(this);for(var t=this.children,r=0,i=t.length;i>r;r++)t[r].traverse(e)},CLOUD.Scene=function(){CLOUD.Group.call(this),this.type="Scene",this.filter=new CLOUD.Filter,this.raycaster=new CLOUD.Raycaster,this.raycaster.setFilter(this.filter),this.rootNode=new CLOUD.Group,this.rootNode.sceneRoot=!0,this.add(this.rootNode),this.clipWidget=null,this.selectedIds=[];.5*CLOUD.GlobalData.SceneSize;this.innerBoundingBox=new THREE.Box3,this.autoUpdate=!1,this.garbageCount=0},CLOUD.Scene.prototype=Object.create(CLOUD.Group.prototype),CLOUD.Scene.prototype.constructor=CLOUD.Scene,CLOUD.Scene.prototype.clearAll=function(){this.rootNode.children=[],this.rootNode.boundingBox=null},CLOUD.Scene.prototype.worldBoundingBox=function(){var e=new THREE.Box3;return function(){return e.copy(this.rootNode.boundingBox),e.applyMatrix4(this.rootNode.matrix),e}}(),CLOUD.Scene.prototype.hitTestClipPlane=function(e,t){function r(e,t,r){return e.distance>=n.distance}function i(e,t,r){return e.distance<=n.distance}if(this.clipWidget&&this.clipWidget.isEnabled()){var n=this.clipWidget.hitTest(e);return null==n.distance?t:t.filter(n.sign?r:i)}return t},CLOUD.Scene.prototype.hitTestPosition=function(e,t,r){var i=this.raycaster;i.setFromCamera(e,t);var n=this.hitTestClipPlane(i.ray,i.intersectObjects(this.children,!0));if(n.length<1)if(this.rootNode.boundingBox){var o=this.worldBoundingBox(),a=o.center();r(a)}else r(null);else n.sort(function(e,t){return e.distance-t.distance}),r(n[0].point)},CLOUD.Scene.prototype.pickByReck=function(e,t){function r(t){t.geometry&&e.intersectsObject(t)&&i.filter.addSelectedId(t.name);var n=t.children;if(n)for(var o=0,a=n.length;a>o;o++){var s=n[o];s.visible&&r(s)}}var i=this;i.filter.setSelectedIds();for(var n=this.rootNode.children,o=0,a=n.length;a>o;o++){var s=n[o];s.visible&&r(s)}},CLOUD.Scene.prototype.pick=function(e,t,r){var i=this.raycaster;i.setFromCamera(e,t);var n=this,o=this.hitTestClipPlane(i.ray,i.intersectObjects(n.children,!0)),a=o.length;if(a>0){o.sort(function(e,t){return e.distance-t.distance});for(var s=0;a>s;++s){var h=o[s];if(!(h.distance<=t.near)){var c=h.object;if(n.filter.isVisible(c)&&c.geometry)return h.userId=c.name,void r(h)}}}r(null)},CLOUD.Scene.prototype.getClipWidget=function(){if(null==this.clipWidget){var e=new THREE.Box3;e.copy(this.rootNode.boundingBox),e.applyMatrix4(this.rootNode.matrix),this.clipWidget=new CLOUD.ClipWidget(new THREE.Vector4(0,0,1,0),e.center()),this.add(this.clipWidget)}return this.clipWidget},CLOUD.Scene.prototype.traverseIf=function(e){function t(e,r){for(var i=e.children,n=0,o=i.length;o>n;n++){var a=i[n];if(!r(a,e))break;a.visible&&t(a,r)}}for(var r=this.rootNode.children,i=0,n=r.length;n>i;i++){var o=r[i];t(o,e)}},CLOUD.Scene.prototype.findSceneNode=function(e){for(var t=this.rootNode.children,r=0,i=t.length;i>r;r++){var n=t[r];if(e==n.sceneId)return n}return null},CLOUD.Scene.prototype.showSceneNodes=function(e,t){for(var r=this.rootNode.children,i=0,n=r.length;n>i;i++){var o=r[i];o.client.databagId===e.databagId&&(o.visible=t)}},CLOUD.Scene.prototype.containsBoxInFrustum=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i){for(var n=r.planes,o=0;6>o;o++){var a=n[o];e.x=a.normal.x>0?i.min.x:i.max.x,t.x=a.normal.x>0?i.max.x:i.min.x,e.y=a.normal.y>0?i.min.y:i.max.y,t.y=a.normal.y>0?i.max.y:i.min.y,e.z=a.normal.z>0?i.min.z:i.max.z,t.z=a.normal.z>0?i.max.z:i.min.z;var s=a.distanceToPoint(e),h=a.distanceToPoint(t);if(0>s||0>h)return!1}return!0}}(),CLOUD.Scene.prototype.prepareSceneBox=function(){var e=new THREE.Frustum;return function(t){function r(t){return e.intersectsBox(t.worldBoundingBox)?(i.containsBoxInFrustum(e,t.worldBoundingBox)?t.inFrustum=!0:t.inFrustum&&delete t.inFrustum,!0):!1}t.updateMVP(),e.setFromMatrix(t.projScreenMatrix);var i=this,n=[];console.time("cull"),this.traverseIf(function(e,t){if(e instanceof CLOUD.BBoxNode){e.visible;return e.visible=!0,t.inFrustum||r(e)?n.push(e):e.visible=!1,!0}return!0}),console.timeEnd("cull"),console.time("raytrace");for(var o={},a=new THREE.Ray,s=new THREE.Vector3,h=0,c=n.length;c>h;++h){var l=n[h];l.worldBoundingBox.center(a.origin),a.direction.copy(t.position).sub(a.origin).normalize(),o[h]=0;for(var u=0;c>u;++u)if(h!=u){var d=n[u];if(d.worldBoundingBox.center(s),s.sub(a.origin).normalize(),s.dot(a.direction)>0){var m=CLOUD.CameraUtil.intersectBoxByRay(a,d.worldBoundingBox);null!==m&&++o[h]}}}var p=0;for(var E in o){var f=o[E];f<CLOUD.GlobalData.RayTracingDeep?n[E].visible=!0:(n[E].visible=!1,++p)}console.log("rt "+n.length+"/"+p),console.timeEnd("raytrace")}}(),CLOUD.Scene.prototype.prepareScene2=function(){var e=new THREE.Frustum,t=new THREE.Ray;return function(r){function i(t){return e.intersectsBox(t.worldBoundingBox)?(o.containsBoxInFrustum(e,t.worldBoundingBox)?t.inFrustum=!0:t.inFrustum&&delete t.inFrustum,!0):!1}function n(e,t){if(e instanceof CLOUD.Cell&&(t.inFrustum||i(e)?e.leaf&&a.push(e):e.visible&&(e.visible=!1)),void 0===e.leaf)for(var r=e.children,o=0,s=r.length;s>o;o++){var h=r[o];n(h,e)}}console.time("rt"),r.updateMVP(),e.setFromMatrix(r.projScreenMatrix),r.inside=this.innerBoundingBox.containsPoint(r.position);var o=this;o.garbageCount=0;for(var a=[],s=o.rootNode.children,h=0,c=s.length;c>h;h++){var l=s[h];n(l,o.rootNode)}for(var u={},d=0,m=a.length;m>d;++d){var p=a[d];p.worldBoundingBox.center(t.origin),t.direction.copy(r.position).sub(t.origin).normalize();for(var E=t.origin.distanceTo(r.position),f=0,T=0;m>T;++T)if(d!=T){var v=a[T],g=CLOUD.CameraUtil.intersectBoxByRay(t,v.worldBoundingBox);null!==g&&E>g&&++f}u[d]=f}var y=0;for(var R in u){var p=a[R];p.visible;if(u[R]<CLOUD.GlobalData.RayTracingDeep)if(2===p.leaf){p.visible=!0;for(var s=p.children,h=0,c=s.length;c>h;h++){var l=s[h];l.update2(r)}}else p.update2(r);else p.visible=!1;p.visible||++y}console.timeEnd("rt"),console.log("rt "+a.length+"/"+y)}}(),CLOUD.Scene.prototype.prepareScene=function(){var e=new THREE.Frustum;return function(t){t.updateMVP(),e.setFromMatrix(t.projScreenMatrix),t.inside=this.innerBoundingBox.containsPoint(t.position);var r=this;r.garbageCount=0,this.traverseIf(function(i,n){if(i instanceof CLOUD.Cell){var o=i.visible;return n.inFrustum?i.update(t):e.intersectsBox(i.worldBoundingBox)?(r.containsBoxInFrustum(e,i.worldBoundingBox)?i.inFrustum=!0:i.inFrustum=!1,i.update(t)):i.visible=!1,o&&!i.visible?(i.isGarbage=!0,++r.garbageCount):i.isGarbage=!1,!0}return!1})}}(),CLOUD.Scene.prototype.collectionGarbage=function(){this.garbageCount<10||(this.traverseIf(function(e,t){return void 0!==e.isGarbage?(e.isGarbage&&(e.unload(),e.isGarbage=!1),!0):!1}),this.garbageCount=0)},CLOUD.Scene.prototype.clearAllSelectedIds=function(){this.selectedIds=[]},CLOUD.Scene.prototype.putSelectedIdsIntoFilter=function(){this.filter.setSelectedIds(this.selectedIds),this.filter.resetSelectionBox()},CLOUD.Scene.prototype.existSelectedId=function(e){for(var t=-1,r=0,i=this.selectedIds.length;i>r;r++)if(e===this.selectedIds[r]){t=r;break}return t},CLOUD.Scene.prototype.removeSelectedId=function(e){var t=this.existSelectedId(e);-1!=t&&this.selectedIds.splice(t,1)},CLOUD.Scene.prototype.addSelectedId=function(e){var t=this.existSelectedId(e);-1===t&&this.selectedIds.push(e)},CLOUD.Scene.prototype.getHitPoint=function(e,t,r){var i=this.raycaster;i.setFromCamera(new THREE.Vector2(e,t),r);var n=this.hitTestClipPlane(i.ray,i.intersectObjects(this.children,!0));if(n.length<1)return null;n.sort(function(e,t){return e.distance-t.distance});for(var o=0,a=n.length;a>o;++o){var s=n[o];if(!(s.distance<=r.near)){var h=s.object;if(this.filter.isVisible(h))return s.point}}return null},CLOUD.Scene.prototype.getTrackingPointFromBoundingBox=function(e,t){if(!this.rootNode.boundingBox)return null;var r=t.origin,i=this.worldBoundingBox(),n=0,o=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];o[0].set(i.min.x,i.min.y,i.min.z),o[1].set(i.min.x,i.min.y,i.max.z),o[2].set(i.min.x,i.max.y,i.min.z),o[3].set(i.min.x,i.max.y,i.max.z),o[4].set(i.max.x,i.min.y,i.min.z),o[5].set(i.max.x,i.min.y,i.max.z),o[6].set(i.max.x,i.max.y,i.min.z),o[7].set(i.max.x,i.max.y,i.max.z);for(var a=0;8>a;a++){var s=new THREE.Vector3;s.subVectors(o[a],r);var h=s.dot(e);h>n&&(n=h)}var c=e.clone().multiplyScalar(n),l=r.clone().add(c),u=new THREE.Plane;return u.setFromNormalAndCoplanarPoint(e,l),t.intersectPlane(u)},CLOUD.Mesh=function(e,t,r){CLOUD.Object3D.call(this,e,t),this.type="Mesh",this.geometry=e,this.material=t,this.boundingBox=null,this.subMeshData=null,r&&(this.loaded=0,this.meshId=r,this.visible=!1)},CLOUD.Mesh.prototype=Object.create(CLOUD.Object3D.prototype),CLOUD.Mesh.prototype.constructor=CLOUD.Mesh,CLOUD.Mesh.prototype.updateGeometry=function(e){this.geometry=e,this.visible=!0},CLOUD.Mesh.prototype.unload=function(){this.meshId&&void 0!==this.geometry.refCount&&0!=this.loaded&&(this.loaded=0,this.geometry.refCount-=1,this.geometry.refCount<=0&&(this.geometry.refCount=0,void 0===this.geometry.symbol&&this.geometry.dispose()))},CLOUD.Mesh.prototype.load=function(){this.meshId&&void 0!==this.geometry.refCount&&(0==this.loaded&&(this.geometry.refCount+=1),this.loaded=1)},CLOUD.Mesh.prototype.findSubMeshData=function(e){if(null===this.subMeshData)return null;var t=this.subMeshData.meshes;for(var r in t)if(r===e)return t[r];return null},CLOUD.Mesh.prototype.findSubBBox=function(e){var t=this.findSubMeshData(e);return null!==t?t.boundingBox:this.subMeshData.bbox},CLOUD.Mesh.prototype.findSubGeometry=function(e){var t=this.findSubMeshData(e);if(null===t)return this.geometry.name===e?this.geometry:null;if(void 0===t.geometry){for(var r=this.geometry.attributes.position.array,i=t.vertex,n=i[0],o=i[1],a=new Float32Array(3*o),s=0;o>s;s++){var h=3*(n+s);a[3*s]=r[h],a[3*s+1]=r[h+1],a[3*s+2]=r[h+2]}for(var c=t.index,l=c[0],u=l+c[1],d=this.geometry.index.array,m=new Uint16Array(c[1]),h=l,s=0;u>h;h++,s++){var p=d[h]-n;(0>p||p>=o)&&(p=0,console.log("bad index of mesh!")),m[s]=p}var E=new THREE.BufferGeometry;E.addAttribute("position",new THREE.BufferAttribute(a,3)),E.setIndex(new THREE.BufferAttribute(m,1)),t.geometry=E}return t.geometry},CLOUD.Mesh.prototype.raycast=function(){function e(e,t,r,i,n,a,s){var h,c=e.material;if(h=c.side===THREE.BackSide?r.intersectTriangle(a,n,i,!0,s):r.intersectTriangle(i,n,a,c.side!==THREE.DoubleSide,s),null===h)return null;o.copy(s),o.applyMatrix4(e.matrixWorld);var l=t.ray.origin.distanceTo(o);return l<t.near||l>t.far?null:{distance:l,point:o.clone(),object:e}}var t=new THREE.Matrix4,r=new THREE.Ray,i=function(e,t){return e.distance-t.distance},n=new THREE.Vector3,o=new THREE.Vector3;return function(o,a){var s=this.geometry,h=this.boundingBox;if(t.getInverse(this.matrixWorld),r.copy(o.ray).applyMatrix4(t),null===h||r.isIntersectionBox(h)!==!1){var c="";if(null!==this.subMeshData){c=this.subMeshData.userId;var l=[],u=this.subMeshData.meshes;for(var d in u){var m=u[d];h=m.boundingBox,r.isIntersectionBox(h)===!0&&this.hitTestSubMesh({start:m.index[0],count:m.index[1],index:0},o,l,r,m.userId,d)}if(l.sort(i),l.length>0)return void a.push(l[0])}if(s instanceof THREE.Geometry)for(var p,E,f,T=material instanceof THREE.MeshFaceMaterial,v=T===!0?material.materials:null,g=s.vertices,y=s.faces,R=0,_=y.length;_>R;R++){var x=y[R],b=T===!0?v[x.materialIndex]:material;if(void 0!==b){p=g[x.a],E=g[x.b],f=g[x.c];var H=e(this,o,r,p,E,f,n);H&&(H.face=x,H.faceIndex=R,a.push(H))}}else this.hitTestGeometry(o,a,r,c,s.name)}}}(),CLOUD.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new CLOUD.Mesh(this.geometry,this.material)),THREE.Mesh.prototype.clone.call(this,e,t),e},CLOUD.Mesh.prototype.hitTestGeometry=function(e,t,r,i,n){var o=this.geometry;if(o instanceof THREE.InstancedBufferGeometry){var a=this.material;if(void 0===a)return;for(var s=e.precision,h=0;h<o.maxInstancedCount;h++){var i=o.extProperty.userIds[h],c=o.extProperty.bboxs[h],l=o.extProperty.transformMatrixs[h],u=r.intersectBox(c);if(null!==u){u.applyMatrix4(this.matrixWorld);var d=e.ray.origin.distanceTo(u);s>d||d<e.near||d>e.far||t.push({transformMatrix:l,bbox:c,distance:d,point:u,face:null,faceIndex:null,object:this,ray:r})}}}else if(o instanceof THREE.BufferGeometry){var a=this.material;if(void 0===a)return;var m=o.attributes;if(void 0!==o.index){var p=o.index.array,E=m.position.array,f=o.groups;0===f.length&&(f=[{start:0,count:p.length,index:0}]);for(var T=0,v=f.length;v>T;++T)this.hitTestSubMesh(f[T],e,t,r,i,n)}else for(var g,y,R,_=new THREE.Vector3,x=new THREE.Vector3,b=new THREE.Vector3,s=e.precision,E=m.position.array,h=0,H=0,C=E.length;C>h;h+=3,H+=9){g=h,y=h+1,R=h+2,_.fromArray(E,H),x.fromArray(E,H+3),b.fromArray(E,H+6);var u;if(u=a.side===THREE.BackSide?r.intersectTriangle(b,x,_,!0):r.intersectTriangle(_,x,b,a.side!==THREE.DoubleSide),null!==u){u.applyMatrix4(this.matrixWorld);var d=e.ray.origin.distanceTo(u);s>d||d<e.near||d>e.far||t.push({distance:d,point:u,face:new THREE.Face3(g,y,R,THREE.Triangle.normal(_,x,b)),faceIndex:null,object:this,ray:r})}}}},CLOUD.Mesh.prototype.hitTestSubMesh=function(e,t,r,i,n,o){for(var a,s,h,c=this.material,l=new THREE.Vector3,u=new THREE.Vector3,d=new THREE.Vector3,m=t.precision,p=this.geometry,E=p.attributes,f=p.index.array,T=E.position.array,v=e.start,g=e.count,y=v,R=v+g;R>y;y+=3){if(a=f[y],s=f[y+1],h=f[y+2],l.fromArray(T,3*a),u.fromArray(T,3*s),d.fromArray(T,3*h),c.side===THREE.BackSide)var _=i.intersectTriangle(d,u,l,!0);else var _=i.intersectTriangle(l,u,d,c.side!==THREE.DoubleSide);if(null!==_){_.applyMatrix4(this.matrixWorld);var x=t.ray.origin.distanceTo(_);m>x||x<t.near||x>t.far||r.push({distance:x,point:_,face:new THREE.Face3(a,s,h,THREE.Triangle.normal(l,u,d)),faceIndex:y,object:this,ray:i,meshId:o})}}},CLOUD.Cell=function(){"use strict";CLOUD.Group.call(this),this.type="Cell",this.worldBoundingBox=null},CLOUD.Cell.prototype=Object.create(CLOUD.Group.prototype),CLOUD.Cell.prototype.constructor=CLOUD.Cell,CLOUD.Cell.prototype.clone=function(e,t){return void 0===e&&(e=new CLOUD.Cell),CLOUD.Group.prototype.clone.call(this,e,t),e},CLOUD.Cell.prototype.load=function(){if(!this.leaf)for(var e=this.children,t=0,r=e.length;r>t;++t)e[t].load()},CLOUD.Cell.prototype.update2=function(e){this.visible=!0},CLOUD.Cell.prototype.update=function(){var e=new THREE.Vector3;new THREE.Vector3;return function(t){var r=this,i=void 0===r.level;if(!i){r.worldBoundingBox.center(e);var n=t.position.distanceToSquared(e);n=.001*Math.min(2*n,25e4);var o=CLOUD.GlobalData.CellVisibleLOD*CLOUD.GlobalData.SubSceneVisibleDistance;r.out&&!t.inside&&(o=20*o),i=o>n}return this.visible=i,this.visible}}(),CLOUD.SubScene=function(){"use strict";CLOUD.Cell.call(this),this.type="SubScene",this.sceneId="",this.client=null,this.loaded=!1,this.visible=!1},CLOUD.SubScene.prototype=Object.create(CLOUD.Cell.prototype),CLOUD.SubScene.prototype.constructor=CLOUD.SubScene,CLOUD.SubScene.prototype.unload=function(){for(var e=this.children,t=0,r=e.length;r>t;t++){var i=e[t];i.unload&&i.unload()}void 0===this.embedded&&(this.children=[]),this.loaded=!1,this.client.geomCacheVer+=1},CLOUD.SubScene.prototype.clone=function(e,t){return void 0===e&&(e=new CLOUD.SubScene),CLOUD.Cell.prototype.clone.call(this,e,t),e},CLOUD.SubScene.prototype.load=function(){this.loaded?this.visible=!0:(this.visible=!1,this.client.loadSubScene(this))},CLOUD.SubScene.prototype.update2=function(e){this.load()},CLOUD.SubScene.prototype.update=function(){var e=new THREE.Vector3;new THREE.Vector3,new THREE.Box3;return function(t){var r=this,i=0;r.worldBoundingBox.center(e);var i=t.position.distanceToSquared(e);i=.001*Math.min(2*i,25e4);var n=CLOUD.ObjectLevelLoD[r.level];n||(console.warn("invalid lod!"),n=5);var o=n*CLOUD.GlobalData.SubSceneVisibleDistance*CLOUD.GlobalData.SubSceneVisibleLOD;return r.level>CLOUD.EnumObjectLevel.Small&&r.out&&!t.inside&&(o=6*o),needLoad=o>i,r.distance=i,
needLoad?this.load():this.visible=!1,this.visible}}(),CLOUD.Raycaster=function(e,t,r,i){"use strict";this.ray=new THREE.Ray(e,t),this.near=r||0,this.far=i||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}},CLOUD.Raycaster.prototype={constructor:CLOUD.Raycaster,precision:1e-4,linePrecision:1,descSort:function(e,t){return e.distance-t.distance},set:function(e,t){this.ray.set(e,t)},setFilter:function(e){this.filter=e},setFromCamera:function(e,t){t instanceof THREE.CombinedCamera?t.inPerspectiveMode?(this.ray.origin.copy(t.position),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(t.position).normalize()):(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):t instanceof THREE.PerspectiveCamera?(this.ray.origin.copy(t.position),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(t.position).normalize()):t instanceof THREE.OrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("CLOUD.Raycaster: Unsupported camera type.")},intersectObject:function(e,t){var r=[];return intersectObject(e,this,r,t,this.filter),r},intersectObjects:function(e,t){for(var r=[],i=0,n=e.length;n>i;i++)intersectObject(e[i],this,r,t,this.filter);return r}},CLOUD.CameraEditor=function(e,t,r,i){"use strict";function n(){return 2*Math.PI/60/60*s.autoRotateSpeed}function o(){return Math.pow(.95,s.zoomSpeed)}this.viewer=e,this.object=t,this.domElement=r,this.enabled=!0,this.target=new THREE.Vector3,this.pivot=null,this.movementSpeed=.005*CLOUD.GlobalData.SceneSize,this.defaultMovementSpeed=this.movementSpeed,this.minMovementSpeed=.01,this.noZoom=!1,this.zoomSpeed=.2,this.minDistance=.001,this.maxDistance=t.far-2*CLOUD.GlobalData.SceneSize,this.defaultThroughOutDistance=.1,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.defaultKeyPanSpeed=this.keyPanSpeed,this.minKeyPanSpeed=.01,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enablePassThrough=!0,this.noKeys=!1,this.keys={ALT:18,BACKSPACE:8,LEFT:37,UP:38,RIGHT:39,BOTTOM:40,A:65,D:68,E:69,Q:81,S:83,W:87,PLUS:187,SUB:189,ZERO:48};var a,s=this,h=1e-6,c=new THREE.Vector2,l=new THREE.Vector2,u=new THREE.Vector2,d=new THREE.Vector2,m=new THREE.Vector2,p=new THREE.Vector2,E=new THREE.Vector3,f=new THREE.Vector3,T=new THREE.Vector3,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,R=new THREE.Vector2,_=0,x=0,b=1,H=new THREE.Vector3,C=new THREE.Quaternion,S={NONE:-1,ROTATE:0,DOLLY:1,PAN:2},M=S.NONE;this.IsIdle=function(){return M===S.NONE},this.updateView=function(e){void 0!==e&&(this.viewer.editorManager.isUpdateRenderList=e),i()},this.rotateLeft=function(e){void 0===e&&(e=n()),x-=e},this.rotateUp=function(e){void 0===e&&(e=n()),_-=e},this.panLeft=function(e){var t=this.object.matrix.elements;E.set(t[0],t[1],t[2]),E.multiplyScalar(-e),f.add(E)},this.panUp=function(e){var t=this.object.matrix.elements;E.set(t[4],t[5],t[6]),E.multiplyScalar(e),f.add(E)},this.pan=function(e,t){var r=s.domElement===document?s.domElement.body:s.domElement;if(void 0!==s.object.fov){var i=s.object.position,n=i.clone().sub(s.target),o=n.length();o*=Math.tan(s.object.fov/2*Math.PI/180),s.panLeft(2*e*o/r.clientHeight),s.panUp(2*t*o/r.clientHeight)}else void 0!==s.object.top?(s.panLeft(e*(s.object.right-s.object.left)/r.clientWidth),s.panUp(t*(s.object.top-s.object.bottom)/r.clientHeight)):console.warn("WARNING: CloudPickEditor.js encountered an unknown camera type - pan disabled.")},this.panOnWorld=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(){var i=this.getContainerDimensions(),n=d.x-i.left,o=d.y-i.top;e.x=n/i.width,e.y=o/i.height,n=m.x-i.left,o=m.y-i.top,t.x=n/i.width,t.y=o/i.height,r.subVectors(t,e);var a=-r.x*v.x,s=r.y*v.y,h=this.getWorldRight().multiplyScalar(a),c=this.getWorldUp().multiplyScalar(s);T.addVectors(h,c),f.add(T)}}(),this.dollyIn=function(e){void 0===e&&(e=o()),b/=e},this.dollyOut=function(e){void 0===e&&(e=o()),b*=e},this.dollyByPoint=function(e,t){if(!(Math.abs(b-1)<h)){var r=this.minDistance,i=2-b,n=this.object.position,o=this.getWorldEye(),s=this.getTrackingPoint(e,t),c=new THREE.Vector3;c.subVectors(s,n);var l=c.length(),u=new THREE.Vector3;if(this.enablePassThrough&&b>1&&r>l){var d=c.clone();d.normalize().multiplyScalar(r),u.addVectors(d,n),this.object.position.copy(u),this.target.copy(o.add(u)),d.normalize().multiplyScalar(this.defaultThroughOutDistance),a=s.clone(),a.add(d)}else c.multiplyScalar(-i),u.addVectors(c,s),this.object.position.copy(u),this.target.copy(o.add(u))}},this.dollyByCenter=function(){if(!(Math.abs(b-1)<h)){var e=this.getWorldEye(),t=e.length(),r=t*b,i=r-t,n=e.clone().normalize();n.multiplyScalar(i),this.object.position.add(n),this.target.addVectors(this.object.position,e)}},this.updateCamera=function(e){H.copy(this.object.position),C.copy(this.object.quaternion),this.target.copy(e),s.reset()},this.update=function(){return function(e,t){var r=this.object.position,n=null!==this.pivot?this.pivot:this.target;if(M==S.ROTATE){var o=this.target.clone().sub(r),a=o.length(),s=r.clone().sub(n),c=s.length();s.normalize();var l=null,u=this.object.getWorldDirection();if(Math.abs(x)>Math.abs(_)){var d=u.clone().cross(this.object.up);if(d.lengthSq()>.001){l=(new THREE.Quaternion).setFromAxisAngle(this.object.up,x);var m=s.clone().applyQuaternion(l);m.normalize(),r.copy(n).add(m.multiplyScalar(c)),u.applyQuaternion(l),u.normalize();var p=new THREE.Vector3;p.copy(r).add(u.multiplyScalar(a)),this.target.copy(p),this.object.realUp.copy(d).cross(u)}}else if(Math.abs(_)>.01){var E=!1,d=u.clone().cross(this.object.up);if(d.lengthSq()<.001){var T=function(e){if(Math.abs(u.dot(new THREE.Vector3(0,1,0))-1)<.001){if(_>0)return!0;d=u.clone().cross(e)}if(Math.abs(u.dot(new THREE.Vector3(0,-1,0))-1)<.001){if(0>_)return!0;d=u.clone().cross(e)}return!1};E=T(this.object.realUp)}if(!E){l=(new THREE.Quaternion).setFromAxisAngle(d,_);var m=s.clone().applyQuaternion(l);m.normalize(),r.copy(n).add(m.multiplyScalar(c)),u.applyQuaternion(l),u.normalize();var p=new THREE.Vector3;p.copy(r).add(u.multiplyScalar(a)),this.object.realUp.copy(d).cross(u),this.target.copy(p)}}}Math.abs(b-1)>.001,M===S.PAN&&(this.target.add(f),this.object.position.add(f));var v=new THREE.Vector3;v.copy(this.object.up),this.object.up.copy(this.object.realUp),this.object.lookAt(this.target),this.object.up.copy(v),x=0,_=0,b=1,f.set(0,0,0),e?(void 0!==t&&(this.viewer.editorManager.isUpdateRenderList=t),i(),H.copy(this.object.position),C.copy(this.object.quaternion)):(H.distanceToSquared(this.object.position)>h||8*(1-C.dot(this.object.quaternion))>h)&&(i(),H.copy(this.object.position),C.copy(this.object.quaternion))}}(),this.setState=function(e){M=e},this.reset=function(){M=S.NONE,this.update()},this.beginRotate=function(e,t){s.noRotate!==!0&&(M=S.ROTATE,c.set(e,t),a=null)},this.beginZoom=function(e,t){s.noZoom!==!0&&(M=S.DOLLY,g.set(e,t))},this.beginPan=function(e,t){s.noPan!==!0&&(M=S.PAN,d.set(e,t),v=this.getWorldDimension(e,t),T.set(0,0,0))},this.endOperation=function(){M=S.NONE,this.pivot=null},this.zoom=function(e,t,r){M=S.DOLLY,void 0===t||void 0===r?(e>0?this.dollyIn(1-e):this.dollyOut(1+e),this.dollyByCenter(),this.update()):(e>0?this.dollyIn(1-e):this.dollyOut(1+e),this.dollyByPoint(t,r),this.update()),M=S.NONE},this.fly=function(e,t){this.object.translateX(e.x),this.object.translateY(e.y),this.object.translateZ(e.z),this.object.quaternion.multiply(t),this.object.rotation.setFromQuaternion(this.object.quaternion,this.object.rotation.order),this.target.copy(this.object.position).add(this.object.getWorldDirection()),i()},this.flyOnWorld=function(){var e=this.object.up.clone();this.object.realUp&&this.object.up.copy(this.object.realUp),this.object.lookAt(this.target),this.object.realUp&&this.object.up.copy(e),i()},this.processRotate=function(e){var t=M;M=S.ROTATE;var r=s.domElement===document?s.domElement.body:s.domElement;s.rotateLeft(2*Math.PI*e.x/r.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*e.y/r.clientHeight*s.rotateSpeed),s.update(),M=t},this.process=function(e,t,r){var i=s.domElement===document?s.domElement.body:s.domElement;if(M===S.ROTATE){if(s.noRotate===!0)return;if(l.set(e,t),u.subVectors(l,c),0==u.x&&0==u.y)return;s.rotateLeft(2*Math.PI*u.x/i.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*u.y/i.clientHeight*s.rotateSpeed),c.copy(l)}else if(M===S.DOLLY){if(s.noZoom===!0)return;if(y.set(e,t),R.subVectors(y,g),0==R.x&&0==R.y)return;R.y>0?s.dollyOut():s.dollyIn(),s.dollyByCenter(),g.copy(y)}else if(M===S.PAN){if(s.noPan===!0)return;if(m.set(e,t),p.subVectors(m,d),0==p.x&&0==p.y)return;s.panOnWorld(),d.copy(m)}M!==S.NONE&&s.update(r)},this.processTouch=function(e,t){var r=e.pointers.length;if(r>1){if(s.noRotate!==!0){M=S.ROTATE;var i=s.domElement===document?s.domElement.body:s.domElement,n=.5*Math.PI/180;e.deltaAngle<n&&e.deltaAngle>-n?_+=2*Math.PI*e.relativeDeltaY/i.clientWidth*s.rotateSpeed:x+=e.relativeRotation}s.noZoom!==!0&&(M=S.DOLLY,b/=e.relativeScale)}else if(s.noPan!==!0){M=S.PAN;var o=e.relativeDeltaX,a=e.relativeDeltaY;s.pan(o,a)}M!==S.NONE&&s.update(t)},this.getContainerDimensions=function(){return CLOUD.DomUtil.getContainerOffsetToClient(this.domElement)},this.mapScreenToLocal=function(e,t,r){var i=this.getContainerDimensions();r.set(e-i.left,i.height-(t-i.top))},this.computeFrustum=function(){var e=new THREE.Matrix4,t=new THREE.Matrix4;return function(r,i,n,o,a,s){var h=this.object,c=h.near*Math.tan(THREE.Math.degToRad(.5*h.fov)),l=c*h.aspect,u=(r-s.left)/s.width*2-1,d=(i-s.left)/s.width*2-1,m=2*-((n-s.top)/s.height)+1,p=2*-((o-s.top)/s.height)+1;e.makeFrustum(u*l,d*l,m*c,p*c,h.near,h.far),h.updateMatrixWorld(),h.matrixWorldInverse.getInverse(h.matrixWorld),t.multiplyMatrices(e,h.matrixWorldInverse),a.setFromMatrix(t)}}(),this.mapWindowToViewport=function(e,t,r){var i=this.getContainerDimensions(),n=r||new THREE.Vector2;return n.x=(e-i.left)/i.width*2-1,n.y=2*-((t-i.top)/i.height)+1,n},this.getCameraInfo=function(){var e=new CLOUD.CameraInfo(this.object.position,this.target,this.object.up);return JSON.stringify(e)},this.isKeepZoom=function(e,t,r){void 0===t&&(t=this.minDistance),void 0===r&&(r=this.maxDistance);var i=this.object.position,n=this.target,o=new THREE.Vector3;o.copy(i).sub(n);var a=o.length()*(2-e);return!(t>a||a>r)},this.computeRotation=function(){var e=new THREE.Matrix4;e.lookAt(this.object.position,this.target,this.object.up);var t=new THREE.Quaternion;t.setFromRotationMatrix(e);var r=new THREE.Euler;return r.setFromQuaternion(t,void 0,!1),r},this.getWorldEye=function(){return this.target.clone().sub(this.object.position)},this.getWorldRight=function(){var e=new THREE.Vector3,t=this.object.up,r=this.getWorldEye();return e.crossVectors(r,t),0===e.lengthSq()&&(t.z>t.y?r.y-=1e-4:r.z+=1e-4,e.crossVectors(r,t)),e.normalize()},this.getWorldUp=function(){var e=this.getWorldRight(),t=this.getWorldEye();return e.cross(t).normalize()},this.getWorldDimension=function(e,t){var r=this.object.position,i=this.getWorldEye().normalize(),n=this.getTrackingPoint(e,t),o=n.clone().sub(r),a=Math.abs(i.dot(o)),s=this.getContainerDimensions(),h=s.width/s.height,c=2*a*Math.tan(THREE.Math.degToRad(.5*this.object.fov)),l=c*h;return new THREE.Vector2(l,c)},this.getHitPoint=function(e,t){var r=this.viewer.getScene(),i=this.object,n=r.getHitPoint(e,t,i);return n?n.clone():null},this.pointToWorld=function(e,r){var i=new THREE.Vector3(e,r,0);return i.unproject(t),i},this.getTrackingPoint=function(e,t){var r=this.getContainerDimensions(),i=e-r.left,n=t-r.top,o=i/r.width*2-1,s=(r.height-n)/r.height*2-1,c=this.getHitPoint(o,s);if(!c){var l=this.object.position,u=this.getWorldEye().normalize(),d=this.pointToWorld(o,s),m=new THREE.Ray;if(m.origin.copy(l),m.direction.copy(d.clone().sub(l).normalize()),a){var p=new THREE.Plane;if(p.setFromNormalAndCoplanarPoint(u,a),c=m.intersectPlane(p)){var E=c.distanceTo(l);h>E&&(c=this.getTrackingPointFromBoundingBox(u,m))}else c=this.getTrackingPointFromBoundingBox(u,m)}else c=this.getTrackingPointFromBoundingBox(u,m);c||(console.log("tracking point is default!"),c=d)}return a=c.clone(),c},this.getTrackingPointFromBoundingBox=function(e,t){var r=this.viewer.getScene();return r.getTrackingPointFromBoundingBox(e,t)},this.flyToPointWithParallelEye=function(e){var t=this.getWorldEye(),r=t.length(),i=t.clone();i.y=0,i.normalize(),i.setLength(r);var n=new THREE.Vector3(0,1,0);this.object.up=n,this.object.realUp=n.clone(),this.object.position.copy(e),this.target.addVectors(this.object.position,i),this.update(!0)},this.flyToPoint=function(e){var t=this.object.position,r=this.getWorldEye(),i=r.clone().normalize(),n=e.clone().sub(t),o=Math.abs(i.dot(n)),a=i.clone().multiplyScalar(o);this.object.position.subVectors(e,a),this.target.addVectors(this.object.position,r),this.update(!0)},this.moveBackward=function(e){var t=this.object.position,r=this.target,i=r.clone().sub(t);this.object.translateZ(e),r.addVectors(t,i)},this.moveForward=function(e){var t=this.object.position,r=this.target,i=r.clone().sub(t);this.object.translateZ(-e),r.addVectors(t,i)}},CLOUD.OrbitEditor=function(e,t,r){"use strict";this.scene=t,this.domElement=void 0!==r?r:document,this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,PAN2:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.cameraEditor=e,this.altHotKey=!1,this.isMouseClick=!1,this.oldMouseX=-1,this.oldMouseY=-1,this.timeoutId=null},CLOUD.OrbitEditor.prototype=Object.create(THREE.EventDispatcher.prototype),CLOUD.OrbitEditor.prototype.constructor=CLOUD.OrbitEditor,CLOUD.OrbitEditor.prototype.onExistEditor=function(){},CLOUD.OrbitEditor.prototype.delayHandle=function(){function e(){t.update(!0,!0)}var t=this.cameraEditor;this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(e,200),t.viewer.editorManager.isUpdateRenderList=!1},CLOUD.OrbitEditor.prototype.processMouseDown=function(e){var t=this,r=this.cameraEditor;if(r.enabled===!1)return!1;if(e.preventDefault(),e.button===t.mouseButtons.ORBIT){if(r.noRotate===!0)return;var i=r.mapWindowToViewport(e.clientX,e.clientY);t.scene.hitTestPosition(i,r.object,function(e){r.pivot=e}),r.beginRotate(e.clientX,e.clientY)}else if(e.button===t.mouseButtons.ZOOM){if(r.noZoom===!0)return;r.beginZoom(e.clientX,e.clientY)}else if(e.button===t.mouseButtons.PAN||e.button===t.mouseButtons.PAN2){if(r.noPan===!0)return;r.beginPan(e.clientX,e.clientY)}return r.IsIdle()===!1},CLOUD.OrbitEditor.prototype.onMouseDown=function(e){return this.isMouseClick=!1,this.oldMouseX=e.clientX,this.oldMouseY=e.clientY,this.processMouseDown(e)},CLOUD.OrbitEditor.prototype.onMouseMove=function(e){var t=this.cameraEditor;t.enabled!==!1&&(e.preventDefault(),t.process(e.clientX,e.clientY,!0))},CLOUD.OrbitEditor.prototype.processMouseUp=function(e){this.oldMouseX==e.clientX&&this.oldMouseY==e.clientY&&(this.isMouseClick=!0);var t=this.cameraEditor;return t.enabled===!1?!1:t.IsIdle()===!0?!1:(t.process(e.clientX,e.clientY,!0),t.endOperation(),!0)},CLOUD.OrbitEditor.prototype.onMouseUp=function(e){return this.processMouseUp(e)},CLOUD.OrbitEditor.prototype.onMouseWheel=function(e){var t=this.cameraEditor;if(t.enabled!==!1&&t.noZoom!==!0){e.preventDefault(),e.stopPropagation();var r=e.wheelDelta||e.detail;r=Math.abs(r)>10?r:40*-r,r*=5e-4,this.delayHandle(),t.zoom(r,e.clientX,e.clientY)}},CLOUD.OrbitEditor.prototype.onMouseDoubleClick=function(e){},CLOUD.OrbitEditor.prototype.onKeyDown=function(e){var t=this.cameraEditor;if(t.enabled!==!1&&t.noKeys!==!0&&t.noPan!==!0)switch(this.delayHandle(),e.keyCode){case t.keys.ALT:this.altHotKey=!0;break;case t.keys.ZERO:t.keyPanSpeed=t.defaultKeyPanSpeed,t.movementSpeed=t.defaultMovementSpeed;break;case t.keys.PLUS:t.keyPanSpeed*=1.1,t.movementSpeed*=1.1;break;case t.keys.SUB:t.keyPanSpeed*=.9,t.keyPanSpeed<t.minKeyPanSpeed&&(t.keyPanSpeed=this.minKeyPanSpeed),t.movementSpeed*=.9,t.movementSpeed<t.minMovementSpeed&&(t.movementSpeed=this.minMovementSpeed);break;case t.keys.Q:t.beginPan(),t.pan(0,t.keyPanSpeed),t.update(!0);break;case t.keys.E:t.beginPan(),t.pan(0,-t.keyPanSpeed),t.update(!0);break;case t.keys.LEFT:case t.keys.A:t.beginPan(),t.pan(t.keyPanSpeed,0),t.update(!0);break;case t.keys.RIGHT:case t.keys.D:t.beginPan(),t.pan(-t.keyPanSpeed,0),t.update(!0);break;case t.keys.UP:case t.keys.W:t.moveForward(t.movementSpeed),t.update(!0);break;case t.keys.BOTTOM:case t.keys.S:t.moveBackward(t.movementSpeed),t.update(!0)}},CLOUD.OrbitEditor.prototype.onKeyUp=function(e){var t=this.cameraEditor;if(t.enabled!==!1&&t.noKeys!==!0&&t.noPan!==!0)switch(e.keyCode){case t.keys.ALT:this.altHotKey=!1}},CLOUD.OrbitEditor.prototype.touchstart=function(e){var t=this.cameraEditor;if(t.enabled!==!1){CloudTouch.proxy.touchsHandler(t,e);var r=t.session.prevInput;t.processTouch(r)}},CLOUD.OrbitEditor.prototype.touchmove=function(e){var t=this.cameraEditor;if(t.enabled!==!1){e.preventDefault(),e.stopPropagation(),CloudTouch.proxy.touchsHandler(t,e);var r=t.session.prevInput;t.processTouch(r)}},CLOUD.OrbitEditor.prototype.touchend=function(){var e=this.cameraEditor;if(e.enabled!==!1){CloudTouch.proxy.touchsHandler(e,event);var t=e.session.prevInput;e.processTouch(t),e.endOperation()}},CLOUD.PickEditor=function(e,t,r){"use strict";CLOUD.OrbitEditor.call(this,e,t,r),this.timerId=null,this.lastDblUserId=null,this.lastUserId=null,this.semitransparentIds=[],this.selectedIds=[],this.filter=t.filter,this.debugInfoDiv=null,this.lastDebugInfoDivShow=!1},CLOUD.PickEditor.prototype=Object.create(CLOUD.OrbitEditor.prototype),CLOUD.PickEditor.prototype.constructor=CLOUD.PickEditor,CLOUD.PickEditor.prototype.onMouseUp=function(e){function t(){r.handleMousePick(e)}var r=this;e.preventDefault(),r.oldMouseX==e.clientX&&r.oldMouseY==e.clientY?(this.isMouseClick=!0,r.timerId&&clearTimeout(r.timerId),r.timerId=setTimeout(t,300)):r.cameraEditor.update(!0)},CLOUD.PickEditor.prototype.onMouseDoubleClick=function(e){e.preventDefault(),this.timerId&&clearTimeout(this.timerId),this.handleMousePick(e,!0)},CLOUD.PickEditor.prototype.handleMousePick=function(e,t){"use strict";t||(t=!1);var r=this.cameraEditor;if(r.enabled===!1)return!1;var i=this,n=e.clientX,o=e.clientY;if(e.button===THREE.MOUSE.LEFT){var i=this,a=r.mapWindowToViewport(e.clientX,e.clientY);i.scene.pick(a,r.object,function(e){var a="";if(e&&(a=e.userId||a),t){if(i.lastDblUserId!==a&&""!==a){i.lastDblUserId=a,i.addSemitransparentId(a),i.putSemitransparentIdsIntoFilter();for(var s=0,h=i.selectedIds.length;h>s;s++)if(i.selectedIds[s]===a){i.setSelectedState(a,!1);break}r.updateView(!0)}else if(i.lastDblUserId&&i.lastDblUserId===a){i.removeSemitransparentId(i.lastDblUserId),i.putSemitransparentIdsIntoFilter();for(var s=0,h=i.selectedIds.length;h>s;s++)if(i.selectedIds[s]===a){i.setSelectedState(a,!0);break}r.updateView(!0),i.lastDblUserId=null}}else i.lastUserId!==a&&""!==a?(i.lastUserId=a,i.clearSelectedIds(),i.addSelectedId(a),i.putSelectedIdsIntoFilter(),r.updateView(!0),i.onObjectSelected(e),i.altHotKey?i.showPickedInformation(e,n,o):i.showPickedInformation(null)):!i.lastUserId||i.lastUserId!==a&&""!==a||(i.removeSelectedId(i.lastUserId),i.putSelectedIdsIntoFilter(),r.updateView(!0),i.onObjectSelected(null),i.lastUserId=null,i.showPickedInformation(null))})}},CLOUD.PickEditor.prototype.showPickedInformation=function(e,t,r){function i(){var e=s.debugInfoDiv;e&&(e.style.display="none",s.lastDebugInfoDivShow&&(e.removeEventListener("dblclick",i,!1),s.lastDebugInfoDivShow=!1))}function n(e,t,r){if(e&&"none"!=e.style.display){var i,n,s=t+o,h=r+a;if(void 0!==t&&void 0!==r)if(window.innerWidth)i=s>window.innerWidth?window.pageXOffset+(t-o)+"px":window.pageXOffset+t+"px",n=h>window.innerHeight?window.pageYOffset+(r-a)+"px":window.pageYOffset+r+"px";else{var c=document.documentElement;i=c.scrollLeft+t+"px",n=c.scrollTop+r+"px"}else if(window.innerWidth)i=window.pageXOffset+(window.innerWidth-o)/2+"px",n=window.pageYOffset+(window.innerHeight-a)/2+"px";else{var c=document.documentElement;i=c.scrollLeft+(c.offsetWidth-o)/2+"px",n=c.scrollTop+(c.offsetHeight-a)/2+"px"}e.style.left=i,e.style.top=n}}var o=340,a=320,s=this;if(!e)return void i();this.debugInfoDiv||(this.debugInfoDiv=document.createElement("div"),this.debugInfoDiv.id="debugPickedInfo",this.debugInfoDiv.style.display="block",this.debugInfoDiv.style.position="absolute",this.debugInfoDiv.style.width=o+"px",this.debugInfoDiv.style.height=a+"px",this.debugInfoDiv.style.backgroundColor="#ffffdd",this.debugInfoDiv.style.borderWidth="2px",this.debugInfoDiv.style.borderStyle="solid",this.debugInfoDiv.style.opacity="0.8",document.body.appendChild(this.debugInfoDiv)),this.debugInfoDiv.style.display="",this.lastDebugInfoDivShow||(this.lastDebugInfoDivShow=!0,this.debugInfoDiv.addEventListener("dblclick",i,!1));var h=this.cameraEditor.viewer,c=null;h.defaultMiniMap&&(c=h.defaultMiniMap.getAxisGridInfoByPoint(e.point));var l="";l+="<span>&#9830;&nbsp;&nbsp;Base Information</span><ul style='width:340px;list-style:none'>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;border-bottom: 1px solid #ccc;float:left;width:80px;height:66px;text-align:left;line-height:66px'>ID</li>",l+="<li style='border:1px solid #ccc;float:left;width:200px;height:66px;text-align:left;'>"+e.userId+"</li>",l+="</ul>",c?(l+="<span>&#9830;&nbsp;&nbsp;Position</span><ul style='width:340px;list-style:none'>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px'>X</li>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px;border-right: 1px solid #ccc'>"+c.position.x+"</li>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px'>Y</li>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px;border-right: 1px solid #ccc'>"+c.position.y+"</li>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px;border-bottom: 1px solid #ccc'>Z</li>",l+="<li style='border:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px'>"+c.position.z+"</li>",l+="</ul>",l+="<span>&#9830;&nbsp;&nbsp;Axis Grid Information</span><ul style='width:340px;list-style:none'>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px'>distanceX</li>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px;border-right: 1px solid #ccc'>("+c.abcName+", "+c.offsetX+")</li>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px;border-bottom: 1px solid #ccc'>distanceY</li>",l+="<li style='border:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px'>("+c.numeralName+", "+c.offsetY+")</li>",l+="</ul>"):(l+="<span>&#9830;&nbsp;&nbsp;Other</span><ul style='width:340px;list-style:none'>",l+="<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px;border-bottom: 1px solid #ccc'>message</li>",l+="<li style='border:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px'><span style='color: red'> not exist axis grid!!!</span></li>",l+="</ul>"),this.debugInfoDiv.innerHTML=l+"<br /><br />",n(this.debugInfoDiv,t,r)},CLOUD.PickEditor.prototype.clearSemitransparentIds=function(){this.semitransparentIds=[]},CLOUD.PickEditor.prototype.putSemitransparentIdsIntoFilter=function(){this.filter.setOverriderByUserIds("dblClick",this.semitransparentIds,"scene")},CLOUD.PickEditor.prototype.existSemitransparentId=function(e){for(var t=-1,r=0,i=this.semitransparentIds.length;i>r;r++)if(e===this.semitransparentIds[r]){t=r;break}return t},CLOUD.PickEditor.prototype.removeSemitransparentId=function(e){var t=this.existSemitransparentId(e);-1!=t&&this.semitransparentIds.splice(t,1)},CLOUD.PickEditor.prototype.addSemitransparentId=function(e){var t=this.existSemitransparentId(e);-1===t&&this.semitransparentIds.push(e)},CLOUD.PickEditor.prototype.clearSelectedIds=function(){this.selectedIds=[]},CLOUD.PickEditor.prototype.putSelectedIdsIntoFilter=function(){this.filter.setSelectedIds(this.selectedIds),this.filter.resetSelectionBox()},CLOUD.PickEditor.prototype.existSelectedId=function(e){for(var t=-1,r=0,i=this.selectedIds.length;i>r;r++)if(e===this.selectedIds[r]){t=r;break}return t},CLOUD.PickEditor.prototype.removeSelectedId=function(e){var t=this.existSelectedId(e);-1!=t&&this.selectedIds.splice(t,1)},CLOUD.PickEditor.prototype.addSelectedId=function(e){var t=this.existSelectedId(e);-1===t&&this.selectedIds.push(e)},CLOUD.PickEditor.prototype.setSelectedState=function(e,t){var r=this.existSelectedId(e);-1!==r&&this.filter.setSelectedState(e,t)},CLOUD.RectPickEditor=function(e,t,r){"use strict";CLOUD.OrbitEditor.call(this,e,t,r),this.startPt=new THREE.Vector2,this.endPt=new THREE.Vector2,this.frustum=new THREE.Frustum,this.mouseButtons={ORBIT:THREE.MOUSE.RIGHT,PAN2:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.LEFT}},CLOUD.RectPickEditor.prototype=Object.create(CLOUD.OrbitEditor.prototype),CLOUD.RectPickEditor.prototype.constructor=CLOUD.RectPickEditor,CLOUD.RectPickEditor.prototype.udpateFrustum=function(e){var t=this.startPt.x,r=this.endPt.x,i=this.startPt.y,n=this.endPt.y;if(t>r){var o=t;t=r,r=o}if(i>n){var a=i;i=n,n=a}if(r-t!=0&&n-i!=0){var s=this.cameraEditor,h=s.getContainerDimensions();s.computeFrustum(t,r,i,n,this.frustum,h),e&&this.onUpdateUI({visible:!0,dir:this.startPt.x<this.endPt.x,left:t-h.left,top:i-h.top,width:r-t,height:n-i})}},CLOUD.RectPickEditor.prototype.onMouseDown=function(e){return this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),e.button===THREE.MOUSE.LEFT?(this.startPt.set(e.clientX,e.clientY),!0):this.processMouseDown(e)},CLOUD.RectPickEditor.prototype.onMouseMove=function(e){return e.preventDefault(),e.button===THREE.MOUSE.LEFT?(this.endPt.set(e.clientX,e.clientY),this.udpateFrustum(!0),!0):void this.cameraEditor.process(e.clientX,e.clientY,!0)},CLOUD.RectPickEditor.prototype.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),e.button===THREE.MOUSE.LEFT){this.endPt.set(e.clientX,e.clientY),this.udpateFrustum();var t=this;return this.scene.pickByReck(this.frustum,function(){t.onObjectSelected()}),this.cameraEditor.updateView(!0),this.onUpdateUI({visible:!1}),!0}return this.processMouseUp(e)},CLOUD.ZoomEditor=function(e,t,r){CLOUD.OrbitEditor.call(this,e,t,r),this.mouseButtons={ZOOM:THREE.MOUSE.LEFT,PAN2:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT}},CLOUD.ZoomEditor.prototype=Object.create(CLOUD.OrbitEditor.prototype),CLOUD.ZoomEditor.prototype.constructor=CLOUD.ZoomEditor,CLOUD.PanEditor=function(e,t,r){"use strict";CLOUD.OrbitEditor.call(this,e,t,r)},CLOUD.PanEditor.prototype=Object.create(CLOUD.OrbitEditor.prototype),CLOUD.PanEditor.prototype.constructor=CLOUD.PanEditor,CLOUD.FlyEditorUI=function(e,t){"use strict";this.domElement=void 0!==e?e:document,e&&this.domElement.setAttribute("tabindex",-1),this.enableControlPanel=!1,this.crossContainer=null,this.crossBoxWidth=30,this.crossBoxHeight=30,this.elementIds={imgKeyQ:"imgKeyQ",imgKeyW:"imgKeyW",imgKeyE:"imgKeyE",imgKeyA:"imgKeyA",imgKeyS:"imgKeyS",imgKeyD:"imgKeyD",imgKeyQ2:"imgKeyQ2",imgKeyW2:"imgKeyW2",imgKeyE2:"imgKeyE2",imgKeyA2:"imgKeyA2",imgKeyS2:"imgKeyS2",imgKeyD2:"imgKeyD2",imgTipQ:"imgTipQ",imgTipW:"imgTipW",imgTipE:"imgTipE",imgTipA:"imgTipA",imgTipS:"imgTipS",imgTipD:"imgTipD",tipRemarkQ:"tipRemarkQ",tipRemarkW:"tipRemarkW",tipRemarkE:"tipRemarkE",tipRemarkA:"tipRemarkA",tipRemarkS:"tipRemarkS",tipRemarkD:"tipRemarkD",keyControlPanel:"keyControlPanel",velocitySliderPanel:"velocitySliderPanel",velocitySlider:"velocitySlider",keySelectedCss:"key-selected"},this.sliderMax=100,this.sliderMin=1,this.sliderMiddle=50,this.sliderSection=10,this.sliderStep=this.sliderMax/this.sliderSection,this.onChangeSpeed=t},CLOUD.FlyEditorUI.prototype={initCross:function(){if(!this.crossContainer){var e=this.domElement,t="http://www.w3.org/2000/svg",r=this.crossBoxWidth,i=this.crossBoxHeight,n=CLOUD.DomUtil.getContainerOffsetToClient(e),o=n.width/2-r/2,a=n.height/2-i/2,s=document.createElementNS(t,"svg");s.setAttributeNS(null,"viewBox","0 0 "+r+" "+i),s.setAttributeNS(null,"width",r),s.setAttributeNS(null,"height",i);var h="M "+r/2+", "+i/2;h+=" l "+r/2+", 0",h+=" l -"+r+", 0",h+=" l "+r/2+", 0",h+=" l 0, "+i/2,h+=" l 0, -"+i,h+=" l 0, "+i/2;var c=document.createElementNS(t,"path");c.setAttributeNS(null,"stroke","red"),c.setAttributeNS(null,"stroke-width",1),c.setAttributeNS(null,"d",h),c.setAttributeNS(null,"opacity",.8),s.appendChild(c);var l=document.createElement("div");l.style.position="absolute",l.style.display="block",l.style.outline="0",l.style.left=o+"px",l.style.top=a+"px",l.style.opacity="1.0",l.style.webkitTransition="opacity .2s ease",l.style.mozTransition="opacity .2s ease",l.style.msTransform="opacity .2s ease",l.style.oTransform="opacity .2s ease",l.style.transition="opacity .2s ease",l.appendChild(s),e.appendChild(l),this.crossContainer=l}},resize:function(){var e=this.domElement,t=this.crossBoxWidth,r=this.crossBoxHeight,i=this.crossContainer,n=CLOUD.DomUtil.getContainerOffsetToClient(e),o=n.width/2-t/2,a=n.height/2-r/2;i.style.left=o+"px",i.style.top=a+"px"},onKeyDown:function(e,t){this.enableControlPanel&&(e&t.FORWARD&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyW,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyW2,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipW,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkW,!0)),e&t.BACK&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyS,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyS2,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipS,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkS,!0)),e&t.LEFT&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyA,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyA2,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipA,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkA,!0)),e&t.RIGHT&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyD,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyD2,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipD,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkD,!0)),e&t.UP&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyQ,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyQ2,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipQ,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkQ,!0)),e&t.DOWN&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyE,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyE2,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipE,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkE,!0)))},onKeyUp:function(e,t){this.enableControlPanel&&(e&t.FORWARD&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyW,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyW2,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipW,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkW,!1)),e&t.BACK&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyS,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyS2,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipS,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkS,!1)),e&t.LEFT&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyA,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyA2,!1),
CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipA,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkA,!1)),e&t.RIGHT&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyD,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyD2,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipD,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkD,!1)),e&t.UP&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyQ,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyQ2,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipQ,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkQ,!1)),e&t.DOWN&&(CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyE,!0),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgKeyE2,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.imgTipE,!1),CLOUD.DomUtil.showOrHideElement(this.elementIds.tipRemarkE,!1)))},changeMoveSpeed:function(e,t){return e>0?(t+=this.sliderStep,t>this.sliderMax&&(t=this.sliderMax)):(t-=this.sliderStep,t<this.sliderMin&&(t=this.sliderMin)),this.velocitySlider&&(this.velocitySlider.value=t),t},enableFlyControlPanel:function(e){this.enableControlPanel=e},showControlPanel:function(e){void 0===e&&(e=!1),this.enableControlPanel=e,e&&(this.createKeyControlPanel(this.domElement.parentNode),this.createVelocitySliderPanel(this.domElement.parentNode)),CLOUD.DomUtil.showOrHideElement(this.elementIds.keyControlPanel,e),CLOUD.DomUtil.showOrHideElement(this.elementIds.velocitySliderPanel,e),this.setCrossVisible(e)},setCrossVisible:function(e){this.crossContainer&&(e?this.crossContainer.style.display="":this.crossContainer.style.display="none")},createVelocitySliderPanel:function(e){if(void 0!==e){var t=this;if(void 0===this.velocitySliderPanel){var r='<span class="span-align">Min</span><span  class="span-align"><input type="range" name="slider" id="velocitySlider" /></span><span class="span-align">Max</span>';this.velocitySliderPanel=document.createElement("div"),this.velocitySliderPanel.id="velocitySliderPanel",this.velocitySliderPanel.style.display="none",this.velocitySliderPanel.align="center",this.velocitySliderPanel.innerHTML=r,e.appendChild(this.velocitySliderPanel),this.velocitySlider=document.getElementById(t.elementIds.velocitySlider),this.velocitySlider&&(this.velocitySlider.max=this.sliderMax,this.velocitySlider.min=this.sliderMin,this.velocitySlider.value=this.sliderMiddle,this.onChangeSpeed(this.sliderMiddle),this.velocitySlider.addEventListener("change",function(){t.onChangeSpeed(t.velocitySlider.value)}))}}},createKeyControlPanel:function(e){if(void 0!==e&&void 0===this.keyControlPanel){for(var t=[{id:"key00",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key01",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key02",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"tipRemarkW",tipText:"",tipCss:"tip-bottom"},{id:"key03",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key04",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key10",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"tipRemarkQ",tipText:"",tipCss:"tip-bottom"},{id:"key11",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key12",imgId:"imgTipW",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-tip-forward.png",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key13",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key14",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"tipRemarkE",tipText:"",tipCss:"tip-bottom"},{id:"key20",imgId:"imgTipQ",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-tip-up.png",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"keyQ",imgId:"imgKeyQ",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-key-Q.png",imgId2:"imgKeyQ2",imgUrl2:CLOUD.GlobalData.TextureResRoot+"cloud-press-Q.png",tipId:"",tipText:"",tipCss:""},{id:"keyW",imgId:"imgKeyW",imgUrl:CLOUD.GlobalData.TextureResRoot+'cloud-key-W.png"',imgId2:"imgKeyW2",imgUrl2:CLOUD.GlobalData.TextureResRoot+"cloud-press-W.png",tipId:"",tipText:"",tipCss:""},{id:"keyE",imgId:"imgKeyE",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-key-E.png",imgId2:"imgKeyE2",imgUrl2:CLOUD.GlobalData.TextureResRoot+"cloud-press-E.png",tipId:"",tipText:"",tipCss:""},{id:"key24",imgId:"imgTipE",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-tip-down.png",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key30",imgId:'imgTipA"',imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-tip-left.png",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"keyA",imgId:"imgKeyA",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-key-A.png",imgId2:"imgKeyA2",imgUrl2:CLOUD.GlobalData.TextureResRoot+"cloud-press-A.png",tipId:"",tipText:"",tipCss:""},{id:"keyS",imgId:"imgKeyS",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-key-S.png",imgId2:"imgKeyS2",imgUrl2:CLOUD.GlobalData.TextureResRoot+"cloud-press-S.png",tipId:"",tipText:"",tipCss:""},{id:"keyD",imgId:"imgKeyD",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-key-D.png",imgId2:"imgKeyD2",imgUrl2:CLOUD.GlobalData.TextureResRoot+"cloud-press-D.png",tipId:"",tipText:"",tipCss:""},{id:"key34",imgId:"imgTipD",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-tip-right.png",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key40",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"tipRemarkA",tipText:"",tipCss:"tip-right"},{id:"key41",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key42",imgId:"imgTipS",imgUrl:CLOUD.GlobalData.TextureResRoot+"cloud-tip-back.png",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key43",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key44",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"tipRemarkD",tipText:"",tipCss:"tip-left"},{id:"key50",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key51",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key52",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"tipRemarkS",tipText:"",tipCss:"tip-top"},{id:"key53",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""},{id:"key54",imgId:"",imgUrl:"",imgId2:"",imgUrl2:"",tipId:"",tipText:"",tipCss:""}],r='<ul class="guide-list">',i=0;i<t.length;i++){var n=t[i];r+='<li id="'+n.id+'">',r+='<div class="key-panel">',""!==n.tipId&&(r+='<p id="'+n.tipId+'" class="'+n.tipCss+'" style="display: none">'+n.tipText+"</p>"),""!==n.imgId&&(""!==n.imgId2?(r+='<img id="'+n.imgId+'" class="icon-medium" src="'+n.imgUrl+'" />',r+='<img id="'+n.imgId2+'" class="icon-medium" src="'+n.imgUrl2+'" style="display: none" />'):r+='<img id="'+n.imgId+'" class="icon-medium" src="'+n.imgUrl+'" style="display: none" />'),r+="</div>",r+="</li>"}r+="</ul>",this.keyControlPanel=document.createElement("div"),this.keyControlPanel.id="keyControlPanel",this.keyControlPanel.style.display="none",this.keyControlPanel.innerHTML=r,e.appendChild(this.keyControlPanel)}}},CLOUD.FlyEditor=function(e,t,r){"use strict";this.cameraEditor=e,this.scene=t,this.domElement=void 0!==r?r:document,this.movementSpeed=.005*CLOUD.GlobalData.SceneSize,this.defaultMovementSpeed=this.movementSpeed,this.minMovementSpeed=.001,this.movementSpeedMultiplier=1,this.lookSpeed=.001,this.constrainPitch=!0,this.pitchMin=THREE.Math.degToRad(5)-.5*Math.PI,this.pitchMax=.5*Math.PI-this.pitchMin,this.pitchDeltaTotal=0,this.MoveDirection={NONE:0,UP:1,DOWN:2,LEFT:4,RIGHT:8,FORWARD:16,BACK:32},this.moveState=this.MoveDirection.NONE,this.isFirstPerson=!0,this.deltaYaw=0,this.deltaPitch=0,this.deltaWheel=0,this.rotateStart=new THREE.Vector2,this.rotateEnd=new THREE.Vector2,this.rotateDelta=new THREE.Vector2,this.timeoutId=null,this.isLockCameraHeight=!0,this.lockCameraHeight=0;this.ui=new CLOUD.FlyEditorUI(this.domElement,function(e){}),this.ui.initCross()},CLOUD.FlyEditor.prototype={constructor:CLOUD.FlyEditor,handleEvent:function(e){"function"==typeof this[e.type]&&this[e.type](e)},delayHandle:function(){function e(){t.cameraEditor.viewer.editorManager.isUpdateRenderList=!0,t.cameraEditor.flyOnWorld()}var t=this;this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(e,200),this.cameraEditor.viewer.editorManager.isUpdateRenderList=!1},activate:function(){},deactivate:function(){},onExistEditor:function(){this.deactivate(),this.ui.showControlPanel(!1)},onKeyDown:function(e){if(!e.altKey){var t=this.MoveDirection.NONE;switch(e.keyCode){case 48:this.movementSpeed=this.defaultMovementSpeed;break;case 187:this.movementSpeed*=1.1;break;case 189:this.movementSpeed*=.9,this.movementSpeed<this.minMovementSpeed&&(this.movementSpeed=this.minMovementSpeed);break;case 38:case 87:t=this.MoveDirection.FORWARD;break;case 40:case 83:t=this.MoveDirection.BACK;break;case 37:case 65:t=this.MoveDirection.LEFT;break;case 39:case 68:t=this.MoveDirection.RIGHT;break;case 81:t=this.MoveDirection.UP;break;case 69:t=this.MoveDirection.DOWN;break;default:needUpdateUI=!0}t!==this.MoveDirection.NONE&&(this.moveState|=t,this.ui.onKeyDown(t,this.MoveDirection)),this.delayHandle(),this.update()}},onKeyUp:function(e){var t=this.MoveDirection.NONE;switch(e.keyCode){case 38:case 87:t=this.MoveDirection.FORWARD;break;case 40:case 83:t=this.MoveDirection.BACK;break;case 37:case 65:t=this.MoveDirection.LEFT;break;case 39:case 68:t=this.MoveDirection.RIGHT;break;case 81:t=this.MoveDirection.UP;break;case 69:t=this.MoveDirection.DOWN}t!==this.MoveDirection.NONE&&(this.ui.onKeyUp(t,this.MoveDirection),this.moveState&=~t)},onMouseDown:function(e){return this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),e.button===THREE.MOUSE.LEFT?this.rotateStart.set(e.clientX,e.clientY):e.button===THREE.MOUSE.RIGHT&&(this.cameraEditor.beginPan(e.clientX,e.clientY),this.isLockCameraHeight&&(this.lockCameraHeight=e.clientY)),!0},onMouseMove:function(e){e.button===THREE.MOUSE.LEFT?(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd),0==this.rotateDelta.x&&0==this.rotateDelta.y||(this.deltaYaw+=this.rotateDelta.x*this.lookSpeed,this.deltaPitch+=this.rotateDelta.y*this.lookSpeed,this.update())):e.button===THREE.MOUSE.RIGHT&&(this.isLockCameraHeight?this.cameraEditor.process(e.clientX,this.lockCameraHeight,!0):this.cameraEditor.process(e.clientX,e.clientY,!0))},onMouseUp:function(e){return e.preventDefault(),e.stopPropagation(),e.button===THREE.MOUSE.LEFT?(this.rotateDelta.set(0,0),this.deltaYaw=0,this.deltaPitch=0,this.update()):e.button===THREE.MOUSE.RIGHT&&(this.isLockCameraHeight?this.cameraEditor.process(e.clientX,this.lockCameraHeight,!0):this.cameraEditor.process(e.clientX,e.clientY,!0),this.cameraEditor.endOperation()),!0},onMouseWheel:function(e){var t=this.cameraEditor;if(t.enabled!==!1&&t.noZoom!==!0){var r=e.wheelDelta||e.detail;r=Math.abs(r)>10?r:40*-r,r*=5e-4,this.delayHandle();var i=t.getContainerDimensions(),n=i.left+.5*i.width,o=i.top+.5*i.height;t.zoom(r,n,o)}},update:function(){var e=this.movementSpeed,t=this.cameraEditor.object,r=t.position,i=this.cameraEditor.target,n=i.clone().sub(r);if(this.moveState&this.MoveDirection.FORWARD&&this.goForward(e),this.moveState&this.MoveDirection.BACK&&this.goBack(e),this.moveState&this.MoveDirection.LEFT&&this.goLeft(e),this.moveState&this.MoveDirection.RIGHT&&this.goRight(e),this.moveState&this.MoveDirection.UP&&this.goUp(e),this.moveState&this.MoveDirection.DOWN&&this.goDown(e),this.isFirstPerson){var o=new THREE.Vector3(0,1,0),a=t.realUp||t.up,s=n.clone().cross(a).normalize();if(0!=this.deltaPitch){var h=(new THREE.Quaternion).setFromAxisAngle(s,-this.deltaPitch),c=n.clone();c.applyQuaternion(h);var l=c.angleTo(o);l-=.5*Math.PI,l>=this.pitchMin&&l<=this.pitchMax&&n.applyQuaternion(h),this.deltaPitch=0}if(0!=this.deltaYaw){var u=(new THREE.Quaternion).setFromAxisAngle(o,-this.deltaYaw);n.applyQuaternion(u),this.deltaYaw=0}i.addVectors(r,n)}else this.pitchDeltaTotal+=this.deltaPitch,this.goTurn(this.deltaYaw),this.deltaYaw=0,this.constrainPitch?this.pitchDeltaTotal<this.pitchMax&&this.pitchDeltaTotal>this.pitchMin&&(this.goPitch(-this.deltaPitch),this.deltaPitch=0):(this.goPitch(-this.deltaPitch),this.deltaPitch=0),this.pitchDeltaTotal=THREE.Math.clamp(this.pitchDeltaTotal,this.pitchMin,this.pitchMax);this.cameraEditor.flyOnWorld()},goForward:function(e){if(this.isFirstPerson)this.cameraEditor.object.translateZ(-e);else{var t=this.cameraEditor.object.position,r=this.cameraEditor.target,i=new THREE.Vector3(r.x-t.x,0,r.z-t.z),n=i.length(),o=e/n,a=new THREE.Vector3(i.x*o,0,i.z*o);t.add(a),r.add(a)}},goBack:function(e){if(this.isFirstPerson)this.cameraEditor.object.translateZ(e);else{var t=this.cameraEditor.object.position,r=this.cameraEditor.target,i=new THREE.Vector3(r.x-t.x,0,r.z-t.z),n=i.length(),o=e/n,a=new THREE.Vector3(-i.x*o,0,-i.z*o);t.add(a),r.add(a)}},goLeft:function(e){if(this.isFirstPerson)this.cameraEditor.object.translateX(-e);else{var t=this.cameraEditor.object.position,r=this.cameraEditor.target,i=new THREE.Vector3(r.x-t.x,0,r.z-t.z),n=i.length(),o=e/n,a=new THREE.Vector3(i.z*o,0,-i.x*o);t.add(a),r.add(a)}},goRight:function(e){if(this.isFirstPerson)this.cameraEditor.object.translateX(e);else{var t=this.cameraEditor.object.position,r=this.cameraEditor.target,i=new THREE.Vector3(r.x-t.x,0,r.z-t.z),n=i.length(),o=e/n,a=new THREE.Vector3(-i.z*o,0,i.x*o);t.add(a),r.add(a)}},goUp:function(e){if(this.isFirstPerson)this.cameraEditor.object.translateY(e);else{var t=this.cameraEditor.object.position,r=this.cameraEditor.target;t.y+=e,r.y+=e}},goDown:function(e){if(this.isFirstPerson)this.cameraEditor.object.translateY(-e);else{var t=this.cameraEditor.object.position,r=this.cameraEditor.target;t.y-=e,r.y-=e}},goTurn:function(e){var t=this.cameraEditor.object.position,r=this.cameraEditor.target,i=new THREE.Vector3(r.x-t.x,0,r.z-t.z),n=Math.cos(e),o=Math.sin(e),a=new THREE.Vector3(i.x*n-i.z*o,0,i.x*o+i.z*n);r.x=t.x+a.x,r.z=t.z+a.z},goPitch:function(e){var t=this.cameraEditor.object.position,r=this.cameraEditor.target,i=r.x-t.x,n=r.z-t.z,o=Math.sqrt(i*i+n*n),a=new THREE.Vector3(o,r.y-t.y,0),s=Math.cos(e),h=Math.sin(e),c=new THREE.Vector3(a.x*s-a.y*h,a.x*h+a.y*s,0),l=c.x/o;r.x=t.x+l*i,r.y=t.y+c.y,r.z=t.z+l*n},resize:function(){this.ui.resize()},setCrossVisible:function(e){this.ui.setCrossVisible(e)},enableFlyControlPanel:function(e){this.ui.enableFlyControlPanel(e)},showControlPanel:function(e){this.ui.showControlPanel(e)}},CLOUD.ClipEditor=function(e,t,r){CLOUD.OrbitEditor.call(this,e,t,r);var i=t.getClipWidget();this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,PAN:THREE.MOUSE.MIDDLE,ZOOM:THREE.MOUSE.RIGHT},this.toggle=function(e,t){void 0!==CloudShaderLib&&i.enable(e,t)},this.visible=function(e){void 0!==CloudShaderLib&&(i.visible=e)},this.horizon=function(e){void 0!==CloudShaderLib&&i.horizon(e)},this.set=function(e){void 0!==CloudShaderLib&&i.offset(e)},this.rotX=function(e){void 0!==CloudShaderLib&&i.rotX(e)},this.rotY=function(e){void 0!==CloudShaderLib&&i.rotY(e)},this.update=function(e){void 0!==i&&i.update(e)},this.backup=function(){return void 0===CloudShaderLib?null:i.backup()},this.restore=function(e,t,r,n){return void 0!==CloudShaderLib?i.restore(e,t,r,n):void 0}},CLOUD.ClipEditor.prototype=Object.create(CLOUD.OrbitEditor.prototype),CLOUD.ClipEditor.prototype.constructor=CLOUD.ClipEditor,CLOUD.CameraAnimator=function(){var e=500,t=13,r=!1,i=new CLOUD.Animation;this.setDuration=function(t){e=t},this.setFrameTime=function(e){t=e},this.setStandardView=function(n,o){r=!1;var a=function(e,t){var r=e.camera.zoomToBBox(t);e.cameraEditor.updateCamera(r),e.render()},s=o.camera,h=CLOUD.GlobalData.SceneSize/2,c=.9995,l=s.getWorldDirection().clone();l.normalize();var u=new THREE.Vector3;u.copy(s.realUp||s.up),u.normalize();var d=o.getScene().worldBoundingBox(),m=s.setStandardView(n,d),p=s.getWorldDirection().clone();p.normalize();var E=new THREE.Vector3;E.copy(s.realUp||s.up),E.normalize();var f=l.dot(p),T=u.dot(E);f>c&&T>c?(a(o,d),s.up.copy(THREE.Object3D.DefaultUp)):(r=!0,i.from({animDir:l,animUp:u}).to({animDir:p,animUp:E},e).onUpdate(function(){o.viewHouse&&(o.viewHouse.isAnimationFinish=!1);var e=this.animDir,t=this.animUp;o.camera.LookAt(m,e,t,h),a(o,d)}).onComplete(function(){o.viewHouse&&(o.viewHouse.isAnimationFinish=!0),o.camera.LookAt(m,p,E,h),a(o,d),r=!1,o.camera.up.copy(THREE.Object3D.DefaultUp)}).start(t))},this.isPlaying=function(){return r}},CLOUD.Filter=function(){function e(){if(void 0===h.ids)return!1;for(var e in h.ids)return!0;return!1}function t(e){return!(!h.ids||!h.ids[e])}var r={},i={},n=!1,o={};o.selection=CLOUD.MaterialUtil.createHilightMaterial(),o.scene=CLOUD.MaterialUtil.createPhongMaterial({color:8947848,opacity:.3,transparent:!0,side:THREE.DoubleSide}),o.darkRed=CLOUD.MaterialUtil.createPhongMaterial({color:10496040,opacity:1,transparent:!1,side:THREE.DoubleSide}),o.lightBlue=CLOUD.MaterialUtil.createPhongMaterial({color:1275840,opacity:1,transparent:!1,side:THREE.DoubleSide}),o.black=CLOUD.MaterialUtil.createPhongMaterial({color:0,opacity:.3,transparent:!0,side:THREE.DoubleSide});var a={},s={},h={boundingBox:new THREE.Box3};this.getVisibleFilter=function(){return r},this.getFileFilter=function(){return i},this.getOverriderByUserId=function(){return a},this.getOverriderByUserData=function(){return s},this.getSelectionSet=function(){return h},this.setFilterByUserIds=function(e){if(e){r.ids={};for(var t=0,i=e.length;i>t;++t)r.ids[e[t]]=!0}else delete r.ids},this.addFilterByUserIds=function(e){if(e){r.ids||(r.ids={});for(var t=0,i=e.length;i>t;++t)r.ids[e[t]]=!0}},this.addUserFilter=function(e,t){void 0===r[e]&&(r[e]={}),r[e][t]=!0},this.getUserFilter=function(e){return r[e]},this.removeUserFilter=function(e,t){r[e]&&(void 0===t?delete r[e]:(r[e][t]&&delete r[e][t],0==Object.getOwnPropertyNames(r[e]).length&&delete r[e]))},this.clearUserFilters=function(){r={}},this.addFileFilter=function(e){i[e]=0},this.removeFileFilter=function(e){void 0===e?i={}:void 0!==i[e]&&delete i[e]},this.hasFileFilter=function(e){return void 0!==i[e]},this.enableSceneOverrider=function(e){n=e},this.isSceneOverriderEnabled=function(){return n},this.setOverriderMaterial=function(e,t){var r=o[e];return r?(r.color=t,r):(r=CLOUD.MaterialUtil.createHilightMaterial({color:t}),o[e]=r,r)},this.setOverriderByUserIds=function(e,t,r){if(void 0===e)return void(a={});if(void 0===t)a[e]&&delete a[e];else{var i;r&&(i=o[r]);var n={};n.material=i?i:o.selection,n.ids={};for(var s=0,h=t.length;h>s;++s)n.ids[t[s]]=!0;a[e]=n}},this.setUserOverrider=function(e,t,r){if(void 0===e)return void(s={});if(void 0===t)s[e]&&delete s[e];else{var i;r&&(i=o[r]),s[e]||(s[e]={}),s[e][t]=i||o.selection}},this.removeUserOverrider=function(e,t){return void 0===e?void(s={}):void(s[e]&&(void 0===t?delete s[e]:delete s[e][t]))},this.setSelectionMaterial=function(e){o.selection.color=e},this.setSelectedState=function(e,t){h.ids&&e in h.ids&&(h.ids[e]=t)},this.setSelectedIds=function(e){if(e&&e.length>0){h.ids={};for(var t=0,r=e.length;r>t;++t)h.ids[e[t]]=!0}else delete h.ids},this.addSelectedIds=function(e){if(e){void 0===h.ids&&(h.ids={});for(var t=0,r=e.length;r>t;++t)h.ids[e[t]]=!0}},this.addSelectedId=function(e){void 0===h.ids&&(h.ids={}),h.ids[e]=!0},this.isVisible=function(e){var t=e.name;if(r.ids&&0===r.ids[t])return!1;if(!e.userData)return!0;for(var i in r){var n=e.userData[i];if(n&&void 0!==r[i][n])return!1}return!0},this.computeSelectionBox=function(r){if(!e())return!1;for(var i=0;i<r.length;++i){var n=r[i].object;if(t(n.name)){if(!n.geometry){console.log("empty geometry!");continue}null==n.geometry.boundingBox&&n.geometry.computeBoundingBox();var o=n.geometry.boundingBox;if(o){var a=o.clone();n.matrixWorld&&a.applyMatrix4(n.matrixWorld),h.boundingBox.expandByPoint(a.min),h.boundingBox.expandByPoint(a.max)}}}return!0},this.getOverridedMaterial=function(e){var r=e.name;if(t(r))return o.selection;for(var i in a){var h=a[i];if(h.ids[r])return h.material}if(!e.userData)return null;for(var i in s){var h=s[i],c=h[e.userData[i]];if(c)return c}return n?o.scene:null},this.resetSelectionBox=function(){h.boundingBox.makeEmpty()},this.getSelectionBox=function(){return h.boundingBox},this.isSelectionSetEmpty=function(){return!e()}};var o3dgc=function(){"use strict";function e(){var e,t,r;return t=new ArrayBuffer(4),e=new Uint32Array(t),r=new Uint8Array(t),e[0]=1,1===r[0]?c.O3DGC_LITTLE_ENDIAN:c.O3DGC_BIG_ENDIAN}function t(e,t,r,i){var n,o,a,s,h,l,u;for(n=-1,o=!1,s=t.m_value,h=0,a=h;s>a;++a){if(e.Equal(r[a].m_id)){o=!0;break}if(e.Less(r[a].m_id)){for(t.m_value<c.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&++t.m_value,l=t.m_value-1;l>a;--l)for(r[l].m_id.m_a=r[l-1].m_id.m_a,r[l].m_id.m_b=r[l-1].m_id.m_b,r[l].m_id.m_c=r[l-1].m_id.m_c,u=0;i>u;++u)r[l].m_pred[u]=r[l-1].m_pred[u];r[a].m_id.m_a=e.m_a,r[a].m_id.m_b=e.m_b,r[a].m_id.m_c=e.m_c,n=a,o=!0;break}}return!o&&t.m_value<c.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&(n=t.m_value++,r[n].m_id.m_a=e.m_a,r[n].m_id.m_b=e.m_b,r[n].m_id.m_c=e.m_c),n}function r(e,t){var r,i,n;r=Math.abs(e.m_x),i=Math.abs(e.m_y),n=Math.abs(e.m_z),n>=r&&n>=i?e.m_z>=0?(t.m_z=0,t.m_x=e.m_x,t.m_y=e.m_y):(t.m_z=1,t.m_x=-e.m_x,t.m_y=-e.m_y):i>=r&&i>=n?e.m_y>=0?(t.m_z=2,t.m_x=e.m_z,t.m_y=e.m_x):(t.m_z=3,t.m_x=-e.m_z,t.m_y=-e.m_x):e.m_x>=0?(t.m_z=4,t.m_x=e.m_y,t.m_y=e.m_z):(t.m_z=5,t.m_x=-e.m_y,t.m_y=-e.m_z)}function i(e){return 0>e?-1-2*e:2*e}function n(e){return 1&e?-(e+1>>>1):e>>>1}function o(e,r,i,n,o,a,s,c){var l,u,d,m,p,E;for(E=new h.SC3DMCTriplet(-1,-1,-1),u=0;3>u;++u)if(m=e[3*r+u],i>m&&(E.m_a=-1,E.m_b=-1,E.m_c=m,d=t(E,n,o,a),-1!==d))for(l=m*c,p=0;a>p;++p)o[d].m_pred[p]=s[l+p]}function a(e,r,i,n,o,a,s,c,l,u){var d,m,p,E,f,T,v,g,y,R,_,x,b,H,C,S,M,w;if(d=3*r,w=new h.SC3DMCTriplet(-1,-1,-1),e[d]===i?(T=e[d+1],v=e[d+2]):e[d+1]===i?(T=e[d],v=e[d+2]):(T=e[d],v=e[d+1]),i>T&&i>v)for(x=l.Begin(T),b=l.End(T),H=x;b>H&&(C=u[H],!(0>C));++H){for(m=3*C,g=-1,S=!1,_=0;3>_;++_)y=e[m+_],y===v?S=!0:i>y&&y!==T&&(g=y);if(-1!==g&&S&&(v>T?(w.m_a=T,w.m_b=v):(w.m_a=v,w.m_b=T),w.m_c=-g-1,M=t(w,n,o,a),-1!==M))for(p=T*c,E=v*c,f=g*c,R=0;a>R;++R)o[M].m_pred[R]=s[p+R]+s[E+R]-s[f+R]}}function s(e,t,r,i,n){var o,a,s,c,l,u,d,m,p,E;for(E=new h.Vec3,m=new h.Vec3,p=new h.Vec3,s=3*i,a=0;s>a;++a)n[a]=0;for(c=0;t>c;++c)o=3*c,l=3*e[o],u=3*e[o+1],d=3*e[o+2],m.m_x=r[u]-r[l],m.m_y=r[u+1]-r[l+1],m.m_z=r[u+2]-r[l+2],p.m_x=r[d]-r[l],p.m_y=r[d+1]-r[l+1],p.m_z=r[d+2]-r[l+2],E.m_x=m.m_y*p.m_z-m.m_z*p.m_y,E.m_y=m.m_z*p.m_x-m.m_x*p.m_z,E.m_z=m.m_x*p.m_y-m.m_y*p.m_x,n[l]+=E.m_x,n[l+1]+=E.m_y,n[l+2]+=E.m_z,n[u]+=E.m_x,n[u+1]+=E.m_y,n[u+2]+=E.m_z,n[d]+=E.m_x,n[d+1]+=E.m_y,n[d+2]+=E.m_z}var h,c;return h={},c={},c.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0=7,c.O3DGC_BINARY_STREAM_MAX_SYMBOL0=127,c.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1=6,c.O3DGC_BINARY_STREAM_MAX_SYMBOL1=63,c.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32=5,c.O3DGC_BIG_ENDIAN=0,c.O3DGC_LITTLE_ENDIAN=1,c.O3DGC_MAX_DOUBLE=1.79769e308,c.O3DGC_MIN_LONG=-2147483647,c.O3DGC_MAX_LONG=2147483647,c.O3DGC_MAX_UCHAR8=255,c.O3DGC_MAX_TFAN_SIZE=256,c.O3DGC_MAX_ULONG=4294967295,c.O3DGC_SC3DMC_START_CODE=497,c.O3DGC_DV_START_CODE=498,c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES=256,c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES=256,c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES=32,c.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS=2,c.O3DGC_SC3DMC_BINARIZATION_FL=0,c.O3DGC_SC3DMC_BINARIZATION_BP=1,c.O3DGC_SC3DMC_BINARIZATION_FC=2,c.O3DGC_SC3DMC_BINARIZATION_AC=3,c.O3DGC_SC3DMC_BINARIZATION_AC_EGC=4,c.O3DGC_SC3DMC_BINARIZATION_ASCII=5,c.O3DGC_STREAM_TYPE_UNKOWN=0,c.O3DGC_STREAM_TYPE_ASCII=1,c.O3DGC_STREAM_TYPE_BINARY=2,c.O3DGC_SC3DMC_NO_PREDICTION=0,c.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION=1,c.O3DGC_SC3DMC_XOR_PREDICTION=2,c.O3DGC_SC3DMC_ADAPTIVE_DIFFERENTIAL_PREDICTION=3,c.O3DGC_SC3DMC_CIRCULAR_DIFFERENTIAL_PREDICTION=4,c.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION=5,c.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION=6,c.O3DGC_SC3DMC_ENCODE_MODE_QBCR=0,c.O3DGC_SC3DMC_ENCODE_MODE_SVA=1,c.O3DGC_SC3DMC_ENCODE_MODE_TFAN=2,c.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT=0,c.O3DGC_MIN_NEIGHBORS_SIZE=128,c.O3DGC_MIN_NUM_NEIGHBORS_SIZE=16,c.O3DGC_TFANS_MIN_SIZE_ALLOCATED_VERTICES_BUFFER=128,c.O3DGC_TFANS_MIN_SIZE_TFAN_SIZE_BUFFER=8,c.O3DGC_DEFAULT_VECTOR_SIZE=32,h.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_UNKOWN=0,h.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_POSITION=1,h.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_NORMAL=2,h.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_COLOR=3,h.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_TEXCOORD=4,h.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_WEIGHT=5,h.O3DGC_IFS_INT_ATTRIBUTE_TYPE_UNKOWN=0,h.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX=1,h.O3DGC_IFS_INT_ATTRIBUTE_TYPE_JOINT_ID=2,h.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX_BUFFER_ID=3,h.O3DGC_OK=0,h.O3DGC_ERROR_BUFFER_FULL=1,h.O3DGC_ERROR_CORRUPTED_STREAM=5,h.O3DGC_ERROR_NON_SUPPORTED_FEATURE=6,h.O3DGC_ERROR_AC=7,h.SC3DMCStats=function(){this.m_timeCoord=0,this.m_timeNormal=0,this.m_timeCoordIndex=0,this.m_timeFloatAttribute=new Float32Array(c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_timeIntAttribute=new Float32Array(c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_timeReorder=0,this.m_streamSizeCoord=0,this.m_streamSizeNormal=0,this.m_streamSizeCoordIndex=0,this.m_streamSizeFloatAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_streamSizeIntAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES)},h.SC3DMCTriplet=function(e,t,r){this.m_a=e,this.m_b=t,this.m_c=r},h.SC3DMCTriplet.prototype.Less=function(e){var t;return t=this.m_c!==e.m_c?this.m_c<e.m_c:this.m_b!==e.m_b?this.m_b<e.m_b:this.m_a<e.m_a},h.SC3DMCTriplet.prototype.Equal=function(e){return this.m_c===e.m_c&&this.m_b===e.m_b&&this.m_a===e.m_a},h.SC3DMCPredictor=function(){this.m_id=new h.SC3DMCTriplet(-1,-1,-1),this.m_pred=new Float32Array(c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES)},"undefined"==typeof window.performance&&(window.performance={}),window.performance.now||(c.nowOffset=Date.now(),performance.timing&&performance.timing.navigationStart&&(c.nowOffset=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-c.nowOffset}),h.Timer=function(){this.m_start=0,this.m_end=0},h.Timer.prototype.Tic=function(){this.m_start=window.performance.now()},h.Timer.prototype.Toc=function(){this.m_end=window.performance.now()},h.Timer.prototype.GetElapsedTime=function(){return this.m_end-this.m_start},h.Vec3=function(e,t,r){this.m_x=e,this.m_y=t,this.m_z=r},h.Vec3.prototype.Set=function(e,t,r){this.m_x=e,this.m_y=t,this.m_z=r},h.Vec3.prototype.Sub=function(e,t){this.m_x=e.m_x-t.m_x,this.m_y=e.m_y-t.m_y,this.m_z=e.m_z-t.m_z},h.Vec3.prototype.Add=function(e,t){this.m_x=e.m_x+t.m_x,this.m_y=e.m_y+t.m_y,this.m_z=e.m_z+t.m_z},h.Vec3.prototype.SelfAdd=function(e){this.m_x+=e.m_x,this.m_y+=e.m_y,this.m_z+=e.m_z},h.Vec3.prototype.Cross=function(e,t){this.m_x=e.m_y*t.m_z-e.m_z*t.m_y,this.m_y=e.m_z*t.m_x-e.m_x*t.m_z,this.m_z=e.m_x*t.m_y-e.m_y*t.m_x},h.Vec3.prototype.GetNorm=function(){return Math.sqrt(this.m_x*this.m_x+this.m_y*this.m_y+this.m_z*this.m_z)},c.CubeToSphere={0:function(e,t){t.m_x=e.m_x,t.m_y=e.m_y,t.m_z=Math.sqrt(Math.max(0,1-t.m_x*t.m_x-t.m_y*t.m_y))},1:function(e,t){t.m_x=-e.m_x,t.m_y=-e.m_y,t.m_z=-Math.sqrt(Math.max(0,1-t.m_x*t.m_x-t.m_y*t.m_y))},2:function(e,t){t.m_z=e.m_x,t.m_x=e.m_y,t.m_y=Math.sqrt(Math.max(0,1-t.m_x*t.m_x-t.m_z*t.m_z))},3:function(e,t){t.m_z=-e.m_x,t.m_x=-e.m_y,t.m_y=-Math.sqrt(Math.max(0,1-t.m_x*t.m_x-t.m_z*t.m_z))},4:function(e,t){t.m_y=e.m_x,t.m_z=e.m_y,t.m_x=Math.sqrt(Math.max(0,1-t.m_y*t.m_y-t.m_z*t.m_z))},5:function(e,t){t.m_y=-e.m_x,t.m_z=-e.m_y,t.m_x=-Math.sqrt(Math.max(0,1-t.m_y*t.m_y-t.m_z*t.m_z))}},h.Iterator=function(){this.m_count=0},h.NumberRef=function(){this.m_value=0},h.BinaryStream=function(t){this.m_endianness=e(),this.m_buffer=t,this.m_stream=new Uint8Array(this.m_buffer),this.m_localBuffer=new ArrayBuffer(4),this.m_localBufferViewUChar8=new Uint8Array(this.m_localBuffer),this.m_localBufferViewFloat32=new Float32Array(this.m_localBuffer),this.m_localBufferViewUInt32=new Uint32Array(this.m_localBuffer)},h.BinaryStream.prototype.ReadFloat32Bin=function(e){return this.m_endianness===c.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++]),this.m_localBufferViewFloat32[0]},h.BinaryStream.prototype.ReadUInt32Bin=function(e){return this.m_endianness===c.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++]),this.m_localBufferViewUInt32[0]},h.BinaryStream.prototype.ReadUChar8Bin=function(e){return this.m_stream[e.m_count++]},h.BinaryStream.prototype.ReadUInt32ASCII=function(e){var t,r,i;for(t=0,r=0,i=0;i<c.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32;++i)t+=this.m_stream[e.m_count++]<<r>>>0,r+=c.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0;return t},h.BinaryStream.prototype.ReadFloat32ASCII=function(e){var t=this.ReadUInt32ASCII(e);return this.m_endianness===c.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=t&c.O3DGC_MAX_UCHAR8,t>>>=8,this.m_localBufferViewUChar8[2]=t&c.O3DGC_MAX_UCHAR8,t>>>=8,this.m_localBufferViewUChar8[1]=t&c.O3DGC_MAX_UCHAR8,t>>>=8,this.m_localBufferViewUChar8[0]=t&c.O3DGC_MAX_UCHAR8):(this.m_localBufferViewUChar8[0]=t&c.O3DGC_MAX_UCHAR8,t>>>=8,this.m_localBufferViewUChar8[1]=t&c.O3DGC_MAX_UCHAR8,t>>>=8,this.m_localBufferViewUChar8[2]=t&c.O3DGC_MAX_UCHAR8,t>>>=8,this.m_localBufferViewUChar8[3]=t&c.O3DGC_MAX_UCHAR8),this.m_localBufferViewFloat32[0]},h.BinaryStream.prototype.ReadIntASCII=function(e){return n(this.ReadUIntASCII(e))},h.BinaryStream.prototype.ReadUIntASCII=function(e){var t,r,i;if(i=this.m_stream[e.m_count++],i===c.O3DGC_BINARY_STREAM_MAX_SYMBOL0){t=0;do r=this.m_stream[e.m_count++],i+=r>>>1<<t>>>0,t+=c.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1;while(1&r)}return i},h.BinaryStream.prototype.ReadUCharASCII=function(e){return this.m_stream[e.m_count++]},h.BinaryStream.prototype.ReadFloat32=function(e,t){return t===c.O3DGC_STREAM_TYPE_ASCII?this.ReadFloat32ASCII(e):this.ReadFloat32Bin(e)},h.BinaryStream.prototype.ReadUInt32=function(e,t){return t===c.O3DGC_STREAM_TYPE_ASCII?this.ReadUInt32ASCII(e):this.ReadUInt32Bin(e)},h.BinaryStream.prototype.ReadUChar=function(e,t){return t===c.O3DGC_STREAM_TYPE_ASCII?this.ReadUCharASCII(e):this.ReadUChar8Bin(e)},h.BinaryStream.prototype.GetBuffer=function(e,t){return new Uint8Array(this.m_buffer,e.m_count,t)},c.O3DGC_AC_MIN_LENGTH=16777216,c.O3DGC_AC_MAX_LENGTH=4294967295,c.O3DGC_AC_BM_LENGTH_SHIFT=13,c.O3DGC_AC_BM_MAX_COUNT=1<<c.O3DGC_AC_BM_LENGTH_SHIFT>>>0,c.O3DGC_AC_DM_LENGTH_SHIFT=15,c.O3DGC_AC_DM_MAX_COUNT=1<<c.O3DGC_AC_DM_LENGTH_SHIFT>>>0,h.StaticBitModel=function(){this.m_bit0Prob=1<<c.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0},h.StaticBitModel.prototype.SetProbability=function(e){this.m_bit0Prob=Math.floor(e*(1<<c.O3DGC_AC_BM_LENGTH_SHIFT>>>0))},h.AdaptiveBitModel=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<c.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},h.AdaptiveBitModel.prototype.Reset=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<c.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},h.AdaptiveBitModel.prototype.Update=function(){(this.m_bitCount+=this.m_updateCycle)>c.O3DGC_AC_BM_MAX_COUNT&&(this.m_bitCount=this.m_bitCount+1>>>1,this.m_bit0Count=this.m_bit0Count+1>>>1,
this.m_bit0Count===this.m_bitCount&&++this.m_bitCount);var e=Math.floor(2147483648/this.m_bitCount);this.m_bit0Prob=this.m_bit0Count*e>>>31-c.O3DGC_AC_BM_LENGTH_SHIFT,this.m_updateCycle=5*this.m_updateCycle>>>2,this.m_updateCycle>64&&(this.m_updateCycle=64),this.m_bitsUntilUpdate=this.m_updateCycle},h.AdaptiveDataModel=function(){this.m_buffer={},this.m_distribution={},this.m_symbolCount={},this.m_decoderTable={},this.m_totalCount=0,this.m_updateCycle=0,this.m_symbolsUntilUpdate=0,this.m_dataSymbols=0,this.m_lastSymbol=0,this.m_tableSize=0,this.m_tableShift=0},h.AdaptiveDataModel.prototype.Update=function(){var e,t,r,i,n,o,a;if((this.m_totalCount+=this.m_updateCycle)>c.O3DGC_AC_DM_MAX_COUNT)for(this.m_totalCount=0,e=0;e<this.m_dataSymbols;++e)this.m_totalCount+=this.m_symbolCount[e]=this.m_symbolCount[e]+1>>>1;if(t=0,r=0,i=Math.floor(2147483648/this.m_totalCount),0===this.m_tableSize)for(n=0;n<this.m_dataSymbols;++n)this.m_distribution[n]=i*t>>>31-c.O3DGC_AC_DM_LENGTH_SHIFT,t+=this.m_symbolCount[n];else{for(n=0;n<this.m_dataSymbols;++n)for(this.m_distribution[n]=i*t>>>31-c.O3DGC_AC_DM_LENGTH_SHIFT,t+=this.m_symbolCount[n],a=this.m_distribution[n]>>>this.m_tableShift;a>r;)this.m_decoderTable[++r]=n-1;for(this.m_decoderTable[0]=0;r<=this.m_tableSize;)this.m_decoderTable[++r]=this.m_dataSymbols-1}this.m_updateCycle=5*this.m_updateCycle>>>2,o=this.m_dataSymbols+6<<3>>>0,this.m_updateCycle>o&&(this.m_updateCycle=o),this.m_symbolsUntilUpdate=this.m_updateCycle},h.AdaptiveDataModel.prototype.Reset=function(){var e;if(0!==this.m_dataSymbols){for(this.m_totalCount=0,this.m_updateCycle=this.m_dataSymbols,e=0;e<this.m_dataSymbols;++e)this.m_symbolCount[e]=1;this.Update(),this.m_symbolsUntilUpdate=this.m_updateCycle=this.m_dataSymbols+6>>>1}},h.AdaptiveDataModel.prototype.SetAlphabet=function(e){if(2>e||e>2048)return Console.log("invalid number of data symbols"),h.O3DGC_ERROR_AC;if(this.m_dataSymbols!==e)if(this.m_dataSymbols=e,this.m_lastSymbol=this.m_dataSymbols-1,this.m_dataSymbols>16){for(var t=3;this.m_dataSymbols>1<<t+2>>>0;)++t;this.m_tableSize=1<<t>>>0,this.m_tableShift=c.O3DGC_AC_DM_LENGTH_SHIFT-t,this.m_buffer=new ArrayBuffer(4*(2*this.m_dataSymbols+this.m_tableSize+2)),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable=new Uint32Array(this.m_buffer,8*this.m_dataSymbols,this.m_tableSize+2)}else this.m_tableSize=this.m_tableShift=0,this.m_buffer=new ArrayBuffer(8*this.m_dataSymbols),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable={};return this.Reset(),h.O3DGC_OK},h.ArithmeticDecoder=function(){this.m_codeBuffer={},this.m_acShift=0,this.m_base=0,this.m_value=0,this.m_length=0,this.m_bufferSize=0,this.m_mode=0},h.ArithmeticDecoder.prototype.SetBuffer=function(e,t){return 0===e?(Console.log("invalid codec buffer size"),h.O3DGC_ERROR_AC):0!==this.m_mode?(Console.log("cannot set buffer while encoding or decoding"),h.O3DGC_ERROR_AC):(this.m_bufferSize=e,void(this.m_codeBuffer=t))},h.ArithmeticDecoder.prototype.StartDecoder=function(){return 0!==this.m_mode?(Console.log("cannot start decoder"),h.O3DGC_ERROR_AC):0===this.m_bufferSize?(Console.log("no code buffer set"),h.O3DGC_ERROR_AC):(this.m_mode=2,this.m_length=c.O3DGC_AC_MAX_LENGTH,this.m_acShift=3,void(this.m_value=(this.m_codeBuffer[0]<<24|this.m_codeBuffer[1]<<16|this.m_codeBuffer[2]<<8|this.m_codeBuffer[3])>>>0))},h.ArithmeticDecoder.prototype.StopDecoder=function(){return 2!==this.m_mode?(Console.log("invalid to stop decoder"),h.O3DGC_ERROR_AC):void(this.m_mode=0)},h.ArithmeticDecoder.prototype.GetBit=function(){this.m_length>>>=1;var e=this.m_value>=this.m_length;return e&&(this.m_value-=this.m_length),this.m_length<c.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),e},h.ArithmeticDecoder.prototype.GetBits=function(e){var t=Math.floor(this.m_value/(this.m_length>>>=e));return this.m_value-=this.m_length*t,this.m_length<c.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),t},h.ArithmeticDecoder.prototype.DecodeStaticBitModel=function(e){var t,r;return t=e.m_bit0Prob*(this.m_length>>>c.O3DGC_AC_BM_LENGTH_SHIFT),r=this.m_value>=t,r?(this.m_value-=t,this.m_length-=t):this.m_length=t,this.m_length<c.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),r},h.ArithmeticDecoder.prototype.DecodeAdaptiveBitModel=function(e){var t,r;return t=e.m_bit0Prob*(this.m_length>>>c.O3DGC_AC_BM_LENGTH_SHIFT),r=this.m_value>=t,r?(this.m_value-=t,this.m_length-=t):(this.m_length=t,++e.m_bit0Count),this.m_length<c.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),0===--e.m_bitsUntilUpdate&&e.Update(),r},h.ArithmeticDecoder.prototype.DecodeAdaptiveDataModel=function(e){var t,r,i,n,o,a,s,h;if(n=this.m_length,e.m_tableSize>0){for(a=Math.floor(this.m_value/(this.m_length>>>=c.O3DGC_AC_DM_LENGTH_SHIFT)),o=a>>>e.m_tableShift,r=e.m_decoderTable[o],t=e.m_decoderTable[o+1]+1;t>r+1;)h=r+t>>>1,e.m_distribution[h]>a?t=h:r=h;i=e.m_distribution[r]*this.m_length,r!==e.m_lastSymbol&&(n=e.m_distribution[r+1]*this.m_length)}else{i=r=0,this.m_length>>>=c.O3DGC_AC_DM_LENGTH_SHIFT,h=(t=e.m_dataSymbols)>>>1;do s=this.m_length*e.m_distribution[h],s>this.m_value?(t=h,n=s):(r=h,i=s);while((h=r+t>>>1)!==r)}return this.m_value-=i,this.m_length=n-i,this.m_length<c.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),++e.m_symbolCount[r],0===--e.m_symbolsUntilUpdate&&e.Update(!1),r},h.ArithmeticDecoder.prototype.ExpGolombDecode=function(e,t,r){var i,n,o;i=0,n=0;do o=this.DecodeAdaptiveBitModel(r),o&&(i+=1<<e>>>0,e++);while(o);for(;e--;)this.DecodeStaticBitModel(t)&&(n=(n|1<<e)>>>0);return i+n},h.ArithmeticDecoder.prototype.RenormDecInterval=function(){do this.m_value=(this.m_value<<8|this.m_codeBuffer[++this.m_acShift])>>>0,this.m_length=this.m_length<<8>>>0;while(this.m_length<c.O3DGC_AC_MIN_LENGTH)},h.ArithmeticDecoder.prototype.DecodeIntACEGC=function(e,t,r,i,o){var a=this.DecodeAdaptiveDataModel(e);return a===o&&(a+=this.ExpGolombDecode(i,t,r)),n(a)},h.ArithmeticDecoder.prototype.DecodeUIntACEGC=function(e,t,r,i,n){var o=this.DecodeAdaptiveDataModel(e);return o===n&&(o+=this.ExpGolombDecode(i,t,r)),o},h.FIFO=function(){this.m_data={},this.m_allocated=0,this.m_size=0,this.m_start=0,this.m_end=0},h.FIFO.prototype.Clear=function(){this.m_start=this.m_end=this.m_size=0},h.FIFO.prototype.GetAllocatedSize=function(){return this.m_allocated},h.FIFO.prototype.GetSize=function(){return this.m_size},h.FIFO.prototype.Allocate=function(e){return e>this.m_allocated&&(this.m_allocated=e,this.m_data=new Int32Array(this.m_allocated)),this.Clear(),h.O3DGC_OK},h.FIFO.prototype.PopFirst=function(){--this.m_size;var e=this.m_start++;return this.m_start===this.m_allocated&&(this.m_end=0),this.m_data[e]},h.FIFO.prototype.PushBack=function(e){--this.m_size,this.m_data[this.m_end]=e,++this.m_size,++this.m_end,this.m_end===this.m_allocated&&(this.m_end=0)},h.IndexedFaceSet=function(){this.m_nCoordIndex=0,this.m_nCoord=0,this.m_nNormal=0,this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_creaseAngle=30,this.m_ccw=!0,this.m_solid=!0,this.m_convex=!0,this.m_isTriangularMesh=!0,this.m_coordMin=new Float32Array(3),this.m_coordMax=new Float32Array(3),this.m_normalMin=new Float32Array(3),this.m_normalMax=new Float32Array(3),this.m_nFloatAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_nIntAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_dimFloatAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_dimIntAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_typeFloatAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_typeIntAttribute=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_minFloatAttributeBuffer=new ArrayBuffer(4*c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minFloatAttribute=new Float32Array(this.m_minFloatAttributeBuffer),this.m_maxFloatAttributeBuffer=new ArrayBuffer(4*c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_maxFloatAttribute=new Float32Array(this.m_maxFloatAttributeBuffer),this.m_coordIndex={},this.m_coord={},this.m_normal={},this.m_floatAttribute=[],this.m_intAttribute=[]},h.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},h.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},h.IndexedFaceSet.prototype.GetNCoord=function(){return this.m_nCoord},h.IndexedFaceSet.prototype.GetNNormal=function(){return this.m_nNormal},h.IndexedFaceSet.prototype.GetNFloatAttribute=function(e){return this.m_nFloatAttribute[e]},h.IndexedFaceSet.prototype.GetNIntAttribute=function(e){return this.m_nIntAttribute[e]},h.IndexedFaceSet.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},h.IndexedFaceSet.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},h.IndexedFaceSet.prototype.GetCoordMinArray=function(){return this.m_coordMin},h.IndexedFaceSet.prototype.GetCoordMaxArray=function(){return this.m_coordMax},h.IndexedFaceSet.prototype.GetNormalMinArray=function(){return this.m_normalMin},h.IndexedFaceSet.prototype.GetNormalMaxArray=function(){return this.m_normalMax},h.IndexedFaceSet.prototype.GetFloatAttributeMinArray=function(e){return new Float32Array(this.m_minFloatAttributeBuffer,e*c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES*4,this.GetFloatAttributeDim(e))},h.IndexedFaceSet.prototype.GetFloatAttributeMaxArray=function(e){return new Float32Array(this.m_maxFloatAttributeBuffer,e*c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES*4,this.GetFloatAttributeDim(e))},h.IndexedFaceSet.prototype.GetFloatAttributeDim=function(e){return this.m_dimFloatAttribute[e]},h.IndexedFaceSet.prototype.GetIntAttributeDim=function(e){return this.m_dimIntAttribute[e]},h.IndexedFaceSet.prototype.GetFloatAttributeType=function(e){return this.m_typeFloatAttribute[e]},h.IndexedFaceSet.prototype.GetIntAttributeType=function(e){return this.m_typeIntAttribute[e]},h.IndexedFaceSet.prototype.GetFloatAttributeMax=function(e,t){return this.m_maxFloatAttribute[e*c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+t]},h.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},h.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},h.IndexedFaceSet.prototype.GetCCW=function(){return this.m_ccw},h.IndexedFaceSet.prototype.GetSolid=function(){return this.m_solid},h.IndexedFaceSet.prototype.GetConvex=function(){return this.m_convex},h.IndexedFaceSet.prototype.GetIsTriangularMesh=function(){return this.m_isTriangularMesh},h.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},h.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},h.IndexedFaceSet.prototype.GetCoord=function(){return this.m_coord},h.IndexedFaceSet.prototype.GetNormal=function(){return this.m_normal},h.IndexedFaceSet.prototype.GetFloatAttribute=function(e){return this.m_floatAttribute[e]},h.IndexedFaceSet.prototype.GetIntAttribute=function(e){return this.m_intAttribute[e]},h.IndexedFaceSet.prototype.SetNCoordIndex=function(e){this.m_nCoordIndex=e},h.IndexedFaceSet.prototype.SetNNormalIndex=function(e){},h.IndexedFaceSet.prototype.SetNormalPerVertex=function(e){},h.IndexedFaceSet.prototype.SetNFloatAttributeIndex=function(e){},h.IndexedFaceSet.prototype.SetNIntAttributeIndex=function(e){},h.IndexedFaceSet.prototype.SetFloatAttributePerVertex=function(e){},h.IndexedFaceSet.prototype.SetIntAttributePerVertex=function(e){},h.IndexedFaceSet.prototype.SetNCoord=function(e){this.m_nCoord=e},h.IndexedFaceSet.prototype.SetNNormal=function(e){this.m_nNormal=e},h.IndexedFaceSet.prototype.SetNumFloatAttributes=function(e){this.m_numFloatAttributes=e},h.IndexedFaceSet.prototype.SetNumIntAttributes=function(e){this.m_numIntAttributes=e},h.IndexedFaceSet.prototype.SetCreaseAngle=function(e){this.m_creaseAngle=e},h.IndexedFaceSet.prototype.SetCCW=function(e){this.m_ccw=e},h.IndexedFaceSet.prototype.SetSolid=function(e){this.m_solid=e},h.IndexedFaceSet.prototype.SetConvex=function(e){this.m_convex=e},h.IndexedFaceSet.prototype.SetIsTriangularMesh=function(e){this.m_isTriangularMesh=e},h.IndexedFaceSet.prototype.SetCoordMin=function(e,t){this.m_coordMin[e]=t},h.IndexedFaceSet.prototype.SetCoordMax=function(e,t){this.m_coordMax[e]=t},h.IndexedFaceSet.prototype.SetNormalMin=function(e,t){this.m_normalMin[e]=t},h.IndexedFaceSet.prototype.SetNormalMax=function(e,t){this.m_normalMax[e]=t},h.IndexedFaceSet.prototype.SetNFloatAttribute=function(e,t){this.m_nFloatAttribute[e]=t},h.IndexedFaceSet.prototype.SetNIntAttribute=function(e,t){this.m_nIntAttribute[e]=t},h.IndexedFaceSet.prototype.SetFloatAttributeDim=function(e,t){this.m_dimFloatAttribute[e]=t},h.IndexedFaceSet.prototype.SetIntAttributeDim=function(e,t){this.m_dimIntAttribute[e]=t},h.IndexedFaceSet.prototype.SetFloatAttributeType=function(e,t){this.m_typeFloatAttribute[e]=t},h.IndexedFaceSet.prototype.SetIntAttributeType=function(e,t){this.m_typeIntAttribute[e]=t},h.IndexedFaceSet.prototype.SetFloatAttributeMin=function(e,t,r){this.m_minFloatAttribute[e*c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+t]=r},h.IndexedFaceSet.prototype.SetFloatAttributeMax=function(e,t,r){this.m_maxFloatAttribute[e*c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+t]=r},h.IndexedFaceSet.prototype.SetCoordIndex=function(e){this.m_coordIndex=e},h.IndexedFaceSet.prototype.SetCoord=function(e){this.m_coord=e},h.IndexedFaceSet.prototype.SetNormal=function(e){this.m_normal=e},h.IndexedFaceSet.prototype.SetFloatAttribute=function(e,t){this.m_floatAttribute[e]=t},h.IndexedFaceSet.prototype.SetIntAttribute=function(e,t){this.m_intAttribute[e]=t},h.SC3DMCEncodeParams=function(){var e;for(this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_floatAttributeQuantBits=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_floatAttributePredMode=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_intAttributePredMode=new Uint32Array(c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_encodeMode=c.O3DGC_SC3DMC_ENCODE_MODE_TFAN,this.m_streamTypeMode=c.O3DGC_STREAM_TYPE_ASCII,this.m_coordQuantBits=14,this.m_normalQuantBits=8,this.m_coordPredMode=c.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,this.m_normalPredMode=c.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION,e=0;e<c.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES;++e)this.m_floatAttributePredMode[e]=c.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION;for(e=0;e<c.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES;++e)this.m_intAttributePredMode[e]=c.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION},h.SC3DMCEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},h.SC3DMCEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},h.SC3DMCEncodeParams.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},h.SC3DMCEncodeParams.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},h.SC3DMCEncodeParams.prototype.GetCoordQuantBits=function(){return this.m_coordQuantBits},h.SC3DMCEncodeParams.prototype.GetNormalQuantBits=function(){return this.m_normalQuantBits},h.SC3DMCEncodeParams.prototype.GetFloatAttributeQuantBits=function(e){return this.m_floatAttributeQuantBits[e]},h.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},h.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},h.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(e){return this.m_floatAttributePredMode[e]},h.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(e){return this.m_intAttributePredMode[e]},h.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},h.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},h.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(e){return this.m_floatAttributePredMode[e]},h.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(e){return this.m_intAttributePredMode[e]},h.SC3DMCEncodeParams.prototype.SetStreamType=function(e){this.m_streamTypeMode=e},h.SC3DMCEncodeParams.prototype.SetEncodeMode=function(e){this.m_encodeMode=e},h.SC3DMCEncodeParams.prototype.SetNumFloatAttributes=function(e){this.m_numFloatAttributes=e},h.SC3DMCEncodeParams.prototype.SetNumIntAttributes=function(e){this.m_numIntAttributes=e},h.SC3DMCEncodeParams.prototype.SetCoordQuantBits=function(e){this.m_coordQuantBits=e},h.SC3DMCEncodeParams.prototype.SetNormalQuantBits=function(e){this.m_normalQuantBits=e},h.SC3DMCEncodeParams.prototype.SetFloatAttributeQuantBits=function(e,t){this.m_floatAttributeQuantBits[e]=t},h.SC3DMCEncodeParams.prototype.SetCoordPredMode=function(e){this.m_coordPredMode=e},h.SC3DMCEncodeParams.prototype.SetNormalPredMode=function(e){this.m_normalPredMode=e},h.SC3DMCEncodeParams.prototype.SetFloatAttributePredMode=function(e,t){this.m_floatAttributePredMode[e]=t},h.SC3DMCEncodeParams.prototype.SetIntAttributePredMode=function(e,t){this.m_intAttributePredMode[e]=t},h.AdjacencyInfo=function(){this.m_neighborsSize=0,this.m_numNeighborsSize=0,this.m_numElements=0,this.m_neighbors={},this.m_numNeighbors={}},h.AdjacencyInfo.prototype.Allocate=function(e,t){return this.m_numElements=e,t>this.m_neighborsSize&&(this.m_neighborsSize=t,this.m_neighbors=new Int32Array(this.m_neighborsSize)),e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),h.O3DGC_OK},h.AdjacencyInfo.prototype.AllocateNumNeighborsArray=function(e){return e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),this.m_numElements=e,h.O3DGC_OK},h.AdjacencyInfo.prototype.AllocateNeighborsArray=function(){var e;for(e=1;e<this.m_numElements;++e)this.m_numNeighbors[e]+=this.m_numNeighbors[e-1];return this.m_numNeighbors[this.m_numElements-1]>this.m_neighborsSize&&(this.m_neighborsSize=this.m_numNeighbors[this.m_numElements-1],this.m_neighbors=new Int32Array(this.m_neighborsSize)),h.O3DGC_OK},h.AdjacencyInfo.prototype.ClearNumNeighborsArray=function(){var e;for(e=0;e<this.m_numElements;++e)this.m_numNeighbors[e]=0;return h.O3DGC_OK},h.AdjacencyInfo.prototype.ClearNeighborsArray=function(){var e;for(e=0;e<this.m_neighborsSize;++e)this.m_neighbors[e]=-1;return h.O3DGC_OK},h.AdjacencyInfo.prototype.Begin=function(e){return e>0?this.m_numNeighbors[e-1]:0},h.AdjacencyInfo.prototype.End=function(e){return this.m_numNeighbors[e]},h.AdjacencyInfo.prototype.AddNeighbor=function(e,t){var r,i,n;for(i=this.Begin(e),n=this.End(e),r=i;n>r;++r)if(-1===this.m_neighbors[r])return this.m_neighbors[r]=t,h.O3DGC_OK;return h.O3DGC_ERROR_BUFFER_FULL},h.AdjacencyInfo.prototype.GetNeighbor=function(e){return this.m_neighbors[e]},h.AdjacencyInfo.prototype.GetNumNeighbors=function(e){return this.End(e)-this.Begin(e)},h.AdjacencyInfo.prototype.GetNumNeighborsBuffer=function(){return this.m_numNeighbors},h.AdjacencyInfo.prototype.GetNeighborsBuffer=function(){return this.m_neighbors},h.Vector=function(){this.m_data={},this.m_allocated=0,this.m_size=0},h.Vector.prototype.Clear=function(){this.m_size=0},h.Vector.prototype.Get=function(e){return this.m_data[e]},h.Vector.prototype.GetAllocatedSize=function(){return this.m_allocated},h.Vector.prototype.GetSize=function(){return this.m_size},h.Vector.prototype.GetBuffer=function(){return this.m_data},h.Vector.prototype.SetSize=function(e){this.m_size=e},h.Vector.prototype.Allocate=function(e){var t,r;if(e>this.m_allocated){if(this.m_allocated=e,r=new Int32Array(this.m_allocated),this.m_size>0)for(t=0;t<this.m_size;++t)r[t]=this.m_data[t];this.m_data=r}},h.Vector.prototype.PushBack=function(e){var t,r;if(this.m_size===this.m_allocated){if(this.m_allocated*=2,this.m_allocated<c.O3DGC_DEFAULT_VECTOR_SIZE&&(this.m_allocated=c.O3DGC_DEFAULT_VECTOR_SIZE),r=new Int32Array(this.m_allocated),this.m_size>0)for(t=0;t<this.m_size;++t)r[t]=this.m_data[t];this.m_data=r}this.m_data[this.m_size++]=e},h.CompressedTriangleFans=function(){this.m_numTFANs=new h.Vector,this.m_degrees=new h.Vector,this.m_configs=new h.Vector,this.m_operations=new h.Vector,this.m_indices=new h.Vector,this.m_trianglesOrder=new h.Vector,this.m_streamType=c.O3DGC_STREAM_TYPE_UNKOWN},h.CompressedTriangleFans.prototype.GetStreamType=function(){return this.m_streamType},h.CompressedTriangleFans.prototype.SetStreamType=function(e){this.m_streamType=e},h.CompressedTriangleFans.prototype.Clear=function(){return this.m_numTFANs.Clear(),this.m_degrees.Clear(),this.m_configs.Clear(),this.m_operations.Clear(),this.m_indices.Clear(),h.O3DGC_OK},h.CompressedTriangleFans.prototype.Allocate=function(e,t){return this.m_numTFANs.Allocate(e),this.m_degrees.Allocate(2*e),this.m_configs.Allocate(2*e),this.m_operations.Allocate(2*e),this.m_indices.Allocate(2*e),this.m_trianglesOrder.Allocate(t),this.Clear(),h.O3DGC_OK},h.CompressedTriangleFans.prototype.PushNumTFans=function(e){this.m_numTFANs.PushBack(e)},h.CompressedTriangleFans.prototype.ReadNumTFans=function(e){return this.m_numTFANs.Get(e.m_count++)},h.CompressedTriangleFans.prototype.PushDegree=function(e){this.m_degrees.PushBack(e)},h.CompressedTriangleFans.prototype.ReadDegree=function(e){return this.m_degrees.Get(e.m_count++)},h.CompressedTriangleFans.prototype.PushConfig=function(e){this.m_configs.PushBack(e)},h.CompressedTriangleFans.prototype.ReadConfig=function(e){return this.m_configs.Get(e.m_count++)},h.CompressedTriangleFans.prototype.PushOperation=function(e){this.m_operations.PushBack(e)},h.CompressedTriangleFans.prototype.ReadOperation=function(e){return this.m_operations.Get(e.m_count++)},h.CompressedTriangleFans.prototype.PushIndex=function(e){this.m_indices.PushBack(e)},h.CompressedTriangleFans.prototype.ReadIndex=function(e){return this.m_indices.Get(e.m_count++)},h.CompressedTriangleFans.prototype.PushTriangleIndex=function(e){this.m_trianglesOrder.PushBack(i(e))},h.CompressedTriangleFans.prototype.ReadTriangleIndex=function(e){return n(this.m_trianglesOrder.Get(e.m_count++))},h.CompressedTriangleFans.prototype.LoadUIntData=function(e,t,r){var i,n;for(t.ReadUInt32ASCII(r),i=t.ReadUInt32ASCII(r),e.Allocate(i),e.Clear(),n=0;i>n;++n)e.PushBack(t.ReadUIntASCII(r));return h.O3DGC_OK},h.CompressedTriangleFans.prototype.LoadIntData=function(e,t,r){var i,n;for(t.ReadUInt32ASCII(r),i=t.ReadUInt32ASCII(r),e.Allocate(i),e.Clear(),n=0;i>n;++n)e.PushBack(t.ReadIntASCII(r));return h.O3DGC_OK},h.CompressedTriangleFans.prototype.LoadBinData=function(e,t,r){var i,n,o,a;for(t.ReadUInt32ASCII(r),i=t.ReadUInt32ASCII(r),e.Allocate(i*c.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0),e.Clear(),o=0;i>o;)for(n=t.ReadUCharASCII(r),a=0;a<c.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0;++a)e.PushBack(1&n),n>>>=1,++o;return h.O3DGC_OK},h.CompressedTriangleFans.prototype.LoadUIntAC=function(e,t,r,i){var n,o,a,s,c,l,u;if(n=r.ReadUInt32Bin(i)-12,o=r.ReadUInt32Bin(i),0===o)return h.O3DGC_OK;for(a=r.ReadUInt32Bin(i),s=r.GetBuffer(i,n),i.m_count+=n,e.Allocate(o),c=new h.ArithmeticDecoder,c.SetBuffer(n,s),c.StartDecoder(),l=new h.AdaptiveDataModel,l.SetAlphabet(t+1),u=0;o>u;++u)e.PushBack(c.DecodeAdaptiveDataModel(l)+a);return h.O3DGC_OK},h.CompressedTriangleFans.prototype.LoadIntACEGC=function(e,t,r,i){var n,o,a,s,l,u,d,m,p,E;if(n=r.ReadUInt32Bin(i)-12,o=r.ReadUInt32Bin(i),0===o)return h.O3DGC_OK;for(a=r.ReadUInt32Bin(i)-c.O3DGC_MAX_LONG,s=r.GetBuffer(i,n),i.m_count+=n,e.Allocate(o),l=new h.ArithmeticDecoder,l.SetBuffer(n,s),l.StartDecoder(),u=new h.AdaptiveDataModel,u.SetAlphabet(t+2),d=new h.StaticBitModel,m=new h.AdaptiveBitModel,E=0;o>E;++E)p=l.DecodeAdaptiveDataModel(u),p===t&&(p+=l.ExpGolombDecode(0,d,m)),e.PushBack(p+a);return h.O3DGC_OK},h.CompressedTriangleFans.prototype.LoadBinAC=function(e,t,r){var i,n,o,a,s,c;if(i=t.ReadUInt32Bin(r)-8,n=t.ReadUInt32Bin(r),0===n)return h.O3DGC_OK;for(o=t.GetBuffer(r,i),r.m_count+=i,e.Allocate(n),a=new h.ArithmeticDecoder,a.SetBuffer(i,o),a.StartDecoder(),s=new h.AdaptiveBitModel,c=0;n>c;++c)e.PushBack(a.DecodeAdaptiveBitModel(s));return h.O3DGC_OK},h.CompressedTriangleFans.prototype.Load=function(e,t,r,i){return i===c.O3DGC_STREAM_TYPE_ASCII?(this.LoadUIntData(this.m_numTFANs,e,t),this.LoadUIntData(this.m_degrees,e,t),this.LoadUIntData(this.m_configs,e,t),this.LoadBinData(this.m_operations,e,t),this.LoadIntData(this.m_indices,e,t),r&&this.LoadUIntData(this.m_trianglesOrder,e,t)):(this.LoadIntACEGC(this.m_numTFANs,4,e,t),this.LoadIntACEGC(this.m_degrees,16,e,t),this.LoadUIntAC(this.m_configs,10,e,t),this.LoadBinAC(this.m_operations,e,t),this.LoadIntACEGC(this.m_indices,8,e,t),r&&this.LoadIntACEGC(this.m_trianglesOrder,16,e,t)),h.O3DGC_OK},h.TriangleFans=function(){this.m_verticesAllocatedSize=0,this.m_sizeTFANAllocatedSize=0,this.m_numTFANs=0,this.m_numVertices=0,this.m_sizeTFAN={},this.m_vertices={}},h.TriangleFans.prototype.Allocate=function(e,t){return this.m_numTFANs=0,this.m_numVertices=0,this.m_verticesAllocatedSize<t&&(this.m_verticesAllocatedSize=t,this.m_vertices=new Int32Array(this.m_verticesAllocatedSize)),this.m_sizeTFANAllocatedSize<e&&(this.m_sizeTFANAllocatedSize=e,this.m_sizeTFAN=new Int32Array(this.m_sizeTFANAllocatedSize)),h.O3DGC_OK},h.TriangleFans.prototype.Clear=function(){return this.m_numTFANs=0,this.m_numVertices=0,h.O3DGC_OK},h.TriangleFans.prototype.AddVertex=function(e){var t,r;if(++this.m_numVertices,this.m_numVertices>this.m_verticesAllocatedSize){for(this.m_verticesAllocatedSize*=2,r=new Int32Array(this.m_verticesAllocatedSize),t=0;t<this.m_numVertices;++t)r[t]=this.m_vertices[t];this.m_vertices=r}return this.m_vertices[this.m_numVertices-1]=e,++this.m_sizeTFAN[this.m_numTFANs-1],h.O3DGC_OK},h.TriangleFans.prototype.AddTFAN=function(){var e,t;if(++this.m_numTFANs,this.m_numTFANs>this.m_sizeTFANAllocatedSize){for(this.m_sizeTFANAllocatedSize*=2,t=new Int32Array(this.m_sizeTFANAllocatedSize),e=0;e<this.m_numTFANs;++e)t[e]=this.m_sizeTFAN[e];this.m_sizeTFAN=t}return this.m_sizeTFAN[this.m_numTFANs-1]=this.m_numTFANs>1?this.m_sizeTFAN[this.m_numTFANs-2]:0,h.O3DGC_OK},h.TriangleFans.prototype.Begin=function(e){return e>0?this.m_sizeTFAN[e-1]:0},h.TriangleFans.prototype.End=function(e){return this.m_sizeTFAN[e]},h.TriangleFans.prototype.GetVertex=function(e){return this.m_vertices[e]},h.TriangleFans.prototype.GetTFANSize=function(e){return this.End(e)-this.Begin(e)},h.TriangleFans.prototype.GetNumTFANs=function(){return this.m_numTFANs},h.TriangleFans.prototype.GetNumVertices=function(){return this.m_numVertices},h.TriangleListDecoder=function(){this.m_itNumTFans=new h.Iterator,this.m_itDegree=new h.Iterator,this.m_itConfig=new h.Iterator,this.m_itOperation=new h.Iterator,this.m_itIndex=new h.Iterator,this.m_maxNumVertices=0,this.m_maxNumTriangles=0,this.m_numTriangles=0,this.m_numVertices=0,this.m_tempTrianglesSize=0,this.m_vertexCount=0,this.m_triangleCount=0,this.m_numConqueredTriangles=0,this.m_numVisitedVertices=0,this.m_triangles={},this.m_tempTriangles={},this.m_visitedVertices={},this.m_visitedVerticesValence={},this.m_vertexToTriangle=new h.AdjacencyInfo,this.m_ctfans=new h.CompressedTriangleFans,this.m_tfans=new h.TriangleFans,this.m_streamType=c.O3DGC_STREAM_TYPE_ASCII,this.m_decodeTrianglesOrder=!1,this.m_decodeVerticesOrder=!1,this.m_processConfig={0:function(e,t){var r;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),r=1;t-1>r;++r)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[1])},1:function(e,t,r){var i,n,o;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),i=1;t-1>i;++i)n=e.m_ctfans.ReadOperation(e.m_itOperation),1===n?(o=e.m_ctfans.ReadIndex(e.m_itIndex),0>o?e.m_tfans.AddVertex(e.m_visitedVertices[-o-1]):e.m_tfans.AddVertex(o+r)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++));e.m_tfans.AddVertex(e.m_visitedVertices[1])},2:function(e,t){var r;for(r=0;t-1>r;++r)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[0])},3:function(e,t){var r;for(r=0;t-1>r;++r)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[1])},4:function(e,t){var r;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),r=1;t>r;++r)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},5:function(e,t){var r;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),r=1;t>r;++r)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},6:function(e,t){var r;for(r=0;t>r;++r)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},7:function(e,t){var r;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),r=1;t-1>r;++r)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[0])},8:function(e,t,r){var i,n,o;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),i=1;t-1>i;++i)n=e.m_ctfans.ReadOperation(e.m_itOperation),1===n?(o=e.m_ctfans.ReadIndex(e.m_itIndex),0>o?e.m_tfans.AddVertex(e.m_visitedVertices[-o-1]):e.m_tfans.AddVertex(o+r)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++));e.m_tfans.AddVertex(e.m_visitedVertices[0])},9:function(e,t,r){var i,n,o;for(i=0;t>i;++i)n=e.m_ctfans.ReadOperation(e.m_itOperation),1===n?(o=e.m_ctfans.ReadIndex(e.m_itIndex),0>o?e.m_tfans.AddVertex(e.m_visitedVertices[-o-1]):e.m_tfans.AddVertex(o+r)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++))}}},h.TriangleListDecoder.prototype.GetStreamType=function(){return this.m_streamType},h.TriangleListDecoder.prototype.GetReorderTriangles=function(){return this.m_decodeTrianglesOrder},h.TriangleListDecoder.prototype.GetReorderVertices=function(){return this.m_decodeVerticesOrder},h.TriangleListDecoder.prototype.SetStreamType=function(e){this.m_streamType=e},h.TriangleListDecoder.prototype.GetVertexToTriangle=function(){return this.m_vertexToTriangle},h.TriangleListDecoder.prototype.Reorder=function(){var e,t,r,i,o,a,s,c;if(this.m_decodeTrianglesOrder)for(e=this.m_triangles,t=this.m_numTriangles,r=this.m_ctfans.m_trianglesOrder.m_data,a=this.m_tempTriangles,a.set(e),i=0,o=0,c=0;t>c;++c)s=n(r[i++])+o,e[3*s]=a[3*c],e[3*s+1]=a[3*c+1],e[3*s+2]=a[3*c+2],o=s+1;return h.O3DGC_OK},h.TriangleListDecoder.prototype.CompueLocalConnectivityInfo=function(e){var t,r,i,n,o,a,s,c,l,u,d,m,p,E,f,T,v,g,y;for(t=this.m_visitedVertices,r=this.m_visitedVerticesValence,i=this.m_triangles,n=this.m_vertexToTriangle,o=n.Begin(e),a=n.End(e),s=0,l=0,v=0,d=o;v>=0&&a>d;++d)if(v=n.GetNeighbor(d),v>=0)for(++s,g=3*v,p=0;3>p;++p)if(y=i[g+p],y>e){for(c=!1,m=0;l>m;++m){if(y===t[m]){r[m]++,c=!0;break}if(y<t[m]){for(++l,E=l-1;E>m;--E)t[E]=t[E-1],r[E]=r[E-1];t[m]=y,r[m]=1,c=!0;break}}c||(t[l]=y,r[l]=1,l++)}if(l>2)for(f=1;l>f;++f)if(1===r[f])for(T=f;T>0&&r[T]<r[T-1];)u=r[T],r[T]=r[T-1],r[T-1]=u,u=t[T],t[T]=t[T-1],t[T-1]=u,--T;return this.m_numConqueredTriangles=s,this.m_numVisitedVertices=l,h.O3DGC_OK},h.TriangleListDecoder.prototype.DecompressTFAN=function(e){var t,r,i,n,o,a,s,c,l,u,d,m,p,E,f,T,v,g,y;if(t=this.m_vertexToTriangle,r=this.m_triangles,i=this.m_itDegree,n=this.m_itConfig,o=this.m_tfans,s=this.m_processConfig,c=this.m_ctfans,l=this.m_triangleCount,u=this.m_numConqueredTriangles,a=c.ReadNumTFans(this.m_itNumTFans),a>0)for(g=0;a>g;++g)for(o.AddTFAN(),d=c.ReadDegree(i)+2-u,m=c.ReadConfig(n),p=o.GetNumVertices(),o.AddVertex(e),s[m](this,d,e),E=o.GetNumVertices(),f=o.GetVertex(p+1),y=p+2;E>y;++y)T=o.GetVertex(y),v=3*l,r[v++]=e,r[v++]=f,r[v]=T,t.AddNeighbor(e,l),t.AddNeighbor(f,l),t.AddNeighbor(T,l),f=T,l++;return this.m_triangleCount=l,h.O3DGC_OK},h.TriangleListDecoder.prototype.Decompress=function(){var e;for(e=0;e<this.m_numVertices;++e)e===this.m_vertexCount&&this.m_vertexCount++,
this.CompueLocalConnectivityInfo(e),this.DecompressTFAN(e);return h.O3DGC_OK},h.TriangleListDecoder.prototype.Init=function(e,t,r,i){var n,o;for(this.m_numTriangles=t,this.m_numVertices=r,this.m_triangles=e,this.m_vertexCount=0,this.m_triangleCount=0,this.m_itNumTFans.m_count=0,this.m_itDegree.m_count=0,this.m_itConfig.m_count=0,this.m_itOperation.m_count=0,this.m_itIndex.m_count=0,this.m_numVertices>this.m_maxNumVertices&&(this.m_maxNumVertices=this.m_numVertices,this.m_visitedVerticesValence=new Int32Array(this.m_numVertices),this.m_visitedVertices=new Int32Array(this.m_numVertices)),this.m_decodeTrianglesOrder&&this.m_tempTrianglesSize<this.m_numTriangles&&(this.m_tempTrianglesSize=this.m_numTriangles,this.m_tempTriangles=new Int32Array(3*this.m_tempTrianglesSize)),this.m_ctfans.SetStreamType(this.m_streamType),this.m_ctfans.Allocate(this.m_numVertices,this.m_numTriangles),this.m_tfans.Allocate(2*this.m_numVertices,8*this.m_numVertices),this.m_vertexToTriangle.AllocateNumNeighborsArray(r),o=this.m_vertexToTriangle.GetNumNeighborsBuffer(),n=0;r>n;++n)o[n]=i;return this.m_vertexToTriangle.AllocateNeighborsArray(),this.m_vertexToTriangle.ClearNeighborsArray(),h.O3DGC_OK},h.TriangleListDecoder.prototype.Decode=function(e,t,r,i,n){var o,a;return o=i.ReadUChar(n,this.m_streamType),this.m_decodeTrianglesOrder=0!==(2&o),this.m_decodeVerticesOrder=0!==(1&o),this.m_decodeVerticesOrder?h.O3DGC_ERROR_NON_SUPPORTED_FEATURE:(a=i.ReadUInt32(n,this.m_streamType),this.Init(e,t,r,a),this.m_ctfans.Load(i,n,this.m_decodeTrianglesOrder,this.m_streamType),this.Decompress(),h.O3DGC_OK)},h.SC3DMCDecoder=function(){var e;for(this.m_iterator=new h.Iterator,this.m_streamSize=0,this.m_params=new h.SC3DMCEncodeParams,this.m_triangleListDecoder=new h.TriangleListDecoder,this.m_quantFloatArray={},this.m_orientation={},this.m_normals={},this.m_quantFloatArraySize=0,this.m_normalsSize=0,this.m_orientationSize=0,this.m_stats=new h.SC3DMCStats,this.m_streamType=c.O3DGC_STREAM_TYPE_UNKOWN,this.m_neighbors=[],this.m_idelta=new Float32Array(c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minNormal=new Float32Array(2),this.m_maxNormal=new Float32Array(2),this.m_minNormal[0]=this.m_minNormal[1]=-2,this.m_maxNormal[0]=this.m_maxNormal[1]=2,e=0;e<c.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES;++e)this.m_neighbors[e]=new h.SC3DMCPredictor},h.SC3DMCDecoder.prototype.GetStats=function(){return this.m_stats},h.SC3DMCDecoder.prototype.DecodeHeader=function(e,t){var r,i,n,o,a,s;if(r=this.m_iterator.m_count,i=t.ReadUInt32(this.m_iterator,c.O3DGC_STREAM_TYPE_BINARY),i!==c.O3DGC_SC3DMC_START_CODE){if(this.m_iterator.m_count=r,i=t.ReadUInt32(this.m_iterator,c.O3DGC_STREAM_TYPE_ASCII),i!==c.O3DGC_SC3DMC_START_CODE)return h.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=c.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=c.O3DGC_STREAM_TYPE_BINARY;if(this.m_streamSize=t.ReadUInt32(this.m_iterator,this.m_streamType),this.m_params.SetEncodeMode(t.ReadUChar(this.m_iterator,this.m_streamType)),e.SetCreaseAngle(t.ReadFloat32(this.m_iterator,this.m_streamType)),n=t.ReadUChar(this.m_iterator,this.m_streamType),e.SetCCW(1===(1&n)),e.SetSolid(1===(2&n)),e.SetConvex(1===(4&n)),e.SetIsTriangularMesh(1===(8&n)),e.SetNCoord(t.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNNormal(t.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNumFloatAttributes(t.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNumIntAttributes(t.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNCoord()>0){for(e.SetNCoordIndex(t.ReadUInt32(this.m_iterator,this.m_streamType)),o=0;3>o;++o)e.SetCoordMin(o,t.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetCoordMax(o,t.ReadFloat32(this.m_iterator,this.m_streamType));this.m_params.SetCoordQuantBits(t.ReadUChar(this.m_iterator,this.m_streamType))}if(e.GetNNormal()>0){for(e.SetNNormalIndex(t.ReadUInt32(this.m_iterator,this.m_streamType)),o=0;3>o;++o)e.SetNormalMin(o,t.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetNormalMax(o,t.ReadFloat32(this.m_iterator,this.m_streamType));e.SetNormalPerVertex(1===t.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetNormalQuantBits(t.ReadUChar(this.m_iterator,this.m_streamType))}for(a=0;a<e.GetNumFloatAttributes();++a)if(e.SetNFloatAttribute(a,t.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNFloatAttribute(a)>0){for(e.SetNFloatAttributeIndex(a,t.ReadUInt32(this.m_iterator,this.m_streamType)),s=t.ReadUChar(this.m_iterator,this.m_streamType),e.SetFloatAttributeDim(a,s),o=0;s>o;++o)e.SetFloatAttributeMin(a,o,t.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetFloatAttributeMax(a,o,t.ReadFloat32(this.m_iterator,this.m_streamType));e.SetFloatAttributePerVertex(a,1===t.ReadUChar(this.m_iterator,this.m_streamType)),e.SetFloatAttributeType(a,t.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetFloatAttributeQuantBits(a,t.ReadUChar(this.m_iterator,this.m_streamType))}for(a=0;a<e.GetNumIntAttributes();++a)e.SetNIntAttribute(a,t.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNIntAttribute(a)>0&&(e.SetNIntAttributeIndex(a,t.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetIntAttributeDim(a,t.ReadUChar(this.m_iterator,this.m_streamType)),e.SetIntAttributePerVertex(a,1===t.ReadUChar(this.m_iterator,this.m_streamType)),e.SetIntAttributeType(a,t.ReadUChar(this.m_iterator,this.m_streamType)));return h.O3DGC_OK},h.SC3DMCDecoder.prototype.DecodeIntArrayBinary=function(e,t,r,i,n,a,s){var l,u,d,m,p,E,f,T,v,g,y,R,_,x,b,H,C,S,M,w,D,A,L,O,U,I,P,k,F,B,V,G;if(v=this.m_iterator,g=this.m_streamType,R=new h.ArithmeticDecoder,_=new h.StaticBitModel,x=new h.AdaptiveBitModel,b=new h.AdaptiveDataModel,b.SetAlphabet(c.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS+1),H=this.m_triangleListDecoder.GetVertexToTriangle(),C=H.m_neighbors,S=n.GetCoordIndex(),M=t*r,w=v.m_count,D=s.ReadUInt32(v,g),A=s.ReadUChar(v,g),L=A>>>4&7,a.m_value=7&A,D-=v.m_count-w,O=new h.Iterator,O.m_count=v.m_count+D,U=0,I=0,P=new h.SC3DMCTriplet(-1,-1,-1),L!==c.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return h.O3DGC_ERROR_CORRUPTED_STREAM;for(T=s.GetBuffer(v,D),v.m_count+=D,R.SetBuffer(D,T),R.StartDecoder(),U=R.ExpGolombDecode(0,_,x),I=R.ExpGolombDecode(0,_,x),k=new h.AdaptiveDataModel,k.SetAlphabet(I+2),F=this.m_neighbors,B=this.m_normals,V=new h.NumberRef,l=a.m_value!==c.O3DGC_SC3DMC_NO_PREDICTION,G=0;t>G;++G){if(V.m_value=0,H.GetNumNeighbors(G)>0&&l)for(E=H.Begin(G),f=H.End(G),m=E;f>m&&(p=C[m],!(0>p));++m)o(S,p,G,V,F,r,e,i);if(V.m_value>1)for(u=R.DecodeAdaptiveDataModel(b),d=0;r>d;++d)y=R.DecodeIntACEGC(k,_,x,U,I),e[G*i+d]=y+F[u].m_pred[d];else if(G>0&&a.m_value!==c.O3DGC_SC3DMC_NO_PREDICTION)for(d=0;r>d;++d)y=R.DecodeIntACEGC(k,_,x,U,I),e[G*i+d]=y+e[(G-1)*i+d];else for(d=0;r>d;++d)y=R.DecodeUIntACEGC(k,_,x,U,I),e[G*i+d]=y}return v.m_count=O.m_count,h.O3DGC_OK},h.SC3DMCDecoder.prototype.DecodeIntArrayASCII=function(e,t,r,i,n,a,s){var l,u,d,m,p,E,f,T,v,g,y,R,_,x,b,H,C,S,M,w,D,A,L,O;if(u=this.m_iterator,d=this.m_streamType,p=this.m_triangleListDecoder.GetVertexToTriangle(),E=p.m_neighbors,f=n.GetCoordIndex(),T=t*r,v=u.m_count,g=s.ReadUInt32(u,d),y=s.ReadUChar(u,d),R=y>>>4&7,a.m_value=7&y,g-=u.m_count-v,_=new h.Iterator,_.m_count=u.m_count+g,x=new h.SC3DMCTriplet(-1,-1,-1),R!==c.O3DGC_SC3DMC_BINARIZATION_ASCII)return h.O3DGC_ERROR_CORRUPTED_STREAM;for(s.ReadUInt32(_,d),b=this.m_neighbors,H=this.m_normals,C=new h.NumberRef,l=a.m_value!==c.O3DGC_SC3DMC_NO_PREDICTION,S=0;t>S;++S){if(C.m_value=0,p.GetNumNeighbors(S)>0&&l)for(M=p.Begin(S),w=p.End(S),D=M;w>D&&(A=E[D],!(0>A));++D)o(f,A,S,C,b,r,e,i);if(C.m_value>1)for(O=s.ReadUCharASCII(_),L=0;r>L;++L)m=s.ReadIntASCII(u),e[S*i+L]=m+b[O].m_pred[L];else if(S>0&&a.m_value!==c.O3DGC_SC3DMC_NO_PREDICTION)for(L=0;r>L;++L)m=s.ReadIntASCII(u),e[S*i+L]=m+e[(S-1)*i+L];else for(L=0;r>L;++L)m=s.ReadUIntASCII(u),e[S*i+L]=m}return u.m_count=_.m_count,h.O3DGC_OK},h.SC3DMCDecoder.prototype.DecodeIntArray=function(e,t,r,i,n,o,a){return this.m_streamType===c.O3DGC_STREAM_TYPE_ASCII?this.DecodeIntArrayASCII(e,t,r,i,n,o,a):this.DecodeIntArrayBinary(e,t,r,i,n,o,a)},h.SC3DMCDecoder.prototype.ProcessNormals=function(e){var t,i,n,o,a,c,l,u,d,m,p,E,f,T,v;for(n=e.GetNNormal(),o=3*e.GetNNormal(),this.m_normalsSize<o&&(this.m_normalsSize=o,this.m_normals=new Float32Array(this.m_normalsSize)),a=this.m_normals,c=this.m_quantFloatArray,l=this.m_orientation,u=e.GetCoordIndex(),s(u,e.GetNCoordIndex(),c,n,a),d=new h.Vec3,m=new h.Vec3,p=0;n>p;++p)t=3*p,d.m_x=a[t],d.m_y=a[t+1],d.m_z=a[t+2],v=Math.sqrt(d.m_x*d.m_x+d.m_y*d.m_y+d.m_z*d.m_z),0===v&&(v=1),r(d,m),E=m.m_x/v,f=m.m_y/v,T=m.m_z+l[p],l[p]=T,T>>>1!==m.m_z>>>1&&(E=0,f=0),i=2*p,a[i]=E,a[i+1]=f;return h.O3DGC_OK},h.SC3DMCDecoder.prototype.IQuantize=function(e,t,r,i,n,o,a,s){var l,u,d,m,p,E;if(s.m_value===c.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION)for(E=c.CubeToSphere,m=this.m_orientation,p=this.m_normals,u=new h.Vec3(0,0,0),d=new h.Vec3(0,0,0),this.IQuantizeFloatArray(e,t,r,i,this.m_minNormal,this.m_maxNormal,a+1),l=0;t>l;++l)u.m_x=e[i*l]+p[2*l],u.m_y=e[i*l+1]+p[2*l+1],u.m_z=m[l],E[u.m_z](u,d),e[i*l]=d.m_x,e[i*l+1]=d.m_y,e[i*l+2]=d.m_z;else this.IQuantizeFloatArray(e,t,r,i,n,o,a)},h.SC3DMCDecoder.prototype.DecodeFloatArrayBinary=function(e,t,r,i,s,l,u,d,m,p){var E,f,T,v,g,y,R,_,x,b,H,C,S,M,w,D,A,L,O,U,I,P,k,F,B,V,G,N,z,j,W,X,Y,K,q,Q;if(A=this.m_iterator,L=this.m_orientation,O=this.m_streamType,I=new h.ArithmeticDecoder,P=new h.StaticBitModel,k=new h.AdaptiveBitModel,F=new h.AdaptiveDataModel,E=c.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,F.SetAlphabet(E+1),B=this.m_triangleListDecoder.GetVertexToTriangle(),V=B.m_neighbors,G=d.GetCoordIndex(),N=t*r,z=A.m_count,j=p.ReadUInt32(A,O),W=p.ReadUChar(A,O),X=W>>>4&7,m.m_value=7&W,j-=A.m_count-z,Y=new h.Iterator,Y.m_count=A.m_count+j,K=0,q=0,X!==c.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return h.O3DGC_ERROR_CORRUPTED_STREAM;if(y=p.GetBuffer(A,j),A.m_count+=j,I.SetBuffer(j,y),I.StartDecoder(),K=I.ExpGolombDecode(0,P,k),q=I.ExpGolombDecode(0,P,k),Q=new h.AdaptiveDataModel,Q.SetAlphabet(q+2),m.m_value===c.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(this.m_orientationSize<N&&(this.m_orientationSize=N,this.m_orientation=new Int8Array(this.m_orientationSize),L=this.m_orientation),g=new h.AdaptiveDataModel,g.SetAlphabet(12),C=0;t>C;++C)L[C]=n(I.DecodeAdaptiveDataModel(g));this.ProcessNormals(d),r=2}for(this.m_quantFloatArraySize<N&&(this.m_quantFloatArraySize=N,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),R=this.m_quantFloatArray,_=this.m_neighbors,x=this.m_normals,b=new h.NumberRef,f=m.m_value!==c.O3DGC_SC3DMC_NO_PREDICTION,T=m.m_value===c.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,S=0;t>S;++S){if(b.m_value=0,B.GetNumNeighbors(S)>0&&f){if(w=B.Begin(S),D=B.End(S),T)for(M=w;D>M&&(H=V[M],!(0>H));++M)a(G,H,S,b,_,r,R,i,B,V);if(b.m_value<E)for(M=w;D>M&&(H=V[M],!(0>H));++M)o(G,H,S,b,_,r,R,i)}if(b.m_value>1)for(v=I.DecodeAdaptiveDataModel(F),C=0;r>C;++C)U=I.DecodeIntACEGC(Q,P,k,K,q),R[S*i+C]=U+_[v].m_pred[C];else if(S>0&&f)for(C=0;r>C;++C)U=I.DecodeIntACEGC(Q,P,k,K,q),R[S*i+C]=U+R[(S-1)*i+C];else for(C=0;r>C;++C)U=I.DecodeUIntACEGC(Q,P,k,K,q),R[S*i+C]=U}return A.m_count=Y.m_count,this.IQuantize(e,t,r,i,s,l,u,m),h.O3DGC_OK},h.SC3DMCDecoder.prototype.DecodeFloatArrayASCII=function(e,t,r,i,n,s,l,u,d,m){var p,E,f,T,v,g,y,R,_,x,b,H,C,S,M,w,D,A,L,O,U,I,P,k,F,B,V;if(p=c.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,T=this.m_iterator,v=this.m_orientation,g=this.m_streamType,R=this.m_triangleListDecoder.GetVertexToTriangle(),_=R.m_neighbors,x=u.GetCoordIndex(),b=t*r,H=T.m_count,C=m.ReadUInt32(T,g),S=m.ReadUChar(T,g),M=S>>>4&7,d.m_value=7&S,C-=T.m_count-H,w=new h.Iterator,w.m_count=T.m_count+C,M!==c.O3DGC_SC3DMC_BINARIZATION_ASCII)return h.O3DGC_ERROR_CORRUPTED_STREAM;if(m.ReadUInt32(w,g),d.m_value===c.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(this.m_orientationSize<t&&(this.m_orientationSize=t,this.m_orientation=new Int8Array(this.m_orientationSize),v=this.m_orientation),B=0;t>B;++B)v[B]=m.ReadIntASCII(T);this.ProcessNormals(u),r=2}for(this.m_quantFloatArraySize<b&&(this.m_quantFloatArraySize=b,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),D=this.m_quantFloatArray,A=this.m_neighbors,L=this.m_normals,O=new h.NumberRef,E=d.m_value!==c.O3DGC_SC3DMC_NO_PREDICTION,f=d.m_value===c.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,U=0;t>U;++U){if(O.m_value=0,R.GetNumNeighbors(U)>0&&E){if(P=R.Begin(U),k=R.End(U),f)for(I=P;k>I&&(F=_[I],!(0>F));++I)a(x,F,U,O,A,r,D,i,R,_);if(O.m_value<p)for(I=P;k>I&&(F=_[I],!(0>F));++I)o(x,F,U,O,A,r,D,i)}if(O.m_value>1)for(V=m.ReadUCharASCII(w),B=0;r>B;++B)y=m.ReadIntASCII(T),D[U*i+B]=y+A[V].m_pred[B];else if(U>0&&d.m_value!==c.O3DGC_SC3DMC_NO_PREDICTION)for(B=0;r>B;++B)y=m.ReadIntASCII(T),D[U*i+B]=y+D[(U-1)*i+B];else for(B=0;r>B;++B)y=m.ReadUIntASCII(T),D[U*i+B]=y}return T.m_count=w.m_count,this.IQuantize(e,t,r,i,n,s,l,d),h.O3DGC_OK},h.SC3DMCDecoder.prototype.DecodeFloatArray=function(e,t,r,i,n,o,a,s,h,l){return this.m_streamType===c.O3DGC_STREAM_TYPE_ASCII?this.DecodeFloatArrayASCII(e,t,r,i,n,o,a,s,h,l):this.DecodeFloatArrayBinary(e,t,r,i,n,o,a,s,h,l)},h.SC3DMCDecoder.prototype.IQuantizeFloatArray=function(e,t,r,i,n,o,a){var s,c,l,u,d;for(s=this.m_idelta,c=this.m_quantFloatArray,l=0;r>l;++l)u=o[l]-n[l],u>0?s[l]=u/((1<<a>>>0)-1):s[l]=1;for(d=0;t>d;++d)for(l=0;r>l;++l)e[d*i+l]=c[d*i+l]*s[l]+n[l];return h.O3DGC_OK},h.SC3DMCDecoder.prototype.DecodePlayload=function(e,t){var r,i,n,o,a,s,c;if(r=this.m_params,i=this.m_iterator,n=this.m_stats,o=new h.NumberRef,a=new h.Timer,s=h.O3DGC_OK,this.m_triangleListDecoder.SetStreamType(this.m_streamType),n.m_streamSizeCoordIndex=i.m_count,a.Tic(),this.m_triangleListDecoder.Decode(e.GetCoordIndex(),e.GetNCoordIndex(),e.GetNCoord(),t,i),a.Toc(),n.m_timeCoordIndex=a.GetElapsedTime(),n.m_streamSizeCoordIndex=i.m_count-n.m_streamSizeCoordIndex,n.m_streamSizeCoord=i.m_count,a.Tic(),e.GetNCoord()>0&&(s=this.DecodeFloatArray(e.GetCoord(),e.GetNCoord(),3,3,e.GetCoordMinArray(),e.GetCoordMaxArray(),r.GetCoordQuantBits(),e,o,t),r.SetCoordPredMode(o.m_value)),s!==h.O3DGC_OK)return s;if(a.Toc(),n.m_timeCoord=a.GetElapsedTime(),n.m_streamSizeCoord=i.m_count-n.m_streamSizeCoord,n.m_streamSizeNormal=i.m_count,a.Tic(),e.GetNNormal()>0&&(s=this.DecodeFloatArray(e.GetNormal(),e.GetNNormal(),3,3,e.GetNormalMinArray(),e.GetNormalMaxArray(),r.GetNormalQuantBits(),e,o,t),r.SetNormalPredMode(o.m_value)),s!==h.O3DGC_OK)return s;for(a.Toc(),n.m_timeNormal=a.GetElapsedTime(),n.m_streamSizeNormal=i.m_count-n.m_streamSizeNormal,c=0;c<e.GetNumFloatAttributes();++c)n.m_streamSizeFloatAttribute[c]=i.m_count,a.Tic(),s=this.DecodeFloatArray(e.GetFloatAttribute(c),e.GetNFloatAttribute(c),e.GetFloatAttributeDim(c),e.GetFloatAttributeDim(c),e.GetFloatAttributeMinArray(c),e.GetFloatAttributeMaxArray(c),r.GetFloatAttributeQuantBits(c),e,o,t),r.SetFloatAttributePredMode(c,o.m_value),a.Toc(),n.m_timeFloatAttribute[c]=a.GetElapsedTime(),n.m_streamSizeFloatAttribute[c]=i.m_count-n.m_streamSizeFloatAttribute[c];if(s!==h.O3DGC_OK)return s;for(c=0;c<e.GetNumIntAttributes();++c)n.m_streamSizeIntAttribute[c]=i.m_count,a.Tic(),s=this.DecodeIntArray(e.GetIntAttribute(c),e.GetNIntAttribute(c),e.GetIntAttributeDim(c),e.GetIntAttributeDim(c),e,o,t),r.SetIntAttributePredMode(c,o.m_value),a.Toc(),n.m_timeIntAttribute[c]=a.GetElapsedTime(),n.m_streamSizeIntAttribute[c]=i.m_count-n.m_streamSizeIntAttribute[c];return s!==h.O3DGC_OK?s:(a.Tic(),this.m_triangleListDecoder.Reorder(),a.Toc(),n.m_timeReorder=a.GetElapsedTime(),s)},h.DVEncodeParams=function(){this.m_encodeMode=c.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT,this.m_streamTypeMode=c.O3DGC_STREAM_TYPE_ASCII,this.m_quantBits=10},h.DVEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},h.DVEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},h.DVEncodeParams.prototype.GetQuantBits=function(){return this.m_quantBits},h.DVEncodeParams.prototype.SetStreamType=function(e){this.m_streamTypeMode=e},h.DVEncodeParams.prototype.SetEncodeMode=function(e){this.m_encodeMode=e},h.DVEncodeParams.prototype.SetQuantBits=function(e){this.m_quantBits=e},h.DynamicVector=function(){this.m_num=0,this.m_dim=0,this.m_stride=0,this.m_max={},this.m_min={},this.m_vectors={}},h.DynamicVector.prototype.GetNVector=function(){return this.m_num},h.DynamicVector.prototype.GetDimVector=function(){return this.m_dim},h.DynamicVector.prototype.GetStride=function(){return this.m_stride},h.DynamicVector.prototype.GetMinArray=function(){return this.m_min},h.DynamicVector.prototype.GetMaxArray=function(){return this.m_max},h.DynamicVector.prototype.GetVectors=function(){return this.m_vectors},h.DynamicVector.prototype.GetMin=function(e){return this.m_min[e]},h.DynamicVector.prototype.GetMax=function(e){return this.m_max[e]},h.DynamicVector.prototype.SetNVector=function(e){this.m_num=e},h.DynamicVector.prototype.SetDimVector=function(e){this.m_dim=e},h.DynamicVector.prototype.SetStride=function(e){this.m_stride=e},h.DynamicVector.prototype.SetMinArray=function(e){this.m_min=e},h.DynamicVector.prototype.SetMaxArray=function(e){this.m_max=e},h.DynamicVector.prototype.SetMin=function(e,t){this.m_min[e]=t},h.DynamicVector.prototype.SetMax=function(e,t){this.m_max[e]=t},h.DynamicVector.prototype.SetVectors=function(e){this.m_vectors=e},h.DynamicVectorDecoder=function(){this.m_streamSize=0,this.m_maxNumVectors=0,this.m_numVectors=0,this.m_dimVectors=0,this.m_quantVectors={},this.m_iterator=new h.Iterator,this.m_streamType=c.O3DGC_STREAM_TYPE_UNKOWN,this.m_params=new h.DVEncodeParams},h.DynamicVectorDecoder.prototype.GetStreamType=function(){return this.m_streamType},h.DynamicVectorDecoder.prototype.GetIterator=function(){return this.m_iterator},h.DynamicVectorDecoder.prototype.SetStreamType=function(e){this.m_streamType=e},h.DynamicVectorDecoder.prototype.SetIterator=function(e){this.m_iterator=e},h.DynamicVectorDecoder.prototype.IUpdate=function(e,t,r){var i,n;for(n=r-1,i=2,e[t]-=e[t+1]>>1;n>i;)e[t+i]-=e[t+i-1]+e[t+i+1]+2>>2,i+=2;return i===n&&(e[t+i]-=e[t+i-1]>>1),h.O3DGC_OK},h.DynamicVectorDecoder.prototype.IPredict=function(e,t,r){var i,n;for(n=r-1,i=1;n>i;)e[t+i]+=e[t+i-1]+e[t+i+1]+1>>1,i+=2;return i===n&&(e[t+i]+=e[t+i-1]),h.O3DGC_OK},h.DynamicVectorDecoder.prototype.Merge=function(e,t,r){var i,n,o,a,s;for(n=(r>>1)+(1&r),o=n-1,a=n;o>0;){for(i=o;a>i;i+=2)s=e[t+i],e[t+i]=e[t+i+1],e[t+i+1]=s;--o,++a}return h.O3DGC_OK},h.DynamicVectorDecoder.prototype.ITransform=function(e,t,r){var i,n,o,a;for(i=r,n=0,o=0,n+=(1&i)<<o++>>>0;i>1;)i=(i>>1)+((1&i)>>>0),n+=(1&i)<<o++>>>0;for(a=o-2;a>=0;--a)i=(i<<1>>>0)-(n>>>a&1)>>>0,this.Merge(e,t,i),this.IUpdate(e,t,i),this.IPredict(e,t,i);return h.O3DGC_OK},h.DynamicVectorDecoder.prototype.IQuantize=function(e,t,r,i,n,o,a){var s,c,l,u,d,m;for(s=this.m_quantVectors,u=t*r,d=0;r>d;++d)for(c=o[d]-n[d],l=c>0?c/((1<<a>>>0)-1):1,m=0;t>m;++m)e[m*i+d]=s[m+d*t]*l+n[d];return h.O3DGC_OK},h.DynamicVectorDecoder.prototype.DecodeHeader=function(e,t){var r,i,n,o;if(r=this.m_iterator,i=r.m_count,n=t.ReadUInt32(r,c.O3DGC_STREAM_TYPE_BINARY),n!==c.O3DGC_DV_START_CODE){if(r.m_count=i,n=t.ReadUInt32(r,c.O3DGC_STREAM_TYPE_ASCII),n!==c.O3DGC_DV_START_CODE)return h.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=c.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=c.O3DGC_STREAM_TYPE_BINARY;return o=this.m_streamType,this.m_streamSize=t.ReadUInt32(r,o),this.m_params.SetEncodeMode(t.ReadUChar(r,o)),e.SetNVector(t.ReadUInt32(r,o)),e.GetNVector()>0&&(e.SetDimVector(t.ReadUInt32(r,o)),this.m_params.SetQuantBits(t.ReadUChar(r,o))),h.O3DGC_OK},h.DynamicVectorDecoder.prototype.DecodePlayload=function(e,t){var r,i,n,o,a,s,l,u,d,m,p,E,f,T,v,g,y,R,_;for(i=this.m_iterator,n=this.m_streamType,o=h.O3DGC_OK,a=i.m_count,s=t.ReadUInt32(i,n),l=e.GetDimVector(),u=e.GetNVector(),r=l*u,d=0;d<e.GetDimVector();++d)e.SetMin(d,t.ReadFloat32(i,n)),e.SetMax(d,t.ReadFloat32(i,n));if(m=new h.ArithmeticDecoder,p=new h.StaticBitModel,E=new h.AdaptiveBitModel,s-=i.m_count-a,f=0,T=0,n===c.O3DGC_STREAM_TYPE_BINARY&&(v=t.GetBuffer(i,s),i.m_count+=s,m.SetBuffer(s,v),m.StartDecoder(),f=m.ExpGolombDecode(0,p,E),T=m.ExpGolombDecode(0,p,E)),g=new h.AdaptiveDataModel,g.SetAlphabet(T+2),this.m_maxNumVectors<r&&(this.m_maxNumVectors=r,this.m_quantVectors=new Int32Array(this.m_maxNumVectors)),y=this.m_quantVectors,n===c.O3DGC_STREAM_TYPE_ASCII)for(R=0;u>R;++R)for(_=0;l>_;++_)y[_*u+R]=t.ReadIntASCII(i);else for(R=0;u>R;++R)for(_=0;l>_;++_)y[_*u+R]=m.DecodeIntACEGC(g,p,E,f,T);for(_=0;l>_;++_)this.ITransform(y,_*u,u);return this.IQuantize(e.GetVectors(),u,l,e.GetStride(),e.GetMinArray(),e.GetMaxArray(),this.m_params.GetQuantBits()),o},h}(),S3D=S3D||{};S3D.S3DLoader=function(){this.ifs=new o3dgc.IndexedFaceSet},S3D.S3DLoader.prototype={constructor:S3D.S3DLoader,destroy:function(){this.ifs=null},position:function(){return this.ifs.GetCoord()},index:function(){return this.ifs.GetCoordIndex()},vertexCount:function(){return this.ifs.GetNCoord()},faceCount:function(){return this.ifs.GetNCoordIndex()},parse:function(e){var t=this.ifs,r=new o3dgc.BinaryStream(e),i=(e.byteLength,new o3dgc.SC3DMCDecoder);i.DecodeHeader(t,r);i.m_iterator.m_count;t.GetNCoordIndex()>0&&t.SetCoordIndex(new Uint32Array(3*t.GetNCoordIndex())),t.GetNCoord()>0&&t.SetCoord(new Float32Array(3*t.GetNCoord())),t.GetNNormal()>0&&t.SetNormal(new Float32Array(3*t.GetNNormal()));for(var n=t.GetNumFloatAttributes(),o=0;n>o;++o)t.GetNFloatAttribute(o)>0&&t.SetFloatAttribute(o,new Float32Array(t.GetFloatAttributeDim(o)*t.GetNFloatAttribute(o)));for(var a=t.GetNumIntAttributes(),o=0;a>o;++o)t.GetNIntAttribute(o)>0&&t.SetIntAttribute(o,new Int32Array(t.GetIntAttributeDim(o)*t.GetNIntAttribute(o)));i.DecodePlayload(t,r)},load:function(e,t){var r=this,i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(e){r.parse(i.response),t()},i.send(null)}},CLOUD.MaterialLoader=function(e){THREE.Loader.call(this,e)},CLOUD.MaterialLoader.prototype=Object.create(THREE.Loader.prototype),CLOUD.MaterialLoader.prototype.constructor=CLOUD.MaterialLoader,CLOUD.MaterialLoader.prototype.setBaseUrl=function(e){this.baseUrl=e},CLOUD.MaterialLoader.prototype.setCrossOrigin=function(e){this.crossOrigin=e},CLOUD.MaterialLoader.prototype.load=function(e,t,r){function i(e){var t=new THREE[e.type](e.parameters);return void 0===CloudShaderLib?t:("MeshPhongMaterial"===e.type&&(t.type="phong_cust_clip",t.uniforms=CloudShaderLib.phong_cust_clip.uniforms,t.vertexShader=CloudShaderLib.phong_cust_clip.vertexShader,t.fragmentShader=CloudShaderLib.phong_cust_clip.fragmentShader),void 0!==e.parameters.mapDiffuse&&(t.map=n.loadTexture(o+"/"+e.parameters.mapDiffuse)),void 0!==e.parameters.mapSpecular&&(t.specularMap=n.loadTexture(o+"/"+e.parameters.mapSpecular)),t)}var n=this,o=this.baseUrl,a=new THREE.XHRLoader;a.load(e,function(e){var n=JSON.parse(e);for(var o in n.materials){var a=n.materials[o];void 0!==a.parameters.opacity&&a.parameters.opacity<1&&(a.parameters.transparent=!0),void 0!=a.parameters.side&&"double"===a.parameters.side&&(a.parameters.side=THREE.DoubleSide),void 0!==a.parameters.ambient&&delete a.parameters.ambient,material=i(a),material.name=o,r.materials[o]=material}t()})},CLOUD.MaterialLoader.prototype.loadTexture=function(e,t,r,i,n){var o,a=THREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null!==a?o=a.load(e,r):(o=new THREE.Texture,a=new THREE.ImageLoader(s),a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){o.image=CLOUD.MaterialLoader.ensurePowerOfTwo(e),o.needsUpdate=!0,r&&r(o)},i,n)),void 0!==t&&(o.mapping=t),o},CLOUD.MaterialLoader.ensurePowerOfTwo=function(e){if(!THREE.Math.isPowerOfTwo(e.width)||!THREE.Math.isPowerOfTwo(e.height)){var t=document.createElement("canvas");t.width=CLOUD.MaterialLoader.nextHighestPowerOfTwo(e.width),t.height=CLOUD.MaterialLoader.nextHighestPowerOfTwo(e.height);var r=t.getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},CLOUD.MaterialLoader.nextHighestPowerOfTwo=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1},CLOUD.MpkLoader=function(e){THREE.Loader.call(this,e)},CLOUD.MpkLoader.prototype=Object.create(THREE.Loader.prototype),CLOUD.MpkLoader.prototype.constructor=CLOUD.MpkLoader,CLOUD.MpkLoader.prototype.load=function(e,t,r,i,n){var o=r.mpkUrl(e),a=this;if(t.binaryData)return a.parseS3D(t.binaryData,t,r,i),n(),void(t.binaryData=null);var s=CLOUD.GlobalData.UseArrayBuffer,h=new XMLHttpRequest;h.onreadystatechange=function(){4===h.readyState&&(200!==h.status&&0!==h.status||(a.parseS3D(h.response,t,r,i),n(),h=null))},h.open("GET",o,!0),s?h.responseType="arraybuffer":(h.setRequestHeader("Content-Type","text/plain; charset=x-user-defined"),h.overrideMimeType("text/plain; charset=x-user-defined")),h.send(null)},CLOUD.MpkLoader.prototype.parseS3D=function(e,t,r,i){var n=t.symbol;for(var o in t.items)if(!r.cache.geometries[o]){var a=t.items[o],s=new S3D.S3DLoader;s.parse(e.slice(a.offset,a.offset+a.size)),this.createModel(s.index(),s.position(),o,n,i),s.destroy(),s=null}},CLOUD.MpkLoader.prototype.createModel=function(e,t,r,i,n){var o=new THREE.BufferGeometry;o.refCount=0,o.name=r,i&&(o.symobl=i);var a=new THREE.BufferAttribute(e,1);a.setDynamic(!0),o.setIndex(a),o.addAttribute("position",new THREE.BufferAttribute(t,3)),o.computeVertexNormals();for(var s in o.attributes)o.attributes[s].setDynamic(!0);n(o)},CLOUD.SubSceneLoader=function(e,t){this.manager=e,this.crossOrigin=t},CLOUD.SubSceneLoader.prototype={constructor:CLOUD.SubSceneLoader,update:function(e){function t(e){for(var n in e){var o=e[n];if(o instanceof CLOUD.Mesh){var a=o.meshId;if(void 0===a)continue;if(!o.geometry||void 0===o.geometry.refCount){var s=r.geometries[a];if(s)o.updateGeometry(s);else{var h=i.meshIds[a];i.addDelayLoadMesh(h,{meshNode:o})}}}else t(o.children)}}var r=e.client.cache,i=e.client;t(e.children),i.processMpkTasks()},parse:function(e,t){function r(e,t,a,s,h){for(var c in t){var l=t[c];void 0!==a&&(l.userId=a),l.userData&&(s=l.userData);var u;if("MpkNode"==l.nodeType)r(e,l.nodes);else if("CellNode"==l.nodeType)console.log("Should not call here!");else if("SceneNode"==l.nodeType)console.log("Should not call here!");else if("GroupNode"==l.nodeType)u=new CLOUD.Group,CLOUD.GeomUtil.parseNodeProperties(u,l,c,h),r(e,l.children,a,s,u.matrix);else if("MeshNode"==l.nodeType){if(1==n.bOutOfLimitation)continue;var d=i.findMaterial(l.materialId,!1);u=new CLOUD.Mesh(CLOUD.GeomUtil.EmptyGeometry,d,l.meshId),CLOUD.GeomUtil.parseNodeProperties(u,l,c,h),u.userData=s,e.add(u)}else if("PGeomNode"==l.nodeType){var d=i.findMaterial(l.materialId,!1);u=u=CLOUD.GeomUtil.parsePGeomNodeInstance(l,d,h),u&&(u.name=l.userId,u.userData=s,e.add(u))}else if("SymbolInstance"==l.nodeType){var m=i.findSymbol(l.symbolId);if(m)if("GroupNode"===m.nodeType)u=new CLOUD.Group,CLOUD.GeomUtil.parseNodeProperties(u,l,c,h),r(e,m.children,l.userId,s,u.matrix);else if("MeshNode"===m.nodeType){var p=l.materialId||m.materialId,d=i.findMaterial(p,!1);u=new CLOUD.Mesh(CLOUD.GeomUtil.EmptyGeometry,d,m.meshId),CLOUD.GeomUtil.parseNodeProperties(u,l,c,h),u.userData=s,e.add(u)}else if("PGeomNode"===m.nodeType){var p=l.materialId||m.materialId,d=i.findMaterial(p,!1),E=new THREE.Matrix4;l.matrix&&E.fromArray(l.matrix),h&&E.multiplyMatrices(h,E.clone()),u=CLOUD.GeomUtil.parsePGeomNodeInstance(m,d,E),u&&(u.name=a,u.userData=s,e.add(u))}}else if("InstancedMeshNode"==l.nodeType){if(n.bOutOfLimitation===!0)continue;var d=i.findMaterial(l.materialId,!0);u=new CLOUD.Mesh(void 0,d,l.meshId),CLOUD.GeomUtil.parseNodeProperties(u,l,c),e.add(u)}u&&(u.updateMatrixWorld(!0),u.level=o)}}var i=e.client,n=i.cache,o=e.level;t.children&&(e.embedded=!0,r(e,t.children))}},CLOUD.SceneLoader=function(e,t){this.manager=e,this.crossOrigin=t,this.loader=new THREE.XHRLoader(e)},CLOUD.SceneLoader.prototype={constructor:CLOUD.SceneLoader,load:function(e,t,r,i,n){var o=this;if(r.subSceneItems){var a=r.subSceneItems[e];if(a)return o.parse(a,e,t,r,i,n),void delete r.subSceneItems[e]}var s=this.loader;s.setCrossOrigin(this.crossOrigin),s.load(r.sceneUrl(e),function(a){o.parse(JSON.parse(a),e,t,r,i,n)})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t,r,i,n,o){function a(e,t){var r=f.geometries[t];if(r)e.updateGeometry(r);else{var n=i.meshIds[t];i.addDelayLoadMesh(n,{meshNode:e})}}function s(e,t,r){var i=f.geometries[t];if(i){var n=CLOUD.GeomUtil.createInstancedBufferGeometry(i,r);e.updateGeometry(n)}else p.push({meshNode:e,isInstanced:!0})}function h(e,t,n,o,u,d){for(var p in t){var E=t[p];void 0!==o&&(E.userId=o),E.userData&&(u=E.userData,u.categoryId||(u.categoryId="0"));var T;if("MpkNode"!=E.nodeType){if("CellNode"==E.nodeType){if(T=new CLOUD.Cell,E.leaf&&(T.leaf=E.leaf),CLOUD.GeomUtil.parseNodeProperties(T,E,p),T.worldBoundingBox=T.boundingBox.clone(),T.worldBoundingBox.applyMatrix4(m.manager.getGlobalTransform()),T.level=E.level,T.deep=E.deep,E.order&&(T.out=1),void 0===E.deep&&T.out&&(r.innerBoundingBox.expandByPoint(T.worldBoundingBox.min),r.innerBoundingBox.expandByPoint(T.worldBoundingBox.max)),CLOUD.GlobalData.ShowCellBox){var v=255;v<<=5*n;var g=new CLOUD.BBoxNode(T.boundingBox,v);CLOUD.Utils.parseTransform(g,E),T.add(g)}h(T,E.children,n+1),e.add(T)}else if("SceneNode"==E.nodeType)E.sceneType==CLOUD.SCENETYPE.Child&&(T=new CLOUD.SubScene,CLOUD.GeomUtil.parseNodeProperties(T,E,p),T.leaf=1,T.client=i,T.client=i,CLOUD.GeomUtil.parseSceneNode(T,E,m.manager,n),e.add(T),m.manager.subSceneLoader.parse(T,E));else if("GroupNode"==E.nodeType){T=new CLOUD.Group,CLOUD.GeomUtil.parseNodeProperties(T,E,p,d);var R=o||E.userId;h(e,E.children,n+1,R,u,T.matrix)}else if("MeshNode"==E.nodeType){if(1==f.bOutOfLimitation)continue;var _=i.findMaterial(E.materialId,!1);T=new CLOUD.Mesh(CLOUD.GeomUtil.EmptyGeometry,_,E.meshId),CLOUD.GeomUtil.parseNodeProperties(T,E,p,d),T.userData=u,a(T,E.meshId),e.add(T)}else if("PGeomNode"==E.nodeType){var _=i.findMaterial(E.materialId,!1);T=CLOUD.GeomUtil.parsePGeomNodeInstance(E,_,d),T&&(T.name=E.userId,T.userData=u,e.add(T))}else if("SymbolInstance"==E.nodeType){var x=i.findSymbol(E.symbolId);if(x)if("GroupNode"===x.nodeType)T=new CLOUD.Group,CLOUD.GeomUtil.parseNodeProperties(T,E,p,d),h(e,x.children,n+1,E.userId,u,T.matrix);else if("MeshNode"===x.nodeType){var b=E.materialId||x.materialId,_=i.findMaterial(b,!1);T=new CLOUD.Mesh(CLOUD.GeomUtil.EmptyGeometry,_,x.meshId),CLOUD.GeomUtil.parseNodeProperties(T,E,p,d),T.userData=u,a(T,x.meshId),e.add(T)}else if("PGeomNode"===x.nodeType){var b=E.materialId||x.materialId,_=i.findMaterial(b,!1),H=new THREE.Matrix4;E.matrix&&H.fromArray(E.matrix),d&&H.multiplyMatrices(d,H.clone()),T=CLOUD.GeomUtil.parsePGeomNodeInstance(x,_,H),T&&(T.name=o,T.userData=u,e.add(T))}}else if("InstancedMeshNode"==E.nodeType){if(f.bOutOfLimitation===!0)continue;var _=i.findMaterial(E.materialId,!0);T=new CLOUD.Mesh(void 0,_,E.meshId),CLOUD.GeomUtil.parseNodeProperties(T,E,p),s(T,E.meshId,E),e.add(T)}T&&(T.updateMatrixWorld(!0),T.renderOrder=y),0==n&&c()}else m.manager.loadMpk(E.mpkId,i,l(e,E,n+1))}}function c(e){v-=1,u()}function l(e,t,r){return function(){h(e,t.nodes,r),v-=1,u()}}function u(){var e={total:T,loaded:T-v};n&&m.manager.dispatchEvent({type:CLOUD.EVENTS.ON_LOAD_PROGRESS,progress:e}),0==v&&(v-=1,d(),o(f))}function d(){function e(t){if(t instanceof CLOUD.Cell&&(t.leaf===!0||1===t.leaf)){for(var r={},i=t.children,n=0,o=i.length;o>n;++n){var a=i[n],s=a.userData.sceneId;if(void 0===s)console.warn("no scene id!");else{var h=r[s];void 0===h&&(h=new CLOUD.Group,h.fileId=s,r[s]=h),h.children.push(a)}}var c=[];for(var l in r)c.push(r[l]);return void(t.children=c)}for(var i=t.children,n=0,o=i.length;o>n;++n)e(i[n])}i.processMpkTasks(),i.needGroupBySceneId()&&e(g)}var m=this,p=[],E=e,f=i.cache,T=E.metadata.count;if(0>=T)return void o(f);var v=T,g=CLOUD.Utils.parseRootNode(r,E);g.sceneId=t,g.client=i,g.subSceneRoot=!0;var y=r.level;if(void 0===y&&(y=CLOUD.EnumObjectLevel.Large),n&&m.manager.dispatchEvent({type:CLOUD.EVENTS.ON_LOAD_START,sceneId:t}),E.mpks){for(var R=E.mpks.length,_=0,R=E.mpks.length;R>_;++_)i.addDelayLoadMesh(E.mpks[_],null);var x=!1;T+=R,i.processMpkTasks(function(e,t){if(void 0!==e&&n){
var r=t-e,i={total:T,loaded:r};m.manager.dispatchEvent({type:CLOUD.EVENTS.ON_LOAD_PROGRESS,progress:i})}0===e&&(x||(v=T,v-=R,x=!0,h(g,E.objects,0),u()))})}else h(g,E.objects,0),u()}},CLOUD.IndexLoader=function(e,t){this.taskCount=0,this.crossOrigin=e,this.maxTaskCount=3,this.manager=t},CLOUD.IndexLoader.prototype={constructor:CLOUD.IndexLoader,load:function(e,t){function r(){i.taskCount++,i.taskCount>=i.maxTaskCount&&t()}var i=this,n=new THREE.XHRLoader(i.manager);n.setCrossOrigin(this.crossOrigin),n.load(e.projectUrl(),function(t){var o=JSON.parse(t);if(e.index=o,void 0===e.slave&&o.view){var a=i.manager.scene.rootNode;CLOUD.Utils.parseTransform(a,o.view),a.updateMatrixWorld(!0),a.matrixAutoUpdate=!1,CLOUD.GlobalData.SubSceneVisibleDistance=CLOUD.GlobalData.LengthUnitScale*a.scale.x,console.log(CLOUD.GlobalData.SubSceneVisibleDistance)}o.metadata.symbol?n.load(e.symbolIndexUrl(),function(t){e.symbolIndex=JSON.parse(t),r()}):r()});var o=new CLOUD.MaterialLoader;o.setBaseUrl(e.getTexturePath()),o.setCrossOrigin(this.crossOrigin),o.load(e.materialUrl("material"),function(){r()},e.cache),n.load(e.mpkIndexUrl(),function(t){e.mkpIndex=JSON.parse(t);for(var i in e.mkpIndex.items){var n=e.mkpIndex.items[i].items;for(var o in n)e.meshIds[o]=i}r()})},setCrossOrigin:function(e){this.crossOrigin=e}},CLOUD.SceneBoxLoader=function(e,t){this.manager=e,this.crossOrigin=t},CLOUD.SceneBoxLoader.prototype={constructor:CLOUD.SceneBoxLoader,load:function(e,t,r,i){var n=this,o=new THREE.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(r.sceneUrl(e),function(o){n.parse(e,JSON.parse(o),t,r,i)})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t,r,i,n){function o(e,t){m++;for(var r in t){0==m&&--u;var i,n=t[r];if("MpkNode"==n.nodeType)o(e,n.nodes);else if("CellNode"==n.nodeType){var a=255;n.leaf&&(a=65280);var h=CLOUD.Utils.box3FromArray(n.bbox);i=new CLOUD.BBoxNode(h,a),CLOUD.Utils.parseTransform(i,n),2==n.deep&&n.leaf&&d.add(i),i.worldBoundingBox=h.clone(),i.worldBoundingBox.applyMatrix4(s.manager.getGlobalTransform()),void 0===n.leaf&&o(i,n.children)}}m--}function a(){var e={total:l,loaded:l-u};s.manager.dispatchEvent({type:CLOUD.EVENTS.ON_LOAD_PROGRESS,progress:e}),0==u&&(u-=1,n(c))}var s=this,h=t,c=i.cache,l=h.metadata.count;if(0>=l)return void n(c);var u=l,d=CLOUD.Utils.parseRootNode(r,h);this.manager.dispatchEvent({type:CLOUD.EVENTS.ON_LOAD_START,sceneId:e});var m=-1;o(d,h.objects),d.updateMatrixWorld(!0),a()}},CLOUD.TaskWorker=function(e){this.MaxThreadCount=e||6;var t=this;t.todoList={},t.todoCount=0,t.doingCount=0,this.hasTask=function(){return t.todoCount>0},this.addItem=function(e,r){t.todoList[e]=r,t.todoCount++},this.run=function(e,t,r){function i(e){if(!(e>=h)){var r=o[e];t(r,e+c,i)}}var n=this;if(!(n.doingCount>0)){var o=[],a=n.todoList;for(var s in a)o.push(a[s]);n.todoList={},n.todoCount=0;var h=o.length;if(0!=h){r&&o.sort(r),h=Math.min(h,50);var c=Math.min(this.MaxThreadCount,h);n.doingCount=h;for(var l=0;c>l;++l)i(l)}}}},CLOUD.FileTaskWorker=function(e){this.MaxThreadCount=e||6;this.doingCount=0,this.run=function(e,t,r){function i(e){if(e>=o)return void(s.doingCount<1&&r());var a=n[e];t(a,e+h,i)}var n=[],o=0;for(var a in e)n[o]=a,++o;if(0!=o){var s=this;s.doingCount=o;for(var h=Math.min(this.MaxThreadCount,o),c=0;h>c;++c)i(c)}}},CLOUD.MpkNodeTaskWorker=function(e){this.MaxThreadCount=e||6;this.todoList={},this.doingCount=0,this.listners=[],this.addItem=function(e,t){return void 0===e?void console.log("undefined mpkId"):(void 0===this.todoList[e]&&(this.todoList[e]=[]),void this.todoList[e].push(t))},this.run=function(e,t){function r(o){if(o>=s)if(a.doingCount<1){t(0,s);for(var l=0,u=h.length;u>l;++l)h[l](0,s);h=[],a.run(e,function(){})}else t(a.doingCount,s);else{o>=c&&t(a.doingCount,s);var d=n[o];e(d,i[d],o+c,r)}}if(this.doingCount>0)return void this.listners.push(t);var i=this.todoList;this.todoList={};var n=[];for(var o in i)n.push(o);var a=this,s=n.length;if(0==s)return void t();var h=this.listners;this.listners=[],a.doingCount=s;for(var c=Math.min(this.MaxThreadCount,s),l=0;c>l;++l)r(l)}},CLOUD.TaskManager=function(e){this.manager=e,this.mpkWorker=new CLOUD.MpkNodeTaskWorker(8),this.sceneWorker=new CLOUD.TaskWorker(8)},CLOUD.TaskManager.prototype={constructor:CLOUD.TaskManager,addMpkTask:function(e,t){this.mpkWorker.addItem(e,t)},loadSceneFiles:function(e,t){function r(t,r,i){var o=e.sceneUrl(t),a=new THREE.XHRLoader;a.setCrossOrigin(!0),a.load(o,function(e){--s.doingCount,n[t]=JSON.parse(e),i(r)})}var i=e.index.metadata.subScenes;if(void 0!=i){e.subSceneItems={};for(var n=e.subSceneItems,o=0,a=i.length;a>o;++o)n[i[o]]=null;var s=new CLOUD.FileTaskWorker(8);s.run(n,r,t)}},loadMpkFiles:function(e,t){function r(t,r,a){var s=e.mpkUrl(t),h=new XMLHttpRequest;h.onreadystatechange=function(){4===h.readyState&&(200!==h.status&&0!==h.status||(--o.doingCount,i[t].binaryData=h.response,a(r)))},h.open("GET",s,!0),n?h.responseType="arraybuffer":(h.setRequestHeader("Content-Type","text/plain; charset=x-user-defined"),h.overrideMimeType("text/plain; charset=x-user-defined")),h.send(null)}var i=e.mkpIndex.items,n=!0,o=new CLOUD.FileTaskWorker(8);o.run(i,r,t)},processMpkTasks:function(e,t){function r(e,t){if(null!==t){var r=e.cache.geometries[t.meshNode.meshId];r?t.meshNode.updateGeometry(r):console.log("err: "+t+" may be in other mpk")}}function i(t,i,o,a){n.manager.loadMpk(t,e,function(){void 0==i&&console.log("error");for(var t=0,s=i.length;s>t;++t)r(e,i[t]);--n.mpkWorker.doingCount,a(o)})}var n=this;this.mpkWorker.run(i,t||function(){})},addSceneTask:function(e){this.sceneWorker.addItem(e.sceneId,e)},sort:function(e,t){return e.distance-t.distance},processSceneTasks:function(e,t){var r=this;if(r.sceneWorker.hasTask()){var i=r.manager.sceneLoader;r.sceneWorker.run(t,function(t,n,o){var a=t;return void 0===a&&console.warn("err"),a.loaded?(--r.sceneWorker.doingCount,void o(n)):void(0==a.children.length?(a.loaded=!0,i.load(a.sceneId,a,e,!1,function(){--r.sceneWorker.doingCount,a.visible=!0,o(n)})):(r.manager.subSceneLoader.update(a),a.visible=!0,--r.sceneWorker.doingCount,o(n)))},r.sort)}}},CLOUD.ModelManager=function(){THREE.LoadingManager.call(this),this.onError=function(){console.log("error")},this.scene=new CLOUD.Scene,this.headLamp=new THREE.DirectionalLight(12040142,.8),this.assistLamp=new THREE.DirectionalLight(3355443,.8);var e=new THREE.HemisphereLight(16777215,16777215,.6);this.scene.add(e),this.scene.add(this.headLamp),this.scene.add(this.assistLamp),this.mpkLoader=new CLOUD.MpkLoader,this.sceneLoader=new CLOUD.SceneLoader(this,!0),this.boxLoader=new CLOUD.SceneBoxLoader(this,!0),this.subSceneLoader=new CLOUD.SubSceneLoader(this,!0),this.clients={},this.vertexCount=0,this.triangleCount=0,this.loading=!1,this.lightOffset=new THREE.Vector3(-1,-1,-1),this.lightOffset.normalize()},CLOUD.ModelManager.prototype=Object.create(THREE.LoadingManager.prototype),CLOUD.ModelManager.prototype.constructor=CLOUD.ModelManager,CLOUD.ModelManager.prototype.updateLights=function(e){var t=this.headLamp;t.position.copy(e.getWorldDirection()).multiplyScalar(-1),t.updateMatrixWorld(!0);var r=this.assistLamp;r.position.copy(t.position).add(this.lightOffset).normalize(),r.updateMatrixWorld()},CLOUD.ModelManager.prototype.prepareScene=function(e,t){this.scene.prepareScene(e),this.prepareResource(t)},CLOUD.ModelManager.prototype.collectionGarbage=function(){CLOUD.GlobalData.GarbageCollection&&this.scene.collectionGarbage()},CLOUD.ModelManager.prototype.getGlobalTransform=function(){return this.scene.rootNode.matrix},CLOUD.ModelManager.prototype.loadIndex=function(e,t){var r=this.clients[e.databagId];if(void 0!==r)return r;r=new CLOUD.Client(this,e.serverUrl,e.databagId),this.clients[e.databagId]=r;var i=0;for(var n in this.clients)i++;r.slave=i>1;var o=(this.sceneLoader,new CLOUD.IndexLoader(!0,this));return o.load(r,function(){t(r)}),r},CLOUD.ModelManager.prototype.load=function(e){var t=this;return this.loadIndex(e,function(r){t.loading=!0;var i=r.index.metadata.scenes[0];e.byBox?t.boxLoader.load(i,t.scene,r,function(e){}):t.sceneLoader.load(i,t.scene,r,!0,function(e){t.loadLinks(e,r)})})},CLOUD.ModelManager.prototype.loadLinks=function(e,t){var r=this,i=this.sceneLoader;t.linkSceneIdx=-1;var n=function(e){t.linkSceneIdx++;var o=t.index.metadata.linkScenes;if(void 0==o||o.length<1)return r.loading=!1,void r.dispatchEvent({type:CLOUD.EVENTS.ON_LOAD_COMPLETE});if(t.linkSceneIdx<o.length){var a=o[t.linkSceneIdx];i.load(a,r.scene,t,!0,n)}else r.loading=!1,r.dispatchEvent({type:CLOUD.EVENTS.ON_LOAD_COMPLETE})};n(e)},CLOUD.ModelManager.prototype.loadMpk=function(e,t,r){var i=this.mpkLoader,n=t.mkpIndex.items[e];if(!n)return console.log("missing mpk "+e),void r();if(n.status){if(n.status==CLOUD.MPKSTATUS.LOADED)return void r();if(n.status==CLOUD.MPKSTATUS.LOADING)return void n.addEventListener("ON_MPK_LOADED",function(){r()})}THREE.EventDispatcher.prototype.apply(n),n.status=CLOUD.MPKSTATUS.LOADING;var o=this;i.load(e,n,t,function(e){o.vertexCount+=e.getAttribute("position").count,o.triangleCount+=e.getIndex().count/3,t.cache.geometries[e.name]=e},function(){n.status=CLOUD.MPKSTATUS.LOADED,r(),n.dispatchEvent({type:"ON_MPK_LOADED"}),n._listeners={},n.items=null})},CLOUD.ModelManager.prototype.prepareResource=function(e){for(var t in this.clients){var r=this.clients[t];r.processSceneTasks(e)}},THREE.EventDispatcher.prototype.apply(CLOUD.ModelManager.prototype),CLOUD.EditorManager=function(e){function t(e){u.editor.touchmove(e)}function r(e){u.editor.touchstart(e)}function i(e){u.editor.touchend(e)}function n(e){u.editor.onKeyDown(e)}function o(e){u.editor.onKeyUp(e)}function a(e){u.editor.onMouseWheel(e)}function s(e){var t=u.isAnimating();t||(d?(u.isUpdateRenderList=!1,u.editor.onMouseMove(e)):(p("move",e),E("move",e)))}function h(e){var t=u.isAnimating();u.isUpdateRenderList=!0;var r=d;d=!1;var i=m;m=!1,t||(r?u.editor.onMouseUp(e):i||(p("up",e),E("up",e)))}function c(e){var t=u.editor.domElement.querySelector("#cloud-main-canvas");t&&t.focus(),m=!0,d=!1,u.isUpdateRenderList=!1;var r=u.isAnimating();if(!r){var i=p("down",e),n=E("down",e);i||n||(d=!0,u.editor.onMouseDown(e))}}function l(e){u.editor.onMouseDoubleClick(e)}this.editor=null,this.animationDuration=500,this.animationFrameTime=13,this.enableAnimation=!0,this.isUpdateRenderList=!0;var u=this,d=!1,m=!1,p=e.viewHouse,E=e.miniMap;this.registerDomEventListeners=function(e){e.addEventListener("contextmenu",function(e){e.preventDefault()},!1),e.addEventListener("mousedown",c,!1),e.addEventListener("mousewheel",a,!1),e.addEventListener("DOMMouseScroll",a,!1),e.addEventListener("dblclick",l,!1),window.addEventListener("mousemove",s,!1),window.addEventListener("mouseup",h,!1),e.addEventListener("touchstart",r,!1),e.addEventListener("touchend",i,!1),e.addEventListener("touchmove",t,!1),e.addEventListener("keydown",n,!1),e.addEventListener("keyup",o,!1);var d=u.editor.domElement.querySelector("#cloud-main-canvas");d&&d.focus()},this.unregisterDomEventListeners=function(e){e.removeEventListener("contextmenu",function(e){e.preventDefault()},!1),e.removeEventListener("mousedown",c,!1),e.removeEventListener("mousewheel",a,!1),e.removeEventListener("DOMMouseScroll",a,!1),e.removeEventListener("dblclick",l,!1),window.removeEventListener("mousemove",s,!1),window.removeEventListener("mouseup",h,!1),e.removeEventListener("touchstart",r,!1),e.removeEventListener("touchend",i,!1),e.removeEventListener("touchmove",t,!1),e.removeEventListener("keydown",n,!1),e.removeEventListener("keyup",o,!1)}},CLOUD.EditorManager.prototype={constructor:CLOUD.EditorManager,updateEditor:function(e){void 0!==this.clipEditor&&this.clipEditor.update(e)},setEditor:function(e){this.editor!==e&&(null!==this.editor&&this.editor.onExistEditor(),this.editor=e)},getClipEditor:function(e){return void 0===this.clipEditor&&(this.clipEditor=new CLOUD.ClipEditor(e.cameraEditor,e.getScene(),e.domElement)),this.clipEditor},setPickMode:function(e){var t=this;if(void 0===this.pickEditor){var r=new CLOUD.PickEditor(e.cameraEditor,e.getScene(),e.domElement);r.onObjectSelected=function(t){e.modelManager.dispatchEvent({type:CLOUD.EVENTS.ON_SELECTION_CHANGED,intersect:t})},this.pickEditor=r}t.setEditor(this.pickEditor)},setRectPickMode:function(e){var t=this;if(void 0===this.rectPickEditor){var r=new CLOUD.RectPickEditor(e.cameraEditor,e.getScene(),e.domElement);r.onObjectSelected=function(){e.modelManager.dispatchEvent({type:CLOUD.EVENTS.ON_SELECTION_CHANGED})},r.onUpdateUI=function(t){e.modelManager.dispatchEvent({type:CLOUD.EVENTS.ON_UPDATE_SELECTION_UI,data:t})},this.rectPickEditor=r}t.setEditor(this.rectPickEditor)},setOrbitMode:function(e){var t=this;void 0===this.orbitEditor&&(this.orbitEditor=new CLOUD.OrbitEditor(e.cameraEditor,e.getScene(),e.domElement)),t.setEditor(this.orbitEditor)},setZoomMode:function(e){var t=this;void 0===this.zoomEditor&&(this.zoomEditor=new CLOUD.ZoomEditor(e.cameraEditor,e.getScene(),e.domElement)),t.setEditor(this.zoomEditor)},setPanMode:function(e){var t=this;void 0===this.panEditor&&(this.panEditor=new CLOUD.PanEditor(e.cameraEditor,e.getScene(),e.domElement)),t.setEditor(this.panEditor)},setFlyMode:function(e,t){var r=this;void 0===this.flyEditor&&(this.flyEditor=new CLOUD.FlyEditor(t.cameraEditor,t.getScene(),t.domElement)),this.flyEditor.showControlPanel(e),this.flyEditor.activate(),r.setEditor(this.flyEditor)},isFlyMode:function(){return this.editor===this.flyEditor},setMarkerMode:function(e){var t=this;void 0===this.markerEditor&&(this.markerEditor=new CLOUD.MarkerEditor(e.cameraEditor,e.getScene(),e.domElement)),this.markerEditor.init(),t.setEditor(this.markerEditor)},setCommentMode:function(e){var t=this;void 0===this.commentEditor&&(this.commentEditor=new CLOUD.Extensions.CommentEditor(e.cameraEditor,e.getScene(),e.domElement)),this.commentEditor.init(),t.setEditor(this.commentEditor)},zoomIn:function(e,t){void 0===e&&(e=.1),0>e&&(e=0),t.cameraEditor.zoom(e)},zoomOut:function(e,t){void 0===e&&(e=.1),e>0?e*=-1:e=0,t.cameraEditor.zoom(e)},zoomAll:function(e){var t=e.getScene().worldBoundingBox(),r=e.camera.zoomToBBox(t);e.cameraEditor.updateCamera(r),e.render()},isAnimating:function(){return this.enableAnimation&&this.animator&&this.animator.isPlaying()},setStandardView:function(e,t){var r=t.camera;if(this.enableAnimation)this.animator||(this.animator=new CLOUD.CameraAnimator),this.animator.setDuration(this.animationDuration),this.animator.setFrameTime(this.animationFrameTime),this.animator.setStandardView(e,t);else{var i=this.getScene().worldBoundingBox(),n=r.setStandardView(e,i);n=t.camera.zoomToBBox(i),t.cameraEditor.updateCamera(n),t.render(),r.up.copy(THREE.Object3D.DefaultUp)}}},CloudViewer=function(){"use strict";function e(){i.setViewHouseVisibility(!0),i.zoomAll(),i.modelManager.removeEventListener(CLOUD.EVENTS.ON_LOAD_START,e)}function t(e,t){if(!i.viewHouse)return!1;var r=!1;switch(e){case"down":r=i.viewHouse.mouseDown(t,function(){});break;case"move":r=i.viewHouse.mouseMove(t,function(e){void 0!==e?i.cameraEditor.processRotate(e):i.cameraEditor.updateView()});break;case"up":r=i.viewHouse.mouseUp(t,function(e,t){void 0!==t&&i.cameraEditor.processRotate(t),void 0!==e&&null!==e&&i.setStandardView(e)})}return r}function r(e,t){var r=!1;for(var n in i.miniMaps){var o=i.miniMaps[n],a=!1;switch(e){case"down":a=o.mouseDown(t,function(){});break;case"move":a=o.mouseMove(t,function(){o.render()});break;case"up":a=o.mouseUp(t,function(e){i.cameraEditor.flyToPointWithParallelEye(e)})}a&&(r=!0)}return r}this.domElement=null,this.camera=null,this.renderer=null,this.requestRenderCount=0,this.rendering=!1,this.incrementRenderEnabled=!0,this.updateRenderListEnabled=!0,this.modelManager=new CLOUD.ModelManager,this.viewHouse=null,this.miniMaps={},this.defaultMiniMap=null,this.tmpBox=new THREE.Box3;var i=this;i.modelManager.addEventListener(CLOUD.EVENTS.ON_LOAD_START,e);var n={viewHouse:t,miniMap:r};this.editorManager=new CLOUD.EditorManager(n),this.isMobile=0;var o=navigator.userAgent;o.indexOf("Android")>-1?this.isMobile=1:o.indexOf("iPhone")>-1?this.isMobile=2:o.indexOf("Windows Phone")>-1&&(this.isMobile=3)},CloudViewer.prototype={constructor:CloudViewer,setImageResPath:function(e){CLOUD.GlobalData.TextureResRoot=e},getScene:function(){return this.modelManager.scene},setIncrementRenderEnabled:function(e){this.incrementRenderEnabled=e},setLimitFrameTime:function(e){this.incrementRenderEnabled&&(0>=e&&(e=30),CLOUD.GlobalData.LimitFrameTime=e)},resetIncrementRender:function(){this.incrementRenderEnabled&&this.renderer.resetIncrementRender()},calculateNearFar:function(){var e=this.getScene();if(null!=e.rootNode.boundingBox){var t=this.tmpBox;t.copy(e.rootNode.boundingBox),t.applyMatrix4(e.rootNode.matrix);var r=t.center(),i=this.camera.position,n=i.clone().sub(r),o=n.length();if(this.camera.inside)this.camera.cameraP.near=.1,this.camera.cameraP.far=2e4;else{var a=.001,s=(o*o+o*a)/((1<<24)*a);this.camera.cameraP.near=s,this.camera.cameraP.far=o+1e4}this.camera.cameraP.updateProjectionMatrix()}},render:function(){function e(n,o){var a=n;return function(){var n=t.renderer;n.autoClear=o;var s=n.IncrementRender(i,r);s||a!=t.requestRenderCount?(t.rendering=!1,a!=t.requestRenderCount?t.render():t.modelManager.collectionGarbage()):requestAnimationFrame(e(a,!1))}}if(++this.requestRenderCount,this.requestRenderCount>1e4&&(this.requestRenderCount=0),!this.rendering){this.rendering=!0;var t=this,r=this.camera;this.resetIncrementRender(),this.editorManager.updateEditor(r),this.modelManager.updateLights(r),t.updateRenderListEnabled?(t.renderer.setObjectListUpdateState(t.editorManager.isUpdateRenderList),t.editorManager.isUpdateRenderList&&(this.modelManager.prepareScene(r,this.requestRenderCount),this.calculateNearFar())):(this.modelManager.prepareScene(r,this.requestRenderCount),this.calculateNearFar());var i=this.getScene();t.renderer.setFilterObject(i.filter),t.incrementRenderEnabled&&t.renderer.IncrementRender?requestAnimationFrame(e(t.requestRenderCount,!0)):(t.renderer.autoClear=!0,t.renderer.render(i,r),t.rendering=!1),this.renderViewHouse(),this.renderMiniMap()}},setEditorDefault:function(){this.setPickMode()},clipToggle:function(e,t){var r=this.editorManager.getClipEditor(this);r.toggle(e,t),this.render()},clipVisible:function(e){var t=this.editorManager.getClipEditor(this);t.visible(e),this.render()},clipHorizon:function(e){var t=this.editorManager.getClipEditor(this);t.horizon(e),this.render()},clipSetPlane:function(e){var t=this.editorManager.getClipEditor(this);t.set(e),this.render()},clipRotPlaneX:function(e){var t=this.editorManager.getClipEditor(this);t.rotX(e),this.render()},clipRotPlaneY:function(e){var t=this.editorManager.getClipEditor(this);t.rotY(e),this.render()},backupClipplane:function(){var e=this.editorManager.getClipEditor(this);return e.backup()},restoreClipplane:function(e,t,r,i){var n=this.editorManager.getClipEditor(this);n.restore(e,t,r,i),this.render()},resize:function(e,t){this.camera.setSize(e,t),this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.resizeViewHouse(e,t,this.isMobile),this.resizeFlyCross(),this.resizeMarkerContainer(),this.render()},init:function(e){this.domElement=e;var t=e.offsetWidth,r=e.offsetHeight;this.renderer=new THREE.WebGLIncrementRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0});var i=this.renderer;i.setRenderTicket(0),i.setClearColor(0,0),i.setPixelRatio(window.devicePixelRatio),i.setSize(t,r),i.domElement.setAttribute("tabindex","0"),i.domElement.setAttribute("id","cloud-main-canvas"),e.appendChild(i.domElement),void 0===this.renderer.IncrementRender&&console.warn("THREE.WebGLIncrementRenderer.IncrementRender: undefined!");var n=new CLOUD.Camera(t,r,45,.1,20*CLOUD.GlobalData.SceneSize,-CLOUD.GlobalData.SceneSize,CLOUD.GlobalData.SceneSize);this.camera=n;var o=this;this.cameraEditor=new CLOUD.CameraEditor(this,n,e,function(){o.render()}),this.lookAt(new THREE.Vector3(.5*-CLOUD.GlobalData.SceneSize,.5*CLOUD.GlobalData.SceneSize,CLOUD.GlobalData.SceneSize),new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)),this.setPickMode(),this.editorManager.registerDomEventListeners(this.domElement)},registerDomEventListeners:function(){this.domElement&&this.editorManager.registerDomEventListeners(this.domElement)},unregisterDomEventListeners:function(){this.domElement&&this.editorManager.unregisterDomEventListeners(this.domElement)},registerEventListener:function(e,t){this.modelManager.addEventListener(e,t)},setMeshLimitation:function(e,t){CLOUD.GlobalData.MaxTriangle=e,CLOUD.GlobalData.MaxVertex=t},setUseArrayBuffer:function(e){CLOUD.GlobalData.UseArrayBuffer=e},load:function(e,t,r,i){var n=this;return r&&(CLOUD.GlobalData.ShowSubSceneBox=!0,CLOUD.GlobalData.ShowCellBox=!1),n.modelManager.load({databagId:e,serverUrl:t,debug:r,byBox:i})},loadIndex:function(e,t,r,i){var n=this;r&&(CLOUD.GlobalData.ShowSubSceneBox=!0,CLOUD.GlobalData.ShowCellBox=!1),n.modelManager.loadIndex({databagId:e,serverUrl:t,debug:r},i)},showScene:function(e,t){this.getScene().showSceneNodes(e,t)},setPickMode:function(){this.editorManager.setPickMode(this)},setRectPickMode:function(){this.editorManager.setRectPickMode(this)},setOrbitMode:function(){this.editorManager.setOrbitMode(this)},setZoomMode:function(){this.editorManager.setZoomMode(this)},setPanMode:function(){this.editorManager.setPanMode(this)},setFlyMode:function(e){this.editorManager.setFlyMode(e,this)},resizeFlyCross:function(){this.editorManager&&this.editorManager.editor===this.editorManager.flyEditor&&this.editorManager.flyEditor.resize()},zoomIn:function(e){this.editorManager.zoomIn(e,this)},zoomOut:function(e){this.editorManager.zoomOut(e,this)},zoomAll:function(){this.editorManager.zoomAll(this)},zoomToSelection:function(){var e=this.renderer.computeSelectionBBox();(null==e||e.empty())&&(e=this.getScene().worldBoundingBox());var t=this.camera.zoomToBBox(e);this.cameraEditor.updateCamera(t),this.render()},zoomToBBox:function(e){e?e.applyMatrix4(this.getScene().rootNode.matrix):e=this.getScene().worldBoundingBox();var t=this.camera.zoomToBBox(e);this.cameraEditor.updateCamera(t),this.render()},setStandardView:function(e){this.editorManager.setStandardView(e,this)},lookAt:function(e,t,r){var i=new THREE.Vector3;i.subVectors(t,e),this.camera.LookAt(t,i,r),this.cameraEditor.updateCamera(t),this.render()},transformCamera:function(e){return CLOUD.CameraUtil.transformCamera(e,this.modelManager.scene)},getCamera:function(){return this.cameraEditor.getCameraInfo()},setCamera:function(e){var t=CLOUD.CameraUtil.parseCameraInfo(e);this.lookAt(t.position,t.target,t.up)},clearAll:function(){this.getScene().clearAll()},canvas2image:function(){var e="image/png";this.render();var t=this.renderer.domElement.toDataURL(e);return t},getFilters:function(){return this.getScene().filter},disableLoD:function(){CLOUD.GlobalData.SubSceneVisibleLOD=1e5,CLOUD.GlobalData.CellVisibleLOD=1e5},adjustSceneLoD:function(e){var t=e.length,r=0;if(t>0){var i=this.modelManager.clients;for(var n in i){var o=i[n].index.sceneNodeCounter;if(o)for(var a=0;t>a;++a){var s=o[e[a]];void 0!==s&&(r+=s)}}}0==r?(CLOUD.GlobalData.SubSceneVisibleLOD=10,CLOUD.GlobalData.CellVisibleLOD=15):1e4>r?(CLOUD.GlobalData.SubSceneVisibleLOD=800,CLOUD.GlobalData.CellVisibleLOD=800,CLOUD.GlobalData.ScreenCullLOD=1e-4,CLOUD.GlobalData.GarbageCollection=!1):1e5>r?(CLOUD.GlobalData.SubSceneVisibleLOD=200,CLOUD.GlobalData.CellVisibleLOD=500,CLOUD.GlobalData.ScreenCullLOD=1e-4,CLOUD.GlobalData.GarbageCollection=!1):2e5>r?(CLOUD.GlobalData.SubSceneVisibleLOD=50,CLOUD.GlobalData.CellVisibleLOD=100,CLOUD.GlobalData.ScreenCullLOD=2e-4,CLOUD.GlobalData.GarbageCollection=!0):(CLOUD.GlobalData.SubSceneVisibleLOD=10,CLOUD.GlobalData.CellVisibleLOD=15,CLOUD.GlobalData.ScreenCullLOD=2e-4,CLOUD.GlobalData.GarbageCollection=!0)},initViewHouse:function(e){this.viewHouse||(this.viewHouse=new CLOUD.ViewHouse(this)),this.setViewHouseVisibility(!1),e=e||this.domElement,e&&this.viewHouse.init(e)},setViewHouseVisibility:function(e){this.viewHouse&&(this.viewHouse.visible=e)},renderViewHouse:function(){this.viewHouse&&this.viewHouse.render()},resizeViewHouse:function(e,t,r){this.viewHouse&&this.viewHouse.resize(e,t,r)},createMiniMap:function(e,t,r,i,n,o){var a=this.miniMaps[e];a||(a=this.miniMaps[e]=new CLOUD.MiniMap(this,o)),t=t||this.domElement,t&&a.init(t,r,i,n),this.defaultMiniMap||(this.defaultMiniMap=this.miniMaps[e])},removeMiniMap:function(e){var t=this.miniMaps[e];t&&t.removeMiniMap()},appendMiniMap:function(e){var t=this.miniMaps[e];t&&t.appendMiniMap()},getMiniMap:function(e){return this.miniMaps[e]},renderMiniMap:function(){for(var e in this.miniMaps){var t=this.miniMaps[e];t&&t.render()}},setFloorPlaneData:function(e){CLOUD.MiniMap.setFloorPlaneData(e)},generateFloorPlane:function(e){var t=this.miniMaps[e];t&&t.generateFloorPlane()},setAxisGridData:function(e,t){CLOUD.MiniMap.setAxisGridData(e)},generateAxisGrid:function(e){var t=this.miniMaps[e];t&&t.generateAxisGrid()},showAxisGrid:function(e,t){var r=this.miniMaps[e];r&&(t?r.showAxisGird():r.hideAxisGird())},showAxisGridNumber:function(e,t){var r=this.miniMaps[e];r&&r.showAxisGridNumber(t)},enableAxisGridEvent:function(e,t){var r=this.miniMaps[e];r&&r.enableMouseEvent(t)},enableMiniMapCameraNode:function(e,t){var r=this.miniMaps[e];r&&r.enableCameraNode(t)},flyBypAxisGridNumber:function(e,t,r){var i=this.miniMaps[e];i&&i.flyByAxisGridNumber(t,r)},setMarkerMode:function(){this.editorManager.setMarkerMode(this)},zoomToSelectedMarkers:function(){if(this.editorManager.markerEditor&&this.editorManager.editor===this.editorManager.markerEditor){var e=this.editorManager.markerEditor.calcBoundingBox();e&&this.zoomToBBox(e),this.editorManager.markerEditor.update()}},editMarkerBegin:function(){this.editorManager.markerEditor&&this.editorManager.editor===this.editorManager.markerEditor&&this.editorManager.markerEditor.editBegin()},editMarkerEnd:function(){this.editorManager.markerEditor&&this.editorManager.editor===this.editorManager.markerEditor&&this.editorManager.markerEditor.editEnd()},setMarkerState:function(e){this.editorManager.markerEditor&&this.editorManager.editor===this.editorManager.markerEditor&&this.editorManager.markerEditor.setMarkerState(e)},loadMarkers:function(e){this.editorManager.markerEditor&&this.editorManager.editor===this.editorManager.markerEditor&&this.editorManager.markerEditor.loadMarkers(e)},getMarkerInfoList:function(){return this.editorManager.markerEditor&&this.editorManager.editor===this.editorManager.markerEditor?this.editorManager.markerEditor.getMarkerInfoList():null},resizeMarkerContainer:function(){return this.editorManager.markerEditor&&this.editorManager.editor===this.editorManager.markerEditor?this.editorManager.markerEditor.update():null},setCommentMode:function(){this.editorManager.setCommentMode(this)},zoomToSelectedComments:function(){if(this.editorManager.commentEditor&&this.editorManager.editor===this.editorManager.commentEditor){var e=this.editorManager.commentEditor.calcBoundingBox();e&&this.zoomToBBox(e),this.editorManager.commentEditor.update()}},editCommentBegin:function(){this.editorManager.commentEditor&&this.editorManager.editor===this.editorManager.commentEditor&&this.editorManager.commentEditor.editBegin()},editCommentEnd:function(){this.editorManager.commentEditor&&this.editorManager.editor===this.editorManager.commentEditor&&this.editorManager.commentEditor.editEnd()},setCommentType:function(e){this.editorManager.commentEditor&&this.editorManager.editor===this.editorManager.commentEditor&&this.editorManager.commentEditor.setCommentType(e)},loadComments:function(e){this.editorManager.commentEditor&&this.editorManager.editor===this.editorManager.commentEditor&&this.editorManager.commentEditor.loadComments(e)},getCommentInfoList:function(){return this.editorManager.commentEditor&&this.editorManager.editor===this.editorManager.commentEditor?this.editorManager.commentEditor.getCommentInfoList():null},resizeCommentContainer:function(){return this.editorManager.commentEditor&&this.editorManager.editor===this.editorManager.commentEditor?this.editorManager.commentEditor.update():null}},function(e){window.bimView=function(t){var r=this,i={type:"model",element:"",etag:"",sourceId:"",projectId:""};r.subscribers={};var n=e.extend({},i,t);return"string"==typeof n.element&&(n.element=e(n.element)),n.element?(n._dom=r._dom={bimBox:e('<div class="bim"></div>'),loading:e('<div class="loading"></div>'),progress:e('<div class="progress"></div>')},void r.init(n)):(console.error("element is not found!"),!1)}}($),function(e){bimView.API={baseUrl:"",fetchModelId:"https://api.bimface.com/inside/databag?viewToken={token}",fetchModel:"https://m.bimface.com/",fetchFamilyType:"https://m.bimface.com/{etag}/metadata/familyInfo.json"}}($),function(e){bimView.model={model:function(e,t){var r=this,i=e,n=new r.BIM(i);return n},singleModel:function(t){var r=this,i=t,n=e('<div class="modelBar"></div>');e.each(r.singleBar,function(t,r){var i=e('<i class="bar-item '+r.icon+'" title="'+r.title+'" data-id="'+r.fn+'" data-type="'+r.type+'" data-group="'+r.group+'"></i>');bimView.comm.bindEvent.on(r.keyCode,i),n.append(i)}),i._dom.bimBox.append(n);var o=new r.BIM(i);return o.disableLoD(),o},familyModel:function(t){var r=this,i=t;bimView.comm.ajax({type:"get",url:bimView.API.fetchFamilyType,etag:i.etag},function(t){var r=JSON.parse(t),n=e('<div class="modelBar"><div class="modelSelect"><span class="cur"></span></div></div>'),o=e('<ul class="modelList"></ul>');i.callback&&i.callback(r.id),bimView.comm.filterData=[],e.each(r.types,function(t,r){var i=e('<li class="modelItem" data-id="'+r.id+'" data-type="familyType">'+r.name+"</li>");o.append(i),bimView.comm.filterData.push(r.id)}),n.find(".modelSelect").append(o),i._dom.bimBox.append(n),n.find(".modelItem:eq(0)").trigger("click")});var n=new r.BIM(i);return n.disableLoD(),n},comment:function(t){var r=this,i=e('<div class="commentBar"></div>');e.each(r.commentBar,function(t,r){var n;n=e(0==t?'<i class="bar-item '+r.icon+' selected" title="'+r.title+'" data-id="'+r.fn+'" data-type="'+r.type+'"></i>':'<i class="bar-item '+r.icon+'" title="'+r.title+'" data-id="'+r.fn+'" data-type="'+r.type+'"></i>'),bimView.comm.bindEvent.on(r.keyCode,n),i.append(n)}),t.append(i)},BIM:function(e){var t=this;return t.init(e)},dwg:function(e){new dwgViewer(e)},singleBar:[{id:"home",icon:"m-home",title:"Home(I)",fn:"home",keyCode:"72",type:"viewer"},{id:"zoom",icon:"m-zoom",title:"(Z)",fn:"zoom",keyCode:"122",type:"pattern"},{id:"fly",icon:"m-fly",title:"(Space)",fn:"fly",keyCode:"32",type:"pattern"}]},bimView.model.BIM.prototype={init:function(t){var r=t,i=new CloudViewer,n=e('<div class="view"></div>');return r.etag=r.etag+"/resource/model",r._dom.bimBox.append(n),i.init(n[0]),i.load(r.etag,bimView.API.baseUrl+bimView.API.fetchModel),i}}}($),function(e){bimView.prototype={on:function(e,t){return this.subscribers[e]?this.subscribers[e].push(t):(this.subscribers[e]=[])&&this.subscribers[e].push(t),'{"event":"'+e+'","fn":"'+(this.subscribers[e].length-1)+'"}'},pub:function(e,t){if(this.subscribers[e])for(var r=0,i=this.subscribers[e].length;i>r;r++)"function"==typeof this.subscribers[e][r]&&this.subscribers[e][r](t)},off:function(e){try{var t=JSON.parse(e);this.subscribers[t.event][t.fn]=null,delete this.subscribers[t.event][t.fn]}catch(r){console.log(r)}},init:function(e){var t=this,r=e;t.getModelId(r.token,function(e){r.etag=e.data.databagId,t.renderModel(r)})},renderModel:function(e){var t=this,r=e;switch(r.element.html(r._dom.bimBox),r.type){case"model":t.viewer=bimView.model.singleModel(r,t);break;case"singleModel":t.viewer=bimView.model.singleModel(r);break;case"familyModel":t.viewer=bimView.model.familyModel(r);break;case"dwg":t.viewer=bimView.model.dwg(r);break;default:t.viewer=bimView.model.singleModel(r)}"dwg"!=r.type&&t.regesiterEvent(r),t.controll(),bimView.comm.bindEvent.init(),t.pub("start")},getModelId:function(e,t){bimView.comm.ajax({
type:"get",url:bimView.API.fetchModelId,token:e},function(e){t&&t(e)})},regesiterEvent:function(e){var t=this,r=e,i={start:function(e){r._dom.loading.append(r._dom.progress),r._dom.bimBox.append(r._dom.loading)},loading:function(e){var i=e.progress.total,n=e.progress.loaded,o=n/i*100;r._dom.progress.width(o+"%"),100==o&&r._dom.loading.remove(),t.pub("loading",e)},loaded:function(e){t.viewer.render(),t.pub("loaded",e)},click:function(e){t.pub("click",e)}};t.on("start",i.start),t.viewer.registerEventListener(CLOUD.EVENTS.ON_SELECTION_CHANGED,i.click),t.viewer.registerEventListener(CLOUD.EVENTS.ON_LOAD_PROGRESS,i.loading),t.viewer.registerEventListener(CLOUD.EVENTS.ON_LOAD_COMPLETE,i.loaded)},controll:function(){var t=this;t._dom.bimBox.on("click",".bar-item",function(){var r=e(this),i=r.data("id"),n=r.data("group"),o=r.is(".selected"),a=r.data("type");switch(a){case"viewer":t[i]();break;case"pattern":r.toggleClass("selected"),r.closest(".toolsBar").length>0?r.closest(".toolsBar").find("[data-group="+n+"]").not(r).removeClass("selected"):r.siblings().removeClass("selected"),o?t.picker():t[i]();break;case"status":r.toggleClass("selected"),t[i](!o);break;case"selected":r.toggleClass("selected").siblings("[data-group="+n+"]").removeClass("selected"),i&&t[i]();break;case"filter":r.toggleClass("selected").siblings("[data-group="+n+"]").removeClass("selected"),bimView.sidebar[i](!o);break;case"more":r.toggleClass("selected"),bimView.sidebar[i](t),r.is(".selected")&&setTimeout(function(){e(document).one("click",function(){e(".m-more").removeClass("selected")})},10);break;case"change":r.toggleClass("m-miniScreen m-fullScreen"),e(bimView.sidebar.el._dom.sidebar).toggleClass("hideMap");break;case"comment":"exit"==i?t.commentEnd():(r.toggleClass("selected").siblings().removeClass("selected"),t.setCommentType(i));break;case"color":var s=bimView.model.colorBar,h=e('<div class="colorBar"></div>');e.each(s,function(t,r){var n=e('<i class="bar-item '+r.icon+'" title="'+r.title+'" data-id="'+r.fn+'" data-type="'+r.type+'" data-group="'+r.group+'"></i>');(i&&i==r.fn||!i&&0==t)&&n.addClass("selected"),h.append(n)});var a;h.on("click",".bar-item",function(){var t=e(this),r=t.data("id");a=r,t.addClass("selected").siblings().removeClass("selected")}),bimView.comm.dialog({title:"",content:h,callback:function(){r.attr("class","bar-item m-color "+a).data("id",a),bimView.comm.setModeBgColor(a),t._dom.bimBox.attr("class","bim "+a)}})}}).on("click",".modelSelect .cur",function(){var t=e(this);t.toggleClass("open")}).on("click",".modelItem",function(){var r=bimView.comm.filterData,i=e(this),n=i.parent(),o=i.data(),a=i.text(),s=n.prev(".cur");s.removeClass("open").text(a),"familyType"==o.type&&t.filter({type:"typeId",ids:bimView.comm.removeById(r,o.id)})}).on("click",".m-openTree,.m-closeTree",function(){var t=e(this),r=bimView.sidebar.classCodeData,i=t.closest(".itemNode"),n=i.data("type"),o=t.next().find("input").prop("checked");if(t.toggleClass("m-closeTree m-openTree"),i.toggleClass("open"),"classCode"==n&&0==i.has(".tree").length){var a=i.data();a.userData||(a.userData=null);var s=[];e.each(r,function(e,t){t.parentCode==a.userData&&s.push(t)});var h=bimView.comm.viewTree({arr:s,type:"classCode",name:"name",data:"code",children:"isChild",isChecked:o});i.append(h)}}).on("change","input",function(){var r,i=e(this),n=i.closest(".itemNode"),o=n.data("type"),a=i.parents(".itemNode"),s=i.prop("checked");if(n.find("input").prop("checked",s),"sceneId"==o){var r=bimView.comm.getFilters(t._dom.bimBox.find("#floors"),"ckecked"),h=bimView.comm.getFilters(t._dom.bimBox.find("#specialty"),"ckecked");r.ids=r.ids.concat(h.ids)}else r=bimView.comm.getFilters(a,"ckecked");t.filter(r)}).on("click",".treeText",function(){var r=e(this),i=r.closest(".itemNode"),n=r.is(".selected");i.data();i.find(".treeText").toggleClass("selected",!n);var o=bimView.comm.getFilters(i,"all");n?t.downplay(o):t.highlight(o)}).on("click",".axisGrid",function(){t.bigMap||(t.bigMap=e('<div id="map"></div>')),t.footer||(t.footer=e('<label class="dialogLabel">X<input type="text" class="dialogInput" id="axisGridX" /></label><label class="dialogLabel">Y<input type="text" class="dialogInput" id="axisGridY" /></label>'));var r=t.curFloorData;bimView.comm.dialog({title:"",content:t.bigMap,footer:t.footer,callback:function(){t.footer.find("#axisGridX").val(),t.footer.find("#axisGridY").val()}}),t.initMap({name:"bigMap",element:t.bigMap,enable:!1,callback:function(e){t.footer.find("#axisGridX").val(e.axis.abcName),t.footer.find("#axisGridY").val(e.axis.numeralName)}}),t.showAxisGrid("bigMap"),t.setFloorMap(r,"bigMap")}),e(window).on("resize",function(){t.resize()}),t.on("changeGrid",function(e){var r=t.curFloor,i="Z("+r+","+e.axis.offsetZ+")";bimView.sidebar.el._dom.mapBar.find(".axisGrid").text(e.axis.infoX+","+e.axis.infoY+","+i)})},resize:function(e,t){var r=this,i=r._dom.bimBox,n=e||i.width(),o=t||i.height();r.viewer.resize(n,o)},fit:function(){var e=this;e.pub("fit"),e.viewer.zoomToSelection()},zoom:function(){var e=this;e._dom.bimBox.find(".view").attr("class","view zoom"),e.pub("zoom"),e.viewer.setZoomMode()},zoomToBox:function(e){var t=this,r=t.viewer;r.zoomToBBox(CLOUD.Utils.computeBBox(e)),r.render()},fly:function(){var e=this;e._dom.bimBox.find(".view").attr("class","view fly"),e.pub("fly"),e.viewer.setFlyMode()},picker:function(){var e=this;e._dom.bimBox.find(".view").attr("class","view"),e.pub("picker"),e.viewer.setPickMode()},home:function(){var e=this;e.pub("home"),e.viewer.setStandardView(CLOUD.EnumStandardView.ISO)},markers:function(){var e=this,t=e.viewer;t.setMarkerMode(),t.editMarkerBegin()},markerEnd:function(){var e=this,t=e.viewer;t.editMarkerEnd(),t.setPickMode()},saveMarkers:function(){var t=this,r=t.viewer,i=r.getMarkerInfoList(),n=[];return e.each(i,function(e,t){n.push(JSON.stringify(t))}),n},loadMarkers:function(t){var r=this,i=r.viewer,n=[];e.each(t,function(e,t){n.push(JSON.parse(t))}),i.setMarkerMode(),i.loadMarkers(n)},comment:function(){var e=this,t=e.viewer;e._dom.bimBox.attr("class","bim comment"),t.setCommentMode(),t.editCommentBegin(),t.setCommentType("0"),bimView.model.comment(e._dom.bimBox)},commentEnd:function(){var e=this,t=e.viewer;e._dom.bimBox.attr("class","bim"),e._dom.bimBox.find(".commentBar").remove(),t.editCommentEnd(),t.setPickMode()},setCommentType:function(e){var t=this,r=t.viewer;r.setCommentType(e)},saveComment:function(){var t=this,r=t.viewer,i=r.getCommentInfoList(),n=[];e.each(i,function(e,t){n.push(window.btoa(JSON.stringify(t)))});var o=bimView.comm.getFilters(e("#floors"),"ckecked"),a=bimView.comm.getFilters(e("#specialty"),"ckecked"),s=bimView.comm.getFilters(e("#category"),"ckecked"),h=bimView.comm.getFilters(e("#classCode"),"ckecked");return{camera:t.getCamera(),list:n,image:r.canvas2image().substr(22),filter:{floors:o,specialty:a,category:s,classCode:h}}},loadComment:function(t){var r=this,i=r.viewer,n=[];e.each(t.list,function(e,t){n.push(JSON.parse(window.atob(t)))}),t.filter.floors.ids=t.filter.floors.ids.concat(t.filter.specialty.ids),r.filter(t.filter.floors),r.filter(filter.category),r.filter(filter.classCode),i.setCommentMode(),i.loadComments(n)},filter:function(t){var r=this,i=r.viewer,n=i.getFilters();n.removeUserFilter(t.type),e.each(t.ids,function(e,r){n.addUserFilter(t.type,r)}),i.render()},highlight:function(t){var r=this,i=r.viewer,n=i.getFilters();"userId"==t.type?n.setOverriderByUserIds("highlight",t.ids):e.each(t.ids,function(e,r){n.setUserOverrider(t.type,r)}),i.render()},downplay:function(t){var r=this,i=r.viewer,n=i.getFilters();"userId"==t.type?n.setOverriderByUserIds("highlight",[]):e.each(t.ids,function(e,r){n.removeUserOverrider(t.type,r)}),i.render()},collision:function(e,t){var r=this,i=r.viewer,n=i.getFilters();n.setOverriderByUserIds("collisionA",[e],"darkRed"),n.setOverriderByUserIds("collisionB",[t],"lightBlue"),i.render()},translucent:function(e){var t=this,r=t.viewer,i=r.getFilters();i.enableSceneOverrider(e),r.render()},getTranslucentStatus:function(){var e=this,t=e.viewer,r=t.getFilters();return r.isSceneOverriderEnabled()},initMap:function(t){var r={element:"",name:"defaultMap",axisGrid:"",enable:!0,callback:null},i=e.extend({},r,t),n=this,o=n.viewer,a=i.element,s=a.width(),h=a.height(),c={left:"0px",bottom:"0px",outline:"none"};i.axisGrid&&o.setAxisGridData(i.axisGrid),o.createMiniMap(i.name,a[0],s,h,c,function(e){i.callback&&i.callback.call(this,e)}),o.enableAxisGridEvent(i.name,i.enable),o.generateAxisGrid(i.name)},setAxisGrid:function(e,t,r){var i=this.viewer;i.flyBypAxisGridNumber(e,t,r)},setFloorMap:function(e,t){var r=this.viewer;r.setFloorPlaneData(e),r.generateFloorPlane(t)},showAxisGrid:function(e){var t=this.viewer;t.showAxisGrid(e,!0)},load:function(e){var t=this.viewer,r=t.load(e,bimView.API.baseUrl+bimView.API.fetchModel);return t.render(),r},showScene:function(e,t){var r=this.viewer;r&&r.showScene&&(r.showScene(e,t),r.render())},getCamera:function(){var e=this.viewer;return window.btoa(e.getCamera())},setCamera:function(e){var t=this.viewer;t.setCamera(window.atob(e))},commentInit:function(){console.log(e("#comment"))}}}($),function(e){bimView.comm={ajax:function(t,r){return t=bimView.comm.getUrl(t),e.ajax(t).done(function(t){e.isFunction(r)&&r(t)})},getUrl:function(e){var t=e,r=e.url.match(/\{([\s\S]+?(\}?)+)\}/g);if(r)for(var i=0;i<r.length;i++){var n=r[i],o=n.replace(/[{|}]/g,""),a=e[o];t.url=t.url.replace(n,a)}return t.url=t.url,t},removeById:function(e,t){var r=e.concat(),i=r.indexOf(t);return r.splice(i,1),r},getFilters:function(t,r){var i=t.data("type"),n=0==t.find(".itemNode").length?t:t.find(".itemNode"),o={type:i,ids:[]};if("classCode"==i){var a=[],s=bimView.sidebar.classCodeData;e.each(n,function(t,i){var n=e(i),o=n.find("input").prop("checked"),s=n.data("userData")?n.data("userData").toString():"";("ckecked"==r&&!o||"all"==r)&&a.push(s)});var h=a.toString().replace(/,/g,"|"),c=new RegExp("^("+h+")");e.each(s,function(e,t){0!=a.length&&(-1==t.parentCode&&-1!=a.indexOf("-1")&&o.ids.push(t.code),c.test(t.code)&&o.ids.push(t.code))})}else e.each(n,function(t,i){var n=e(i),a=n.find("input").prop("checked"),s=n.data("userData")?n.data("userData").toString().split(","):[];("ckecked"==r&&!a||"all"==r)&&(o.ids=o.ids.concat(s))});return o},bindEvent:{sub:{},on:function(e,t){this.sub[e]?this.sub[e].push(t):(this.sub[e]=[])&&this.sub[e].push(t)},pub:function(e){if(this.sub[e])for(var t=0,r=this.sub[e].length;r>t;t++)this.sub[e][t].click()},keyPress:function(e){var e=e||event,t=e.keyCode||e.which||e.charCode;bimView.comm.bindEvent.pub(t)},keyboardEvent:function(){var t=this;e(document).on("keypress",t.keyPress)},removeEvent:function(){e(document).off("keypress",self.keyPress)},init:function(){this.keyboardEvent()}},viewTree:function(t){function r(t,i,o,a){if(0!=t.length){var s=e('<div class="tree"></div>');return e.each(t,function(t,h){var c,l,u,d,m=n.type;"arr"==o?(c=h[i],l=h[n.data]?h[n.data].toString():""):(c=h,l=null!=a?a+"_"+t:t),u=h[n.children]?"m-openTree":"noneSwitch",d=n.isChecked?'<input type="checkbox" checked="checkde" />':'<input type="checkbox" />';var p=e('<li class="itemNode" data-type="'+m+'">            <div class="itemContent">            <i class="'+u+'"></i>            <label class="treeCheckbox">'+d+'<span class="m-lbl"></span></label>            <span class="treeText">'+c+"</span>          </div></li>");if(p.data("userData",l),h[n.children]&&"object"==typeof h[n.children]){var E=r(h[n.children],n.childrenName,n.childrenType,h[n.code]);p.append(E)}s.append(p)}),s}}var i={arr:[],name:"",code:"",type:"",dataType:"arr",children:"",childrenName:"",childrenType:"arr",data:"",id:"",isChecked:!0},n=e.extend({},i,t);return r(n.arr,n.name,n.dataType)},dialog:function(t){var r={title:"",content:"",okText:"",callback:null},i=e.extend({},r,t),n=e('<div class="modelDialog"><div class="dialogBody"><div class="dialogHeader">'+i.title+'<span class="dialogClose"></span></div><div class="dialogContent"></div><div class="dialogFooter"><input type="button" class="dialogOk dialogBtn" value="'+i.okText+'"/></div></div></div>');n.find(".dialogContent").append(i.content),n.find(".dialogFooter").prepend(i.footer),e("body").append(n),n.on("click",".dialogClose",function(){n.remove()}).on("click",".dialogOk",function(){i.callback&&i.callback.call(this)!==!1&&n.remove()})}}}($);var dwgViewer=function(t){var r=this,i={element:"",maxLevel:11,ext:"jpg",etag:""};r._opt=$.extend({},i,t);var n="https://m.bimface.com/"+r._opt.etag+"/manifest.json";$.ajax({url:n,success:function(e){var t=JSON.parse(e);t.Views&&o(t.Views)}});var o=function(e){var t=[],i=$(".bim");$.each(e,function(e,r){t.push({name:r.Name,id:r.ID,res:r.Representations})}),r._opt.element.append(i),r.addControll(t,i)},a=r.dwgView={__container:null,__options:null,__unit:512,__state:"none",__rect:null,__defaultTileURL:"//static.glodon.com/yun/resources/images/databag/tile-default.jpg",__curLevel:1,__zoomFact:1.6,__zoomScale:1,__canMove:!1,__startPos:null,__startPoint:null,__endPoint:null,__startDistance:null,__endDistance:null,__startScale:null,__moveLevel:null,__viewWidth:0,__viewHeight:0,__viewLeft:0,__viewTop:0,__sceneInViewPoint:{},__mouseInViewPoint:{left:0,top:0},__imgObjCache:[],__zoomStart:null,__zoomDelta:800,__zoomTimer:null,__pinchStart:null,__pinchDelta:2e3,__pinchTimer:null,init:function(e,t){var r=this;r.__container=e,r.__options=$.extend({lod:{maxLevel:11,ext:"",url:""}},t),r.__panel&&r.__panel.remove(),r.__panel=$(r.__tpl).appendTo(r.__container),r.__rect=r.__panel.find(".rect"),r.__viewWidth=e.width(),r.__viewHeight=e.height();var i=r.__options.lod;r.__firstImgUrl=i.url+"/L1/Model_0_0."+i.ext,r.fit(),r.__bindEvent()},getPanel:function(){return this.__panel},setState:function(e){this.__state=e},getViewInfo:function(){var e=this,t=e.__zoomScale,r=e.__unit;return{view:{width:e.__viewWidth,height:e.__viewHeight,top:e.__viewTop,left:e.__viewLeft},scene:{width:r*t,height:r*t,scale:e.__zoomScale}}},windowResize:function(){var e=this,t=e.__container;e.__viewWidth=t.width(),e.__viewHeight=t.height(),e.zoom(e.__zoomScale)},drawRect:function(e,t){var r=this;r.__rect.css({width:e,height:t})},rectZoom:function(){var e=this,t=e.__rect;if(t.is(":hidden"))return!1;var r=t.position(),i=e.__viewWidth,n=e.__viewHeight,o=t.width(),a=t.height(),s=e.__zoomScale,h=1;if(10>o||10>a)return t.css({width:0,height:0}).hide(),!1;h=i/n>o/a?n/a:i/o,s*=h;var c={top:r.top+a/2,left:r.left+o/2};t.css({width:0,height:0}).hide(),e.zoom(s,c)},pan:function(e,t){var r=this;r.__panel;r.__viewLeft=r.__startPos.left-e,r.__viewTop=r.__startPos.top-t,r.__resetSceneInViewPoint(),r.__changeViewPos()},zoomIn:function(e){var t=this,r=t.__zoomScale*t.__zoomFact;t.zoom(r,e)},zoomOut:function(e){var t=this,r=t.__zoomScale/t.__zoomFact;t.zoom(r,e)},fit:function(){var e=this;e.__curLevel=1,e.__zoomScale=1,e.__viewLeft=0,e.__viewTop=0,e.__viewPoint(),e.__genTiles()},zoom:function(e,t){var r=this,i=r.__panel,n=r.__options,o=i.find(".view"),a=r.__unit,s=r.__curLevel,h=n.lod,c=r.__minisite;if(1>=e)e=1,s=1;else var l=Math.log(e)/Math.log(2),s=parseInt(l,10)+2;if(s>=h.maxLevel){var u=Math.pow(2,h.maxLevel-1);e>=u&&(e=u),s=h.maxLevel}var d=e/r.__zoomScale;if(o.find(".tile").each(function(){var e=$(this),t=e.data("level"),i=r.__zoomScale/Math.pow(2,t-1);e.css({width:a*i*d,height:a*i*d})}),!c&&e<r.__zoomScale){var m=$('<img class="tile" data-row="0" data-col="0" data-level="1" src="'+r.__firstImgUrl+'" />').css({width:a*e,height:a*e,"z-index":0});o.append(m)}if(t?r.__mouseInViewPoint=t:r.__mouseInViewPoint={left:r.__viewWidth/2,top:r.__viewHeight/2},r.__resetSceneInViewPoint(),r.__zoomScale=e,r.__viewPoint(!0),c)return void(r.__moveLevel=s);r.__curLevel=s,r.__stateChange();var p=r.__zoomStart,E=r.__zoomDelta,f=new Date;window.clearTimeout(r.__zoomTimer),p?f.getTime()-p.getTime()>=E?r.__zoomEvent():r.__zoomTimer=window.setTimeout(function(){r.__zoomEvent()},E):p=new Date,r.__zoomStart=p},__zoomEvent:function(){var e=this;e.__genTiles(),e.__viewPoint(!0),e.__zoomStart=null},__removeLast:function(){var e=this,t=e.__panel.find(".view");t.find(".tile.past").remove()},__bindEvent:function(){var e=this,t=e.__panel,r=e.__rect,i=e.__zoomScale;$(window).resize(function(){e.windowResize()}),t.mousedown(function(n,o){var a=e.__state;i=e.__zoomScale,n=o||n,e.__canMove=!0,t.css({cursor:"pointer"});var o=e.__startPoint=e.__getEventPoint(n);if(e.__startPos={top:e.__viewTop,left:e.__viewLeft},"rectzoom"==a){var s=e.__container.offset();r.css({top:o.y-s.top,left:o.x-s.left}).show()}return!1}).mouseup(function(r){var i=e.__state;switch(e.__canMove=!1,t.css({cursor:"default"}),e.__startPoint=null,e.__endPoint=null,i){case"none":e.__stateChange(),e.__genTiles();break;case"rectzoom":e.rectZoom()}return!1}).mouseleave(function(e){$(this).trigger("mouseup")}).mousemove(function(t){var r=e.__state;if(!e.__canMove)return!1;var n=e.__endPoint=e.__getEventPoint(t),o=e.__startPoint,a=n.x-o.x,s=n.y-o.y;if(Math.abs(a)>10||Math.abs(s)>10)switch(r){case"none":e.pan(a,s);break;case"rectzoom":e.drawRect(a,s);break;case"zoom":if(s>20||-20>s){var h=-s/200+i;h=1>h?1:h,e.zoom(h)}}return!1}),t.on("mousewheel DOMMouseScroll",function(t,r){"object"==typeof r&&(t=r),e.__wheelEvent(t),t.preventDefault()})},__wheelEvent:function(t){var r=this,i=e.originalEvent.wheelDelta&&(e.originalEvent.wheelDelta>0?1:-1)||e.originalEvent.detail&&(e.originalEvent.detail>0?-1:1),n=r.__zoomScale,o=n-i/4;r.zoom(o)},__viewPoint:function(e){var t=this,r=t.__unit,i=t.__zoomScale,n=t.__viewWidth,o=t.__viewHeight,a=r*i,s=a;if(!e)return t.__viewLeft=(a-n)/2,t.__viewTop=(s-o)/2,t.__mouseInViewPoint={left:n/2,top:o/2},t.__resetSceneInViewPoint(),t.__changeViewPos(),!1;var h=t.__viewLeft,c=t.__viewTop,l=t.__sceneInViewPoint,u=t.__mouseInViewPoint,d=i*r*l.left,m=i*r*l.top;h=d-u.left,c=m-u.top,t.__viewLeft=h,t.__viewTop=c,t.__changeViewPos()},__changeViewPos:function(){var e=this,t=e.__panel,r=e.__zoomScale,i=(e.__curLevel,e.__unit),n=t.find(".view"),o=e.__viewLeft,a=e.__viewTop,s=e.__viewHeight/2+a,h=e.__viewWidth/2+o;n.css({top:s,left:h});var c=t.find(".scene");c.css({top:-a,left:-o}),n.find(".tile").each(function(e,t){var t=$(t),n=i*r/Math.pow(2,t.data("level")-1),o=t.data("col"),a=t.data("row"),c=a*n-s,l=o*n-h;t.css({top:c,left:l})})},__genTiles:function(){function e(e,r){if(r)return!1;l===c&&a.find(".tile.past").remove();var n=$('<img class="tile" data-row="'+e.row+'" data-col="'+e.col+'" data-level="'+e.level+'" src="'+e.src+'" style="top:'+e.top+"px;left:"+e.left+'px;" />');a.append(n);var o=t.__unit,s=i/Math.pow(2,t.__curLevel-1);n.css({width:o*s,height:o*s})}var t=this,r=t.__curLevel,i=t.__zoomScale,n=t.__panel,o=t.__options,a=n.find(".view"),s=t.__getShowTiles(r,t.__viewLeft,t.__viewTop,t.__viewWidth,t.__viewHeight,o.lod.maxLevel),h=a.find(".tile");h.addClass("past");var c=s.length,l=0;$.each(s,function(r,i){var n=new Image;n.onload=function(){l++,e(i,this.stateChange)},n.onerror=function(){i.src=t.__defaultTileURL,l++,e(i,this.stateChange)},n.onabort=function(){i.src=t.__defaultTileURL,l++,e(i,this.stateChange)},n.src=i.src,t.__imgObjCache.push(n)})},__resetSceneInViewPoint:function(){var e=this,t=e.__unit,r=e.__zoomScale,i=e.__viewLeft,n=e.__viewTop,o=e.__sceneInViewPoint,a=e.__mouseInViewPoint;o.left=(i+a.left)/(t*r),o.top=(n+a.top)/(t*r)},__getShowTiles:function(e,t,r,i,n,o){var a=this,s=a.__options.lod.url,h=a.__options.lod.ext,c=[],l=a.__unit*a.__zoomScale/Math.pow(2,a.__curLevel-1),u={row:parseInt(r/l,10),col:parseInt(t/l,10)},d=1,m=l-t%l;for(0===m&&(m+=l);i>m;)m+=l,d++;var p=1,E=l-r%l;for(0===E&&(E+=l);n>E;)E+=l,p++;for(var f=t+i/2,T=r+n/2,v=Math.pow(2,e-1),g=0;p>g;g++){var y=u.row+g;if(!(y>=v||0>y))for(var R=0;d>R;R++){var _=u.col+R;_>=v||0>_||c.push({row:y,col:_,src:s+"/L"+e+"/Model_"+y+"_"+_+"."+h,top:y*l-T,left:_*l-f,level:a.__curLevel})}}return c},__stateChange:function(){var e=this,t=e.__imgObjCache;$.each(t,function(e,t){t.stateChange=!0}),e.__imgObjCache=[]},__getEventPoint:function(e){var t={x:e.clientX||e.pageX||e.originalEvent&&(e.originalEvent.clientX||e.originalEvent.pageX),y:e.clientY||e.pageY||e.originalEvent&&(e.originalEvent.clientY||e.originalEvent.pageY),offsetX:e.offsetX||e.originalEvent&&e.originalEvent.layerX,offsetY:e.offsetY||e.originalEvent&&e.originalEvent.layerY};return t},__showInfo:function(e){var t=this;t.debugPanel.html(t.debugPanel.html()+"<br/>"+e).scrollTop(t.debugPanel[0].scrollHeight)}};a.__tpl='<div class="mod-dwg">    <div class="scene">        <div class="view"></div>    </div>    <div class="rect"></div></div>'};dwgViewer.prototype={render:function(e,t){var r,i=this;$.each(e,function(e,t){return"image/tiles"==t.MIME?r=t:void 0}),i.dwgView.init(t,{lod:{maxLevel:parseInt(r.Attributes.DwgLevel,10),ext:r.Attributes.DwgExt||"jpg",url:"https://m.bimface.com/"+i._opt.etag+"/"+r.Path}})},fit:function(){var e=this;e.dwgView.fit()},pan:function(){var e=this;e.dwgView.setState("none")},zoom:function(){var e=this;e.dwgView.setState("zoom")},zoomIn:function(){var e=this;e.dwgView.zoomIn()},zoomOut:function(){var e=this;e.dwgView.zoomOut()},rectZoom:function(){var e=this;e.dwgView.__state;e.dwgView.setState("rectzoom")},addControll:function(e,t){var r=this,i=$('<ul class="modelList"></ul>');$.each(e,function(e,t){var r=$('<li class="modelItem"></li>').text(t.name).data(t.res);i.append(r),0==e&&r.trigger("click")});var n=$('<div class="modelBar">  <i class="bar-item m-fit2d" data-fn="fit"></i>  <i class="bar-item m-zoom" data-fn="zoom"></i>  <i class="bar-item m-zoomRect" data-fn="rectZoom"></i>  <div class="modelSelect">    <span class="cur"></span>  </div></div>');n.find(".modelSelect").append(i),t.append(n),n.on("click",".modelSelect .modelItem",function(){var e=$(this),i=e.text(),n=e.parent().prev(),o=e.data();r.render(o,t),n.text(i).removeClass("open")}).on("click",".bar-item",function(){var e=$(this),t=e.data("fn");e.is(".m-fit2d")?r[t]():(e.toggleClass("selected").siblings().removeClass("selected"),e.is(".selected")?r[t]():r.pan())}),n.find(".modelItem:last").trigger("click")}};